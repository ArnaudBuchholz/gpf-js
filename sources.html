<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <title>GPF-JS</title>
        <link rel="stylesheet" type="text/css" href="res/html.css">
        <link rel="stylesheet" type="text/css" href="res/table.css">
        <script language="JavaScript" src="build/gpf.js"></script>
        <script language="JavaScript" src="res/xhr.js"></script>
        <script language="JavaScript" src="res/console.js"></script>
        <script language="JavaScript">

function onLoad () {

    function getRowTemplate () {
        var tplRow = document.getElementById("tpl_row"),
            tplHtml = tplRow.innerHTML,
            parent = tplRow.parentNode,
            reMember = /{([a-zA-Z_][a-zA-Z_0-9]*)}/,
            reExpression = /{% ([^%]*) %}/;

        function process (html, regexp, getValue) {
            var result = html,
                match;
            regexp.lastIndex = 0;
            match = regexp.exec(result);
            while (match) {
                result = result.replace(match[0], getValue(match) || "&nbsp;");
                regexp.lastIndex = 0;
                match =  regexp.exec(result);
            }
            return result;
        }

        return function (sourceItem, itemIndex) {
            var html;
            html = process(tplHtml, reMember, function (match) {
                return sourceItem[match[1]];
            });
            html = process(html, reExpression, function (match) {
                return new Function (match[1]).call(sourceItem).toString();
            });
            tplRow.innerHTML = html;
            parent.appendChild(document.importNode(tplRow.content, true));
        }
    }

    xhrGet("src/sources.json").then(function (responseText) {
        JSON.parse(responseText).forEach(getRowTemplate());
    });
}

        </script>
    </head>
    <body onload="onLoad()">
        <table>
            <thead>
                <th>Name</th>
                <th>Description</th>
                <th>Load</th>
                <th>Test</th>
            </thead>
            <body>
                <template id="tpl_row">
                    <tr>
                        <td>{name}</td>
                        <td>{description}</td>
                        <td><input type="checkbox" checked="{% if (undefined === this.load) { return true; } else return this.load %}"></td>
                        <td><input type="checkbox" checked="{% if (undefined === this.test) { return true; } else return this.test %}"></td>
                    </tr>
                </template>
            </body>
        </table>
    </body>
</html>
