<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <title>GPF-JS</title>
        <link rel="stylesheet" type="text/css" href="res/html.css">
        <link rel="stylesheet" type="text/css" href="res/table.css">
        <script language="JavaScript" src="build/gpf.js"></script>
        <script language="JavaScript" src="res/xhr.js"></script>
        <script language="JavaScript" src="res/tpl.js"></script>
        <script language="JavaScript">

function wrap (item) {
    var result = Object.create(item);
    if (undefined === result.load) {
        result.load = true;
    }
    if (undefined === result.test && result.load) {
        result.test = true;
    }
    return result;
}

function onLoad () {
    xhrGet("src/sources.json").then(function (responseText) {
        var tplRow = document.getElementById("tpl_row"),
            tplFunc = tplRow.buildFactory(),
            parent = tplRow.parentNode;
        JSON.parse(responseText).forEach(function (item, index) {
            parent.appendChild(tplFunc(wrap(item), index));
        });
    });
}

        </script>
    </head>
    <body onload="onLoad()">
        <table>
            <thead>
                <th>Name</th>
                <th>Description</th>
                <th>Load</th>
                <th>Test</th>
                <th>Doc</th>
            </thead>
            <body>
                <template id="tpl_row">
{%
    function check(a, b) {
        if ($object[a] && (b === undefined || $object[b])) {
            $write("checked");
        }
    }
%}
                    <tr>
                        <td>{{name}}</td>
                        <td>{{description}}</td>
                        <td><input type="checkbox" {%%}="check('load');"></td>
                        <td><input type="checkbox" {%%}="check('load', 'test');"></td>
                        <td><input type="checkbox" {%%}="check('doc');"></td>
                    </tr>
                </template>
            </body>
</table>
    </body>
</html>
