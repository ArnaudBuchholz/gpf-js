<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>GPF-JS logo</title>
    <script language="JavaScript">
        var gpfSourcesPath = "../src/";
    </script>
    <script language="JavaScript" src="../src/boot.js"></script>
    <script language="JavaScript">

var COLS = 10,
    ROWS = 10;

function onLoad() {
    var svg = document.getElementById("svg"),
        path = gpf.web.createTagFunction("svg:path"),
        x,
        y = 2,
        rows = ROWS,
        cols,
        d;

    while (rows--) {
        x = 1;
        d = ["M", x, y];
        cols = COLS;
        while (cols--) {
            d.push("L", x, y, "L", x + 1, y - 1, "L", x + 2, y - 1, "L", x + 3, y);
            x += 4;
        }
        cols = COLS;
        --x;
        while (cols--) {
            d.push("L", x, y, "L", x - 1, y + 1, "L", x - 2, y + 1, "L", x - 3, y);
            x -= 4;
        }
        path({
            fill: "none",
            stroke: "black",
            "stroke-width": .1,
            d: d.join(" ")
        }).appendTo(svg);
        y += 2;
    }

    function Path (x, y) {
        if (undefined !== x && undefined !== y) {
            this._refX = x;
            this._refY = y;
        }

        this._d = [];
    }

    Path.prototype = {

        _refX: 0,
        _refY: 0,
        _d: [],

        _at: function (x, y) {
            if (0 == this._refX % 2 && x % 2) {
                --y;
            }
            var absX = this._refX + x,
                svgX = 2.5 + 2 * absX,
                svgY = 2 + 2 * (this._refY + y) + absX % 2;
            return svgX + " " + svgY;
        },

        m: function (x, y) {
            this._d.push("M", this._at(x, y));
            return this;
        },

        l: function (x, y) {
            this._d.push("L", this._at(x, y));
            return this;
        },

        toString: function () {
            return this._d.join(" ");
        }

    };

    function g (x, y, color) {
        color = color || "red";
        return path({
            fill: "none",
            stroke: color,
            "stroke-width": 1,
            d: (new Path(x, y))
                .m(0, 0).l(1, 1).l(2, 0).l(2, -4).l(1, -4).l(0, -4).l(0, -3).l(1, -2)
                .toString()
        });
    }

    function p (x, y, color) {
        color = color || "red";
        return path({
            fill: "none",
            stroke: color,
            "stroke-width": 1,
            d: (new Path(x, y))
                .m(0, 0).l(0, -3).l(1, -3).l(2, -3).l(2, -2).l(1, -1)
                .toString()
        })
    }

    function f (x, y, color) {
        color = color || "red";
        return path({
            fill: "none",
            stroke: color,
            "stroke-width": 1,
            d: (new Path(x, y))
                .m(0, 0).l(1, 1).l(2, 0).l(2, -4).l(3, -4).l(4, -4)
                .m(1, -1).l(3, -2)
                .toString()
        })
    }

    g(1, 6).appendTo(svg);
    p(4, 6).appendTo(svg);
    f(5, 6).appendTo(svg);

    path({
        fill: "none",
        stroke: "black",
        "stroke-width": .2,
        d: "M 2 5 L 3 5 L 4 4 L 5 4 L 6 3 L 7 3 L 8 4 L 9 4 L 10 3 L 11 3 L 12 4 L 13 4 L 14 5 L 15 5"
            + "L 16 4 L 17 4 L 18 3 L 19 3 L 20 4 L 21 4 L 22 5 L 23 5 "
    }).appendTo(svg);

}

document/*.getElementById("svg")*/.addEventListener("mousemove", function (e) {
    var svg = document.getElementById("svg"),
        svgRect = svg.getBoundingClientRect(),
        svgViewBox = svg.getAttribute("viewBox").split(" "),
        svgViewWidth = parseInt(svgViewBox[2], 10),
        svgViewHeight = parseInt(svgViewBox[3], 10),
        svgScaleX = svgRect.width / svgViewWidth,
        svgScaleY = svgRect.height / svgViewHeight,
        y = e.clientY - svgRect.top,
        svgX = Math.floor(e.clientX / svgScaleX),
        svgY = Math.floor(y / svgScaleY);
//        row = svgRect.height / ;

    document.getElementById("info").innerHTML = [
        "svgX: ", svgX,
        ", svgY: ", svgY,

    ].join("");

});

    </script>
</head>
<body onload="onLoad()">
    <svg id="svg" width="100%" height="100%" viewBox="0 0 40 40">
    </svg>
    <div id="info">
    </div>
</body>
</html>
