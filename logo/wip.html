<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>GPF-JS logo</title>
    <script language="JavaScript">
        var gpfSourcesPath = "../src/";
    </script>
    <script language="JavaScript" src="../src/boot.js"></script>
    <script language="JavaScript">

function onLoad() {
    var svg = document.getElementById("svg"),
        path = gpf.web.createTagFunction("svg:path");

//    path({
//        fill: "none",
//        stroke: "red",
//        "stroke-width": .2,
//        d: "M 6 5 L 7 5 L 8 4 L 9 4 L 10 3 L 11 3 L 12 4 L 13 4 L 14 5 L 15 5 L 16 4 L 17 4 L 18 5 L 19 5"
//        + "L 20 4 L 21 4 L 22 3 L 23 3 L 24 4 L 25 4 L 26 5 L 27 5 L 28 6 L 27 7 L 28 8 L 27 9 L 26 9"
//        + "L 25 10 L 26 11 L 25 12 L 24 12 L 23 13 L 24 14 L 23 15 L 24 16 L 23 17 L 22 17 L 21 18"
//        + "L 20 18 L 19 19 L 18 19 L 17 18 L 16 18 L 15 17 L 14 17 L 13 18 L 12 18 L 11 19 L 10 19"
//        + "L 9 18 L 8 18 L 7 17 L 6 17 L 5 16 L 6 15 L 5 14 L 6 13 L 7 13 L 8 12 L 7 11 L 6 11 L 5 10"
//        + "L 6 9 L 5 8 L 6 7 L 5 6 L 6 5"
//        + "M 17 2 L 18 1 L 19 1 L 20 2 L 19 3 L 18 3 L 17 2"
//        + "M 1 12 L 2 11 L 3 11 L 4 12 L 3 13 L 2 13 L 1 12"
//        + "M 27 11 L 28 10 L 29 10 L 30 11 L 29 12 L 30 13 L 29 14 L 28 14 L 27 15 L 26 15 L 25 14 L 26 13"
//        + "L 27 13 L 28 12 L 27 11"
//    }).appendTo(svg);

    var WIDTH = 14,
        HEIGHT = 9,
        grid = new Array(WIDTH * HEIGHT);
    function fill (y, fromX, toX) {
        x = toX || fromX;
        while (x >= fromX) {
            grid[y * WIDTH + x--] = true;
        }
    }
    fill(0, 8);
    fill(1, 3, 5);
    fill(1, 7);
    fill(1, 9, 11);
    fill(2, 2, 12);
    fill(3, 2, 12);
    fill(4, 2, 11);
    fill(4, 13);
    fill(5, 0);
    fill(5, 3, 10);
    fill(5, 13);
    fill(6, 2, 10);
    fill(6, 12);
    fill(7, 2, 10);
    fill(8, 4);
    fill(8, 8);

    var limits = [];

    for (y = 0; y < HEIGHT; ++y) {
        for (x = 0; x < WIDTH; ++x) {
            if (grid[y * WIDTH + x]) {
                var x0 = 1 + x * 2,
                    y0 = 2 + y * 2 + x % 2;
                path({
                    fill: "none",
                    stroke: "black",
                    "stroke-width": .1,
                    d: ["M", x0, y0, "L", x0 + 1, y0 - 1, "L", x0 + 2, y0 - 1, "L", x0 + 3, y0,
                        "L", x0 + 2, y0 + 1, "L", x0 + 1, y0 + 1, "L", x0, y0].join(" ")
                }).appendTo(svg);
                if (0 === y || !grid[(y - 1) * WIDTH + x]) {
                    limits.push("M", x0 + 1, y0 - 1, "L", x0 + 2, y0 - 1);
                }
                if (0 === x) {
                    limits.push("M", x0, y0, "L", x0 + 1, y0 - 1);
                    limits.push("M", x0, y0, "L", x0 + 1, y0 + 1);
                } else {
                    if (0 < y && !grid[(y - 1) * WIDTH + x - 1]) {
                        limits.push("M", x0, y0, "L", x0 + 1, y0 - 1);
                    }
                    if (HEIGHT > y && !grid[(y + 1) * WIDTH + x - 1]) {
                        limits.push("M", x0, y0, "L", x0 + 1, y0 + 1);
                    }
                }
                if (WIDTH - 1 === x) {
                    limits.push("M", x0 + 3, y0, "L", x0 + 2, y0 - 1);
                    limits.push("M", x0 + 3, y0, "L", x0 + 2, y0 + 1);
                }
                if (HEIGHT - 1 === y || !grid[(y + 1) * WIDTH + x]) {
                    limits.push("M", x0 + 1, y0 + 1, "L", x0 + 2, y0 + 1);
                }
            }
        }
    }
    path({
        fill: "none",
        stroke: "red",
        "stroke-width": .2,
        d: limits.join(" ")
    }).appendTo(svg);


    function Path (x, y) {
        if (undefined !== x && undefined !== y) {
            this._refX = x;
            this._refY = y;
        }

        this._d = [];
    }

    Path.prototype = {

        _refX: 0,
        _refY: 0,
        _d: [],

        _at: function (x, y) {
            if (0 == this._refX % 2 && x % 2) {
                --y;
            }
            var absX = this._refX + x,
                svgX = 2.5 + 2 * absX,
                svgY = 2 + 2 * (this._refY + y) + absX % 2;
            return svgX + " " + svgY;
        },

        m: function (x, y) {
            this._d.push("M", this._at(x, y));
            return this;
        },

        l: function (x, y) {
            this._d.push("L", this._at(x, y));
            return this;
        },

        toString: function () {
            return this._d.join(" ");
        }

    };

    function g (x, y, color) {
        color = color || "red";
        return path({
            fill: "none",
            stroke: color,
            "stroke-width": 1,
            d: (new Path(x, y))
                .m(0, 0).l(1, 1).l(2, 0).l(2, -4).l(1, -4).l(0, -4).l(0, -3).l(1, -2)
                .toString()
        });
    }

    function p (x, y, color) {
        color = color || "red";
        return path({
            fill: "none",
            stroke: color,
            "stroke-width": 1,
            d: (new Path(x, y))
                .m(0, 0).l(0, -3).l(1, -3).l(2, -3).l(2, -2).l(1, -1)
                .toString()
        })
    }

    function f (x, y, color) {
        color = color || "red";
        return path({
            fill: "none",
            stroke: color,
            "stroke-width": 1,
            d: (new Path(x, y))
                .m(0, 0).l(1, 1).l(2, 0).l(2, -4).l(3, -4).l(4, -4)
                .m(1, -1).l(3, -2)
                .toString()
        })
    }

    g(3, 6).appendTo(svg);
    p(6, 6).appendTo(svg);
    f(7, 6).appendTo(svg);

}

document/*.getElementById("svg")*/.addEventListener("mousemove", function (e) {
    var svg = document.getElementById("svg"),
        svgRect = svg.getBoundingClientRect(),
        svgViewBox = svg.getAttribute("viewBox").split(" "),
        svgViewWidth = parseInt(svgViewBox[2], 10),
        svgViewHeight = parseInt(svgViewBox[3], 10),
        svgScaleX = svgRect.width / svgViewWidth,
        svgScaleY = svgRect.height / svgViewHeight,
        y = e.clientY - svgRect.top,
        svgX = Math.floor(e.clientX / svgScaleX),
        svgY = Math.floor(y / svgScaleY);
//        row = svgRect.height / ;

    document.getElementById("info").innerHTML = [
        "svgX: ", svgX,
        ", svgY: ", svgY,

    ].join("");

});

    </script>
</head>
<body onload="onLoad()">
    <svg id="svg" width="100%" height="50%" viewBox="0 0 40 20">
    </svg>
    <div id="info">
    </div>
</body>
</html>
