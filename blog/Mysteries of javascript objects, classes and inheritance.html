<script language="javascript" src="include.js"></script>
<h3 class="post-title entry-title">
    Mysteries of javascript objects, classes and inheritance
</h3>
<div class="post-body">
<!-- The above must be replaced with -->
<!-- <script language="javascript"
     src="http://buchholz.free.fr/gpf-js/blog/include.js"></script> -->
    <h1>What did I spend my time on during the last months?</h1>

<p>I know that the blog activity does not reflect this reality but I have been
working on my library during my - rare - spare time.
For instance, I tried to organize the different features into namespaces to
avoid creating one object containing all the methods.
<br />
Since I started the new job, I also rewrote some of it to fit most of JSLint
validation rules and changed the way tests are made to support several hosts
(<a href="http://technet.microsoft.com/en-us/library/bb490887.aspx"
target="_blank">cscript</a>, <a href="http://nodejs.org/" target="_blank">nodeJS
</a> and a <a href="http://en.wikipedia.org/wiki/List_of_web_browsers"
target="_blank">browser</a>).</p>

<p>One interesting problem I had to deal with is related to the way attributes
are handled in my implementation. Attributes could be compared to the Java
annotations: they are information added to the source code that are retrieved
at run-time using specific methods.
They are used to generate code (such as object members' accessors) or customize
behaviors (such as XML serialization).</p>

<p>I will write an article later about that very specific topic.</p>

<p>The problem I had to deal with is related to classes and inheritance: indeed,
it sounds natural to inherit the attributes and - as a consequence - I needed
the possibility to walk through the class hierarchy.<br />
Also, I wanted to simplify the way attributes are created so I wrote aliases for
constructors (let say object factories).</p>

<p>I learned a lot by implementing these methods and I would like to share with
you my understanding of how objects are handled in JavaScript.</p>

    <h1>Classes and inheritance</h1>

<p>First of all, I will not detail the class and inheritance concepts as they
belong to the <a href="http://en.wikipedia.org/wiki/Object-oriented_programming"
target="_blank">Object Oriented Programming languages</a>.</p>

<p>But also, the main reason is that JavaScript is <b>*not*</b> an usual OOP
language: it misses lots of interesting features such as the possibility to
control members visibility (using private, protected and public), polymorphism
or operators....</p>

<p>As a matter of fact, the <span class="keyword">class</span> keyword is
reserved but you can't do anything with it. You will also discover that the
<span class="keyword">delete</span> keyword exists but for a different usage.
</p>

<p>That's why I would like to explain what is a JavaScript object, how it is
declared and the way it can be manipulated in order to highlight what can be
done and illustrate what can't.</p>

    <h2>Objects and members</h2>

        <h3>My first object</h3>

<p>In the JavaScript language, the simplest (and shortest) way to create an
object is to write the following line of code:</p>
<code class="javascript">var myObject1 = {};</code>

<p>The following syntax is strictly equivalent:</p>
<code class="javascript">var myObject2 = new Object();</code>

<p>However, those who are used to program with real OOP languages will
recognize the use of the <span class="keyword">new</span> operator. I will come
back later to this one, we will first focus on the result.
<br/>
Both samples are generating an empty object and once created, it already exposes
a number of predefined members (mostly methods), for instance:
<ul>
    <li><span class="keyword">toString</span> a method that returns a
        string representation of the object</li>
    <li><span class="keyword">hasOwnProperty</span> a method that will become
        helpful later in this article</li>
    <li><span class="keyword">constructor</span> an object that will also be
        explained later</li>
</ul>
</p>

        <h3>Members</h3>

<p>To access the members (or call the methods), you can use either the "."
operator or the "[]" one:</p>
<code class="javascript">var string1 = myObject1.toString();
var string2 = myObject2["toString"]();</code>

<p>Usually, the bracket operator is used whenever the member name is
contained in a variable or an invalid identifier (just try to access the member
named "my field" with the dot operator).</p>

<p>The real power of JavaScript compared to classical OOP languages is the fact
that you can dynamically add any member to any object.<br />
Again, there are several syntaxes you can use:</p>

<code class="javascript">myObject1.member = "value";
myObject2["member"] = "value";
myObject1["member"] === myObject2.member;</code>

<p>Indeed, assigning a member on an object will either update the member if
existing or create it.</p>

<div class="note">This simplicity is probably one of the most exciting feature
of the JavaScript language. As a consequence, any object can be used as a map
and there is virtually no limit to the number of members you can add to an
object.<br/>
Very often, I used them as dictionary (to associate keys to values).
</div>

<p>If you want to initialize the object with members, you can add them one by
one:</p>
<code class="javascript">var johnSmith = new Object();
johnSmith.firstName = "John";
johnSmith.lastName = "Smith";
johnSmith.age = 25;
johnSmith.address = new Object();
johnSmith.address.streetAddress = "21 2nd Street";
johnSmith.address.city = "New York";
johnSmith.address.state = "NY";
johnSmith.address.postalCode = 10021;</code>

<p>Or you can make it simpler by using the
<a href="http://en.wikipedia.org/wiki/JavaScript_Object_Notation"
target="_blank">JSON</a> notation:</p>
<code class="javascript">var johnSmith = {
    "firstName": "John",
    "lastName": "Smith",
    "age": 25,
        "address": {
        "streetAddress": "21 2nd Street",
        "city": "New York",
        "state": "NY",
        "postalCode": 10021
    }
};</code>

<p>This means that, unlike a strict OOP language, you can't be sure that your
object will respect a given structure (or interface). To be more precise
prototyping (that I will explain below) can help you ensure that the object has
a minimum set of properties.</p>

        <h3>Object inspection</h3>

<p>In any case, the JavaScript language also offers operators to inspect an
object definition, like
<a href="http://en.wikipedia.org/wiki/Reflection_(computer_programming)"
target="_blank">reflection</a>.</p>

<p>First of all, accessing a member that is not defined does not generate any
error. Instead, JavaScript returns special value that represents this missing
definition.</p>

<div class="note">I hear some screams regarding the above assertion as most of
us faced errors related to values that were not defined. However, please take a
closer look at what really happened and you will realize that the error came
from the use of the undefined value rather than its access.</div>

<p>The keyword <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/
Reference/Global_Objects/undefined" target="_blank"><span class="keyword">
undefined</span></a> allows you to test this situation:</p>

<code class="javascript">if (undefined === myObject1.notYetDefined) {
    myObject1.notYetDefined = "OK";
}</code>

<!-- TODO -->

<br />
You may also want to use the <b><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/typeof" target="_blank">typeof</a></b> operator but I tend to limit its use:<br />
<code class="javascript">if ("undefined" === typeof myObject1.notYetDefined) {
    myObject1.notYetDefined = "OK";
    }</code><br />
<br />
On the other hand, you might want to list members currently defined on the object, this is where you will start using the operator <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/in" style="font-weight: bold;" target="_blank">in</a>&nbsp;(this is where the "[]" operator is really useful):<br />
<code class="javascript">for (var member in myObject1) {
    alert(myObject1[member]);
    }</code><br />
<br />
Another use of the <b>in</b> operator is to test if a member exists in an object:<br />
<code class="javascript">if (!("notYetDefined" in myObject1)) {
    myObject1.notYetDefined = "OK";
    }</code><br />
<br />
<div class="note">
    Some will argue this is not the right way to test if a member exists and will recommend the use of <b><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object/hasOwnProperty" target="_blank">hasOwnProperty</a></b>. It depends on what you really want to test and - right now - I just want to verify if myObject1 has a member named "notYetDefined" which is exactly what <b>in</b> is doing.</div>
<br />
To conclude with object members, there is one operator that is not widely known and rarely used but can be helpful when applied wisely (I will provide an example later): <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/delete" target="_blank"><b>delete</b></a>. As documented, it is used to remove a property from an object. It means that, unlike OOP languages, it does not 'free' objects.<br />
<br />
An example of use:<br />
<code class="javascript">if (!("notYetDefined" in myObject1)) {
    myObject1.notYetDefined = "OK";
    }
    // Do something that relies on myObject1.notYetDefined
    delete myObject1.notYetDefined;
    // Now "notYetDefined" is no more a property of in myObject1</code><br />
<br />
However, <b>delete </b>might not work in some cases.<br />
<h4>
    Own properties and prototype</h4>
The last sentence being confusing, here is an example to illustrate it:<br />
<code class="javascript">var test = new Object();
    if ("toString" in test) {
    console.log("test has \"toString\"");
    } else {
    console.log("test doesn't have \"toString\"");
    }
    delete test.toString;
    if ("toString" in test) {
    console.log("test has \"toString\"");
    } else {
    console.log("test doesn't have \"toString\"");
    }</code>
<br />
<br />
As a result, you will get:<br />
<code class="output">test has "toString"
    test has "toString"</code>
<br />
<br />
Hold on a second, we have two possibilities here:<br />
<br />
<ul>
    <li>Either the <b>delete</b> operator does not work as described</li>
    <li>Or the <b>toString </b>member is not a property of the object</li>
</ul>
<div>
    First, I confirm that <b>delete</b> operator works as described, however the sentence <i>"remove a property from an object"</i> has to be clarified.</div>


<!-- Drop those two lines -->
</div>