
(function(root,factory){"use strict";if(typeof define==="function"&&define.amd){define(["exports"],factory);}else if(typeof exports!=="undefined"){factory(exports);}else if(typeof module!=="undefined"&&module.exports){factory(module.exports);}else{var newGpf={};factory(newGpf);root.gpf=newGpf;}}(this,function(gpf){"use strict";function _gpfEmptyFunc(){}var _gpfVersion="0.1.5-alpha",_GPF_HOST_BROWSER="browser",_GPF_HOST_NODEJS="nodejs",_GPF_HOST_PHANTOMJS="phantomjs",_GPF_HOST_RHINO="rhino",_GPF_HOST_UNKNOWN="unknown",_GPF_HOST_WSCRIPT="wscript",_gpfHost=_GPF_HOST_UNKNOWN,_gpfDosPath=false,_gpfMainContext=this,_gpfIgnore=_gpfEmptyFunc,_gpfExit=_gpfEmptyFunc,_gpfInNode=false,_gpfInBrowser=false,_gpfWebWindow,_gpfWebDocument,_gpfWebHead,_gpfMsFSO,_gpfNodeFs,_gpfNodePath;if("undefined"!==typeof WScript){_gpfHost=_GPF_HOST_WSCRIPT;_gpfDosPath=true;}else if("undefined"!==typeof print&&"undefined"!==typeof java){_gpfHost=_GPF_HOST_RHINO;_gpfDosPath=false;}else if("undefined"!==typeof phantom&&phantom.version){_gpfHost=_GPF_HOST_PHANTOMJS;_gpfDosPath=require("fs").separator==="\\";}else if("undefined"!==typeof module&&module.exports){_gpfHost=_GPF_HOST_NODEJS;_gpfNodePath=require("path");_gpfDosPath=_gpfNodePath.sep==="\\";_gpfMainContext=global;}else if("undefined"!==typeof window){_gpfHost=_GPF_HOST_BROWSER;_gpfMainContext=window;}gpf.host=function(){return _gpfHost;};gpf.version=function(){return _gpfVersion;};if(_GPF_HOST_BROWSER===_gpfHost){_gpfInBrowser=true;_gpfExit=function(code){window.location="https://arnaudbuchholz.github.io/gpf/exit.html?"+(code||0);};_gpfWebWindow=window;_gpfWebDocument=document;_gpfWebHead=_gpfWebDocument.getElementsByTagName("head")[0]||_gpfWebDocument.documentElement;}if(_GPF_HOST_NODEJS===_gpfHost){_gpfInNode=true;_gpfExit=process.exit;}if(_GPF_HOST_PHANTOMJS===_gpfHost){_gpfInNode=true;_gpfInBrowser=true;_gpfExit=phantom.exit;}if(_GPF_HOST_RHINO===_gpfHost){_gpfMainContext.console={log:function(t){print("    "+t);},info:function(t){print("[?] "+t);},warn:function(t){print("/!\\ "+t);},error:function(t){print("(X) "+t);}};_gpfExit=function(code){java.lang.System.exit(code);};}if(_GPF_HOST_WSCRIPT===_gpfHost){_gpfMainContext.console={log:function(t){WScript.Echo("    "+t);},info:function(t){WScript.Echo("[?] "+t);},warn:function(t){WScript.Echo("/!\\ "+t);},error:function(t){WScript.Echo("(X) "+t);}};_gpfExit=function(code){WScript.Quit(code);};}var _gpfAssert,_gpfAsserts;function _gpfAssertImpl(condition,message){if(undefined===message){message="Assertion with no message";condition=false;}if(!condition){console.warn("ASSERTION FAILED: "+message);throw gpf.Error.assertionFailed({message:message});}}function _gpfAssertsImpl(messages){for(var message in messages){if(messages.hasOwnProperty(message)){_gpfAssertImpl(messages[message],message);}}}gpf.assert=_gpfAssertImpl;gpf.asserts=_gpfAssertsImpl;_gpfAssert=_gpfEmptyFunc;_gpfAsserts=_gpfEmptyFunc;var _gpfConflictingSymbol;_gpfConflictingSymbol=_gpfMainContext.gpf;gpf.noConflict=function(){if(undefined===_gpfConflictingSymbol){delete _gpfMainContext.gpf;}else{_gpfMainContext.gpf=_gpfConflictingSymbol;}return gpf;};var _gpfIsArrayLike=function(obj){return Array.isArray(obj);};if(_GPF_HOST_BROWSER===_gpfHost&&(_gpfWebWindow.HTMLCollection||_gpfWebWindow.NodeList)){_gpfIsArrayLike=function(obj){return Array.isArray(obj)||obj instanceof _gpfWebWindow.HTMLCollection||obj instanceof _gpfWebWindow.NodeList;};}gpf.isArrayLike=_gpfIsArrayLike;function _gpfArrayForEach(array,callback,thisArg){var index,length=array.length;for(index=0;index<length;++index){callback.call(thisArg,array[index],index,array);}}function _gpfObjectForEach(object,callback,thisArg){for(var property in object){if(object.hasOwnProperty(property)){callback.call(thisArg,object[property],property,object);}}}gpf.forEach=function(structure,callback,thisArg){if(_gpfIsArrayLike(structure)){_gpfArrayForEach(structure,callback,thisArg);return;}_gpfObjectForEach(structure,callback,thisArg);};function _gpfAssign(value,member){this[0][member]=value;}function _gpfAssignOrCall(value,member){var dst=this[0],overwriteCallback=this[2];if(undefined===dst[member]){dst[member]=value;}else{overwriteCallback(dst,member,value);}}function _gpfExtend(dst,src,overwriteCallback){var callbackToUse;if(undefined===overwriteCallback){callbackToUse=_gpfAssign;}else{_gpfAssert("function"===typeof overwriteCallback,"Expected function");callbackToUse=_gpfAssignOrCall;}_gpfObjectForEach(src,callbackToUse,arguments);return dst;}gpf.extend=_gpfExtend;function _gpfInstallCompatibility(typeName,overrides){var on=overrides.on;if(overrides.methods){_gpfExtend(on.prototype,overrides.methods,_gpfEmptyFunc);}if(overrides.statics){_gpfExtend(on,overrides.statics,_gpfEmptyFunc);}}_gpfInstallCompatibility("Array",{on:Array,methods:{every:function(callback){var thisArg=arguments[1],len=this.length,idx;for(idx=0;idx<len;++idx){if(!callback.call(thisArg,this[idx],idx,this)){return false;}}return true;},filter:function(callback){var thisArg=arguments[1],result=[],len=this.length,idx,item;for(idx=0;idx<len;++idx){item=this[idx];if(callback.call(thisArg,this[idx],idx,this)){result.push(item);}}return result;},forEach:function(callback){var thisArg=arguments[1],len=this.length,idx;for(idx=0;idx<len;++idx){callback.call(thisArg,this[idx],idx,this);}},indexOf:function(searchElement){var fromIndex=arguments[1],index=fromIndex||0,thisLength=this.length;while(index<thisLength){if(this[index]===searchElement){return index;}++index;}return-1;},map:function(callback){var thisArg=arguments[1],thisLength=this.length,result=new Array(thisLength),index;for(index=0;index<thisLength;++index){result[index]=callback.call(thisArg,this[index],index,this);}return result;},reduce:function(callback){var initialValue=arguments[1],thisLength=this.length,index=0,value;if(undefined===initialValue){value=this[index++];}else{value=initialValue;}for(;index<thisLength;++index){value=callback(value,this[index],index,this);}return value;}},statics:{from:function(arrayLike){var length=arrayLike.length,array=[],index,callback=arguments[1],thisArg=arguments[2];if("string"===typeof arrayLike){for(index=0;index<length;++index){array.push(arrayLike.charAt(index));}}else{for(index=0;index<length;++index){array.push(arrayLike[index]);}}if("function"===typeof callback){array=array.map(callback,thisArg);}return array;},isArray:function(arrayLike){return"[object Array]"===Object.prototype.toString.call(arrayLike);}}});function _gpfGetGenericFactoryArguments(count){var args=[],idx=count;while(idx--){args.unshift("p["+idx+"]");}return args;}function _gpfGenerateGenericFactorySource(maxParameters){var src=["var C = this, p = arguments, l = p.length;"],args=_gpfGetGenericFactoryArguments(maxParameters);args.forEach(function(value,idx){src.push("if ("+idx+" === l) { return new C("+args.slice(0,idx).join(", ")+");}");});return src.join("\r\n");}function _gpfGenerateGenericFactory(maxParameters){return new Function(_gpfGenerateGenericFactorySource(maxParameters));}var _gpfGenericFactory=_gpfGenerateGenericFactory(10);function _pad(number){if(10>number){return"0"+number;}return number;}_gpfInstallCompatibility("Date",{on:Date,methods:{toISOString:function(){return[this.getUTCFullYear(),"-",_pad(this.getUTCMonth()+1),"-",_pad(this.getUTCDate()),"T",_pad(this.getUTCHours()),":",_pad(this.getUTCMinutes()),":",_pad(this.getUTCSeconds()),".",(this.getUTCMilliseconds()/1000).toFixed(3).slice(2,5),"Z"].join("");}}});var _gpfISO8601RegExp=new RegExp(["^([0-9][0-9][0-9][0-9])","\\-","([0-9][0-9])","\\-","([0-9][0-9])","(?:T","([0-9][0-9])","\\:","([0-9][0-9])","\\:","([0-9][0-9])","(?:\\.","([0-9][0-9][0-9])","Z)?)?$"].join(""));function _gpfIsISO8601String(value){var matchResult,matchedDigits,result,len,idx;if("string"===typeof value){_gpfISO8601RegExp.lastIndex=0;matchResult=_gpfISO8601RegExp.exec(value);if(matchResult){result=[];len=matchResult.length-1;for(idx=0;idx<len;++idx){matchedDigits=matchResult[idx+1];if(matchedDigits){result.push(parseInt(matchResult[idx+1],10));}else{result.push(0);}}--result[1];if(result[1]<12&&result[2]<32&&result[3]<24&&result[4]<60&&result[5]<60){return result;}}}}var _GpfGenuineDate=_gpfMainContext.Date;function _GpfDate(){var firstArgument=arguments[0],values=_gpfIsISO8601String(firstArgument);if(values){return new _GpfGenuineDate(_GpfGenuineDate.UTC.apply(_GpfGenuineDate.UTC,values));}return _gpfGenericFactory.apply(_GpfGenuineDate,arguments);}(function(){var members=["prototype","UTC","parse","now"],len=members.length,idx,member;for(idx=0;idx<len;++idx){member=members[idx];_GpfDate[member]=_GpfGenuineDate[member];}var supported=false;try{var longDate=new Date("2003-01-22T22:45:34.075Z"),shortDate=new Date("2003-01-22");supported=2003===longDate.getUTCFullYear()&&0===longDate.getUTCMonth()&&22===longDate.getUTCDate()&&22===longDate.getUTCHours()&&45===longDate.getUTCMinutes()&&34===longDate.getUTCSeconds()&&75===longDate.getUTCMilliseconds()&&2003===shortDate.getUTCFullYear()&&0===shortDate.getUTCMonth()&&22===shortDate.getUTCDate();}catch(e){}if(!supported){_gpfMainContext.Date=_GpfDate;}}());var _gpfArrayPrototypeSlice=Array.prototype.slice;_gpfInstallCompatibility("Function",{on:Function,methods:{bind:function(thisArg){var me=this,prependArgs=_gpfArrayPrototypeSlice.call(arguments,1);return function(){var args=_gpfArrayPrototypeSlice.call(arguments,0);me.apply(thisArg,prependArgs.concat(args));};}}});var _gpfJsCommentsRegExp=new RegExp("//.*$|/\\*(?:[^\\*]*|\\*[^/]*)\\*/","gm");function _gpfGetFunctionName(){var functionSource=Function.prototype.toString.call(this),functionKeywordPos=functionSource.indexOf("function"),parameterListStartPos=functionSource.indexOf("(",functionKeywordPos);return functionSource.substr(functionKeywordPos+9,parameterListStartPos-functionKeywordPos-9).replace(_gpfJsCommentsRegExp,"").trim();}if(function(){function functionName(){}return functionName.name!=="functionName";}()){Function.prototype.compatibleName=_gpfGetFunctionName;}else{Function.prototype.compatibleName=function(){return this.name;};}_gpfInstallCompatibility("Object",{on:Object,statics:{create:function(){function Temp(){}return function(O){Temp.prototype=O;var obj=new Temp;Temp.prototype=null;if(!obj.__proto__){obj.__proto__=O;}return obj;};}(),getPrototypeOf:function(object){if(object.__proto__){return object.__proto__;}return object.constructor.prototype;},keys:function(object){var result=[],key;for(key in object){if(object.hasOwnProperty(key)){result.push(key);}}return result;},values:function(object){var result=[],key;for(key in object){if(object.hasOwnProperty(key)){result.push(object[key]);}}return result;}}});_gpfInstallCompatibility("String",{on:String,methods:{trim:function(){var rtrim=new RegExp("^[\\s\uFEFF\xA0]+|[\\s\uFEFF\xA0]+$","g");return function(){return this.replace(rtrim,"");};}()}});function _gpfPromiseSafeResolve(fn,onFulfilled,onRejected){var safe=true;function makeSafe(callback){return function(value){if(safe){safe=false;callback(value);}};}try{fn(makeSafe(onFulfilled),makeSafe(onRejected));}catch(e){if(safe){safe=false;onRejected(e);}}}function _gpfPromiseFinale(){var me=this;me._handlers.forEach(function(handler){handler.process(me);});me._handlers=[];}function _gpfPromiseReject(newValue){var me=this;me._state=false;me._value=newValue;_gpfPromiseFinale.call(me);}function _gpfPromiseResolve(newValue){var me=this;try{_gpfAssert(newValue!==me,"A promise cannot be resolved with itself.");if(newValue&&(typeof newValue==="object"||typeof newValue==="function")){var then=newValue.then;if("function"===typeof then){_gpfPromiseSafeResolve(then.bind(newValue),_gpfPromiseResolve.bind(me),_gpfPromiseReject.bind(me));return;}}me._state=true;me._value=newValue;_gpfPromiseFinale.call(me);}catch(e){_gpfPromiseReject.call(me,e);}}var _GpfPromise=gpf.Promise=function(fn){_gpfPromiseSafeResolve(fn,_gpfPromiseResolve.bind(this),_gpfPromiseReject.bind(this));};function _gpfPromiseHandler(){}_gpfPromiseHandler.prototype={onFulfilled:null,onRejected:null,resolve:null,reject:null,process:function(promise){var me=this;if(promise._state===null){if(!promise.hasOwnProperty("_handlers")){promise._handlers=[];}promise._handlers.push(me);return;}setTimeout(function(){var callback,result;if(promise._state){callback=me.onFulfilled;}else{callback=me.onRejected;}if(null===callback){if(promise._state){me.resolve(promise._value);}else{me.reject(promise._value);}return;}try{result=callback(promise._value);}catch(e){me.reject(e);return;}me.resolve(result);},0);}};_GpfPromise.prototype={_state:null,_value:null,_handlers:[],then:function(onFulfilled,onRejected){var me=this;return new _GpfPromise(function(resolve,reject){var handler=new _gpfPromiseHandler;if(undefined!==onFulfilled){handler.onFulfilled=onFulfilled;}if(undefined!==onRejected){handler.onRejected=onRejected;}handler.resolve=resolve;handler.reject=reject;handler.process(me);});},"catch":function(onRejected){return this.then(null,onRejected);}};_GpfPromise.resolve=function(value){return new _GpfPromise(function(resolve){resolve(value);});};_GpfPromise.reject=function(value){return new _GpfPromise(function(resolve,reject){_gpfIgnore(resolve);reject(value);});};_GpfPromise.all=function(promises){if(0===promises.length){return _GpfPromise.resolve([]);}return new _GpfPromise(function(resolve,reject){var remaining=promises.length;function handle(result,index){try{if(result&&result instanceof _GpfPromise){result.then(function(value){handle(value,index);},reject);return;}promises[index]=result;if(--remaining===0){resolve(promises);}}catch(e){reject(e);}}promises.forEach(handle);});};_GpfPromise.race=function(promises){return new _GpfPromise(function(resolve,reject){promises.forEach(function(promise){promise.then(resolve,reject);});});};if(undefined===_gpfMainContext.Promise){_gpfMainContext.Promise=_GpfPromise;}var _gpfTimeoutQueue=[],_gpfTimeoutID=0,_gpfSleep=_gpfEmptyFunc;gpf.handleTimeout=_gpfEmptyFunc;function _gpfSortOnDt(a,b){return a.dt-b.dt;}function _gpSetTimeoutPolyfill(callback,timeout){_gpfAssert("number"===typeof timeout,"Timeout is required");var timeoutItem={id:++_gpfTimeoutID,dt:new Date(new Date().getTime()+timeout),cb:callback};_gpfTimeoutQueue.push(timeoutItem);_gpfTimeoutQueue.sort(_gpfSortOnDt);return _gpfTimeoutID;}function _gpfClearTimeoutPolyfill(timeoutId){var pos;if(!_gpfTimeoutQueue.every(function(timeoutItem,index){if(timeoutItem.id===timeoutId){pos=index;return false;}return true;})){_gpfTimeoutQueue.splice(pos,1);}}function _gpfHandleTimeout(){var queue=_gpfTimeoutQueue,timeoutItem,now;while(queue.length){timeoutItem=queue.shift();now=new Date;if(timeoutItem.dt>now){_gpfSleep(timeoutItem.dt-now);}timeoutItem.cb();}}if("undefined"===typeof setTimeout){if(_GPF_HOST_WSCRIPT===_gpfHost){_gpfSleep=function(t){WScript.Sleep(t);};}else if(_GPF_HOST_RHINO===_gpfHost){_gpfSleep=java.lang.Thread.sleep;}else{console.warn("No implementation for setTimeout");}_gpfMainContext.setTimeout=_gpSetTimeoutPolyfill;_gpfMainContext.clearTimeout=_gpfClearTimeoutPolyfill;gpf.handleTimeout=_gpfHandleTimeout;}function _gpfGetObjectProperty(parent,name){if(undefined!==parent){return parent[name];}}function _gpfGetOrCreateObjectProperty(parent,name){var result=parent[name];if(undefined===result){result=parent[name]={};}return result;}function _gpfReduceContext(path,reducer){var rootContext;if(path[0]==="gpf"){rootContext=gpf;path=path.slice(1);}else{rootContext=_gpfMainContext;}return path.reduce(reducer,rootContext);}function _gpfContext(path,createMissingParts){var reducer;if(createMissingParts){reducer=_gpfGetOrCreateObjectProperty;}else{reducer=_gpfGetObjectProperty;}return _gpfReduceContext(path,reducer);}gpf.context=function(path){if(undefined===path){return _gpfMainContext;}return _gpfContext(path.split("."));};var _GPF_EVENT_ANY="*",_GPF_EVENT_ERROR="error",_GPF_EVENT_READY="ready",_GPF_EVENT_DATA="data",_GPF_EVENT_END_OF_DATA="endOfData",_GPF_EVENT_CONTINUE="continue",_GPF_EVENT_STOP="stop",_GPF_EVENT_STOPPED="stopped",_GPF_FS_TYPE_NOT_FOUND=0,_GPF_FS_TYPE_FILE=1,_GPF_FS_TYPE_DIRECTORY=2,_GPF_FS_TYPE_UNKNOWN=99,_GpfFunc=Function,_gpfMax31=2147483647,_gpfMax32=4294967295,_gpfAlpha="abcdefghijklmnopqrstuvwxyz",_gpfALPHA="ABCDEFGHIJKLMNOPQRSTUVWXYZ",_gpfDigit="0123456789",_gpfIdentifierFirstChar=_gpfAlpha+_gpfALPHA+"_$",_gpfIdentifierOtherChars=_gpfAlpha+_gpfALPHA+_gpfDigit+"_$",_gpfJsKeywords=("break,case,class,catch,const,continue,debugger,default,delete,do,else,export,extends,finally,"+"for,function,if,import,in,instanceof,let,new,return,super,switch,this,throw,try,typeof,var,void,while,with,"+"yield").split(",");function _gpfFalseFunc(){return false;}function _gpfFunc(params,source){var args;if(undefined===source){source=params;params=[];}_gpfAssert("string"===typeof source&&source.length,"Source expected (or use _gpfEmptyFunc)");if(0===params.length){return _GpfFunc(source);}args=[].concat(params);args.push(source);return _GpfFunc.apply(null,args);}function _gpfIsUnsignedByte(value){return"number"===typeof value&&0<=value&&value<256;}function _gpfCreateConstants(obj,dictionary){var key;for(key in dictionary){if(dictionary.hasOwnProperty(key)){obj[key]=dictionary[key];}}}_gpfCreateConstants(gpf,{HOST_BROWSER:_GPF_HOST_BROWSER,HOST_NODEJS:_GPF_HOST_NODEJS,HOST_PHANTOMJS:_GPF_HOST_PHANTOMJS,HOST_RHINO:_GPF_HOST_RHINO,HOST_UNKNOWN:_GPF_HOST_UNKNOWN,HOST_WSCRIPT:_GPF_HOST_WSCRIPT});if(_gpfInNode){gpf.node={};}gpf.web={};function _gpfResolveScope(scope){if(null===scope||"object"!==typeof scope){return _gpfMainContext;}return scope;}function _GpfEventsIsValidHandler(eventHandler){var type=typeof eventHandler,dispatchEvent;if("function"===type){return 1===eventHandler.length;}if("object"!==type){return false;}dispatchEvent=eventHandler.dispatchEvent;if("function"===typeof dispatchEvent){return 1===dispatchEvent.length;}return true;}gpf.events={isValidHandler:_GpfEventsIsValidHandler};var _GpfEvent=gpf.events.Event=function(type,params,scope){this.type=type;this.scope=_gpfResolveScope(scope);if(undefined!==params){this._params=params;}};_GpfEvent.prototype={constructor:_GpfEvent,type:"",scope:null,_params:{},get:function(name){return this._params[name];}};function _getEventHandler(event,eventsHandler){var scope=event.scope,eventHandler;if("function"===typeof eventsHandler.dispatchEvent){return eventsHandler.dispatchEvent.bind(eventsHandler);}if("function"===typeof eventsHandler){return eventsHandler.bind(scope);}eventHandler=eventsHandler[event.type]||eventsHandler["*"]||_gpfEmptyFunc;return eventHandler.bind(eventsHandler.scope||eventsHandler);}function _gpfEventsTriggerHandler(event,eventsHandler,resolvePromise){var eventHandler=_getEventHandler(event,eventsHandler);eventHandler(event);if(undefined!==resolvePromise){resolvePromise(event);}}var _gpfEventsFiring=0;function _gpfEventsFire(event,params,eventsHandler){var scope=_gpfResolveScope(this);_gpfAssert(_GpfEventsIsValidHandler(eventsHandler),"Expected a valid event handler");if(!(event instanceof _GpfEvent)){event=new gpf.events.Event(event,params,scope);}return new Promise(function(resolve){if(++_gpfEventsFiring>10){setTimeout(_gpfEventsTriggerHandler.bind(null,event,eventsHandler,resolve),0);}else{_gpfEventsTriggerHandler(event,eventsHandler);resolve(event);}--_gpfEventsFiring;});}_GpfEvent.prototype.fire=function(eventsHandler){return _gpfEventsFire.call(this,this,{},eventsHandler);};gpf.events.fire=function(event,params,eventsHandler){_gpfIgnore(event,params,eventsHandler);var me=this,scope;if(this!==gpf.events){scope=me;}if(undefined===eventsHandler){eventsHandler=params;params={};}return _gpfEventsFire.call(scope,event,params,eventsHandler);};function _gpfEventGetPromiseHandler(eventHandlingMethod){return new Promise(function(resolve,reject){eventHandlingMethod(function(event){if(_GPF_EVENT_ERROR===event.type){reject(event.get("error"));}else{resolve(event);}});});}gpf.events.getPromiseHandler=_gpfEventGetPromiseHandler;_gpfCreateConstants(gpf.events,{EVENT_ANY:_GPF_EVENT_ANY,EVENT_ERROR:_GPF_EVENT_ERROR,EVENT_READY:_GPF_EVENT_READY,EVENT_DATA:_GPF_EVENT_DATA,EVENT_END_OF_DATA:_GPF_EVENT_END_OF_DATA,EVENT_CONTINUE:_GPF_EVENT_CONTINUE,EVENT_STOP:_GPF_EVENT_STOP,EVENT_STOPPED:_GPF_EVENT_STOPPED});if(_gpfInBrowser){gpf.web.include=function(){var INCLUDE_ID_PREFIX="gpf-include-",lastIncludeId=0,includeMap={};function IncludeContext(url,eventsHandler){this.id=++lastIncludeId;this.url=url;this.eventsHandler=eventsHandler;includeMap[this.id]=this;}IncludeContext.prototype={id:0,url:"",eventsHandler:null,clean:function(domScript){var parent=domScript.parentNode;domScript.onerror=domScript.onload=domScript.onreadystatechange=null;if(parent){parent.removeChild(domScript);}delete includeMap[this.id];},check:function(domScript){var readyState=domScript.readyState;if(!readyState||-1<["loaded","complete"].indexOf(readyState)){this.clean(domScript);setTimeout(_gpfEventsFire,0,_GPF_EVENT_READY,{url:this.url},this.eventsHandler);}},failed:function(domScript){this.clean(domScript);setTimeout(_gpfEventsFire,0,_GPF_EVENT_ERROR,{url:this.url},this.eventsHandler);}};function getIncludeContextFromId(id){return includeMap[id.substr(INCLUDE_ID_PREFIX.length)];}function onLoad(){var me=this;var context=getIncludeContextFromId(me.id);if(context){context.check(me);}}function onError(){var me=this;var context=getIncludeContextFromId(me.id);if(context){context.failed(me);}}function insert(domScript){_gpfWebHead.insertBefore(domScript,_gpfWebHead.firstChild);}return function(url,eventsHandler){var context=new IncludeContext(url,eventsHandler),domScript=_gpfWebDocument.createElement("script");domScript.language="javascript";domScript.src=url;domScript.id=INCLUDE_ID_PREFIX+context.id;domScript.onload=domScript.onreadystatechange=onLoad;domScript.onerror=onError;if(undefined!==domScript.async){domScript.async=true;}setTimeout(insert,0,domScript);};}();}function _gpfGetBootstrapMethod(path,methodFactory){var pathList=path.split("."),name=pathList.pop(),namespace=_gpfContext(pathList,true),method;namespace[name]=function(){method=methodFactory(path);namespace[name]=method;return method.apply(this,arguments);};}function _gpfStringCapitalize(that){return that.charAt(0).toUpperCase()+that.substr(1);}function _gpfStringReplaceEx(that,replacements){var result=that;_gpfObjectForEach(replacements,function(replacement,key){result=result.split(key).join(replacement);});return result;}var _gpfStringEscapes={javascript:{"\\":"\\\\","\"":"\\\"","\n":"\\n","\r":"\\r","\t":"\\t"},xml:{"&":"&amp;","<":"&lt;",">":"&gt;"}};(function(){var escapes=_gpfStringEscapes,html={};_gpfObjectForEach(escapes.xml,function(escape,key){html[key]=escape;});_gpfObjectForEach({224:"&agrave;",225:"&aacute;",232:"&egrave;",233:"&eacute;",234:"&ecirc;"},function(escape,key){html[String.fromCharCode(key)]=escape;});escapes.html=html;}());function _gpfStringEscapeFor(that,language){that=_gpfStringReplaceEx(that,_gpfStringEscapes[language]);if("javascript"===language){that="\""+that+"\"";}return that;}var _gpfValues={"boolean":function(value,valueType,defaultValue){_gpfIgnore(defaultValue);if("string"===valueType){if("yes"===value||"true"===value){return true;}return 0!==parseInt(value,10);}if("number"===valueType){return 0!==value;}},number:function(value,valueType,defaultValue){_gpfIgnore(defaultValue);if("string"===valueType){return parseFloat(value);}},string:function(value,valueType,defaultValue){if(value instanceof Date){return value.toISOString();}_gpfIgnore(valueType,defaultValue);return value.toString();},object:function(value,valueType,defaultValue){if(defaultValue instanceof Date&&"string"===valueType&&_gpfIsISO8601String(value)){return new Date(value);}}};function _gpfValue(value,defaultValue,expectedType){var valueType=typeof value,result;if(!expectedType){expectedType=typeof defaultValue;}if(expectedType===valueType){return value;}if("undefined"===valueType){return defaultValue;}result=_gpfValues[expectedType](value,valueType,defaultValue);if(undefined===result){return defaultValue;}return result;}gpf.value=_gpfValue;_gpfExtend(gpf,{clone:function(obj){return JSON.parse(JSON.stringify(obj));},test:function(dictionary,value){var idx;if(dictionary instanceof Array){idx=dictionary.length;while(idx>0){if(dictionary[--idx]===value){return idx;}}}else{for(idx in dictionary){if(dictionary.hasOwnProperty(idx)&&dictionary[idx]===value){return idx;}}}return undefined;},set:function(array,value){_gpfAssert(array instanceof Array,"gpf.set must be used with an Array");var idx=array.length;while(idx>0){if(array[--idx]===value){return array;}}array.push(value);return array;},clear:function(dictionary,value){var idx;if(dictionary instanceof Array){idx=dictionary.length;while(idx>0){if(dictionary[--idx]===value){dictionary.splice(idx,1);break;}}}else{for(idx in dictionary){if(dictionary.hasOwnProperty(idx)&&dictionary[idx]===value){delete dictionary[idx];}}}return dictionary;},xor:function(a,b){return a&&!b||!a&&b;}});gpf.exit=function(exitCode){if(undefined===exitCode){exitCode=0;}_gpfExit(exitCode);};function _gpfNodeBuffer2JsArray(buffer){var result=[],len=buffer.length,idx;for(idx=0;idx<len;++idx){result.push(buffer.readUInt8(idx));}return result;}function _gpfStringTrim(string){return string.trim();}function _GpfFunctionBuilder(functionToAnalyze){this.parameters=[];if(undefined!==functionToAnalyze){this._extract(functionToAnalyze);}}_GpfFunctionBuilder.prototype={isNative:false,name:"",parameters:[],body:"",replaceInBody:function(replacements){this.body=_gpfStringReplaceEx(this.body,replacements);},_extract:function(functionObject){this.name=functionObject.compatibleName();var source=Function.prototype.toString.call(functionObject).replace(_gpfJsCommentsRegExp,""),start,end;if(0<functionObject.length){start=source.indexOf("(")+1;end=source.indexOf(")",start)-1;this.parameters=source.substr(start,end-start+1).split(",").map(_gpfStringTrim);}else{this.parameters=[];}if(-1<source.indexOf("[native")){this.isNative=true;}else{start=source.indexOf("{")+1;end=source.lastIndexOf("}")-1;this.body=source.substr(start,end-start+1);}},generate:function(){return _gpfFunc("return "+this._toSource())();},_toSource:function(){var name;if(this.name){name=" "+this.name;}else{name="";}return["function",name," ("].concat(this.parameters).concat([") {\n",this.body,"\n}"]).join("");}};function _GpfLikeContext(alike){this._pending=[];this._done=[];if(true===alike){this._haveDifferentPrototypes=_gpfFalseFunc;}else{this._alike=_gpfFalseFunc;}}_GpfLikeContext.prototype={_pending:[],_done:[],_stack:function(a,b){var array=this._done,indexOfA,comparedWith;indexOfA=array.indexOf(a);while(-1<indexOfA){if(indexOfA%2){comparedWith=array[indexOfA-1];}else{comparedWith=array[indexOfA+1];}if(comparedWith===b){return;}indexOfA=array.indexOf(a,indexOfA+1);}array=this._pending;array.push(a);array.push(b);},_haveDifferentPrototypes:function(a,b){return a.constructor!==b.constructor;},explore:function(){var pending=this._pending,done=this._done,a,b;while(0!==pending.length){b=pending.pop();a=pending.pop();done.push(a,b);if(this._haveDifferentPrototypes(a,b)){return false;}if(this._checkMembersDifferences(a,b)){return false;}}return true;},_checkMembersDifferences:function(a,b){var membersCount=0,member;for(member in a){if(a.hasOwnProperty(member)){++membersCount;if(!this.like(a[member],b[member])){return true;}}}for(member in b){if(b.hasOwnProperty(member)){--membersCount;}}return 0!==membersCount;},_downcast:function(a){if("object"===typeof a){if(a instanceof String){return a.toString();}return a.valueOf();}return a;},_alike:function(a,b){return this._downcast(a)===this._downcast(b);},like:function(a,b){if(a===b){return true;}if(typeof a!==typeof b){return this._alike(a,b);}if(null===a||null===b||"object"!==typeof a){return false;}this._stack(a,b);return true;}};gpf.like=function(a,b,alike){var context=new _GpfLikeContext(alike);return context.like(a,b)&&context.explore();};var _GpfError=gpf.Error=function(){};_GpfError.prototype={constructor:_GpfError,code:0,name:"Error",message:""};function _gpfErrorFactory(code,name,message){return function(context){var error=new _GpfError,finalMessage,replacements;error.code=code;error.name=name;if(context){replacements={};_gpfObjectForEach(context,function(value,key){replacements["{"+key+"}"]=value.toString();});finalMessage=_gpfStringReplaceEx(message,replacements);}else{finalMessage=message;}error.message=finalMessage;return error;};}function _gpfGenenerateErrorFunction(code,name,message){var result=_gpfErrorFactory(code,name,message);result.CODE=code;result.NAME=name;result.MESSAGE=message;return result;}var _gpfLastErrorCode=0;function _gpfErrorDeclare(module,list){var name,code;_gpfIgnore(module);for(name in list){if(list.hasOwnProperty(name)){code=++_gpfLastErrorCode;gpf.Error["CODE_"+name.toUpperCase()]=code;gpf.Error[name]=_gpfGenenerateErrorFunction(code,name,list[name]);}}}_gpfErrorDeclare("boot",{notImplemented:"Not implemented",abstractMethod:"Abstract method",assertionFailed:"Assertion failed: {message}",invalidParameter:"Invalid parameter"});function _gpfAllocateEventDispatcherListeners(object){var listeners=object._eventDispatcherListeners;if(!listeners){listeners=object._eventDispatcherListeners={};}return listeners;}function _gpfAddEventListener(event,eventsHandler){var listeners=_gpfAllocateEventDispatcherListeners(this);if(undefined===listeners[event]){listeners[event]=[];}listeners[event].push(eventsHandler);return this;}function _gpfRemoveEventListener(event,eventsHandler){var listeners=this._eventDispatcherListeners,eventListeners,index;if(listeners){eventListeners=listeners[event];if(undefined!==eventListeners){index=eventListeners.indexOf(eventsHandler);if(-1!==index){eventListeners.splice(index,1);}}}return this;}function _gpfTriggerListeners(eventObj,eventListeners){var index,length=eventListeners.length;for(index=0;index<length;++index){_gpfEventsFire.call(eventObj.scope,eventObj,{},eventListeners[index]);}}function _gpfDispatchEvent(event,params){var listeners=this._eventDispatcherListeners,eventObj,type,eventListeners;if(!listeners){return this;}if(event instanceof _GpfEvent){eventObj=event;type=event.type;}else{type=event;}eventListeners=this._eventDispatcherListeners[type];if(undefined===eventListeners){return this;}if(!eventObj){eventObj=new _GpfEvent(type,params,this);}_gpfTriggerListeners(eventObj,eventListeners);return eventObj;}gpf.mixins={EventDispatcher:{addEventListener:_gpfAddEventListener,removeEventListener:_gpfRemoveEventListener,dispatchEvent:_gpfDispatchEvent}};var _gpfHardCodedMimeTypes={application:{javascript:"js"},image:{gif:0,jpeg:"jpg,jpeg",png:0},text:{css:0,html:"htm,html",plain:"txt,text,log"}},_gpfMimeTypesToExtension=null,_gpfMimeTypesFromExtension=null;function _createMimeTypeExtensionMapping(mimeType,fileExtension){_gpfMimeTypesFromExtension[fileExtension]=mimeType;if(undefined===_gpfMimeTypesToExtension[mimeType]){_gpfMimeTypesToExtension[mimeType]=fileExtension;}}function _gpfBuildMimeTypeFromMappings(path,mappings){_gpfObjectForEach(mappings,function(extensions,key){var mimeType=path+key;if(0===extensions){_createMimeTypeExtensionMapping(mimeType,"."+key);}else if("string"===typeof extensions){extensions.split(",").forEach(function(extension){_createMimeTypeExtensionMapping(mimeType,"."+extension);});}else{_gpfBuildMimeTypeFromMappings(mimeType+"/",extensions);}});}function _gpfGetMimeType(fileExtension){var mimeType=_gpfMimeTypesFromExtension[fileExtension.toLowerCase()];if(undefined===mimeType){mimeType="application/octet-stream";}return mimeType;}function _gpfGetFileExtension(mimeType){var fileExtension=_gpfMimeTypesToExtension[mimeType.toLowerCase()];if(undefined===fileExtension){fileExtension=".bin";}return fileExtension;}function _gpfInitMimeTypes(){if(null===_gpfMimeTypesFromExtension){_gpfMimeTypesFromExtension={};_gpfMimeTypesToExtension={};_gpfBuildMimeTypeFromMappings("",_gpfHardCodedMimeTypes);}}_gpfGetBootstrapMethod("gpf.web.getMimeType",function(){_gpfInitMimeTypes();return _gpfGetMimeType;});_gpfGetBootstrapMethod("gpf.web.getFileExtension",function(){_gpfInitMimeTypes();return _gpfGetFileExtension;});var _gpfB64=_gpfALPHA+_gpfAlpha+_gpfDigit+"+/",_gpfB16="0123456789ABCDEF",_gpfBinZ=987654321,_gpfBinW=new Date().getTime()&_gpfMax32;function _gpfToBaseAnyEncodeUsingBitShifting(baseAndValue,pow,length){var base=baseAndValue.base,value=baseAndValue.value,result=[],bits,mask,digit;if(undefined===length){bits=32;}else{bits=length*pow;}mask=(1<<bits-pow)-1;bits=(1<<pow)-1;while(0!==value){digit=value&bits;result.unshift(base.charAt(digit));value=value>>pow&mask;}return result;}function _gpfToBaseAnyEncodeUsingModulo(baseAndValue){var base=baseAndValue.base,value=baseAndValue.value,result=[],baseLength=base.length,digit;while(0!==value){digit=value%baseLength;result.unshift(base.charAt(digit));value=(value-digit)/baseLength;}return result;}function _gpfToBaseAnyEncode(baseAndValue,length){var pow=gpf.bin.isPow2(baseAndValue.base.length);if(-1<pow&&(undefined===length||length*pow<=32)){return _gpfToBaseAnyEncodeUsingBitShifting(baseAndValue,pow,length);}return _gpfToBaseAnyEncodeUsingModulo(baseAndValue);}function _gpfToBaseANY(base,value,formattingOptions){var length=formattingOptions.length,pad=formattingOptions.pad,result=_gpfToBaseAnyEncode({base:base,value:value},length);if(undefined!==length){if(undefined===pad){pad=base.charAt(0);}while(result.length<length){result.unshift(pad.charAt(result.length%pad.length));}}else if(0===result.length){result=[base.charAt(0)];}return result.join("");}function _gpfFromBaseANY(base,text,pad){var baseLength=base.length,result=0,idx=0;if(undefined===pad){pad=base.charAt(0);}while(idx<text.length){if(-1===pad.indexOf(text.charAt(idx))){break;}else{++idx;}}while(idx<text.length){result=baseLength*result+base.indexOf(text.charAt(idx++));}return result;}gpf.bin={pow2:function(n){if(31===n){return _gpfMax31+1;}if(32===n){return _gpfMax32+1;}if(31>n){return 1<<n;}var result=_gpfMax32+1;n-=31;while(--n){result*=2;}return result;},isPow2:function(value){if(0<value&&0===(value&value-1)){var result=0;while(1<value){++result;value/=2;}return result;}return-1;},toHexa:function(value,length,pad){return _gpfToBaseANY(_gpfB16,value,{length:length,pad:pad});},fromHexa:function(text,pad){return _gpfFromBaseANY(_gpfB16,text,pad);},toBase64:function(value,length,pad){return _gpfToBaseANY(_gpfB64,value,{length:length,pad:pad});},fromBase64:function(text,pad){return _gpfFromBaseANY(_gpfB64,text,pad);},test:function(value,bitmask){return(value&bitmask)===bitmask;},clear:function(value,bitmask){return value&~bitmask;},random:function(){_gpfBinZ=36969*(_gpfBinZ&65535)+(_gpfBinZ>>16)&_gpfMax32;_gpfBinW=18000*(_gpfBinW&65535)+(_gpfBinW>>16)&_gpfMax32;return((_gpfBinZ<<16)+_gpfBinW&_gpfMax32)+_gpfMax31;}};var _gpfJsonStringify,_gpfJsonParse;function _gpfObject2Json(object){var isArray,results,property,value;isArray=object instanceof Array;results=[];for(property in object){if("function"===typeof object[property]){continue;}value=_gpfJsonStringifyPolyfill(object[property]);if(isArray){results.push(value);}else{results.push(_gpfStringEscapeFor(property,"javascript")+":"+value);}}if(isArray){return"["+results.join(",")+"]";}return"{"+results.join(",")+"}";}function _gpfJsonStringifyObject(object){return object.toString();}var _gpfJsonStringifyMapping={undefined:_gpfEmptyFunc,"function":_gpfEmptyFunc,number:_gpfJsonStringifyObject,"boolean":_gpfJsonStringifyObject,string:function(object){return _gpfStringEscapeFor(object,"javascript");}};function _gpfJsonStringifyPolyfill(object){var mapper=_gpfJsonStringifyMapping[typeof object];if(undefined!==mapper){return mapper(object);}if(null===object){return"null";}return _gpfObject2Json(object);}function _gpfJsonParsePolyfill(test){return _gpfFunc("return "+test)();}if("undefined"===typeof JSON){_gpfJsonStringify=_gpfJsonStringifyPolyfill;_gpfJsonParse=_gpfJsonParsePolyfill;_gpfMainContext.JSON={stringify:_gpfJsonStringify,parse:_gpfJsonParse};}else{_gpfJsonStringify=JSON.stringify;_gpfJsonParse=JSON.parse;}function _gpfPathDecompose(path){if(-1<path.indexOf("/")){path=path.split("/");}else if(-1<path.indexOf("\\")){path=path.toLowerCase().split("\\");}else{return[path];}if(path.length&&!path[path.length-1]){path.pop();}return path;}function _gpfPathNormalize(path){return _gpfPathDecompose(path).join("/");}function _gpfPathName(path){path=_gpfPathDecompose(path);return path[path.length-1];}gpf.path={join:function(path){path=_gpfPathDecompose(path);var idx,len=arguments.length,relativePath;for(idx=1;idx<len;++idx){relativePath=_gpfPathDecompose(arguments[idx]);while(relativePath[0]===".."){relativePath.shift();if(path.length){path.pop();}else{return"";}}if(relativePath.length){path=path.concat(relativePath);}}return path.join("/");},parent:function(path){path=_gpfPathDecompose(path);path.pop();return path.join("/");},name:_gpfPathName,nameOnly:function(path){var name=_gpfPathName(path),pos=name.lastIndexOf(".");if(-1===pos){return name;}return name.substr(0,pos);},extension:function(path){var name=_gpfPathName(path),pos=name.lastIndexOf(".");if(-1===pos){return"";}return name.substr(pos);},relative:function(from,to){from=_gpfPathDecompose(from);to=_gpfPathDecompose(to);var length;while(from.length&&to.length&&from[0]===to[0]){from.shift();to.shift();}length=from.length+1;while(--length){to.unshift("..");}return to.join("/");}};function _gpfPatternPartSplit(part){return part.split("*");}function _GpfPathMatcher(pattern){if("!"===pattern.charAt(0)){this.negative=true;pattern=pattern.substr(1);}var pos=pattern.indexOf("**");if(-1===pos){this.start=pattern.split("/").map(_gpfPatternPartSplit);}else{if(0<pos){_gpfAssert(pattern.charAt(pos-1)==="/","** must be preceded by /");this.start=pattern.substr(0,pos-1).split("/").map(_gpfPatternPartSplit);}if(pos<pattern.length-2){_gpfAssert(pattern.charAt(pos+2)==="/","** must be followed by /");this.end=pattern.substr(pos+3).split("/").map(_gpfPatternPartSplit).reverse();}}}function _gpfPathMatchCompilePattern(pattern){if(pattern instanceof _GpfPathMatcher){return pattern;}return new _GpfPathMatcher(pattern);}function _gpfPathMatchCompilePatterns(pattern){if(pattern instanceof Array){return pattern.map(_gpfPathMatchCompilePattern);}return[_gpfPathMatchCompilePattern(pattern)];}function _gpfPathMatchApply(pathMatcher){var negative=pathMatcher.negative;if(pathMatcher.match(this.parts)){this.result=!negative;return false;}if(negative){this.result=true;return false;}return true;}function _gpfPathMatch(pattern,path){var parts=_gpfPathDecompose(path),matchers=_gpfPathMatchCompilePatterns(pattern),scope={parts:parts};matchers.every(_gpfPathMatchApply,scope);return scope.result;}_GpfPathMatcher.prototype={constructor:_GpfPathMatcher,negative:false,start:null,end:null,_matchName:function(fixedPatterns,part){var len=fixedPatterns.length,idx,fixedPattern,pos=0;for(idx=0;idx<len;++idx){fixedPattern=fixedPatterns[idx];if(fixedPattern){pos=part.indexOf(fixedPattern,pos);if(-1===pos){return false;}if(0===idx&&0<pos){return false;}}}return!fixedPattern||pos+fixedPattern.length===part.length;},_matchStart:function(context){var parts=context.parts,partsLen=parts.length,startPos=context.startPos,array=this.start,len=array.length,idx;for(idx=0;idx<len;++idx){if(this._matchName(array[idx],parts[startPos])){if(++startPos>=partsLen){return idx===len-1&&!this.end;}}else{return false;}}context.startPos=startPos;return undefined;},_matchEnd:function(context){var parts=context.parts,startPos=context.startPos,endPos=parts.length-1,array=this.end,len=array.length,idx;for(idx=0;idx<len;++idx){if(-1<endPos&&this._matchName(array[idx],parts[endPos])){if(endPos--<startPos){return false;}}else{return false;}}return undefined;},match:function(parts){var result,context={parts:parts,startPos:0};if(this.start){result=this._matchStart(context);if(undefined!==result){return result;}}if(this.end){result=this._matchEnd(context);if(undefined!==result){return result;}}return true;}};_gpfExtend(gpf.path,{match:function(pattern,path){return _gpfPathMatch(pattern,path)||false;},compileMatchPattern:function(pattern){return _gpfPathMatchCompilePatterns(pattern);}});gpf.js={keywords:function(){return[].concat(_gpfJsKeywords);}};_gpfErrorDeclare("csv",{csvInvalid:"Invalid CSV syntax (bad quote sequence or missing end of file)"});var _gpfCsvSeparators=";,\t ";function _gpfCsvComputeSeparator(header){var len=_gpfCsvSeparators.length,idx,separator;for(idx=0;idx<len;++idx){separator=_gpfCsvSeparators.charAt(idx);if(-1!==header.indexOf(separator)){return separator;}}return _gpfCsvSeparators.charAt(0);}function _gpfTrimFinalR(line){var len=line.length-1;if("\r"===line.charAt(len)){return line.substr(0,len);}return line;}function _GpfCsvParser(content,options){options=options||{};this._lines=content.split("\n").map(_gpfTrimFinalR);var header=options.header||this._lines.shift();this._separator=options.separator||_gpfCsvComputeSeparator(header);this._quote=options.quote||"\"";this._columns=header.split(this._separator);}_GpfCsvParser.prototype={_lines:[],_separator:"",_quote:"",_columns:[],_unquote:function(value){var quote=this._quote,pos=value.indexOf(quote),inQuotedString=true;while(-1<pos){if(pos===value.length-1){value=value.substr(0,pos);inQuotedString=false;break;}else if(value.charAt(pos+1)===quote){value=value.substr(0,pos)+value.substr(pos+1);}else{throw gpf.Error.csvInvalid();}pos=value.indexOf(quote,pos+1);}return[value,inQuotedString];},_processQuotedLineValue:function(line,idx,flags){var value=line[idx],unQuoted;var previousValue=[line[idx-1]];if(flags.includeCarriageReturn){previousValue.push("\r\n");}else{previousValue.push(this._separator);}unQuoted=this._unquote(value);previousValue.push(unQuoted[0]);flags.inQuotedString=unQuoted[1];line[idx-1]=previousValue.join("");flags.includeCarriageReturn=false;line.splice(idx,1);return idx;},_processLineValue:function(line,idx,flags){var value=line[idx],unQuoted;if(0===value.indexOf(this._quote)){flags.inQuotedString=true;unQuoted=this._unquote(value.substr(1));line[idx]=unQuoted[0];flags.inQuotedString=unQuoted[1];}return idx+1;},_processLineValues:function(line,values,flags){var idx;if(flags.inQuotedString){flags.includeCarriageReturn=true;line.unshift(values.pop());idx=1;}else{idx=0;flags.includeCarriageReturn=false;}while(idx<line.length){if(flags.inQuotedString){idx=this._processQuotedLineValue(line,idx,flags);}else{idx=this._processLineValue(line,idx,flags);}}[].splice.apply(values,[values.length,0].concat(line));return!flags.inQuotedString;},_readValues:function(){var lines=this._lines,separator=this._separator,values=[],flags={inQuotedString:false,includeCarriageReturn:false},line;while(lines.length){line=lines.shift().split(separator);if(this._processLineValues(line,values,flags)){break;}}if(flags.inQuotedString){throw gpf.Error.csvInvalid();}return values;},read:function(){var values=this._readValues(),record={};this._columns.forEach(function(name,idx){record[name]=values[idx];});return record;},readAll:function(){var result=[];while(this._lines.length){result.push(this.read());}return result;}};gpf.csv={parse:function(content,options){var csvParser=new _GpfCsvParser(content,options);return csvParser.readAll();}};_gpfErrorDeclare("define",{"classMemberOverloadWithTypeChange":"You can't overload a member and change its type","classInvalidVisibility":"Invalid visibility keyword"});function _gpfEncodeAttributeMember(member){if("constructor"===member){return"constructor ";}return member;}function _gpfDecodeAttributeMember(member){if("constructor "===member){return"constructor";}return member;}var _gpfClassConstructorAllowed=true;function _gpfNewClassConstructorTpl(classDef){return function(){if(classDef.isConstructionAllowed()){classDef._resolvedConstructor.apply(this,arguments);}};}function _gpfUsesSuper(method){var parts=method.toString().split("._super");return!parts.every(function(part){return-1!==_gpfIdentifierOtherChars.indexOf(part.charAt(0));});}function _gpfGenSuperMember(superMethod,method){return function GpfSuperableMethod(){var previousSuper=this._super,result;this._super=superMethod;try{result=method.apply(this,arguments);}finally{if(undefined===previousSuper){delete this._super;}else{this._super=previousSuper;}}return result;};}var _gpfClassDefinitions={},_gpfClassDefUID=0,_GPF_CLASSDEF_MARKER="_gpf_"+gpf.bin.toHexa(gpf.bin.random(),8);function _GpfClassDefinition(name,Super,definition){this._uid=++_gpfClassDefUID;_gpfClassDefinitions[this._uid]=this;this._Subs=[];if("function"===typeof name){this._name=name.compatibleName()||"anonymous";this._Constructor=name;}else{this._name=name;this._Super=Super;this._definition=definition;this._build();}}function _gpfGetClassDefinition(constructor){var classDef,uid=constructor[_GPF_CLASSDEF_MARKER];if(undefined===uid){classDef=new _GpfClassDefinition(constructor);constructor[_GPF_CLASSDEF_MARKER]=classDef._uid;}else{classDef=_gpfClassDefinitions[uid];}return classDef;}var _gpfVisibilityKeywords="public|protected|private|static".split("|"),_GPF_VISIBILITY_UNKNOWN=-1,_GPF_VISIBILITY_PUBLIC=0,_GPF_VISIBILITY_PROTECTED=1,_GPF_VISIBILITY_STATIC=3;_GpfClassDefinition.prototype={constructor:_GpfClassDefinition,_uid:0,_name:"",_Super:Object,_Subs:[],_definitionAttributes:null,_Constructor:_gpfEmptyFunc,_definitionConstructor:null,_resolvedConstructor:_gpfEmptyFunc,_definition:null,isConstructionAllowed:function(){return _gpfClassConstructorAllowed;},addMember:function(member,memberValue,visibility){if(undefined===visibility){visibility=_GPF_VISIBILITY_PUBLIC;}else{visibility=_gpfVisibilityKeywords.indexOf(visibility);if(-1===visibility){throw gpf.Error.classInvalidVisibility();}}this._addMember(member,memberValue,visibility);},_addMember:function(member,memberValue,visibility){if(_GPF_VISIBILITY_STATIC===visibility){_gpfAssert(undefined===this._Constructor[member],"Static members can't be overridden");this._Constructor[member]=memberValue;}else if("constructor"===member){this._addConstructor(memberValue,visibility);}else{this._addNonStaticMember(member,memberValue,visibility);}},_addConstructor:function(memberValue,visibility){_gpfAsserts({"Constructor must be a function":"function"===typeof memberValue,"Own constructor can't be overridden":null===this._definitionConstructor});if(_gpfUsesSuper(memberValue)){memberValue=_gpfGenSuperMember(this._Super,memberValue);}_gpfIgnore(visibility);this._definitionConstructor=memberValue;},_addNonStaticMember:function(member,memberValue,visibility){var newType=typeof memberValue,baseMemberValue,baseType,prototype=this._Constructor.prototype;_gpfAssert(!prototype.hasOwnProperty(member),"Existing own member can't be overridden");baseMemberValue=this._Super.prototype[member];baseType=typeof baseMemberValue;if("undefined"!==baseType){if(null!==baseMemberValue&&newType!==baseType){throw gpf.Error.classMemberOverloadWithTypeChange();}if("function"===newType&&_gpfUsesSuper(memberValue)){memberValue=_gpfGenSuperMember(baseMemberValue,memberValue);}}_gpfIgnore(visibility);prototype[member]=memberValue;},_filterAttribute:function(member,memberValue){var attributeArray;if("["!==member.charAt(0)||"]"!==member.charAt(member.length-1)){return false;}member=_gpfEncodeAttributeMember(member.substr(1,member.length-2));if(this._definitionAttributes){attributeArray=this._definitionAttributes[member];}else{this._definitionAttributes={};}if(undefined===attributeArray){attributeArray=[];}this._definitionAttributes[member]=attributeArray.concat(memberValue);return true;},_defaultVisibility:_GPF_VISIBILITY_UNKNOWN,_deduceVisibility:function(memberName){var visibility=this._defaultVisibility;if(_GPF_VISIBILITY_UNKNOWN===visibility){if(memberName.charAt(0)==="_"){visibility=_GPF_VISIBILITY_PROTECTED;}else{visibility=_GPF_VISIBILITY_PUBLIC;}}return visibility;},_processDefinitionMember:function(memberValue,memberName){if(this._filterAttribute(memberName,memberValue)){return;}var newVisibility=_gpfVisibilityKeywords.indexOf(memberName);if(_GPF_VISIBILITY_UNKNOWN===newVisibility){return this._addMember(memberName,memberValue,this._deduceVisibility(memberName));}if(_GPF_VISIBILITY_UNKNOWN!==this._defaultVisibility){throw gpf.Error.classInvalidVisibility();}this._processDefinition(memberValue,newVisibility);},_processDefinition:function(definition,visibility){var isWScript=_GPF_HOST_WSCRIPT===_gpfHost;this._defaultVisibility=visibility;_gpfObjectForEach(definition,this._processDefinitionMember,this);if(isWScript&&definition.hasOwnProperty("toString")){this._processDefinitionMember(definition.toString,"toString");}this._defaultVisibility=_GPF_VISIBILITY_UNKNOWN;if(isWScript&&definition.hasOwnProperty("constructor")){this._addConstructor(definition.constructor,this._defaultVisibility);}},_processAttributes:function(){var attributes=this._definitionAttributes,Constructor,newPrototype;if(attributes){_gpfAssert("function"===typeof _gpfAttributesAdd,"Attributes can't be defined before they exist");Constructor=this._Constructor;newPrototype=Constructor.prototype;_gpfObjectForEach(attributes,function(attributeList,attributeName){attributeName=_gpfDecodeAttributeMember(attributeName);if(attributeName in newPrototype||attributeName==="Class"){_gpfAttributesAdd(Constructor,attributeName,attributeList);}else{console.error("gpf.define: Invalid attribute name '"+attributeName+"'");}});}},_getNewClassConstructor:function(name){var builder=new _GpfFunctionBuilder(_gpfNewClassConstructorTpl);builder.replaceInBody({"function":"function "+name});return builder.generate()(this);},_safeNewSuper:function(){var result;_gpfClassConstructorAllowed=false;result=new this._Super;_gpfClassConstructorAllowed=true;return result;},_build:function(){var newClass,newPrototype,baseClassDef,constructorName;constructorName=this._name.split(".").pop();newClass=this._getNewClassConstructor(constructorName);this._Constructor=newClass;newClass[_GPF_CLASSDEF_MARKER]=this._uid;newPrototype=this._safeNewSuper();newClass.prototype=newPrototype;newPrototype.constructor=newClass;baseClassDef=_gpfGetClassDefinition(this._Super);baseClassDef._Subs.push(newClass);this._processDefinition(this._definition,_GPF_VISIBILITY_UNKNOWN);this._processAttributes();this._resolveConstructor();},_resolveConstructor:function(){if(this._definitionConstructor){this._resolvedConstructor=this._definitionConstructor;}else if(Object!==this._Super){this._resolvedConstructor=this._Super;}}};function _gpfDefineCore(name,base,definition){_gpfAsserts({"name is required (String)":"string"===typeof name,"base is required (String|Function)":"string"===typeof base||base instanceof Function,"definition is required (Object)":"object"===typeof definition});var result,path,ns,leafName,classDef;if(-1<name.indexOf(".")){path=name.split(".");leafName=path.pop();ns=_gpfContext(path,true);}if("string"===typeof base){base=_gpfContext(base.split("."));_gpfAssert(base instanceof Function,"base must resolve to a function");}classDef=new _GpfClassDefinition(name,base,definition);result=classDef._Constructor;if(undefined!==ns){ns[leafName]=result;}return result;}function _gpfCleanDefinition(name,shortcut){var shortcutValue=this[shortcut];if(undefined!==shortcutValue){this[name]=shortcutValue;delete this[shortcut];}}var _gpfCleaningShortcuts={"-":"private","#":"protected","+":"public","~":"static"};function _gpfDefine(name,base,definition){_gpfObjectForEach(_gpfCleaningShortcuts,_gpfCleanDefinition,definition);return _gpfDefineCore(name,base,definition);}gpf.define=function(name,base,definition){if("object"===typeof base){definition=base;base=undefined;}if(undefined===base){base=Object;}return _gpfDefineCore(name,base,definition||{});};function _gpfGenDefHandler(ctxRoot,defaultBase){ctxRoot+=".";defaultBase=ctxRoot+defaultBase;return function(name,base,definition){if(undefined===definition&&"object"===typeof base){definition=base;base=defaultBase;}if(-1===name.indexOf(".")){name=ctxRoot+name;}return _gpfDefine(name,base||defaultBase,definition||{});};}_GpfClassDefinition.prototype._attributes=null;var _gpfA=gpf.attributes={},_gpfEmptyMemberArray;function _gpfAlias(objectClass,name){name="$"+name;gpf[name]=function(){var Proxy=_gpfFunc("return function "+name+"(args) {this.constructor.apply(this, args);};")();Proxy.prototype=objectClass.prototype;return function(){return new Proxy(arguments);};}();}function _gpfIArrayGetItemsCount(member){return _gpfFunc("return this."+member+".length;");}function _gpfIArrayGetItem(member){return _gpfFunc(["idx"],"return this."+member+"[idx];");}var _gpfDefAttrBase=_gpfGenDefHandler("gpf.attributes","Attribute");function _gpfDefAttr(name,base,definition){var isAlias=name.charAt(0)==="$",fullName,result;if(isAlias){name=name.substr(1);fullName=name+"Attribute";}else{fullName=name;}result=_gpfDefAttrBase(fullName,base,definition);if(isAlias){_gpfAlias(result,name);}return result;}var _gpfAttribute=_gpfDefine("gpf.attributes.Attribute",Object,{"#":{_member:"",_alterPrototype:function(objPrototype){_gpfIgnore(objPrototype);}},"+":{getMemberName:function(){return this._member;}}});var _gpfAssertAttributeClassOnly,_gpfAssertAttributeOnly;_gpfAssertAttributeClassOnly=_gpfEmptyFunc;_gpfAssertAttributeOnly=_gpfEmptyFunc;_gpfDefine("gpf.attributes.Array",Object,{"-":{_array:[]},"+":{constructor:function(){this._array=[];},getItemsCount:_gpfIArrayGetItemsCount("_array"),getItem:_gpfIArrayGetItem("_array"),has:function(expectedClass){_gpfAssertAttributeClassOnly(expectedClass);return!this._array.every(function(attribute){return!(attribute instanceof expectedClass);});},filter:function(expectedClass){_gpfAssertAttributeClassOnly(expectedClass);var result=new _gpfA.Array;result._array=this._array.filter(function(attribute){return attribute instanceof expectedClass;});return result;},forEach:function(callback,thisArg){this._array.forEach(callback,thisArg);},every:function(callback,thisArg){return this._array.every(callback,thisArg);}}});_gpfEmptyMemberArray=new _gpfA.Array;_gpfDefine("gpf.attributes.Map",Object,{"-":{_members:{},_count:0,_copy:function(to,callback,param){_gpfObjectForEach(this._members,function(attributeArray,member){member=_gpfDecodeAttributeMember(member);attributeArray._array.forEach(function(attribute){if(!callback||callback(member,attribute,param)){to.add(member,attribute);}});});return to;},_filterCallback:function(member,attribute,expectedClass){_gpfIgnore(member);return attribute instanceof expectedClass;}},"+":{constructor:function(object){this._members={};if(object instanceof Function){this.fillFromClassDef(_gpfGetClassDefinition(object));}else if(undefined!==object){this.fillFromObject(object);}},fillFromClassDef:function(classDef){var attributes,Super;while(classDef){attributes=classDef._attributes;if(attributes){attributes._copy(this);}Super=classDef._Super;if(Super===Object){break;}else{classDef=_gpfGetClassDefinition(Super);}}return this;},fillFromObject:function(object){var classDef=_gpfGetClassDefinition(object.constructor);return this.fillFromClassDef(classDef);},getCount:function(){return this._count;},add:function(member,attribute){_gpfAssertAttributeOnly(attribute);member=_gpfEncodeAttributeMember(member);var array=this._members[member];if(undefined===array){array=this._members[member]=new _gpfA.Array;}array._array.push(attribute);++this._count;},filter:function(expectedClass){_gpfAssertAttributeClassOnly(expectedClass);return this._copy(new _gpfA.Map,this._filterCallback,expectedClass);},getMemberAttributes:function(member){member=_gpfEncodeAttributeMember(member);var result=this._members[member];if(undefined===result||!(result instanceof _gpfA.Array)){return _gpfEmptyMemberArray;}return result;},getMembers:function(){var result=[];_gpfObjectForEach(this._members,function(attributes,member){_gpfIgnore(attributes);result.push(_gpfDecodeAttributeMember(member));});return result;},forEach:function(callback,thisArg){_gpfObjectForEach(this._members,function(attributes,member,dictionary){callback.call(thisArg,attributes,_gpfDecodeAttributeMember(member),dictionary);});}}});var _gpfAttributesAdd=_gpfA.add=function(objectClass,name,attributes){if(attributes instanceof _gpfA.Array){attributes=attributes._array;}else if(!(attributes instanceof Array)){attributes=[attributes];}var classDef=_gpfGetClassDefinition(objectClass),objectClassOwnAttributes=classDef._attributes,len,idx,attribute;if(!objectClassOwnAttributes){objectClassOwnAttributes=classDef._attributes=new _gpfA.Map;}len=attributes.length;for(idx=0;idx<len;++idx){attribute=attributes[idx];_gpfAssert(attribute instanceof _gpfAttribute,"Expected attribute");attribute._member=name;objectClassOwnAttributes.add(name,attribute);attribute._alterPrototype(objectClass.prototype);}};_gpfErrorDeclare("a_attributes",{onlyForAttributeClass:"The attribute {attributeName} can be used only on an Attribute class",onlyOnClassForAttributeClass:"The attribute {attributeName} must be used on Class",classOnlyAttribute:"The attribute {attributeName} can be used only for Class",memberOnlyAttribute:"The attribute {attributeName} can be used only for members",uniqueAttributeConstraint:"Attribute {attributeName} already defined on {className}",uniqueMemberAttributeConstraint:"Attribute {attributeName} already defined on {className}::{memberName}"});function _GpfAttrOnlyCheck(targetAttribute,objPrototype){_gpfIgnore(targetAttribute,objPrototype);throw gpf.Error.abstractMethod();}var _GpfAttrOnly=_gpfDefAttr("AttrClassOnlyAttribute",{"#":{_alterPrototype:function(objPrototype){if(!(objPrototype instanceof _gpfAttribute)){throw gpf.Error.onlyForAttributeClass({attributeName:_gpfGetClassDefinition(this.constructor)._name});}if(this._member!=="Class"){throw gpf.Error.onlyOnClassForAttributeClass({attributeName:_gpfGetClassDefinition(this.constructor)._name});}}}}),_gpfAttrConstraint=_gpfDefAttr("AttrConstraintAttribute",_GpfAttrOnly,{"~":{originalAlterPrototype:"_alterPrototype:checked"},"-":{_checkAndAlterPrototype:function(objPrototype){var me=this,statics=_gpfA.AttrConstraintAttribute,originalAlterPrototype=statics.originalAlterPrototype,attributes=new _gpfA.Map(me);attributes.filter(_gpfAttrConstraint).forEach(function(constraintAttributes){constraintAttributes.forEach(function(attribute){attribute._check(me,objPrototype);});});me[originalAlterPrototype](objPrototype);}},"#":{_check:_GpfAttrOnlyCheck,_alterPrototype:function(objPrototype){var statics=_gpfA.AttrConstraintAttribute,originalAlterPrototype=statics.originalAlterPrototype;this._super(objPrototype);if(undefined===objPrototype[originalAlterPrototype]){objPrototype[originalAlterPrototype]=objPrototype._alterPrototype;objPrototype._alterPrototype=this._checkAndAlterPrototype;}}}});_gpfDefAttr("$ClassAttribute",_gpfAttrConstraint,{"#":{_check:function(targetAttribute,objPrototype){_gpfIgnore(objPrototype);if(targetAttribute._member!=="Class"){var attributeClass=targetAttribute.constructor,attributeClassDef=_gpfGetClassDefinition(attributeClass);throw gpf.Error.classOnlyAttribute({attributeName:attributeClassDef._name});}}}});_gpfDefAttr("$MemberAttribute",_gpfAttrConstraint,{"#":{_check:function(targetAttribute,objPrototype){_gpfIgnore(objPrototype);if(targetAttribute._member==="Class"){var attributeClass=targetAttribute.constructor,attributeClassDef=_gpfGetClassDefinition(attributeClass);throw gpf.Error.memberOnlyAttribute({attributeName:attributeClassDef._name});}}}});_gpfDefAttr("$UniqueAttribute",_gpfAttrConstraint,{"-":{_classScope:true},"#":{_check:function(targetAttribute,objPrototype){var objectClass,objectClassDef,objectClassAttributes,attributeClass,attributeClassDef,attributesInObj,member=targetAttribute._member;objectClass=objPrototype.constructor;objectClassDef=_gpfGetClassDefinition(objectClass);objectClassAttributes=new _gpfA.Map(objectClass);attributeClass=targetAttribute.constructor;attributeClassDef=_gpfGetClassDefinition(attributeClass);attributesInObj=objectClassAttributes.filter(attributeClass);if(this._classScope){if(1<attributesInObj.getCount()){throw gpf.Error.uniqueAttributeConstraint({attributeName:attributeClassDef._name,className:objectClassDef._name});}}else if(1<attributesInObj.getMemberAttributes(member).getItemsCount()){throw gpf.Error.uniqueMemberAttributeConstraint({attributeName:attributeClassDef._name,className:objectClassDef._name,memberName:member});}}},"+":{constructor:function(classScope){if(undefined!==classScope){this._classScope=true===classScope;}}}});var _gpfClassAttribute=_gpfDefAttr("ClassAttribute"),_gpfANoSerial;function _gpfGetProperty(){return this._MEMBER_;}function _gpfSetProperty(value){var result=this._MEMBER_;this._MEMBER_=value;return result;}function _gpfBuildPropertyFunc(template,member){var src,params,start,end;src=template.toString().split("_MEMBER_").join(member);start=src.indexOf("(")+1;end=src.indexOf(")",start)-1;params=src.substr(start,end-start+1).split(",").map(function(name){return name.trim();});start=src.indexOf("{")+1;end=src.lastIndexOf("}")-1;src=src.substr(start,end-start+1);return _gpfFunc(params,src);}_gpfDefAttr("$ClassProperty",_gpfClassAttribute,{"[Class]":[gpf.$MemberAttribute(),gpf.$UniqueAttribute(false)],"-":{_writeAllowed:false,_publicName:undefined,_visibility:undefined},"#":{_alterPrototype:function(objPrototype){var member=this._member,name=this._publicName,visibility=this._visibility,classDef=_gpfGetClassDefinition(objPrototype.constructor);if(!name){if("_"===member.charAt(0)){name=member.substr(1);}else{name=member;}}name=_gpfStringCapitalize(name);if(this._writeAllowed){classDef.addMember("set"+name,_gpfBuildPropertyFunc(_gpfSetProperty,member),visibility);}classDef.addMember("get"+name,_gpfBuildPropertyFunc(_gpfGetProperty,member),visibility);}},"+":{constructor:function(writeAllowed,publicName,visibility){if(writeAllowed){this._writeAllowed=true;}if("string"===typeof publicName){this._publicName=publicName;}if("string"===typeof visibility){this._visibility=visibility;}}}});_gpfDefAttr("$ClassEventHandler",_gpfClassAttribute,{"[Class]":[gpf.$MemberAttribute(),gpf.$UniqueAttribute(false)]});_gpfANoSerial=_gpfDefAttr("$ClassNonSerialized",_gpfClassAttribute,{"[Class]":[gpf.$MemberAttribute(),gpf.$UniqueAttribute(false)]});_gpfErrorDeclare("interfaces",{interfaceExpected:"Expected interface not implemented: {name}"});function _gpfIsImplementedBy(inspectedObject,interfaceDefinition){var member,memberReference,memberValue,memberType;for(member in interfaceDefinition.prototype){if("constructor"===member){continue;}memberReference=interfaceDefinition.prototype[member];memberValue=inspectedObject[member];memberType=typeof memberValue;if(typeof memberReference!==memberType){return false;}if("function"===memberType&&memberReference.length!==memberValue.length){return false;}}return true;}function _gpfQueryInterface(objectInstance,interfaceDefinition,throwError){var result=null;if(_gpfIsImplementedBy(objectInstance,interfaceDefinition)){return objectInstance;}else if(_gpfIsImplementedBy(objectInstance,gpf.interfaces.IUnknown)){result=objectInstance.queryInterface(interfaceDefinition);}if(null===result&&(undefined===throwError||throwError)){throw gpf.Error.interfaceExpected({name:_gpfGetClassDefinition(interfaceDefinition)._name});}return result;}var _gpfI=gpf.interfaces={isImplementedBy:function(inspectedObject,interfaceDefinition){if(inspectedObject instanceof Function){inspectedObject=inspectedObject.prototype;}return _gpfIsImplementedBy(inspectedObject,interfaceDefinition);},query:_gpfQueryInterface};var _gpfDefIntrf=_gpfGenDefHandler("gpf.interfaces","Interface");_gpfDefine("gpf.interfaces.Interface",Object,{});_gpfDefIntrf("IEventDispatcher",{addEventListener:function(event,eventsHandler){_gpfIgnore(event,eventsHandler);return this;},removeEventListener:function(event,eventsHandler){_gpfIgnore(event,eventsHandler);return this;},dispatchEvent:function(event,params){_gpfIgnore(event,params);}});var _gpfIUnknown=_gpfDefIntrf("IUnknown",{queryInterface:function(interfaceDefinition){_gpfIgnore(interfaceDefinition);return null;}});function _queryInterface(interfaceDefinition){var array=new gpf.attributes.Map(this).getMemberAttributes("Class").filter(gpf.attributes.InterfaceImplementAttribute),builder;if(!array.every(function(attribute){builder=attribute._builder;return attribute._interfaceDefinition!==interfaceDefinition||!builder;})){if("function"===typeof builder){return builder(this);}return this[builder]();}return null;}function _wrapQueryInterface(orgQueryInterface){return function(interfaceDefinition){_gpfIgnore(interfaceDefinition);var result=_queryInterface.apply(this,arguments);if(null===result){result=orgQueryInterface.apply(this,arguments);}return result;};}_gpfDefAttr("$InterfaceImplement",{"-":{"[_interfaceDefinition]":[gpf.$ClassProperty(false)],_interfaceDefinition:_gpfEmptyFunc,"[_builder]":[gpf.$ClassProperty(false)],_builder:null,_addMissingInterfaceMembers:function(objPrototype){var iProto=this._interfaceDefinition.prototype,member;for(member in iProto){if(!(member in objPrototype)){objPrototype[member]=iProto[member];}}},_addQueryInterface:function(objPrototype){if(undefined===objPrototype.queryInterface){objPrototype.queryInterface=_queryInterface;_gpfAttributesAdd(objPrototype.constructor,"Class",[gpf.$InterfaceImplement(_gpfIUnknown)]);}else if(_queryInterface!==objPrototype.queryInterface){objPrototype.queryInterface=_wrapQueryInterface(objPrototype.queryInterface);}}},"#":{_alterPrototype:function(objPrototype){if(this._builder){this._addQueryInterface(objPrototype);}else{this._addMissingInterfaceMembers(objPrototype);new gpf.attributes.Map().fillFromClassDef(_gpfGetClassDefinition(this._interfaceDefinition)).forEach(function(attributes,member){_gpfAttributesAdd(objPrototype.constructor,member,attributes);});}}},"+":{constructor:function(interfaceDefinition,queryInterfaceBuilder){this._interfaceDefinition=interfaceDefinition;if(queryInterfaceBuilder){this._builder=queryInterfaceBuilder;}}}});_gpfErrorDeclare("i_enumerator",{enumerableInvalidMember:"$Enumerator can be associated to arrays only"});function _gpfEnumeratorEach(enumerator,callback,eventsHandler){var iEnumerator=_gpfI.query(enumerator,_gpfI.IEnumerator),process;function end(event){_gpfEventsFire.call(enumerator,event,{},eventsHandler);}if(1<callback.length){process=function(event){if(gpf.events.EVENT_CONTINUE===event.type){if(!iEnumerator.moveNext(process)){return;}}else if(gpf.events.EVENT_STOP===event.type){return end(gpf.events.EVENT_STOPPED);}else if(gpf.events.EVENT_DATA!==event.type){return end(event.type);}callback(iEnumerator.current(),process);};if(iEnumerator.moveNext(process)){callback(iEnumerator.current(),process);}}else{process=function(event){if(gpf.events.EVENT_DATA!==event.type){return end(event);}do{callback(iEnumerator.current());}while(iEnumerator.moveNext(process));};while(iEnumerator.moveNext(process)){callback(iEnumerator.current());}}}function _gpfArrayEnumerator(array){var pos=-1;return{reset:function(){pos=-1;},moveNext:function(eventsHandler){var result;++pos;result=pos<array.length;if(!result&&eventsHandler){_gpfEventsFire.call(this,_GPF_EVENT_END_OF_DATA,{},eventsHandler);}return result;},current:function(){return array[pos];}};}_gpfDefIntrf("IEnumerator",{reset:function(){},"[moveNext]":[gpf.$ClassEventHandler()],moveNext:function(eventsHandler){_gpfIgnore(eventsHandler);return false;},current:function(){return null;},"~":{each:_gpfEnumeratorEach,fromArray:_gpfArrayEnumerator}});function _buildEnumeratorOnObjectArray(object){var attributes=new _gpfA.Map(object).filter(_gpfA.EnumerableAttribute),members=attributes.getMembers();return _gpfArrayEnumerator(object[members[0]]);}_gpfDefAttr("$Enumerable",_gpfA.ClassAttribute,{"Class":[gpf.$UniqueAttribute(),gpf.$MemberAttribute()],_alterPrototype:function(objPrototype){if(!_gpfIsArrayLike(objPrototype[this._member])){throw gpf.Error.enumerableInvalidMember();}_gpfAttributesAdd(objPrototype.constructor,"Class",[new _gpfA.InterfaceImplementAttribute(_gpfI.IEnumerator,_buildEnumeratorOnObjectArray)]);}});var iROArray=_gpfDefIntrf("IReadOnlyArray",{getItemsCount:function(){return 0;},getItem:function(idx){_gpfIgnore(idx);return undefined;}});_gpfDefIntrf("IArray",iROArray,{setItemsCount:function(count){_gpfIgnore(count);return 0;},setItem:function(idx,value){_gpfIgnore(idx,value);return undefined;}});_gpfDefAttr("$ClassIArray",_gpfA.ClassAttribute,{"[Class]":[gpf.$UniqueAttribute(),gpf.$MemberAttribute()],"-":{_writeAllowed:false},"#":{_alterPrototype:function(objPrototype){var implementedInterface,member=this._member;if(this._writeAllowed){implementedInterface=_gpfI.IArray;}else{implementedInterface=_gpfI.IReadOnlyArray;}_gpfAttributesAdd(objPrototype.constructor,"Class",[gpf.$InterfaceImplement(implementedInterface)]);objPrototype.getItemsCount=_gpfIArrayGetItemsCount(member);objPrototype.getItem=_gpfIArrayGetItem(member);if(this._writeAllowed){objPrototype.setItemsCount=_gpfFunc(["count"],["var oldValue = this.",member,".length;","this.",member,".length = count;","return oldValue;"].join(""));objPrototype.setItem=_gpfFunc(["idx","value"],["var oldValue = this.",member,"[idx];","this.",member,"[idx] = value;","return oldValue;"].join(""));}}},"+":{constructor:function(writeAllowed){if(writeAllowed){this._writeAllowed=true;}}}});_gpfAttributesAdd(_gpfA.Array,"_array",[gpf.$ClassIArray(false)]);_gpfDefIntrf("IReadableStream",{"[read]":[gpf.$ClassEventHandler()],read:function(size,eventsHandler){_gpfIgnore(size,eventsHandler);}});_gpfDefIntrf("IWritableStream",{"[write]":[gpf.$ClassEventHandler()],write:function(buffer,eventsHandler){_gpfIgnore(buffer,eventsHandler);}});_gpfDefIntrf("IFileStorage",{"[getInfo]":[gpf.$ClassEventHandler()],getInfo:function(path,eventsHandler){_gpfIgnore(path,eventsHandler);},"[readAsBinaryStream]":[gpf.$ClassEventHandler()],readAsBinaryStream:function(path,eventsHandler){_gpfIgnore(path,eventsHandler);},"[writeAsBinaryStream]":[gpf.$ClassEventHandler()],writeAsBinaryStream:function(path,eventsHandler){_gpfIgnore(path,eventsHandler);},close:function(stream,eventsHandler){_gpfIgnore(stream,eventsHandler);},"[explore]":[gpf.$ClassEventHandler()],explore:function(path,eventsHandler){_gpfIgnore(path,eventsHandler);},"[createFolder]":[gpf.$ClassEventHandler()],createFolder:function(path,eventsHandler){_gpfIgnore(path,eventsHandler);},"[deleteFile]":[gpf.$ClassEventHandler()],deleteFile:function(path,eventsHandler){_gpfIgnore(path,eventsHandler);},"[deleteFolder]":[gpf.$ClassEventHandler()],deleteFolder:function(path,eventsHandler){_gpfIgnore(path,eventsHandler);}});_gpfErrorDeclare("fs",{"fileNotFound":"File not found"});function _gpfFsExploreEnumerator(iFileStorage,listOfPaths){var pos=-1,info;listOfPaths=[].concat(listOfPaths);return{reset:function(){pos=-1;},moveNext:function(eventsHandler){var me=this;++pos;info=undefined;if(eventsHandler){if(pos<listOfPaths.length){iFileStorage.getInfo(listOfPaths[pos],function(event){if(_GPF_EVENT_ERROR===event.type){_gpfEventsFire.call(me,event,{},eventsHandler);return;}info=event.get("info");_gpfEventsFire.call(me,_GPF_EVENT_DATA,{},eventsHandler);});}else{_gpfEventsFire.call(me,_GPF_EVENT_END_OF_DATA,{},eventsHandler);}}return false;},current:function(){return info;}};}function _gpfFsBuildFindMethod(iFileStorage){return function(basePath,filters,eventsHandler){var pendingCount=0,match=gpf.path.match,compiledFilters=gpf.path.compileMatchPattern(filters);function _fire(event,params){_gpfEventsFire(event,params||{},eventsHandler);}function _done(event){if(_GPF_EVENT_ERROR===event.type){_fire(event);}if(0===--pendingCount){_fire(_GPF_EVENT_END_OF_DATA);}}function _explore(fileInfo){var filePath,relativePath,fileInfoType=fileInfo.type;if(_GPF_FS_TYPE_DIRECTORY===fileInfoType){++pendingCount;iFileStorage.explore(fileInfo.filePath,function(event){if(_GPF_EVENT_ERROR===event.type){_fire(event);}else{_gpfI.IEnumerator.each(event.get("enumerator"),_explore,_done);}});}else if(_GPF_FS_TYPE_FILE===fileInfoType){filePath=fileInfo.filePath;relativePath=gpf.path.relative(basePath,filePath);if(match(compiledFilters,relativePath)){_fire(_GPF_EVENT_DATA,{path:relativePath});}}}iFileStorage.getInfo(basePath,function(event){if(_GPF_EVENT_ERROR===event.type){_fire(event);}else{_explore(event.get("info"));}});};}gpf.fs={host:function(){return null;},find:_gpfEmptyFunc};_gpfGetBootstrapMethod("gpf.fs.find",function(){return _gpfFsBuildFindMethod(gpf.fs.host());});_gpfCreateConstants(gpf.fs,{TYPE_NOT_FOUND:_GPF_FS_TYPE_NOT_FOUND,TYPE_FILE:_GPF_FS_TYPE_FILE,TYPE_DIRECTORY:_GPF_FS_TYPE_DIRECTORY,TYPE_UNKNOWN:_GPF_FS_TYPE_UNKNOWN});_gpfErrorDeclare("stream",{readInProgress:"A read operation is already in progress",writeInProgress:"A write operation is already in progress"});var _GPF_STREAM_DEFAULT_READ_SIZE=4096;gpf.stream={};function _GpfStreamPipe(configuration,eventsHandler){this._readable=_gpfQueryInterface(configuration.readable,_gpfI.IReadableStream,true);this._writable=_gpfQueryInterface(configuration.writable,_gpfI.IWritableStream,true);if(undefined!==configuration.chunkSize){this._chunkSize=configuration.chunkSize;}this._eventsHandler=eventsHandler;}_GpfStreamPipe.prototype={_readable:null,_writable:null,_chunkSize:_GPF_STREAM_DEFAULT_READ_SIZE,_eventsHandler:null,scope:null};_GpfStreamPipe.prototype[_GPF_EVENT_READY]=function(event){_gpfIgnore(event);this._readable.read(this._chunkSize,this);};_GpfStreamPipe.prototype[_GPF_EVENT_END_OF_DATA]=function(event){_gpfIgnore(event);_gpfEventsFire.call(this,_GPF_EVENT_READY,{},this._eventsHandler);};_GpfStreamPipe.prototype[_GPF_EVENT_DATA]=function(event){var buffer=event.get("buffer");this._writable.write(buffer,this);};_GpfStreamPipe.prototype[_GPF_EVENT_ANY]=function(event){_gpfEventsFire.call(this,event,{},this._eventsHandler);};function _gpfStreamPipe(configuration,eventsHandler){var scope=new _GpfStreamPipe(configuration,eventsHandler);scope.ready();}gpf.stream.pipe=_gpfStreamPipe;function _gpfStringArrayCountToFit(strings,size){var stringsLength=strings.length,count=0,string,length;while(0<size&&count<stringsLength){string=strings[count];length=string.length;if(length<=size){++count;size-=length;}else{break;}}return{count:count,remaining:size};}function _gpfStringArraySplice(strings,itemsCount,characterCount){var result,string;_gpfAssert(itemsCount<=strings.length,"itemsCount within strings range");if(0<itemsCount){result=strings.splice(0,itemsCount);}else{result=[];}if(strings.length&&characterCount){string=strings.shift();result.push(string.substr(0,characterCount));strings.unshift(string.substr(characterCount));}return result.join("");}function _gpfStringArrayExtract(strings,size){var parts=_gpfStringArrayCountToFit(strings,size);return _gpfStringArraySplice(strings,parts.count,parts.remaining);}var _GpfStringStream=_gpfDefine("StringStream",Object,{"[Class]":[gpf.$InterfaceImplement(_gpfI.IReadableStream),gpf.$InterfaceImplement(_gpfI.IWritableStream)],"+":{constructor:function(string){if("string"===typeof string){this._buffer=[string];}else{this._buffer=[];}},read:function(count,eventsHandler){var result;if(0===this._buffer.length){_gpfEventsFire.call(this,_GPF_EVENT_END_OF_DATA,{},eventsHandler);}else{result=_gpfStringArrayExtract(this._buffer,count);_gpfEventsFire.call(this,_GPF_EVENT_DATA,{buffer:result},eventsHandler);}},write:function(buffer,eventsHandler){_gpfAssert("string"===typeof buffer&&buffer.length,"String buffer must contain data");this._buffer.push(buffer);_gpfEventsFire.call(this,_GPF_EVENT_READY,{},eventsHandler);},toString:function(){return this._buffer.join("");}},"-":{_buffer:[]}});_gpfExtend(gpf,{capitalize:_gpfStringCapitalize,replaceEx:_gpfStringReplaceEx,escapeFor:_gpfStringEscapeFor,stringExtractFromStringArray:_gpfStringArrayExtract,stringToStream:function(that){return new _GpfStringStream(that);},stringFromStream:function(stream,eventsHandler){if(stream instanceof _GpfStringStream){_gpfEventsFire(_GPF_EVENT_READY,{buffer:stream.toString()},eventsHandler);}else{var stringStream=new _GpfStringStream;_gpfStreamPipe({readable:stream,writable:stringStream},function(event){if(_GPF_EVENT_READY===event.type){_gpfEventsFire(_GPF_EVENT_READY,{buffer:stringStream.toString()},eventsHandler);}else{_gpfEventsFire(event,{},eventsHandler);}});}}});var _GpfArrayStream=_gpfDefine("ArrayStream",Object,{"[Class]":[gpf.$InterfaceImplement(_gpfI.IReadableStream),gpf.$InterfaceImplement(_gpfI.IWritableStream)],"+":{constructor:function(array){if(array instanceof Array){this._buffer=[].concat(array);}else{this._buffer=[];}},read:function(count,eventsHandler){var result;if(0===this._buffer.length){_gpfEventsFire.call(this,_GPF_EVENT_END_OF_DATA,{},eventsHandler);}else{result=this._buffer.splice(0,count);_gpfEventsFire.call(this,_GPF_EVENT_DATA,{buffer:result},eventsHandler);}},write:function(buffer,eventsHandler){_gpfAssert(buffer instanceof Array,"Array expected");this._buffer=this._buffer.concat(buffer);_gpfEventsFire.call(this,_GPF_EVENT_READY,{},eventsHandler);},toArray:function(){return[].concat(this._buffer);}},"-":{_buffer:[]}});_gpfExtend(gpf,{arrayToStream:function(that){return new _GpfArrayStream(that);},arrayFromStream:function(stream,eventsHandler){if(stream instanceof _GpfArrayStream){_gpfEventsFire(_GPF_EVENT_READY,{buffer:stream.toArray()},eventsHandler);}else{var arrayStream=new _GpfArrayStream;_gpfStreamPipe({readable:stream,writable:arrayStream},function(event){if(_GPF_EVENT_READY===event.type){_gpfEventsFire(_GPF_EVENT_READY,{buffer:arrayStream.toArray()},eventsHandler);}else{_gpfEventsFire(event,{},eventsHandler);}});}}});}));