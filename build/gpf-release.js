
(function(root,factory){"use strict";if(typeof define==="function"&&define.amd){define(["exports"],factory);}else if(typeof exports!=="undefined"){factory(exports);}else if(typeof module!=="undefined"&&module.exports){factory(module.exports);}else{factory(root.gpf={});}}(this,function(gpf){"use strict";var _gpfVersion="0.1",_gpfHost,_gpfDosPath=false,_gpfContext,_gpfExit,_gpfResolveScope=function(scope){if(null===scope||"object"!==typeof scope){return _gpfContext;}return scope;},_gpfInNode=false,_gpfInBrowser=false,_gpfWebWindow,_gpfWebDocument,_gpfWebHead,_gpfMsFSO,_gpfNodeFS,_gpfEmptyFunc=function(){};if("undefined"!==typeof WScript){_gpfHost="wscript";_gpfDosPath=true;_gpfContext=function(){return this;}.apply(null,[]);_gpfExit=function(code){WScript.Quit(code);};_gpfContext.console={log:function(t){WScript.Echo("    "+t);},info:function(t){WScript.Echo("[?] "+t);},warn:function(t){WScript.Echo("/!\\ "+t);},error:function(t){WScript.Echo("(X) "+t);}};}else if("undefined"!==typeof phantom&&phantom.version){_gpfHost="phantomjs";_gpfDosPath=require("fs").separator==="\\";_gpfContext=window;_gpfInNode=true;_gpfInBrowser=true;_gpfExit=phantom.exit;}else if("undefined"!==typeof module&&module.exports){_gpfHost="nodejs";_gpfDosPath=require("path").sep==="\\";_gpfContext=global;_gpfInNode=true;_gpfExit=process.exit;}else if("undefined"!==typeof window){_gpfHost="browser";_gpfContext=window;_gpfInBrowser=true;_gpfExit=_gpfEmptyFunc;}else{_gpfHost="unknown";_gpfContext=this;_gpfExit=_gpfEmptyFunc;}if(_gpfInNode){gpf.node={};}gpf.web={};if(_gpfInBrowser){_gpfWebWindow=window;_gpfWebDocument=document;_gpfWebHead=_gpfWebDocument.getElementsByTagName("head")[0]||_gpfWebDocument.documentElement;}gpf.version=function(){return _gpfVersion;};gpf.host=function(){return _gpfHost;};gpf.context=function(path){var len,idx,result;if(undefined===path){return _gpfContext;}else{if("string"===typeof path){path=path.split(".");}len=path.length;idx=0;if(path[0]==="gpf"){result=gpf;++idx;}else{result=_gpfContext;}for(;idx<len;++idx){result=result[path[idx]];if(undefined===result){break;}}return result;}};gpf.loaded=function(callback){if(callback){callback();}return true;};gpf.ASSERT=function(){};var _gpfArraySlice=Array.prototype.slice;if(undefined===Array.prototype.every){Array.prototype.every=function(callback,thisArg){var len=this.length,idx;for(idx=0;idx<len;++idx){if(!callback.apply(thisArg,[this[idx],idx,this])){return false;}}return true;};}if(undefined===Array.prototype.forEach){Array.prototype.forEach=function(callback,thisArg){var len=this.length,idx;for(idx=0;idx<len;++idx){callback.apply(thisArg,[this[idx],idx,this]);}};}if(undefined===Array.prototype.indexOf){Array.prototype.indexOf=function(searchElement,fromIndex){var idx,len=this.length;if(undefined!==fromIndex){idx=fromIndex;}else{idx=0;}while(idx<len){if(this[idx]===searchElement){return idx;}++idx;}return-1;};}if(undefined===Array.prototype.map){Array.prototype.map=function(callback,thisArg){var len=this.length,result=new Array(len),idx;for(idx=0;idx<len;++idx){result[idx]=callback.apply(thisArg,[this[idx],idx,this]);}return result;};}if(undefined===Function.prototype.bind){Function.prototype.bind=function(thisArg){var thisFn=this,prependArgs=_gpfArraySlice.apply(arguments,[1]);return function(){var args=_gpfArraySlice.apply(arguments,[0]);thisFn.apply(thisArg,prependArgs.concat(args));};};}if(undefined===Object.defineProperty){gpf.setReadOnlyProperty=function(obj,name,value){obj[name]=value;return obj;};}else{gpf.setReadOnlyProperty=function(obj,name,value){Object.defineProperty(obj,name,{enumerable:true,configurable:false,writable:false,value:value});return obj;};}var _GpfFunc=Function,_gpfIgnore=_gpfEmptyFunc,_gpfFalseFunc=function(){return false;},_gpfFunc=function(source){gpf.ASSERT("string"===typeof source&&source.length,"Source expected (or use _gpfEmptyFunc)");return new _GpfFunc(source);},_gpfAlpha="abcdefghijklmnopqrstuvwxyz",_gpfALPHA="ABCDEFGHIJKLMNOPQRSTUVWXYZ",_gpfDigit="0123456789",_gpfIdentifierFirstChar=_gpfAlpha+_gpfALPHA+"_$",_gpfIdentifierOtherChars=_gpfAlpha+_gpfALPHA+_gpfDigit+"_$",_gpfJsKeywords=("break,case,catch,continue,debugger,default,delete,do,"+"else,finally,for,function,if,in,instanceof,new,return,switch,"+"this,throw,try,typeof,var,void,while,with").split(",");gpf.events={};var _GpfEvent=gpf.events.Event=function(type,params,scope){gpf.setReadOnlyProperty(this,"type",type);gpf.setReadOnlyProperty(this,"scope",_gpfResolveScope(scope));if(undefined!==params){this._params=params;}},_gpfEventsFiring=0,_gpfEventsFireCall=function(event,eventsHandler){var scope=event.scope,eventHandler;gpf.ASSERT(eventsHandler,"Expected eventsHandler");if("function"===typeof eventsHandler._dispatchEvent){eventsHandler._dispatchEvent(event);}else if("function"===typeof eventsHandler.apply){eventsHandler.apply(scope,[event]);}else{eventHandler=eventsHandler[event.type];if(undefined===eventHandler){eventHandler=eventsHandler["*"];}if(undefined!==eventHandler){eventHandler.apply(eventsHandler.scope||eventsHandler,[event]);}}},_gpfEventsFire=function(event,params,eventsHandler){var scope=_gpfResolveScope(this);if(!(event instanceof _GpfEvent)){event=new gpf.events.Event(event,params,scope);}if(++_gpfEventsFiring>10){gpf.defer(_gpfEventsFireCall,0,null,[event,eventsHandler]);}else{_gpfEventsFireCall(event,eventsHandler);}--_gpfEventsFiring;return event;},_gpfLookForEventsHandler=function(thatArgs,defaultArgs,callback){var lastExpectedIdx=defaultArgs.length,argIdx=thatArgs.length-1;if(argIdx!==lastExpectedIdx){thatArgs=_gpfArraySlice.apply(thatArgs,[0]);thatArgs[lastExpectedIdx]=thatArgs[argIdx];--argIdx;--lastExpectedIdx;while(lastExpectedIdx>argIdx){thatArgs[lastExpectedIdx]=defaultArgs[lastExpectedIdx];--lastExpectedIdx;}}return callback.apply(this,thatArgs);};_GpfEvent.prototype={constructor:_GpfEvent,type:"",scope:null,_params:{},get:function(name){return this._params[name];},fire:function(eventsHandler){return gpf.events.fire(this,eventsHandler);}};gpf.events.fire=function(){var scope=this;if(scope===gpf.events){scope=undefined;}return _gpfLookForEventsHandler.apply(scope,[arguments,[0,{}],_gpfEventsFire]);};var _GpfIncludeContext=function(src,eventsHandler){this.id=++_GpfIncludeContext.id;this.src=src;this.eventsHandler=eventsHandler;_GpfIncludeContext.map[this.id]=this;},_gpfWebIncludeInsert=function(domScript){_gpfWebHead.insertBefore(domScript,_gpfWebHead.firstChild);},_gpfWebIncludeAsyncResult=function(parameters){gpf.events.fire.apply(_gpfContext,parameters);},_gpfWebInclude=function(src,eventsHandler){var context=new _GpfIncludeContext(src,eventsHandler),domScript=_gpfWebDocument.createElement("script");domScript.language="javascript";domScript.src=src;domScript.id=context.id;domScript.onload=domScript.onreadystatechange=_GpfIncludeContext.onLoad;domScript.onerror=_GpfIncludeContext.onError;if(undefined!==domScript.async){domScript.async=true;}setTimeout(_gpfWebIncludeInsert,0,domScript);};_GpfIncludeContext.prototype={id:0,src:"",eventsHandler:null,clean:function(domScript){var parent=domScript.parentNode;domScript.onerror=domScript.onload=domScript.onreadystatechange=null;if(parent){parent.removeChild(domScript);}delete _GpfIncludeContext.map[this.id];},check:function(domScript){var readyState=domScript.readyState;if(!readyState||-1<["loaded","complete"].indexOf(readyState)){this.clean(domScript);setTimeout(_gpfWebIncludeAsyncResult,0,["load",{url:this.src},this.eventsHandler]);}},failed:function(domScript){this.clean(domScript);setTimeout(_gpfWebIncludeAsyncResult,0,["error",{url:this.src},this.eventsHandler]);}};_GpfIncludeContext.id=0;_GpfIncludeContext.map={};_GpfIncludeContext.onLoad=function(){var context=_GpfIncludeContext.map[this.id];if(context){context.check(this);}};_GpfIncludeContext.onError=function(){var context=_GpfIncludeContext.map[this.id];if(context){context.failed(this);}};if(_gpfInBrowser){gpf.web.include=_gpfWebInclude;}var _gpfArrayEachWithResult=function(array,memberCallback,defaultResult){var result,len=array.length,idx;for(idx=0;idx<len;++idx){result=memberCallback.apply(this,[idx,array[idx]]);if(undefined!==result){return result;}}return defaultResult;},_gpfArrayEach=function(array,memberCallback){var len=array.length,idx;for(idx=0;idx<len;++idx){memberCallback.apply(this,[idx,array[idx]]);}},_gpfDictionaryEachWithResult=function(dictionary,memberCallback,defaultResult){var result,member;for(member in dictionary){if(dictionary.hasOwnProperty(member)){result=memberCallback.apply(this,[member,dictionary[member]]);if(undefined!==result){return result;}}}return defaultResult;},_gpfDictionaryEach=function(dictionary,memberCallback){var member;for(member in dictionary){if(dictionary.hasOwnProperty(member)){memberCallback.apply(this,[member,dictionary[member]]);}}},_gpfAssign=function(member,value){this[0][member]=value;},_gpfAssignOrCall=function(member,value){var dictionary=this[0],overwriteCallback=this[2];if(undefined!==dictionary[member]){overwriteCallback(dictionary,member,value);}else{dictionary[member]=value;}},_gpfValues={boolean:function(value,valueType,defaultValue){if("string"===valueType){if("yes"===value||"true"===value){return true;}return 0!==parseInt(value,10);}if("number"===valueType){return 0!==value;}return defaultValue;},number:function(value,valueType,defaultValue){if("string"===valueType){return parseFloat(value);}return defaultValue;},string:function(value,valueType,defaultValue){gpf.interfaces.ignoreParameter(valueType);gpf.interfaces.ignoreParameter(defaultValue);if(value instanceof Date){return gpf.dateToComparableFormat(value);}return value.toString();},object:function(value,valueType,defaultValue){if(defaultValue instanceof Date&&"string"===valueType){return gpf.dateFromComparableFormat(value);}return defaultValue;}},_gpfStringCapitalize=function(that){return that.charAt(0).toUpperCase()+that.substr(1);},_gpfStringReplaceEx=function(that,replacements){var result=that,key;for(key in replacements){if(replacements.hasOwnProperty(key)){if(-1<result.indexOf(key)){result=result.split(key).join(replacements[key]);}}}return result;},_gpfStringEscapes={javascript:{"\\":"\\\\","\"":"\\\"","\n":"\\n","\r":"\\r","\t":"\\t"},xml:{"&":"&amp;","<":"&lt;",">":"&gt;"},html:{"&":"&amp;","<":"&lt;",">":"&gt;","\xE9":"&eacute;","\xE8":"&egrave;","\xEA":"&ecirc;","\xE1":"&aacute;","\xE0":"&agrave;"}},_gpfStringEscapeFor=function(that,language){var replacements=_gpfStringEscapes[language];if(undefined!==replacements){that=_gpfStringReplaceEx(that,replacements);if("javascript"===language){that="\""+that+"\"";}}return that;},_gpfIsArrayLike;if("browser"===_gpfHost&&(window.HTMLCollection||window.NodeList)){_gpfIsArrayLike=function(obj){return obj instanceof Array||obj instanceof window.HTMLCollection||obj instanceof window.NodeList;};}else{_gpfIsArrayLike=function(obj){return obj instanceof Array;};}gpf.isArrayLike=_gpfIsArrayLike;gpf.each=function(dictionary,memberCallback,defaultResult){if(undefined===defaultResult){if(gpf.isArrayLike(dictionary)){_gpfArrayEach.apply(this,arguments);}else{_gpfDictionaryEach.apply(this,arguments);}return;}if(gpf.isArrayLike(dictionary)){return _gpfArrayEachWithResult.apply(this,arguments);}return _gpfDictionaryEachWithResult.apply(this,arguments);};gpf.extend=function(dictionary,additionalProperties,overwriteCallback){var callbackToUse;if(undefined===overwriteCallback){callbackToUse=_gpfAssign;}else{gpf.ASSERT("function"===typeof overwriteCallback,"Expected function");callbackToUse=_gpfAssignOrCall;}_gpfDictionaryEach.apply(arguments,[additionalProperties,callbackToUse]);return dictionary;};gpf.extend(gpf,{value:function(value,defaultValue,expectedType){var valueType=typeof value;if(!expectedType){expectedType=typeof defaultValue;}if(expectedType===valueType){return value;}if("undefined"===valueType||!value){return defaultValue;}return _gpfValues[expectedType](value,valueType,defaultValue);},clone:function(obj){return gpf.json.parse(gpf.json.stringify(obj));},test:function(dictionary,value){var idx;if(dictionary instanceof Array){idx=dictionary.length;while(idx>0){if(dictionary[--idx]===value){return idx;}}}else{for(idx in dictionary){if(dictionary.hasOwnProperty(idx)&&dictionary[idx]===value){return idx;}}}return undefined;},set:function(array,value){gpf.ASSERT(array instanceof Array,"gpf.set must be used with an Array");var idx=array.length;while(idx>0){if(array[--idx]===value){return array;}}array.push(value);return array;},clear:function(dictionary,value){var idx;if(dictionary instanceof Array){idx=dictionary.length;while(idx>0){if(dictionary[--idx]===value){dictionary.splice(idx,1);break;}}}else{for(idx in dictionary){if(dictionary.hasOwnProperty(idx)&&dictionary[idx]===value){break;}}}return dictionary;},xor:function(a,b){return a&&!b||!a&&b;},exit:function(exitCode){if(undefined===exitCode){exitCode=0;}_gpfExit(exitCode);}});if(_gpfInNode){gpf.node.buffer2JsArray=function(buffer){var result=[],len=buffer.length,idx;for(idx=0;idx<len;++idx){result.push(buffer.readUInt8(idx));}return result;};}var _GpfLikeContext=function(alike){this._pending=[];this._done=[];if(true!==alike){this._alike=_gpfFalseFunc;}else{this._haveDifferentPrototypes=_gpfFalseFunc;}};_GpfLikeContext.prototype={_pending:[],_done:[],_stack:function(a,b){var array=this._done,indexOfA,comparedWith;indexOfA=array.indexOf(a);while(-1<indexOfA){if(indexOfA%2){comparedWith=array[indexOfA-1];}else{comparedWith=array[indexOfA+1];}if(comparedWith===b){return;}indexOfA=array.indexOf(a,indexOfA+1);}array=this._pending;array.push(a);array.push(b);},_haveDifferentPrototypes:function(a,b){return a.prototype!==b.prototype;},explore:function(){var pending=this._pending,a,b,done=this._done,membersCount,member;while(0!==pending.length){b=pending.pop();a=pending.pop();if(this._haveDifferentPrototypes(a,b)){return false;}done.push(a,b);membersCount=0;for(member in a){if(a.hasOwnProperty(member)){++membersCount;if(!this.like(a,b)){return false;}}}for(member in b){if(b.hasOwnProperty(member)){--membersCount;}}if(0!==membersCount){return false;}}return true;},_downcast:function(a){if("object"===typeof a){if(a instanceof String){return a.toString();}if(a instanceof Number){return a.valueOf();}if(a instanceof Boolean){return!!a;}}return a;},_alike:function(a,b){return this._downcast(a)===this._downcast(b);},like:function(a,b){if(a===b){return true;}if(typeof a!==typeof b){return this._alike(a,b);}if(null===a||null===b||"object"!==typeof a){return false;}this._stack(a,b);return true;}};gpf.like=function(a,b,alike){var context=new _GpfLikeContext(alike);return context.like(a,b)&&context.explore();};gpf.Callback=function(handler,scope){gpf.ASSERT(handler,"Handler expected");this._handler=handler;if(scope){this._scope=_gpfResolveScope(scope);}};gpf.extend(gpf.Callback.prototype,{_handler:_gpfEmptyFunc,_scope:null,handler:function(){return this._handler;},scope:function(){return this._scope;},call:function(){return this.apply(arguments[0],_gpfArraySlice.apply(arguments,[1]));},apply:function(scope,args){var finalScope=_gpfResolveScope(scope||this._scope);return this._handler.apply(finalScope,args||[]);}});gpf.extend(gpf.Callback,{resolveScope:function(scope){return _gpfResolveScope(scope);},buildParamArray:function(count,params){var len,result,idx;if(params){len=params.length;result=new Array(count+len);for(idx=0;idx<len;++idx){result[count]=params[idx];++count;}}else{result=new Array(count);}return result;},doApply:function(callback,scope,paramArray){var len=arguments.length,idx=3,paramIdx=0;while(idx<len){paramArray[paramIdx]=arguments[idx];++idx;++paramIdx;}return callback.apply(scope,paramArray);},bind:function(obj,method,dynamic){gpf.ASSERT("string"===typeof method,"Expected method name");gpf.ASSERT("function"===typeof obj[method],"Only methods can be bound");var boundMember=method+":boundToThis",result;result=obj[boundMember];if(undefined===result){if(true===dynamic){result=function(){return obj[method].apply(obj,arguments);};}else{result=obj[method].bind(obj);}obj[boundMember]=result;}return result;}});gpf.events.EventDispatcherImpl={_eventDispatcherListeners:null,addEventListener:function(event,eventsHandler,useCapture){var listeners=this._eventDispatcherListeners;if(!listeners){listeners=this._eventDispatcherListeners={};}if(!useCapture){useCapture=false;}if(undefined===listeners[event]){listeners[event]=[];}if(useCapture){listeners[event].unshift(eventsHandler);}else{listeners[event].push(eventsHandler);}return this;},removeEventListener:function(event,eventsHandler){var listeners=this._eventDispatcherListeners,eventListeners,idx;if(listeners){eventListeners=listeners[event];if(undefined!==eventListeners){idx=eventListeners.indexOf(eventsHandler);if(-1!==idx){eventListeners.splice(idx,1);}}}return this;},_dispatchEvent:function(event,params){var listeners=this._eventDispatcherListeners,eventObj,type,eventListeners,len,idx;if(!listeners){return this;}if(event instanceof gpf.events.Event){eventObj=event;type=event.type;}else{type=event;}eventListeners=this._eventDispatcherListeners[type];if(undefined===eventListeners){return this;}if(!eventObj){eventObj=new gpf.events.Event(type,params,this);}len=eventListeners.length;for(idx=0;idx<len;++idx){gpf.events.fire.apply(this,[eventObj,eventListeners[idx]]);}return this;}};var _gpfHardCodedMimeTypes={application:{javascript:"js"},image:{gif:0,jpeg:"jpg,jpeg",png:0},text:{css:0,html:"htm,html",plain:"txt,text,log"}},_gpfMimeTypesToExtension=null,_gpfMimeTypesFromExtension=null,_gpfBuildMimeTypeFromMappings=function(path,mappings){var key,mimeType,fileExtension,extensions,len,idx;for(key in mappings){if(mappings.hasOwnProperty(key)){if(path){mimeType=path+"/"+key;}else{mimeType=key;}extensions=mappings[key];if(0===extensions){fileExtension="."+key;_gpfMimeTypesFromExtension[fileExtension]=mimeType;if(undefined===_gpfMimeTypesToExtension[mimeType]){_gpfMimeTypesToExtension[mimeType]=fileExtension;}}else if("string"===typeof extensions){extensions=extensions.split(",");len=extensions.length;for(idx=0;idx<len;++idx){fileExtension="."+extensions[idx];_gpfMimeTypesFromExtension[fileExtension]=mimeType;if(undefined===_gpfMimeTypesToExtension[mimeType]){_gpfMimeTypesToExtension[mimeType]=fileExtension;}}}else{_gpfBuildMimeTypeFromMappings(mimeType,extensions);}}}},_gpfInitMimeTypes=function(){if(null===_gpfMimeTypesFromExtension){_gpfMimeTypesFromExtension={};_gpfMimeTypesToExtension={};_gpfBuildMimeTypeFromMappings("",_gpfHardCodedMimeTypes);}};gpf.web.getMimeType=function(fileExtension){var mimeType;_gpfInitMimeTypes();mimeType=_gpfMimeTypesFromExtension[fileExtension.toLowerCase()];if(undefined===mimeType){mimeType="application/octet-stream";}return mimeType;};gpf.web.getFileExtension=function(mimeType){var fileExtension;_gpfInitMimeTypes();fileExtension=_gpfMimeTypesToExtension[mimeType.toLowerCase()];if(undefined===fileExtension){fileExtension=".bin";}return fileExtension;};"use strict";var _gpfAsyncCallback=function(callback,scope,args){if("string"===typeof callback){callback=_gpfFunc(callback);}if(!_gpfIsArrayLike(args)){args=[];}return function(){callback.apply(_gpfResolveScope(scope),args);};},_gpfAsyncQueue=[],_gpfSortOnDt=function(a,b){return a._dt-b._dt;},_gpfDefer;gpf.runAsyncQueue=_gpfEmptyFunc;if("browser"===_gpfHost){_gpfAsyncCallback=function(parameters){parameters[0].apply(_gpfResolveScope(parameters[1]),parameters[2]);};_gpfDefer=function(callback,timeout,scope,args){if("string"===typeof callback){callback=_gpfFunc(callback);}if(!timeout){timeout=0;}setTimeout(_gpfAsyncCallback,timeout,[callback,scope,args]);};}else if("undefined"!==typeof setTimeout){_gpfDefer=function(callback,timeout,scope,args){if(!timeout){timeout=0;}setTimeout(_gpfAsyncCallback(callback,scope,args),timeout);};}else if("wscript"===_gpfHost){_gpfDefer=function(callback,timeout,scope,args){var item=_gpfAsyncCallback(callback,scope,args);if(!timeout){timeout=0;}item._dt=new Date(new Date- -timeout);_gpfAsyncQueue.push(item);_gpfAsyncQueue.sort(_gpfSortOnDt);};gpf.runAsyncQueue=function(){var queue=_gpfAsyncQueue,callback;while(queue.length){callback=queue.shift();if(callback._dt>new Date){WScript.Sleep(callback._dt-new Date);}callback();}};}else{console.warn("No implementation for gpf.defer");_gpfDefer=function(callback,timeout,scope,args){_gpfIgnore(timeout);_gpfAsyncCallback(callback,scope,args)();};}gpf.defer=_gpfDefer;var _b64=_gpfALPHA+_gpfAlpha+_gpfDigit+"+/",_b16="0123456789ABCDEF",_toBaseANY=function(base,value,length,safepad){var baseLength=base.length,pow=gpf.bin.isPow2(baseLength),bits,mask,result=[],digit;if(-1<pow&&(undefined===length||length*pow<=32)){if(undefined===length){bits=32;}else{bits=length*pow;}mask=(1<<bits-pow)-1;bits=(1<<pow)-1;while(0!==value){digit=value&bits;result.unshift(base.charAt(digit));value=value>>pow&mask;}}else{while(0!==value){digit=value%baseLength;result.unshift(base.charAt(digit));value=(value-digit)/baseLength;}}if(undefined!==length){if(undefined===safepad){safepad=base.charAt(0);}while(result.length<length){result.unshift(safepad.charAt(result.length%safepad.length));}}else if(0===result.length){result=[base.charAt(0)];}return result.join("");},_fromBaseANY=function(base,text,safepad){var baseLength=base.length,result=0,idx=0;if(undefined===safepad){safepad=base.charAt(0);}while(idx<text.length){if(-1===safepad.indexOf(text.charAt(idx))){break;}else{++idx;}}while(idx<text.length){result=baseLength*result+base.indexOf(text.charAt(idx++));}return result;};gpf.bin={pow2:function(n){return 1<<n;},isPow2:function(value){if(0<value&&0===(value&value-1)){var result=0;while(1<value){++result;value>>=1;}return result;}else{return-1;}},toBaseANY:_toBaseANY,fromBaseANY:_fromBaseANY,toHexa:function(value,length,safepad){return _toBaseANY(_b16,value,length,safepad);},fromHexa:function(text,safepad){return _fromBaseANY(_b16,text,safepad);},toBase64:function(value,length,safepad){return _toBaseANY(_b64,value,length,safepad);},fromBase64:function(text,safepad){return _fromBaseANY(_b64,text,safepad);},test:function(value,bitmask){return(value&bitmask)===bitmask;},clear:function(value,bitmask){return value&~bitmask;}};var _gpfJsonStringify,_gpfJsonParse;function _gpfObject2Json(object){var isArray,results,property,value;isArray=object instanceof Array;results=[];for(property in object){if("function"===typeof object[property]){continue;}value=_gpfJsonStringify(object[property]);if(isArray){results.push(value);}else{results.push(_gpfStringEscapeFor(property,"javascript")+":"+value);}}if(isArray){return"["+results.join(",")+"]";}else{return"{"+results.join(",")+"}";}}if("undefined"===typeof JSON){_gpfJsonStringify=function(object){var type=typeof object;if("undefined"===type||"function"===type){return;}else if("number"===type||"boolean"===type){return object.toString();}else if("string"===type){return _gpfStringEscapeFor(object,"javascript");}if(null===object){return"null";}else{return _gpfObject2Json(object);}};_gpfJsonParse=function(test){return _gpfFunc("return "+test)();};}else{_gpfJsonStringify=JSON.stringify;_gpfJsonParse=JSON.parse;}gpf.json={stringify:_gpfJsonStringify,parse:_gpfJsonParse};var _gpfPatternPartSplit=function(part){return part.split("*");},_GpfPathMatcher=function(pattern){if("!"===pattern.charAt(0)){this.negative=true;pattern=pattern.substr(1);}var pos=pattern.indexOf("**");if(-1===pos){this.start=pattern.split("/").map(_gpfPatternPartSplit);}else{if(0<pos){gpf.ASSERT(pattern.charAt(pos-1)==="/","** must be preceded by /");this.start=pattern.substr(0,pos-1).split("/").map(_gpfPatternPartSplit);}if(pos<pattern.length-2){gpf.ASSERT(pattern.charAt(pos+2)==="/","** must be followed by /");this.end=pattern.substr(pos+3).split("/").map(_gpfPatternPartSplit).reverse();}}},_gpfPathMatchCompilePattern=function(pattern){if(pattern instanceof _GpfPathMatcher){return pattern;}else{return new _GpfPathMatcher(pattern);}},_gpfPathMatchCompilePatterns=function(pattern){if(pattern instanceof Array){return pattern.map(_gpfPathMatchCompilePattern);}else{return[_gpfPathMatchCompilePattern(pattern)];}},_gpfPathMatchApply=function(pathMatcher){var negative=pathMatcher.negative;if(pathMatcher.match(this.parts)){this.result=!negative;return false;}if(negative){this.result=true;return false;}return true;},_gpfPathMatch=function(pattern,path){if(_gpfDosPath){path=path.toLowerCase().split("\\").join("/");}var parts=path.split("/"),matchers=_gpfPathMatchCompilePatterns(pattern),scope={parts:parts};matchers.every(_gpfPathMatchApply,scope);return scope.result;};_GpfPathMatcher.prototype={constructor:_GpfPathMatcher,negative:false,start:null,end:null,_matchName:function(fixedPatterns,part){var len=fixedPatterns.length,idx,fixedPattern,pos=0;for(idx=0;idx<len;++idx){fixedPattern=fixedPatterns[idx];if(fixedPattern){pos=part.indexOf(fixedPattern,pos);if(-1===pos){return false;}if(0===idx&&0<pos){return false;}}}return!fixedPattern||pos+fixedPattern.length===part.length;},match:function(parts){var partsLen=parts.length,startPos=0,endPos=partsLen-1,array,len,idx;if(this.start){array=this.start;len=array.length;for(idx=0;idx<len;++idx){if(this._matchName(array[idx],parts[startPos])){if(++startPos>partsLen){return false;}}else{return false;}}}if(this.end){array=this.end;len=array.length;for(idx=0;idx<len;++idx){if(-1<endPos&&this._matchName(array[idx],parts[endPos])){if(endPos--<startPos){return false;}}else{return false;}}}return true;}};gpf.path={match:function(pattern,path){return _gpfPathMatch(pattern,path)||false;},compileMatchPattern:function(pattern){return _gpfPathMatchCompilePatterns(pattern);}};var _GPF_ERRORS={"ClassMemberOverloadWithTypeChange":"You can't overload a member to change its type","ClassInvalidVisibility":"Invalid visibility keyword","InterfaceExpected":"Expected interface not implemented: {name}","EnumerableInvalidMember":"$Enumerable can be associated to arrays only","PatternUnexpected":"Invalid syntax (unexpected)","PatternEmpty":"Empty pattern","PatternInvalidSyntax":"Invalid syntax","PatternEmptyGroup":"Syntax error (empty group)","HtmlHandlerMultiplicityError":"Too many $HtmlHandler attributes for '{member}'","HtmlHandlerMissing":"No $HtmlHandler attributes","HtmlHandlerNoDefault":"No default $HtmlHandler attribute","EngineStackUnderflow":"Stack underflow","EngineTypeCheck":"Type check","EncodingNotSupported":"Encoding not supported","EncodingEOFWithUnprocessedBytes":"Unexpected end of stream: unprocessed bytes","XmlInvalidName":"Invalid XML name","ParamsNameRequired":"Missing name","ParamsTypeUnknown":"Type unknown","ParamsRequiredMissing":"Required parameter '{name}' is missing","FileNotFound":"File not found"},_GpfError=gpf.Error=function(){},_gpfGenErrorName=function(code,name,message){var result=function(context){var error=new gpf.Error,finalMessage,replacements,key;gpf.setReadOnlyProperty(error,"code",code);gpf.setReadOnlyProperty(error,"name",name);if(context){replacements={};for(key in context){if(context.hasOwnProperty(key)){replacements["{"+key+"}"]=context[key].toString();}}finalMessage=_gpfStringReplaceEx(message,replacements);}else{finalMessage=message;}gpf.setReadOnlyProperty(error,"message",finalMessage);return error;};gpf.setReadOnlyProperty(result,"CODE",code);gpf.setReadOnlyProperty(result,"NAME",name);gpf.setReadOnlyProperty(result,"MESSAGE",message);return result;},_gpfLastErrorCode=0,_gpfErrorDeclare=function(module,list){var name,code;for(name in list){if(list.hasOwnProperty(name)){code=++_gpfLastErrorCode;gpf.Error["CODE_"+name.toUpperCase()]=code;gpf.Error[name]=_gpfGenErrorName(code,name,list[name]);}}};_GpfError.prototype={constructor:_GpfError,code:0,name:"Error",message:""};_gpfErrorDeclare("boot",{NotImplemented:"Not implemented",Abstract:"Abstract",AssertionFailed:"Assertion failed: {message}"});gpf.js={keywords:function(){return[].concat(_gpfJsKeywords);}};_gpfErrorDeclare("csv",{CsvInvalid:"Invalid CSV syntax (bad quote sequence or missing end of file)"});var _gpfCsvSeparators=";,\t ",_gpfCsvComputeSeparator=function(header){var len=_gpfCsvSeparators.length,idx,separator;for(idx=0;idx<len;++idx){separator=_gpfCsvSeparators.charAt(idx);if(-1!==header.indexOf(separator)){return separator;}}return _gpfCsvSeparators.charAt(0);},_gpfCsvUnquote=function(value,quote){var pos=value.indexOf(quote),inQuotedString=true;while(-1<pos){if(pos===value.length-1){value=value.substr(0,pos);inQuotedString=false;break;}else{if(value.charAt(pos+1)===quote){value=value.substr(0,pos)+value.substr(pos+1);}else{throw gpf.Error.CsvInvalid();}}pos=value.indexOf(quote,pos+1);}return[value,inQuotedString];},_gpfCsvReadValues=function(lines,separator,quote){var values=[],line,inQuotedString=false,includeCarriageReturn,idx,value,previousValue,unQuoted;while(lines.length){line=lines.shift();line=line.split(separator);if(inQuotedString){includeCarriageReturn=true;line.unshift(values.pop());idx=1;}else{idx=0;includeCarriageReturn=false;}while(idx<line.length){value=line[idx];if(inQuotedString){previousValue=[line[idx-1]];if(includeCarriageReturn){previousValue.push("\r\n");}else{previousValue.push(separator);}unQuoted=_gpfCsvUnquote(value,quote);previousValue.push(unQuoted[0]);inQuotedString=unQuoted[1];line[idx-1]=previousValue.join("");includeCarriageReturn=false;line.splice(idx,1);}else{if(0===value.indexOf(quote)){inQuotedString=true;unQuoted=_gpfCsvUnquote(value.substr(1),quote);line[idx]=unQuoted[0];inQuotedString=unQuoted[1];}++idx;}}values=values.concat(line);if(inQuotedString){if(0===lines.length){throw gpf.Error.CsvInvalid();}}else{return values;}}},_trimFinalR=function(line){var len=line.length-1;if("\r"===line.charAt(len)){return line.substr(0,len);}return line;},_gpfCsvParse=function(content,options){options=options||{};var lines=content.split("\n").map(_trimFinalR),header=options.header||lines.shift(),headerLen,separator=options.separator||_gpfCsvComputeSeparator(header),values,record,idx,result=[];header=header.split(separator);headerLen=header.length;while(lines.length){values=_gpfCsvReadValues(lines,separator,options.quote||"\"");record={};for(idx=0;idx<headerLen;++idx){record[header[idx]]=values[idx];}result.push(record);}return result;};gpf.csv={parse:_gpfCsvParse};}));