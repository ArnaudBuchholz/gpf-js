
(function(root,factory){"use strict";if(typeof define==="function"&&define.amd){define(["exports"],factory);}else if(typeof exports!=="undefined"){factory(exports);}else if(typeof module!=="undefined"&&module.exports){factory(module.exports);}else{var newGpf={};factory(newGpf);root.gpf=newGpf;}}(this,function(gpf){"use strict";function _gpfEmptyFunc(){}var _gpfVersion="0.1.6-alpha",_GPF_HOST={BROWSER:"browser",NODEJS:"nodejs",PHANTOMJS:"phantomjs",RHINO:"rhino",UNKNOWN:"unknown",WSCRIPT:"wscript"},_gpfHost=_GPF_HOST.UNKNOWN,_gpfDosPath=false,_gpfMainContext=this,_gpfIgnore=_gpfEmptyFunc,_gpfExit=_gpfEmptyFunc,_gpfWebWindow,_gpfWebDocument,_gpfWebHead,_gpfMsFSO,_gpfNodeFs,_gpfNodePath;if("undefined"!==typeof WScript){_gpfHost=_GPF_HOST.WSCRIPT;_gpfDosPath=true;}else if("undefined"!==typeof print&&"undefined"!==typeof java){_gpfHost=_GPF_HOST.RHINO;_gpfDosPath=false;}else if("undefined"!==typeof phantom&&phantom.version){_gpfHost=_GPF_HOST.PHANTOMJS;_gpfDosPath=require("fs").separator==="\\";_gpfMainContext=window;}else if("undefined"!==typeof module&&module.exports){_gpfHost=_GPF_HOST.NODEJS;_gpfNodePath=require("path");_gpfDosPath=_gpfNodePath.sep==="\\";_gpfMainContext=global;}else if("undefined"!==typeof window){_gpfHost=_GPF_HOST.BROWSER;_gpfMainContext=window;}gpf.hosts={browser:_GPF_HOST.BROWSER,nodejs:_GPF_HOST.NODEJS,phantomjs:_GPF_HOST.PHANTOMJS,rhino:_GPF_HOST.RHINO,unknown:_GPF_HOST.UNKNOWN,wscript:_GPF_HOST.WSCRIPT};gpf.host=function(){return _gpfHost;};gpf.version=function(){return _gpfVersion;};if(_GPF_HOST.BROWSER===_gpfHost){_gpfExit=function(code){window.location="https://arnaudbuchholz.github.io/gpf/exit.html?"+(code||0);};_gpfWebWindow=window;_gpfWebDocument=document;_gpfWebHead=_gpfWebDocument.getElementsByTagName("head")[0]||_gpfWebDocument.documentElement;}if(_GPF_HOST.NODEJS===_gpfHost){_gpfExit=function(code){process.exit(code);};}if(_GPF_HOST.PHANTOMJS===_gpfHost){_gpfExit=function(code){phantom.exit(code);};_gpfWebWindow=window;_gpfWebDocument=document;_gpfWebHead=_gpfWebDocument.getElementsByTagName("head")[0]||_gpfWebDocument.documentElement;}if(_GPF_HOST.RHINO===_gpfHost){_gpfMainContext.console={log:function(t){print("    "+t);},info:function(t){print("[?] "+t);},warn:function(t){print("/!\\ "+t);},error:function(t){print("(X) "+t);}};_gpfExit=function(code){java.lang.System.exit(code);};}if(_GPF_HOST.WSCRIPT===_gpfHost){_gpfMainContext.console={log:function(t){WScript.Echo("    "+t);},info:function(t){WScript.Echo("[?] "+t);},warn:function(t){WScript.Echo("/!\\ "+t);},error:function(t){WScript.Echo("(X) "+t);}};_gpfExit=function(code){WScript.Quit(code);};}var _gpfAssert,_gpfAsserts;function _gpfAssertImpl(condition,message){if(undefined===message){message="Assertion with no message";condition=false;}if(!condition){console.warn("ASSERTION FAILED: "+message);gpf.Error.assertionFailed({message:message});}}function _gpfAssertsImpl(assertions){for(var message in assertions){if(assertions.hasOwnProperty(message)){_gpfAssertImpl(assertions[message],message);}}}gpf.assert=_gpfAssertImpl;gpf.asserts=_gpfAssertsImpl;_gpfAssert=_gpfEmptyFunc;_gpfAsserts=_gpfEmptyFunc;var _GpfFunc=Function,_gpfMax31=2147483647,_gpfMax32=4294967295,_gpfAlpha="abcdefghijklmnopqrstuvwxyz",_gpfALPHA="ABCDEFGHIJKLMNOPQRSTUVWXYZ",_gpfDigit="0123456789",_gpfIdentifierFirstChar=_gpfAlpha+_gpfALPHA+"_$",_gpfIdentifierOtherChars=_gpfAlpha+_gpfALPHA+_gpfDigit+"_$",_gpfJsKeywords=("break,case,class,catch,const,continue,debugger,default,delete,do,else,export,extends,finally,"+"for,function,if,import,in,instanceof,let,new,return,super,switch,this,throw,try,typeof,var,void,while,with,"+"yield").split(",");function _gpfFuncUnsafe(params,source){var args;if(0===params.length){return _GpfFunc(source);}args=[].concat(params);args.push(source);return _GpfFunc.apply(null,args);}function _gpfFunc(params,source){if(undefined===source){source=params;params=[];}_gpfAssert("string"===typeof source&&source.length,"Source expected (or use _gpfEmptyFunc)");return _gpfFuncUnsafe(params,source);}function _gpfIsUnsignedByte(value){return"number"===typeof value&&0<=value&&value<256;}if(_GPF_HOST.NODEJS===_gpfHost){gpf.node={};}gpf.web={};var _gpfIsArrayLike=function(obj){return Array.isArray(obj);};if(_GPF_HOST.BROWSER===_gpfHost&&(_gpfWebWindow.HTMLCollection||_gpfWebWindow.NodeList)){_gpfIsArrayLike=function(obj){return Array.isArray(obj)||obj instanceof _gpfWebWindow.HTMLCollection||obj instanceof _gpfWebWindow.NodeList;};}gpf.isArrayLike=_gpfIsArrayLike;function _gpfArrayForEach(array,callback,thisArg){var index,length=array.length;for(index=0;index<length;++index){callback.call(thisArg,array[index],index,array);}}function _gpfObjectForEach(object,callback,thisArg){for(var property in object){if(object.hasOwnProperty(property)){callback.call(thisArg,object[property],property,object);}}}gpf.forEach=function(container,callback,thisArg){if(_gpfIsArrayLike(container)){_gpfArrayForEach(container,callback,thisArg);return;}_gpfObjectForEach(container,callback,thisArg);};function _gpfStringCapitalize(that){return that.charAt(0).toUpperCase()+that.substr(1);}function _gpfStringReplaceEx(that,replacements){var result=that;_gpfObjectForEach(replacements,function(replacement,key){result=result.split(key).join(replacement);});return result;}var _gpfStringEscapes={};function _gpfStringEscapeFor(that,language){_gpfAssert(undefined!==_gpfStringEscapes[language],"Unknown language");that=_gpfStringReplaceEx(that,_gpfStringEscapes[language]);if("javascript"===language){that="\""+that+"\"";}return that;}_gpfStringEscapes.javascript={"\\":"\\\\","\"":"\\\"","\n":"\\n","\r":"\\r","\t":"\\t"};_gpfStringEscapes.xml={"&":"&amp;","<":"&lt;",">":"&gt;"};function _gpfInstallMissingMembers(on,members){_gpfObjectForEach(members,function(value,memberName){if(on[memberName]===undefined){on[memberName]=value;}});}function _gpfInstallCompatibleMethods(on,methods){if(methods){_gpfInstallMissingMembers(on.prototype,methods);}}function _gpfInstallCompatibleStatics(on,statics){if(statics){_gpfInstallMissingMembers(on,statics);}}function _gpfInstallCompatibility(typeName,description){var on=description.on;_gpfInstallCompatibleMethods(on,description.methods);_gpfInstallCompatibleStatics(on,description.statics);}function _gpfArrayBind(callback,thisArg){if(undefined!==thisArg){return callback.bind(thisArg);}return callback;}function _gpfArrayForEachOwn(array,callback){var len=array.length,idx=0;while(idx<len){if(array.hasOwnProperty(idx)){callback(array[idx],idx,array);}++idx;}}function _gpfArrayEveryOwn(array,callback,idx){var len=array.length;while(idx<len){if(array.hasOwnProperty(idx)&&true!==callback(array[idx],idx,array)){return false;}++idx;}return true;}function _gpfArrayEveryOwnFrom0(array,callback){return _gpfArrayEveryOwn(array,callback,0);}function _gpfArrayFromString(array,string){var length=string.length,index;for(index=0;index<length;++index){array.push(string.charAt(index));}}function _gpfArrayConvertFrom(arrayLike){var array=[];if("string"===typeof arrayLike){_gpfArrayFromString(array,arrayLike);}else{_gpfArrayForEach(arrayLike,function(value){array.push(value);},0);}return array;}function _gpfArrayFrom(arrayLike){var array=_gpfArrayConvertFrom(arrayLike),callback=arguments[1];if("function"===typeof callback){array=array.map(callback,arguments[2]);}return array;}_gpfInstallCompatibility("Array",{on:Array,methods:{every:function(callback){return _gpfArrayEveryOwnFrom0(this,_gpfArrayBind(callback,arguments[1]));},filter:function(callback){var result=[];callback=_gpfArrayBind(callback,arguments[1]);_gpfArrayForEachOwn(this,function(item,idx,array){if(callback(item,idx,array)){result.push(item);}});return result;},forEach:function(callback){_gpfArrayForEachOwn(this,_gpfArrayBind(callback,arguments[1]));},indexOf:function(searchElement){var result=-1;_gpfArrayEveryOwn(this,function(value,index){if(value===searchElement){result=index;return false;}return true;},arguments[1]||0);return result;},map:function(callback){var result=new Array(this.length);callback=_gpfArrayBind(callback,arguments[1]);_gpfArrayForEachOwn(this,function(item,index,array){result[index]=callback(item,index,array);});return result;},some:function(callback){callback=_gpfArrayBind(callback,arguments[1]);return!_gpfArrayEveryOwnFrom0(this,function(item,index,array){return!callback(item,index,array);});},reduce:function(callback){var initialValue=arguments[1],thisLength=this.length,index=0,value;if(undefined===initialValue){value=this[index++];}else{value=initialValue;}for(;index<thisLength;++index){value=callback(value,this[index],index,this);}return value;}},statics:{from:_gpfArrayFrom,isArray:function(arrayLike){return"[object Array]"==={}.toString.call(arrayLike);}}});function _gpfBuildFunctionParameterList(count){return new Array(count).join(" ").split(" ").map(function(value,index){return"p"+index;});}function _gpfGenerateGenericFactorySource(parameters){var src=["var C = this, l = arguments.length;","if (0 === l) { return new C();}"];parameters.forEach(function(value,index){var count=index+1;src.push("if ("+count+" === l) { return new C("+parameters.slice(0,count).join(", ")+");}");});return src.join("\r\n");}function _gpfGenerateGenericFactory(maxParameters){var parameters=_gpfBuildFunctionParameterList(maxParameters);return _gpfFunc(parameters,_gpfGenerateGenericFactorySource(parameters));}var _gpfGenericFactory=_gpfGenerateGenericFactory(10);function _gpfNewApply(Constructor,parameters){if(parameters.length>_gpfGenericFactory.length){_gpfGenericFactory=_gpfGenerateGenericFactory(parameters.length);}return _gpfGenericFactory.apply(Constructor,parameters);}function _pad(number){if(10>number){return"0"+number;}return number;}_gpfInstallCompatibility("Date",{on:Date,methods:{toISOString:function(){return[this.getUTCFullYear(),"-",_pad(this.getUTCMonth()+1),"-",_pad(this.getUTCDate()),"T",_pad(this.getUTCHours()),":",_pad(this.getUTCMinutes()),":",_pad(this.getUTCSeconds()),".",(this.getUTCMilliseconds()/1000).toFixed(3).slice(2,5),"Z"].join("");}}});var _gpfISO8601RegExp=new RegExp(["^([0-9][0-9][0-9][0-9])","\\-","([0-9][0-9])","\\-","([0-9][0-9])","(?:T","([0-9][0-9])","\\:","([0-9][0-9])","\\:","([0-9][0-9])","(?:\\.","([0-9][0-9][0-9])","Z)?)?$"].join(""));function _gpfCheckDateArray(dateArray){if(dateArray[1]<12&&dateArray[2]<32&&dateArray[3]<24&&dateArray[4]<60&&dateArray[5]<60){return dateArray;}}function _gpfAddDatePartToArray(dateArray,datePart){if(datePart){dateArray.push(parseInt(datePart,10));}else{dateArray.push(0);}}function _gpfToDateArray(matchResult){var dateArray=[],len=matchResult.length,idx;for(idx=1;idx<len;++idx){_gpfAddDatePartToArray(dateArray,matchResult[idx]);}return dateArray;}function _gpfProcessISO8601MatchResult(matchResult){var dateArray;if(matchResult){dateArray=_gpfToDateArray(matchResult);--dateArray[1];return _gpfCheckDateArray(dateArray);}}function _gpfIsISO8601String(value){if("string"===typeof value){_gpfISO8601RegExp.lastIndex=0;return _gpfProcessISO8601MatchResult(_gpfISO8601RegExp.exec(value));}}var _GpfGenuineDate=_gpfMainContext.Date;function _GpfDate(){var firstArgument=arguments[0],values=_gpfIsISO8601String(firstArgument);if(values){return new _GpfGenuineDate(_GpfGenuineDate.UTC.apply(_GpfGenuineDate.UTC,values));}return _gpfNewApply(_GpfGenuineDate,arguments);}function _gpfCopyDateStatics(){var members=["prototype","UTC","parse","now"],len=members.length,idx,member;for(idx=0;idx<len;++idx){member=members[idx];_GpfDate[member]=_GpfGenuineDate[member];}}function _gpfInstallCompatibleDate(){_gpfCopyDateStatics();var supported=false;try{var longDate=new Date("2003-01-22T22:45:34.075Z"),shortDate=new Date("2003-01-22");supported=2003===longDate.getUTCFullYear()&&0===longDate.getUTCMonth()&&22===longDate.getUTCDate()&&22===longDate.getUTCHours()&&45===longDate.getUTCMinutes()&&34===longDate.getUTCSeconds()&&75===longDate.getUTCMilliseconds()&&2003===shortDate.getUTCFullYear()&&0===shortDate.getUTCMonth()&&22===shortDate.getUTCDate();}catch(e){}if(!supported){_gpfMainContext.Date=_GpfDate;}}_gpfInstallCompatibleDate();var _gpfArrayPrototypeSlice=Array.prototype.slice;function _generateBindBuilderSource(length){return["var me = this;","return function ("+_gpfBuildFunctionParameterList(length).join(", ")+") {","   var args = _gpfArrayPrototypeSlice.call(arguments, 0);","    return me.apply(thisArg, prependArgs.concat(args));","};"].join("\n");}_gpfInstallCompatibility("Function",{on:Function,methods:{bind:function(thisArg){var me=this,prependArgs=_gpfArrayPrototypeSlice.call(arguments,1),builderSource=_generateBindBuilderSource(Math.max(this.length-prependArgs.length,0));return _gpfFunc(["thisArg","prependArgs","_gpfArrayPrototypeSlice"],builderSource).call(me,thisArg,prependArgs,_gpfArrayPrototypeSlice);}}});var _gpfJsCommentsRegExp=new RegExp("//.*$|/\\*(?:[^\\*]*|\\*[^/]*)\\*/","gm");function _gpfGetFunctionName(){var functionSource=_gpfEmptyFunc.toString.call(this),functionKeywordPos=functionSource.indexOf("function"),parameterListStartPos=functionSource.indexOf("(",functionKeywordPos);return functionSource.substr(functionKeywordPos+9,parameterListStartPos-functionKeywordPos-9).replace(_gpfJsCommentsRegExp,"").trim();}if(function(){function functionName(){}return functionName.name!=="functionName";}()){Function.prototype.compatibleName=_gpfGetFunctionName;}else{Function.prototype.compatibleName=function(){return this.name;};}_gpfInstallCompatibility("Object",{on:Object,statics:{create:function(){function Temp(){}return function(O){Temp.prototype=O;var obj=new Temp;Temp.prototype=null;if(!obj.__proto__){obj.__proto__=O;}return obj;};}(),getPrototypeOf:function(object){if(object.__proto__){return object.__proto__;}return object.constructor.prototype;},keys:function(object){var result=[],key;for(key in object){if(object.hasOwnProperty(key)){result.push(key);}}return result;},values:function(object){var result=[],key;for(key in object){if(object.hasOwnProperty(key)){result.push(object[key]);}}return result;}}});_gpfInstallCompatibility("String",{on:String,methods:{trim:function(){var rtrim=new RegExp("^[\\s\uFEFF\xA0]+|[\\s\uFEFF\xA0]+$","g");return function(){return this.replace(rtrim,"");};}()}});function _gpfPromiseSafeResolve(fn,onFulfilled,onRejected){var safe=true;function makeSafe(callback){return function(value){if(safe){safe=false;callback(value);}};}try{fn(makeSafe(onFulfilled),makeSafe(onRejected));}catch(e){if(safe){safe=false;onRejected(e);}}}function _gpfPromiseFinale(){var me=this;me._handlers.forEach(function(handler){handler.process(me);});me._handlers=[];}function _gpfPromiseReject(newValue){var me=this;me._state=false;me._value=newValue;_gpfPromiseFinale.call(me);}function _gpfPromiseResolve(newValue){var me=this;try{_gpfAssert(newValue!==me,"A promise cannot be resolved with itself.");if(newValue&&(typeof newValue==="object"||typeof newValue==="function")){var then=newValue.then;if("function"===typeof then){_gpfPromiseSafeResolve(then.bind(newValue),_gpfPromiseResolve.bind(me),_gpfPromiseReject.bind(me));return;}}me._state=true;me._value=newValue;_gpfPromiseFinale.call(me);}catch(e){_gpfPromiseReject.call(me,e);}}var _GpfPromise=gpf.Promise=function(fn){_gpfPromiseSafeResolve(fn,_gpfPromiseResolve.bind(this),_gpfPromiseReject.bind(this));};function _gpfPromiseHandler(){}_gpfPromiseHandler.prototype={onFulfilled:null,onRejected:null,resolve:null,reject:null,process:function(promise){var me=this;if(promise._state===null){if(!promise.hasOwnProperty("_handlers")){promise._handlers=[];}promise._handlers.push(me);return;}setTimeout(function(){var callback,result;if(promise._state){callback=me.onFulfilled;}else{callback=me.onRejected;}if(null===callback){if(promise._state){me.resolve(promise._value);}else{me.reject(promise._value);}return;}try{result=callback(promise._value);}catch(e){me.reject(e);return;}me.resolve(result);},0);}};_GpfPromise.prototype={_state:null,_value:null,_handlers:[],then:function(onFulfilled,onRejected){var me=this;return new _GpfPromise(function(resolve,reject){var handler=new _gpfPromiseHandler;if(undefined!==onFulfilled){handler.onFulfilled=onFulfilled;}if(undefined!==onRejected){handler.onRejected=onRejected;}handler.resolve=resolve;handler.reject=reject;handler.process(me);});},"catch":function(onRejected){return this.then(null,onRejected);}};_GpfPromise.resolve=function(value){return new _GpfPromise(function(resolve){resolve(value);});};_GpfPromise.reject=function(value){return new _GpfPromise(function(resolve,reject){_gpfIgnore(resolve);reject(value);});};_GpfPromise.all=function(promises){if(0===promises.length){return _GpfPromise.resolve([]);}return new _GpfPromise(function(resolve,reject){var remaining=promises.length;function handle(result,index){try{if(result&&result instanceof _GpfPromise){result.then(function(value){handle(value,index);},reject);return;}promises[index]=result;if(--remaining===0){resolve(promises);}}catch(e){reject(e);}}promises.forEach(handle);});};_GpfPromise.race=function(promises){return new _GpfPromise(function(resolve,reject){promises.forEach(function(promise){promise.then(resolve,reject);});});};if(undefined===_gpfMainContext.Promise){_gpfMainContext.Promise=_GpfPromise;}var _gpfTimeoutQueue=[],_gpfTimeoutID=0,_gpfSleep=_gpfEmptyFunc;gpf.handleTimeout=_gpfEmptyFunc;function _gpfSortOnDt(a,b){return a.dt-b.dt;}function _gpSetTimeoutPolyfill(callback,timeout){_gpfAssert("number"===typeof timeout,"Timeout is required");var timeoutItem={id:++_gpfTimeoutID,dt:new Date(new Date().getTime()+timeout),cb:callback};_gpfTimeoutQueue.push(timeoutItem);_gpfTimeoutQueue.sort(_gpfSortOnDt);return _gpfTimeoutID;}function _gpfClearTimeoutPolyfill(timeoutId){var pos;if(!_gpfTimeoutQueue.every(function(timeoutItem,index){if(timeoutItem.id===timeoutId){pos=index;return false;}return true;})){_gpfTimeoutQueue.splice(pos,1);}}function _gpfHandleTimeout(){var queue=_gpfTimeoutQueue,timeoutItem,now;while(queue.length){timeoutItem=queue.shift();now=new Date;if(timeoutItem.dt>now){_gpfSleep(timeoutItem.dt-now);}timeoutItem.cb();}}if("undefined"===typeof setTimeout){if(_GPF_HOST.WSCRIPT===_gpfHost){_gpfSleep=function(t){WScript.Sleep(t);};}else if(_GPF_HOST.RHINO===_gpfHost){_gpfSleep=java.lang.Thread.sleep;}else{console.warn("No implementation for setTimeout");}_gpfMainContext.setTimeout=_gpSetTimeoutPolyfill;_gpfMainContext.clearTimeout=_gpfClearTimeoutPolyfill;gpf.handleTimeout=_gpfHandleTimeout;}var _gpfJsonStringify,_gpfJsonParse;function _gpfPreprocessValueForJson(callback){return function(value,index){if("function"===typeof value){return;}callback(_gpfJsonStringifyPolyfill(value),index);};}function _gpfObject2Json(object){var isArray,results;isArray=object instanceof Array;results=[];if(isArray){_gpfArrayForEach(object,_gpfPreprocessValueForJson(function(value){results.push(value);}));return"["+results.join(",")+"]";}_gpfObjectForEach(object,_gpfPreprocessValueForJson(function(value,property){results.push(_gpfStringEscapeFor(property,"javascript")+":"+value);}));return"{"+results.join(",")+"}";}function _gpfJsonStringifyObject(object){return object.toString();}var _gpfJsonStringifyMapping={undefined:_gpfEmptyFunc,"function":_gpfEmptyFunc,number:_gpfJsonStringifyObject,"boolean":_gpfJsonStringifyObject,string:function(object){return _gpfStringEscapeFor(object,"javascript");},object:function(object){if(null===object){return"null";}return _gpfObject2Json(object);}};function _gpfJsonStringifyPolyfill(object){return _gpfJsonStringifyMapping[typeof object](object);}function _gpfJsonParsePolyfill(test){return _gpfFunc("return "+test)();}if("undefined"===typeof JSON){_gpfJsonStringify=_gpfJsonStringifyPolyfill;_gpfJsonParse=_gpfJsonParsePolyfill;_gpfMainContext.JSON={stringify:_gpfJsonStringify,parse:_gpfJsonParse};}else{_gpfJsonStringify=JSON.stringify;_gpfJsonParse=JSON.parse;}function _gpfGetObjectProperty(parent,name){if(undefined!==parent){return parent[name];}}function _gpfGetOrCreateObjectProperty(parent,name){var result=parent[name];if(undefined===result){result=parent[name]={};}return result;}function _gpfReduceContext(path,reducer){var rootContext;if(path[0]==="gpf"){rootContext=gpf;path=path.slice(1);}else{rootContext=_gpfMainContext;}return path.reduce(reducer,rootContext);}function _gpfContext(path,createMissingParts){var reducer;if(createMissingParts){reducer=_gpfGetOrCreateObjectProperty;}else{reducer=_gpfGetObjectProperty;}return _gpfReduceContext(path,reducer);}gpf.context=function(path){if(undefined===path){return _gpfMainContext;}return _gpfContext(path.split("."));};function _gpfAssign(value,memberName){this[memberName]=value;}function _gpfExtend(destination,source){_gpfIgnore(source);[].slice.call(arguments,1).forEach(function(nthSource){_gpfObjectForEach(nthSource,_gpfAssign,destination);});return destination;}gpf.extend=_gpfExtend;_gpfStringEscapes.html=_gpfExtend(_gpfStringEscapes.xml,{"à":"&agrave;","á":"&aacute;","è":"&egrave;","é":"&eacute;","ê":"&ecirc;"});var _GpfError=gpf.Error=function(){};_GpfError.prototype=new Error;_gpfExtend(_GpfError.prototype,{constructor:_GpfError,code:0,name:"Error",message:"",_buildMessage:function(context){var replacements;if(context){replacements={};_gpfObjectForEach(context,function(value,key){replacements["{"+key+"}"]=value.toString();});this.message=_gpfStringReplaceEx(this.message,replacements);}}});function _gpfErrorFactory(code,name,message){function NewErrorClass(context){this._buildMessage(context);}NewErrorClass.prototype=new _GpfError;_gpfExtend(NewErrorClass.prototype,{code:code,name:name,message:message});NewErrorClass.prototype.constructor=NewErrorClass;_GpfError[_gpfStringCapitalize(name)]=NewErrorClass;return function(context){throw new NewErrorClass(context);};}function _gpfGenenerateErrorFunction(code,name,message){var result=_gpfErrorFactory(code,name,message);result.CODE=code;result.NAME=name;result.MESSAGE=message;return result;}var _gpfLastErrorCode=0;function _gpfErrorDeclare(source,dictionary){_gpfIgnore(source);_gpfObjectForEach(dictionary,function(message,name){var code=++_gpfLastErrorCode;gpf.Error["CODE_"+name.toUpperCase()]=code;gpf.Error[name]=_gpfGenenerateErrorFunction(code,name,message);});}_gpfErrorDeclare("error",{notImplemented:"Not implemented",abstractMethod:"Abstract method",assertionFailed:"Assertion failed: {message}",invalidParameter:"Invalid parameter"});_gpfErrorDeclare("define/detect",{invalidEntityType:"Invalid entity type"});var _gpfDefineTypedBuilders={};function _gpfDefineRead$TypedProperties(definition){var ResultEntityBuilder;_gpfObjectForEach(_gpfDefineTypedBuilders,function(TypedEntityBuilder,type){if(definition["$"+type]){ResultEntityBuilder=TypedEntityBuilder;}});return ResultEntityBuilder;}function _gpfDefineCheck$TypeProperty(definition){var typedEntityBuilder=_gpfDefineTypedBuilders[definition.$type];if(undefined===typedEntityBuilder){gpf.Error.invalidEntityType();}return typedEntityBuilder;}function _gpfDefineBuildTypedEntity(definition){var EntityBuilder=_gpfDefineRead$TypedProperties(definition);if(!EntityBuilder){EntityBuilder=_gpfDefineCheck$TypeProperty(definition);}return new EntityBuilder(definition);}function _GpfEntityDefinition(definition){_gpfAssert(definition&&"object"===typeof definition,"Expected an entity definition");this._initialDefinition=definition;}_GpfEntityDefinition.prototype={_initialDefinition:{}};function _gpfDefineGenerate$Keys(names){return names.split(",").map(function(name){return"$"+name;});}_gpfErrorDeclare("define/check",{invalidEntity$Property:"Invalid entity $ property",missingEntityName:"Missing entity name",invalidEntityNamespace:"Invalid entity namespace"});function _gpfDefineEntityCheckNameIsNotEmpty(){if(!this._name){gpf.Error.missingEntityName();}}_gpfExtend(_GpfEntityDefinition.prototype,{_type:"",_allowed$Properties:_gpfDefineGenerate$Keys("type,name,namespace"),_check$Property:function(name){if(-1===this._allowed$Properties.indexOf(name)){gpf.Error.invalidEntity$Property();}},_checkProperty:_gpfFunc(["name"]," "),_checkProperties:function(){_gpfObjectForEach(this._initialDefinition,function(value,name){_gpfIgnore(value);if(name.charAt(0)==="$"){this._check$Property(name);}else{this._checkProperty(name);}},this);},_name:"",_readName:function(){var definition=this._initialDefinition;this._name=definition["$"+this._type]||definition.$name;},_checkNameIsNotEmpty:_gpfDefineEntityCheckNameIsNotEmpty,_checkName:_gpfDefineEntityCheckNameIsNotEmpty,_namespace:"",_extractRelativeNamespaceFromName:function(){var name=this._name,lastDotPosition=name.lastIndexOf(".");if(-1<lastDotPosition){this._name=name.substr(lastDotPosition+1);return name.substr(0,lastDotPosition);}},_readNamespace:function(){var namespaces=[this._initialDefinition.$namespace,this._extractRelativeNamespaceFromName()].filter(function(namespacePart){return namespacePart;});if(namespaces.length>0){this._namespace=namespaces.join(".");}},_checkNamespace:function(){var namespace=this._namespace;if(namespace&&![object Object].exec(namespace)){gpf.Error.invalidEntityNamespace();}},check:function(){this._checkProperties();this._readName();this._checkNameIsNotEmpty();this._readNamespace();this._checkName();this._checkNamespace();}});function _GpfClassDefinition(definition){_GpfEntityDefinition.call(this,definition);}_GpfClassDefinition.prototype=Object.create(_GpfEntityDefinition.prototype);_gpfExtend(_GpfClassDefinition.prototype,{_type:"class"});_gpfDefineTypedBuilders["class"]=_GpfClassDefinition;_gpfErrorDeclare("define/class/check",{invalidClassName:"Invalid class name",invalidClassProperty:"Invalid class property"});_gpfExtend(_GpfClassDefinition.prototype,{_allowed$Properties:_GpfEntityDefinition.prototype._allowed$Properties.concat(_gpfDefineGenerate$Keys("class,extend")),_checkMemberName:function(name){if(![object Object].exec(name)){gpf.Error.invalidClassProperty();}},_reservedNames:"super,class,public,private,protected,static,mixin".split(","),_checkReservedMemberName:function(name){if(-1!==this._reservedNames.indexOf(name)){gpf.Error.invalidClassProperty();}},_checkProperty:function(name){_GpfEntityDefinition.prototype._checkProperty.call(this,name);this._checkMemberName(name);this._checkReservedMemberName(name);},_checkName:function(){_GpfEntityDefinition.prototype._checkName.call(this);if(![object Object].exec(this._name)){gpf.Error.invalidClassName();}}});}));