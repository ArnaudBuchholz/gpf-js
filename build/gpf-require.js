!function(e){"use strict";if("function"==typeof define&&define.amd)define(["exports"],e);else if("undefined"!=typeof exports)e(exports);else if("undefined"!=typeof module&&module.exports)e(module.exports);else{var t=Function("return this;")(),n={};e(n),t.gpf=n}}(function(o){"use strict";function c(){}var i,n,r=-1,a=0,e="browser",t="nashorn",u="nodejs",s="phantomjs",f="rhino",l="unknown",p="wscript",d=l,h=Function,_=new h("return this")();function m(e,t,n){return Array.prototype.slice.call(e,t,n||e.length)}"undefined"!=typeof WScript?d=p:"undefined"!=typeof print&&"undefined"!=typeof java?d="undefined"==typeof readFile?t:f:"undefined"!=typeof phantom&&phantom.version&&!document.currentScript?(d=s,_=window):"undefined"!=typeof module&&module.exports?(d=u,_=global):"undefined"!=typeof window&&(d=e,_=window),o.version=function(){return"0.2.9"},e===d&&(function(e){window.location="https://arnaudbuchholz.github.io/gpf/exit.html?"+e},window,document),o.node={},u===d&&(n=require("path"),i=require("fs"),require("http"),require("https"),require("url"),"\\"===n.sep),o.hosts={browser:e,nashorn:t,nodejs:u,phantomjs:s,rhino:f,unknown:l,wscript:p},o.host=function(){return d};var v=1;function y(e){return m(e,v)}var g,b=Array.isArray;function w(e){return b(e)||function t(e){return!!e&&Math.floor(e.length)===e.length}(e)}function E(e,t,n){for(var r=0,i=e.length;r<i;++r)t.call(n,e[r],r,e)}function I(e,t,n){for(var r in e)e.hasOwnProperty(r)&&t.call(n,e[r],r,e)}o.isArrayLike=w,g=p===d?function rn(t,n,r){I(t,n,r),["constructor","toString"].forEach(function(e){t.hasOwnProperty(e)&&n.call(r,t[e],e,t)})}:I,o.forEach=function(e,t,n){w(e)?E(e,t,n):g(e,t,n)};var O=!0;function x(e,t){e||(!function n(e){O&&console.warn("ASSERTION FAILED: "+e)}(t),o.Error.assertionFailed({message:t}))}o.assert=function on(e,t){undefined===t&&on(!1,"Assertion with no message"),x(e,t)},o.asserts=function an(e){g(e,x)},o.preventAssertWarnings=function(e){O=!e};var P=new RegExp("//.*$|/\\*(?:[^\\*]*|\\*[^/]*)\\*/","gm");function j(e,t){return function r(e,t){var n;return e.length?((n=[].concat(e)).push(t),h.apply(null,n)):h(t)}(e,t)}function N(e,t){return undefined===t?j([],e):j(e,t)}function S(e){return e?new Array(e).join(" ").split(" ").map(function(e,t){return"p"+t}):[]}o.web={};(function un(e){var t=S(e);return N(t,function n(r){var i=["var C = this, l = arguments.length;","if (0 === l) { return new C();}"];return r.forEach(function(e,t){var n=1;n+=t,i.push("if ("+n+" === l) { return new C("+r.slice(a,n).join(", ")+");}")}),i.join("\n")}(t))})(10);function $(e,t){if(undefined!==e)return e[t]}function R(e,t){var n=e[t];return undefined===n&&(n=e[t]={}),n}function C(e,t){return function r(e,t){var n;return("gpf"===e[a]?(n=o,y(e)):(n=_,e)).reduce(t,n)}(e,t?R:$)}function k(e){return e.trim()}o.context=function(e){return undefined===e?_:C(e.split("."))};var D,T="function";function M(e,t){var n=c.toString.call(e).replace(P,"");!function i(e,t,n){if(e.length){var r=new RegExp("\\(\\s*(\\w+(?:\\s*,\\s*\\w+)*)\\s*\\)").exec(t);n.parameters=r[1].split(",").map(k)}}(e,n,t),function r(e,t){var n=k(new RegExp("{((?:.*\\r?\\n)*.*)}").exec(e)[1]);n&&(t.body=n)}(n,t)}function F(e){var t={};return function r(e,t){var n=D(e);n&&(t.name=n)}(e,t),M(e,t),t}function A(e,t){return function i(e,t){var n=Object.keys(t),r=n.map(function(e){return t[e]});return N(n,"return "+e).apply(null,r)}(function o(e){return"function"+function t(e){return e.name?" "+e.name:""}(e)+"("+function n(e){return e.parameters?e.parameters.join(", "):""}(e)+') {\n\t"use strict"\n'+function r(e){return e.body?e.body.toString():""}(e)+"\n}"}(e),t||{})}D="functionName"!==N("return function functionName () {};")().name?function sn(e){var t=c.toString.call(e),n=t.indexOf(T)+T.length,r=t.indexOf("(",n);return t.substring(n,r).replace(P,"").trim()}:function(e){return e.name};var B=o.Error=function(){};function W(e,t,n){var r=function o(e){return e.charAt(a).toUpperCase()+e.substring(1)}(t),i=A({name:r,parameters:["context"],body:"this._buildMessage(context);"});return i.prototype=new B,Object.assign(i.prototype,{code:e,name:t,message:n}),i.prototype.constructor=i,B[r]=i,function(e){throw new i(e)}}B.prototype=new Error,Object.assign(B.prototype,{constructor:B,code:0,name:"Error",message:"",_buildMessage:function(e){var n;e&&(n={},g(e,function(e,t){n["{"+t+"}"]=e.toString()}),this.message=function r(e,t){var n=e;return g(t,function(e,t){n=n.split(t).join(e)}),n}(this.message,n))}});var q=0;function L(e,t){g(t,function(e,t){var n=++q;o.Error["CODE_"+t.toUpperCase()]=n,o.Error[t]=function i(e,t,n){var r=W(e,t,n);return r.CODE=e,r.NAME=t,r.MESSAGE=n,r}(n,t,e)})}function z(e){return"function"==typeof e&&function t(e){return e.toString().startsWith("class")}(e)}L(0,{notImplemented:"Not implemented",assertionFailed:"Assertion failed: {message}",invalidParameter:"Invalid parameter"}),o.isClass=z,L(0,{invalidEntityType:"Invalid entity type"});var U={};function V(e){var t,n=function i(n){var r;return g(U,function(e,t){n["$"+t]&&(r=e)}),r}(e);return n||(n=function r(e){var t=U[e.$type];return undefined===t&&o.Error.invalidEntityType(),t}(e)),(t=new n(e)).check(),t}function Z(e,t){return e.exec(t)}function G(e,t){for(var n=[],r=function i(e,t){return e.lastIndex=0,Z(e,t)}(e,t);r;)n.push(r),r=Z(e,t);return n}function H(e){this._initialDefinition=e}function J(e){return A({parameters:S(e),body:"_throw_();"},{_throw_:o.Error.abstractMethod})}H.prototype={constructor:H,_initialDefinition:{}},L(0,{abstractMethod:"Abstract method"});var K=[];function Y(e){K.push(e)}L(0,{invalidEntity$Property:"Invalid entity $ property",missingEntityName:"Missing entity name",invalidEntityNamespace:"Invalid entity namespace"});function X(e,t){t.startsWith("$")?this._check$Property(t.substring("$".length),e):this._checkProperty(t,e)}function Q(e){H.call(this,e)}function ee(e,t){Q.call(this,t),this._instanceBuilder=e}function te(e,t){var n=new ee(e,t);return Y(n),n.check(),n}function ne(e){var t=function n(t){return K.filter(function(e){return e.getInstanceBuilder()===t})[a]}(e);return t||te(e,function r(e){var t=Object.getPrototypeOf(e.prototype);return{$name:D(e),$extend:t.constructor}}(e))}Object.assign(H.prototype,{_type:"",_allowed$Properties:"type,name,namespace".split(","),_check$Property:function(e,t){e!==this._type&&function n(e,t){t.includes(e)||o.Error.invalidEntity$Property()}(e,this._allowed$Properties)},_throwInvalidProperty:J(),_reMemberName:new RegExp(".*"),_checkMemberName:function(e){this._reMemberName.exec(e)||this._throwInvalidProperty()},_reservedNames:"super,class,public,private,protected,static,mixin".split(","),_checkReservedMemberName:function(e){this._reservedNames.includes(e)&&this._throwInvalidProperty()},_checkMemberValue:N(["name","value"]," "),_checkProperty:function(e,t){this._checkMemberName(e),this._checkReservedMemberName(e),this._checkMemberValue(e,t)},_checkProperties:function(){g(this._initialDefinition,X,this)},_name:"",_readName:function(){var e=this._initialDefinition;this._name=e["$"+this._type]||e.$name},_checkNameIsNotEmpty:function(){this._name||o.Error.missingEntityName()},_throwInvalidName:J(),_reName:new RegExp(".*"),_checkName:function(){this._reName.exec(this._name)||this._throwInvalidName()},_namespace:"",_extractRelativeNamespaceFromName:function(){var e=new RegExp("(.*)\\.([^\\.]+)$").exec(this._name);if(e)return this._name=e[2],e[1]},_readNamespace:function(){var e=[this._initialDefinition.$namespace,this._extractRelativeNamespaceFromName()].filter(function(e){return e});e.length&&(this._namespace=e.join("."))},_checkNamespace:function(){new RegExp("^(:?[a-z_$][a-zA-Z0-9]+(:?\\.[a-z_$][a-zA-Z0-9]+)*)?$").exec(this._namespace)||o.Error.invalidEntityNamespace()},check:function(){this._checkProperties(),this._readName(),this._checkNameIsNotEmpty(),this._readNamespace(),this._checkName(),this._checkNamespace()}}),Object.assign(H.prototype,{_instanceBuilder:null,getInstanceBuilder:function(){return this._instanceBuilder||this._setInstanceBuilder(this._build()),this._instanceBuilder},_setInstanceBuilder:function(e){this._namespace&&(C(this._namespace.split("."),!0)[this._name]=e),this._instanceBuilder=e,Y(this)},_build:c}),Q.prototype=Object.create(H.prototype),Object.assign(Q.prototype,{constructor:Q,_type:"class"}),U["class"]=Q,ee.prototype=Object.create(Q.prototype),Object.assign(ee.prototype,{_checkNameIsNotEmpty:c,_checkName:c}),L(0,{invalidClassName:"Invalid class name",invalidClassProperty:"Invalid class property",invalidClassExtend:"Invalid class extend",invalidClassConstructor:"Invalid class constructor",invalidClassOverride:"Invalid class override"}),Object.assign(Q.prototype,{_allowed$Properties:H.prototype._allowed$Properties.concat(["extend"]),_throwInvalidProperty:o.Error.invalidClassProperty,_reMemberName:new RegExp("^[a-z_][a-zA-Z0-9]*$"),_checkConstructorMember:function(e){"function"!=typeof e&&o.Error.invalidClassConstructor()},_checkOverridenMember:function(e,t){typeof e!=typeof t&&o.Error.invalidClassOverride()},_checkIfOverriddenMember:function(e,t){var n=this._extend.prototype[e];undefined!==n&&this._checkOverridenMember(t,n)},_checkMemberValue:function(e,t){"constructor"===e?this._checkConstructorMember(t):this._checkIfOverriddenMember(e,t)},_reName:new RegExp("^[A-Z_$][a-zA-Z0-9]*$"),_throwInvalidName:o.Error.invalidClassName,_extend:Object,_extendDefinition:undefined,_readExtend:function(){var e=function t(e){return"string"==typeof e?C(e.split(".")):e}(this._initialDefinition.$extend);e&&(this._extend=e)},_checkExtendIsNotAnInterface:function(){c.toString.call(this._extend).includes("interfaceConstructorFunction")&&o.Error.invalidClassExtend()},_checkExtend:function(){"function"!=typeof this._extend&&o.Error.invalidClassExtend(),this._checkExtendIsNotAnInterface()},check:function(){this._readExtend(),this._checkExtend(),this._extendDefinition=ne(this._extend),H.prototype.check.call(this)}}),L(0,{classConstructorFunction:"This is a class constructor function, use with new"}),Object.assign(Q.prototype,{_resolvedConstructor:c});var re=[];function ie(e){re.push(e)}function oe(n){var r=function i(e){return z(e._extend)?{instance:"that",body:function t(e){return e._extend===e._resolvedConstructor?"var that = Reflect.construct(_classDef_._extend, arguments, _classDef_._instanceBuilder);\n":'var that,\n    $super = function () {\n        that = Reflect.construct(_classDef_._extend, arguments, _classDef_._instanceBuilder);\n    },\n    hasOwnProperty = function (name) {\n        return !!that && that.hasOwnProperty(name);\n    },\n    proxy = new Proxy({}, {\n        get: function (obj, property) {\n            if (property === "hasOwnProperty") {\n              return hasOwnProperty;\n            }\n            if (!that && property === "$super") {\n              return $super;\n            }\n            return that[property];\n        },\n        set: function (obj, property, value) {\n            if (property !== "$super") {\n                that[property] = value;\n            }\n            return true;\n        }\n    });\n_classDef_._resolvedConstructor.apply(proxy, arguments);\n'}(e)}:{instance:"this",body:"_classDef_._resolvedConstructor.apply(this, arguments);"}}(n),e="if (!(this instanceof _classDef_._instanceBuilder)) gpf.Error.classConstructorFunction();\n"+re.reduce(function(e,t){return t(n,e,r.instance)},r.body);return"this"!==r.instance&&(e+="\nreturn "+r.instance+";"),e}function ae(e){return A(function t(e){return{name:e._name,parameters:F(e._resolvedConstructor).parameters,body:oe(e)}}(e),function n(e){return{gpf:o,_classDef_:e}}(e))}function ue(){o.Error.invalidClassSuper()}function se(e){return function n(e){var t=F(e);return t.body="return _superMethod_.apply(this, arguments);",A(t,{_superMethod_:e})}("function"==typeof e?e:ue)}function ce(e,t,n){return"function"!=typeof n&&o.Error.invalidClassSuperMember(),function i(e,t,n){var r=F(n);return r.body="return _superMethod_.apply(this === _$super_ ? _that_ : this, arguments);",A(r,{_that_:e,_$super_:t,_superMethod_:n})}(e,t,n)}L(0,{invalidClassSuper:"Invalid class super",invalidClassSuperMember:"Invalid class super member"});var fe=new RegExp("\\.\\$super\\.(\\w+)\\b","g");function le(e,t){!function n(e){Object.assign(e,{_extend:null,_extendDefinition:null})}(te(e,function r(e){return{$name:e}}(t)))}Object.assign(Q.prototype,{_get$Super:function(t,e,n){var r=this._extend.prototype,i=se(r[e]);return n.forEach(function(e){i[e]=ce(t,i,r[e])}),i},_superifiedBody:'var _super_;\nif (this.hasOwnProperty("$super")) {\n    _super_ = this.$super;\n}\nthis.$super = _classDef_._get$Super(this, _methodName_, _superMembers_);\ntry{\n    var _result_ = _method_.apply(this, arguments);\n} finally {\n    if (undefined === _super_) {\n        delete this.$super;\n    } else {\n        this.$super = _super_;\n    }\n}\nreturn _result_;',_getSuperifiedContext:function(e,t,n){return{_method_:e,_methodName_:t,_superMembers_:n,_classDef_:this}},_createSuperified:function(e,t,n){var r=F(e);return r.body=this._superifiedBody,A(r,this._getSuperifiedContext(e,t,n))},_superify:function(e,t){return new RegExp("\\.\\$super\\b").exec(e)?this._createSuperified(e,t,function n(e){return G(fe,e).map(function(e){return e[1]})}(e)):e}}),Object.assign(Q.prototype,{_build:function(){var e,t;return this._resolveConstructor(),e=ae(this),t=Object.create(this._extend.prototype),(e.prototype=t).constructor=e,this._buildPrototype(t),e},_addMethodToPrototype:function(e,t,n){e[t]=this._superify(n,t)},_addMemberToPrototype:function(e,t,n){"function"==typeof n?this._addMethodToPrototype(e,t,n):e[t]=n},_buildPrototype:function(n){g(this._initialDefinition,function(e,t){t.startsWith("$")||"constructor"===t||this._addMemberToPrototype(n,t,e)},this)},_setResolvedConstructorToInherited:function(){this._extend!==Object&&(this._resolvedConstructor=this._extend)},_resolveConstructor:function(){this._initialDefinition.hasOwnProperty("constructor")?this._resolvedConstructor=this._superify(this._initialDefinition.constructor,"constructor"):this._setResolvedConstructorToInherited()}}),le(Object,"Object"),g({"Array":Array,"Date":Date,"Error":Error,"Function":Function,"Number":Number,"RegExp":RegExp,"String":String},le),L(0,{invalidClass$AbstractSpecification:"Invalid class $abstract specification",abstractClass:"Abstract Class"}),Q.prototype._allowed$Properties.push("abstract");var pe=Q.prototype._check$Property;Object.assign(Q.prototype,{_abstract:!1,_check$abstract:function(e){!0!==e&&o.Error.invalidClass$AbstractSpecification()},_check$Property:function(e,t){"abstract"===e?(this._check$abstract(t),this._abstract=!0):pe.call(this,e,t)}}),ie(function(e,t,n){return e._abstract?"if (this.constructor === _classDef_._instanceBuilder) gpf.Error.abstractClass();\n"+t:t}),L(0,{invalidClass$SingletonSpecification:"Invalid class $singleton specification"}),Q.prototype._allowed$Properties.push("singleton");var de=Q.prototype._check$Property;function he(e){H.call(this,e)}function _e(e){return A(function t(e){return{name:e._name,body:"gpf.Error.interfaceConstructorFunction();"}}(e),function n(e){return{gpf:o,_classDef_:e}}(e))}function me(e){return V(e).getInstanceBuilder()}function ve(e,r){var i=!0;return g(e.prototype,function(e,t){"constructor"!==t&&function n(e,t){return"function"!=typeof t||e.length!==t.length}(e,r[t])&&(i=!1)}),i}function ye(e,t){return ve(e,t)?t:function r(e,t){if(ve(o.interfaces.IUnknown,t))return function n(e,t){return t.queryInterface(e)}(e,t)}(e,t)}function ge(e){return"string"==typeof e?C(e.split(".")):e}Object.assign(Q.prototype,{_singleton:!1,_singletonInstance:null,_check$singleton:function(e){!0!==e&&o.Error.invalidClass$SingletonSpecification()},_check$Property:function(e,t){"singleton"===e?(this._check$singleton(t),this._singleton=!0):de.call(this,e,t)}}),ie(function(e,t,n){return e._singleton?"if (!_classDef_._singletonInstance) {\n"+t+"\n_classDef_._singletonInstance = "+n+";\n}\nreturn _classDef_._singletonInstance;":t}),he.prototype=Object.create(H.prototype),Object.assign(he.prototype,{constructor:he,_type:"interface"}),U["interface"]=he,L(0,{invalidInterfaceName:"Invalid interface name",invalidInterfaceProperty:"Invalid interface property"}),Object.assign(he.prototype,{_throwInvalidProperty:o.Error.invalidInterfaceProperty,_reMemberName:new RegExp("^[a-z][a-zA-Z0-9]*$"),_reservedNames:H.prototype._reservedNames.concat("constructor"),_checkMemberValue:function(e,t){"function"!=typeof t&&o.Error.invalidInterfaceProperty()},_reName:new RegExp("^I[a-zA-Z0-9]*$"),_throwInvalidName:o.Error.invalidInterfaceName}),L(0,{"interfaceConstructorFunction":"This is an interface constructor function, do not invoke"}),Object.assign(he.prototype,{_build:function(){var e,t;return delete(t=(e=_e(this)).prototype).constructor,this._buildPrototype(t),e},_buildPrototype:function(n){g(this._initialDefinition,function(e,t){t.startsWith("$")||(n[t]=e)},this)}}),o.define=me,L(0,{interfaceExpected:"Expected interface not implemented: {name}"});o.interfaces={isImplementedBy:function(e,t){return!!t&&ve(ge(e),function n(e){return e instanceof Function?e.prototype:e}(t))},query:function(e,t){return ye(ge(e),t)}};function be(e,t){var n={$interface:"gpf.interfaces.I"+e};return Object.keys(t).forEach(function(e){n[e]=J(t[e])}),me(n)}be("Unknown",{"queryInterface":1});var we=be("ReadableStream",{"read":1}),Ee=be("WritableStream",{"write":1});function Ie(e,t,n){return e||o.Error.interfaceExpected({name:n}),function i(e,t,n){var r=ye(t,e);return r||o.Error.interfaceExpected({name:n}),r}(e,t,n)}function Oe(e){return Ie(e,we,"gpf.interfaces.IReadableStream")}function xe(e){return Ie(e,Ee,"gpf.interfaces.IWritableStream")}be("Enumerator",{"reset":0,"moveNext":0,"getCurrent":0}),be("FileStorage",{"getInfo":1,"openTextStream":2,"close":1,"explore":1,"createDirectory":1,"deleteFile":1,"deleteDirectory":1}),L(0,{readInProgress:"A read operation is already in progress",writeInProgress:"A write operation is already in progress",invalidStreamState:"Stream is in an invalid state"}),o.stream={};var Pe="gpf.stream#progress",je=Pe+"/read",Ne=Pe+"/write";function Se(e){e.prototype[je]=!1,e.prototype[Ne]=!1}function $e(e,t,n){e[t]&&o.Error[n](),e[t]=!0}function Re(e){e[je]=!1}function Ce(e){e[Ne]=!1}function ke(e,t,n){return e.then(function(e){return n(t),Promise.resolve(e)},function(e){return n(t),Promise.reject(e)})}function De(r){return function(e){var t=xe(e);return function n(e){$e(e,je,"readInProgress")}(this),ke(r.call(this,t),this,Re)}}function Te(n){return function(e){return function t(e){$e(e,Ne,"writeInProgress")}(this),ke(n.call(this,e),this,Ce)}}var Me=me({$class:"gpf.stream.ReadableString",constructor:function(e){this._buffer=e},read:De(function(e){return e.write(this._buffer)}),_buffer:""}),Fe=me({$class:"gpf.stream.WritableString",constructor:function(){this._buffer=[]},write:Te(function(e){return this._buffer.push(e.toString()),Promise.resolve()}),toString:function(){return this._buffer.join("")},_buffer:[]});Se(Me),Se(Fe),L(0,{incompatibleStream:"Incompatible stream"});var Ae={NOT_FOUND:0,DIRECTORY:1,FILE:2,UNKNOWN:3},Be=0,We=1,qe=null;function Le(e){e.length?e.pop():o.Error.unreachablePath()}function ze(e){var t=function n(e){return e.includes("\\")?e.toLowerCase().split("\\"):e.split("/")}(e);return function r(e){var t=e.pop();t&&e.push(t)}(t),t}function Ue(e){return ze(e).join("/")}function Ve(e){return e?ze(e).pop():""}function Ze(e){var t=Ve(e),n=t.lastIndexOf(".");return n===r?"":t.substring(n)}o.fs={types:{notFound:Ae.NOT_FOUND,directory:Ae.DIRECTORY,file:Ae.FILE,unknown:Ae.UNKNOWN},openFor:{reading:Be,appending:We},getFileStorage:function(){return qe}},L(0,{unreachablePath:"Unreachable path"});var Ge={"":function(e){e.length=0,e.push("")},".":c,"..":function(e){Le(e)}};function He(e){var t=ze(e);return y(arguments).forEach(function r(n,e){E(ze(e),function(e){var t=Ge[e];t?t(n):n.push(e)})}.bind(null,t)),t.join("/")}function Je(e,t){e.length*t.length&&function n(e,t){for(;e[a]===t[a];)e.shift(),t.shift()}(e,t)}function Ke(e){var t=ze(e);return Le(t),t.join("/")}o.path={join:He,parent:Ke,name:Ve,nameOnly:function(e){var t=Ve(e),n=t.lastIndexOf(".");return n===r?t:t.substring(a,n)},extension:Ze,relative:function cn(e,t){var n,r=ze(e),i=ze(t);for(Je(r,i),n=r.length;n--;)i.unshift("..");return i.join("/")}};var Ye=me({$class:"gpf.node.BaseStream",constructor:function(e,t){this._stream=e,"function"==typeof t&&(this._close=t),e.on("error",this._onError.bind(this))},_close:c,close:function(){return this._close()},_stream:null,_invalid:!1,_reject:o.Error.invalidStreamState,_checkIfValid:function(){this._invalid&&o.Error.invalidStreamState()},_onError:function(e){this._invalid=!0,this._reject(e)}}),Xe=me({$class:"gpf.node.ReadableStream",$extend:"gpf.node.BaseStream",read:De(function(n){var r=this,i=r._stream;return new Promise(function(e,t){r._reject=t,r._checkIfValid(),i.on("data",r._onData.bind(r,n)).on("end",function(){r._invalid=!0,e()})})}),_onData:function(e,t){var n=this._stream;n.pause(),e.write(t).then(function(){n.resume()},this._reject)}}),Qe=me({$class:"gpf.node.WritableStream",$extend:"gpf.node.BaseStream",write:Te(function(n){var r=this,i=r._stream;return new Promise(function(e,t){if(r._reject=t,r._checkIfValid(),i.write(n))return e();i.once("drain",e)})})});function et(e,t){return new Promise(function(n,r){i[e].apply(i,t.concat([function(e,t){e?r(e):n(t)}]))})}function tt(e,t){return et(e,[Ue(t)])}function nt(e,t){return et("open",[Ue(e),t.flags]).then(function(e){return new t.GpfStream(i[t.nodeStream]("",{fd:e,autoClose:!1}),et.bind(null,"close",[e]))})}function rt(e){return e.isDirectory()?Ae.DIRECTORY:function t(e){return e.isFile()?Ae.FILE:Ae.UNKNOWN}(e)}!function fn(e,t){e===d&&(qe=new t)}(u,me({$class:"gpf.node.FileStorage",getInfo:function(e){var t=Ue(e);return new Promise(function(e){i.exists(t,e)}).then(function(e){return e?tt("stat",t).then(function(e){return{fileName:n.basename(t),filePath:Ue(n.resolve(t)),size:e.size,createdDateTime:e.ctime,modifiedDateTime:e.mtime,type:rt(e)}}):{type:Ae.NOT_FOUND}})},openTextStream:function(e,t){return Be===t?function n(e){return nt(e,{flags:"r",GpfStream:Xe,nodeStream:"createReadStream"})}(e):function r(e){return nt(e,{flags:"a",GpfStream:Qe,nodeStream:"createWriteStream"})}(e)},close:function ln(t){return function(e){return e instanceof t?e.close():Promise.reject(new o.Error.IncompatibleStream)}}(Ye),explore:function(t){var n=this;return tt("readdir",t).then(function(e){return function i(e,t){var n,r=-1;return{reset:function(){return r=-1,Promise.resolve()},moveNext:function(){return++r,n=undefined,r<t.length?e.getInfo(t[r]).then(function(e){return n=e}):Promise.resolve()},getCurrent:function(){return n}}}(n,e.map(function(e){return He(t,e)}))})},createDirectory:tt.bind(null,"mkdir"),deleteFile:tt.bind(null,"unlink"),deleteDirectory:tt.bind(null,"rmdir")}));var it=Object.prototype.toString;o.isLiteralObject=function pn(e){return e instanceof Object&&"[object Object]"===it.call(e)&&Object.getPrototypeOf(e)===Object.getPrototypeOf({})},o.http={};var ot="GET",at="POST",ut="PUT",st="OPTIONS",ct="DELETE",ft="HEAD",lt=new RegExp("([^:\\s]+)\\s*: ?([^\\r]*)","gm"),pt=1,dt=2;var ht;be("Thenable",{"then":2});function _t(e){return o.interfaces.isImplementedBy(o.interfaces.IThenable,e)?e:Promise.resolve(e)}function mt(e,t){var n=ht;return e===d&&(ht=t),n}function vt(n){return new Promise(function(e,t){ht(n,e,t)})}function yt(e,t,n){return vt("string"==typeof t?{method:e,url:t,data:n}:Object.assign({method:e},t))}o.promisify=_t,o.promisifyDefined=function dn(e){if(undefined!==e)return _t(e)},Object.assign(o.http,{methods:{get:ot,post:at,put:ut,options:st,"delete":ct,head:ft},request:vt,get:yt.bind(o.http,ot),post:yt.bind(o.http,at),put:yt.bind(o.http,ut),options:yt.bind(o.http,st),"delete":yt.bind(o.http,ct),head:yt.bind(o.http,ft)});var gt=4,bt=function hn(r){return function(t,n){n&&Object.keys(n).forEach(function(e){t[r](e,n[e])})}}("setRequestHeader"),wt=function _n(n){return function(e,t){t?e[n](t):e[n]()}}("send"),Et=function mn(t,r,i){return function(e){return{status:e[t],headers:function n(e){var t={};return E(G(lt,e),function(e){t[e[pt]]=e[dt]}),t}(e[r]()),responseText:e[i]}}}("status","getAllResponseHeaders","responseText");function It(e,t){var n=function r(e){var t=new XMLHttpRequest;return t.open(e.method,e.url),t}(e);bt(n,e.headers),function i(e,t){e.onreadystatechange=function(){e.readyState===gt&&t(Et(e))}}(n,t),wt(n,e.data)}function Ot(){}mt(e,It),mt(s,It),Ot.prototype={execute:c};var xt=new Ot,Pt=new Ot;xt.execute=function(e){e._readReject(e._readBuffer.shift())},Pt.execute=function(e){e._readResolve()};var jt=me({$class:"gpf.stream.BufferedRead",constructor:function(){this._readBuffer=[]},_readBuffer:[],_readWriteToStream:null,_readResolve:null,_readReject:null,_readDataIsToken:function(e){return e instanceof Ot&&(e.execute(this),!0)},_readWriteToOutput:function(){var e=this,t=e._readBuffer.shift();return e._readDataIsToken(t)?Promise.resolve():e._readWriteToStream.write(t).then(function(){if(e._readBuffer.length)return e._readWriteToOutput();e._readNotWriting=!0})},_readNotWriting:!0,_readSafeWrite:function(){var t=this;t._readNotWriting&&(t._readNotWriting=!1,t._readWriteToOutput().then(undefined,function(e){t._readReject(e)}))},_readCheckIfData:function(){this._readBuffer.length&&this._readSafeWrite()},_readCheckIfOutput:function(){this._readWriteToStream&&this._readCheckIfData()},_appendToReadBuffer:function(e){return this._readBuffer=this._readBuffer.concat(m(arguments)),this._readCheckIfOutput(),this},_completeReadBuffer:function(){this._readBuffer.push(Pt),this._readCheckIfOutput()},_setReadError:function(e){this._readBuffer.push(xt,e),this._readCheckIfOutput()},read:De(function(e){var n=this;return n._readWriteToStream=e,n._readCheckIfData(),new Promise(function(e,t){n._readResolve=e,n._readReject=t})})});Se(jt);var Nt=/\r\n/g,St=(me({$class:"gpf.stream.LineAdapter",$extend:jt,constructor:function(){this.$super(),this._buffer=[]},write:Te(function(e){return this._buffer.push(e.toString()),this._process(),Promise.resolve()}),flush:function(){return this._buffer.length&&(this._buffer.push("\n"),this._process()),this._completeReadBuffer(),Promise.resolve()},_buffer:[],_consolidateLines:function(){return this._buffer.join("").replace(Nt,"\n").split("\n")},_pushBackLastLineIfNotEmpty:function(e){var t=e.pop();t.length&&this._buffer.push(t)},_process:function(){var t=this,e=t._consolidateLines();t._buffer.length=0,t._pushBackLastLineIfNotEmpty(e),E(e,function(e){t._appendToReadBuffer(e)})}}),be("FlushableStream",{"flush":0})),$t={};function Rt(e,t){e===d&&($t=t)}function Ct(e){return $t(e)}o.read=Ct,o.fs&&(o.fs.read=Ct);Rt(e,function vn(e){return vt({method:ot,url:e}).then(function(e){if(2!==Math.floor(e.status/100))throw new Error(e.responseText);return e.responseText})}),Rt(u,function yn(e){return new Promise(function(n,r){i.readFile(e,function(e,t){e?r(e):n(t.toString())})})});var kt={};function Dt(e,t){return Promise.resolve(t)}function Tt(t){var n=this;return function r(e,t){var n=e.preload[t];return n?Promise.resolve(n):Ct(t)}(n,t).then(function(e){return n.preprocess({name:t,content:e,type:Ze(t).toLowerCase()})}).then(function(e){return function t(e){return kt[e.type]||Dt}(e).call(n,e.name,e.content)})}function Mt(e,t){return function r(e,t){return e._initialDefine=t.define,t.define=function n(){var e=this.gpf.require,t=this._initialDefine;return this.promise=t.apply(e,arguments),e.define=t,this.promise}.bind(e),e.gpf.require=t,e}(function n(){return{gpf:Object.create(o),promise:Promise.resolve(),_initialDefine:null}}(),Gt(e,{base:Ke(t)}))}kt[".json"]=function(e,t){return JSON.parse(t)},L(0,{noCommonJSDynamicRequire:"Dynamic require not supported"});var Ft=/[^.]\brequire\b\s*\(\s*(?:['|"]([^"']+)['|"]|[^)]+)\s*\)/g;var At,Bt=[null,function gn(e){return{dependencies:[],factory:e}},function bn(e,t){return{dependencies:e,factory:t}},function wn(e,t,n){return{dependencies:t,factory:n}}];function Wt(e,t,n){var r={};return N(["gpf","define","module","require"],t)(e,function i(e,t,n){var r=Bt[arguments.length].apply(null,arguments);this.require.define(r.dependencies,function(e){return e.length=r.dependencies.length,r.factory.apply(null,m(e))})}.bind(e),r,function(e){return n[e]||o.Error.noCommonJSDynamicRequire()}),r.exports}At=e===d?function En(e,t){var n=location.pathname.toString();return n.endsWith("/")||(n=Ke(n)),"//# sourceURL="+location.origin+He(n,e)+"?gpf.require\n"+t}:function In(e,t){return t},kt[".js"]=function(n,r){var i=Mt(this,n);return function o(e,t){var n=G(Ft,t);return n.length?Mt(this,e).gpf.require.define(n.map(function(e){return e[1]}).filter(function(e){return e}).reduce(function(e,t){return e[t]=t,e},{}),function(e){return e}):Promise.resolve({})}.call(this,n,r).then(function(e){var t=Wt(i.gpf,At(n,r),e);return undefined===t?i.promise:t})},L(0,{invalidRequireConfigureOption:"Invalid configuration option",invalidRequireConfigureOptionValue:"Invalid configuration option value"});var qt={},Lt=[];function zt(e,t,n){n?Lt.unshift(e):Lt.push(e),qt[e]=t}function Ut(t){!function r(e){E(Object.keys(e),function(e){qt[e]||o.Error.invalidRequireConfigureOption()})}(t);var n=this;E(Lt.filter(function(e){return t[e]!==undefined}),function(e){qt[e](n,t[e])})}function Vt(e){return He(this.base,e)}function Zt(t){var e;return this.cache[t]?this.cache[t]:(e=Tt.call(this,t),(this.cache[t]=e)["catch"](function(e){return function n(e,t){Array.isArray(e.requires)||(e.requires=[]),e.requires.push(t)}(e,t),Promise.reject(e)}))}function Gt(e,t){var n=Object.create(e),r={};return r.define=function o(t,e){var n=this,r=[],i=Object.keys(t);return E(i,function(e){r.push(Zt.call(n,Vt.call(n,t[e])))},n),Promise.all(r).then(function(n){var r;return"function"==typeof e?(r={},E(i,function(e,t){r[e]=n[t]}),e(r)):e})}.bind(n),r.resolve=Vt.bind(n),r.configure=Ut.bind(n),t&&r.configure(t),r}zt("base",function On(e,t){!function n(e){"string"!=typeof e&&o.Error.invalidRequireConfigureOptionValue()}(t),e.base=t}),zt("cache",function xn(t,n){!function r(e){"object"!=typeof e&&o.Error.invalidRequireConfigureOptionValue()}(n),E(Object.keys(n),function(e){t.cache[e]=Promise.resolve(n[e])})}),zt("clearCache",function Pn(e,t){!function n(e){"boolean"!=typeof e&&o.Error.invalidRequireConfigureOptionValue()}(t),t&&(e.cache={})},!0),zt("preload",function jn(t,n){!function r(e){"object"!=typeof e&&o.Error.invalidRequireConfigureOptionValue()}(n),E(Object.keys(n),function(e){t.preload[e]=n[e]})}),zt("preprocess",function Nn(e,t){!function n(e){"function"!=typeof e&&o.Error.invalidRequireConfigureOptionValue()}(t),e.preprocess=t}),o.require=Gt({base:"",cache:{},preload:{},preprocess:function(e){return Promise.resolve(e)}});var Ht=me({$class:"gpf.stream.ReadableArray",constructor:function(e){this._buffer=e},read:De(function(e){var t=this._buffer,n=0;return function r(){return t.length===n?Promise.resolve():e.write(t[n++]).then(r)}()}),_buffer:[]}),Jt=me({$class:"gpf.stream.WritableArray",constructor:function(){this._buffer=[]},write:Te(function(e){return this._buffer.push(e),Promise.resolve()}),toArray:function(){return this._buffer},_buffer:[]});Se(Ht),Se(Jt);var Kt={flush:Promise.resolve.bind(Promise)};function Yt(e){return ye(St,e)||Kt}function Xt(e){if(e.readError)return Promise.reject(e.readError)}function Qt(e,t){var n=function u(e,t){return{iReadableIntermediate:Oe(e),iWritableIntermediate:xe(e),iFlushableIntermediate:Yt(e),iWritableDestination:xe(t),iFlushableDestination:Yt(t),readError:null,rejectWrite:c}}(e,t),r=function s(t){var n=!0,r=t.iReadableIntermediate,i=t.iWritableDestination;return function(){if(n)try{n=!1,r.read(i).then(function(){n=!0},function(e){t.readError=e,t.rejectWrite(e)})}catch(e){t.readError=e}}}(n),i=n.iFlushableIntermediate,o=n.iFlushableDestination,a=n.iWritableIntermediate;return r(),{flush:function(){return Xt(n)||i.flush().then(function(){return o.flush()})},write:function(e){return r(),Xt(n)||function t(n,r){return new Promise(function(t,e){r.then(function(e){t(e),n.rejectWrite=c},e),n.rejectWrite=e})}(n,a.write(e))}}}function en(e){return y(e).length?function r(e){for(var t=e.length,n=e[--t];t;)n=Qt(e[--t],n);return n}(e):xe(e[a])}o.stream.pipe=function Sn(e,t){var n=Oe(e),r=en(y(arguments)),i=Yt(r);try{return n.read(r).then(function(){return i.flush()})}catch(o){return Promise.reject(o)}};var tn={},nn=me({$class:"gpf.stream.AbstractOperator",_dataInPromise:undefined,_dataInResolve:c,_dataOutResolve:c,_dataOutReject:c,_waitForData:function(){var t=this;return t._dataInPromise||(t._dataInPromise=new Promise(function(e){t._dataInResolve=e}).then(function(e){return delete t._dataInPromise,delete t._dataInResolve,e})),t._dataInPromise},_writeData:function(e){var n=this;return n._waitForData(),n._dataInResolve(e),new Promise(function(e,t){n._dataOutResolve=e,n._dataOutReject=t}).then(function(e){return delete n._dataOutResolve,delete n._dataOutReject,e},function(e){return delete n._dataOutResolve,delete n._dataOutReject,Promise.reject(e)})},read:De(function(t){var n=this;return n._waitForData().then(function(e){return tn!==e?t.write(e).then(n._dataOutResolve,n._dataOutReject):(n._dataOutResolve(),Promise.resolve())})}),_process:J(),write:Te(function(e){return this._process(e)}),flush:function(){return this._dataInPromise?this._writeData(tn):Promise.resolve()}});Se(nn);me({$class:"gpf.stream.Filter",$extend:nn,constructor:function(e){this._filter=e},_process:function(e){return this._filter(e)?this._writeData(e):Promise.resolve()}}),me({$class:"gpf.stream.Map",$extend:nn,constructor:function(e){this._map=e},_process:function(e){return this._writeData(this._map(e))}});o.interfaces.promisify=function $n(n){return function(e){var t=ye(n,e);return t||o.Error.interfaceExpected({name:D(n)}),function i(n,e,r){var t=r.then;return r.then=function(){return i(n,e,t.apply(r,arguments))},g(e.prototype,function(e,t){r[t]=function(){var e=arguments;return r.then(function(){return _t(n[t].apply(n,e))})}}),r}(t,n,Promise.resolve())}}});