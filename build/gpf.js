
(function(a,b){"use strict";if(typeof define==="function"&&define.amd){define(["exports"],b);}else if(typeof exports!=="undefined"){b(exports);}else{b(a.gpf={});}}(this,function(a){"use strict";var a,b;if("undefined"!==typeof WScript){a="wscript";b=function(){return this;}.apply(null,[]);b.console={log:function(c){WScript.Echo("    "+c);},info:function(c){WScript.Echo("[?] "+c);},warn:function(c){WScript.Echo("/!\\ "+c);},error:function(c){WScript.Echo("(X) "+c);}};}else if("undefined"!==typeof module&&module.exports){a="nodejs";b=global;}else if("undefined"!==typeof window){a="browser";b=window;}else{a="unknown";b=this;}gpf.host=function(){return a;};gpf.context=function(c){var d,e,f;if(undefined===c){return b;}else{if("string"===typeof c){c=c.split(".");}d=c.length;e=0;if(c[0]==="gpf"){f=gpf;++e;}else{f=b;}for(;e<d;++e){f=f[c[e]];if(undefined===f){break;}}return f;}};gpf.loaded=function(c){if(c){c();}return true;};gpf.ASSERT=function(){};(function(){"use strict";if(undefined===Array.prototype.indexOf){Array.prototype.indexOf=function(c){var d=this.length;while(d--){if(this[d]===c){return d;}}return-1;};}if(undefined===Object.defineProperty){gpf.setReadOnlyProperty=function(c,d,e){c[d]=e;return c;};}else{gpf.setReadOnlyProperty=function(c,d,e){Object.defineProperty(c,d,{enumerable:true,configurable:false,writable:false,value:e});return c;};}}());var c=function(o,p,q){var r,s=o.length,t;for(t=0;t<s;++t){r=p.apply(this,[t,o[t]]);if(undefined!==r){return r;}}return q;},d=function(o,p){var q=o.length,r;for(r=0;r<q;++r){p.apply(this,[r,o[r]]);}},e=function(o,p,q){var r,s;for(s in o){if(o.hasOwnProperty(s)){r=p.apply(this,[s,o[s]]);if(undefined!==r){return r;}}}return q;},f=function(o,p){var q;for(q in o){if(o.hasOwnProperty(q)){p.apply(this,[q,o[q]]);}}},g=function(o,p){this[0][o]=p;},h=function(o,p){var q=this[0],r=this[2];if(undefined!==q[o]){r(q,o,p);}else{q[o]=p;}},i=function(o,p,q){var r,s,t,u=o.length;for(r=0;r<u;++r){s=o[r].a;t=o[r].b;if(s===p&&t===q||t===p&&s===q){return r;}}return undefined;},j=function(o,p,q){if(q&&("object"===typeof o||"object"===typeof p)){if(o instanceof String||p instanceof String){return o.toString()===p.toString();}if(o instanceof Number||p instanceof Number){return o.valueOf()===p.valueOf();}return false;}return false;},k=function(o,p,q,r){if(o!==p){if(typeof o!==typeof p&&!j(o,p,q)){return false;}if(null===o||null===p||"object"!==typeof o){return false;}if(undefined===i(r.done,o,p)){r.todo.push(o);r.todo.push(p);}}return true;},l=function(o,p,q){var r,s,t={todo:[o,p],done:[]};while(0!==t.todo.length){p=t.todo.pop();o=t.todo.pop();if(o.prototype!==p.prototype){return false;}t.done.push({a:o,b:p});s=0;for(r in o){if(o.hasOwnProperty(r)){++s;if(!k(o[r],p[r],q,t)){return false;}}}for(r in p){if(p.hasOwnProperty(r)){--s;}}if(0!==s){return false;}}return true;},m={boolean:function(o,p,q){if("string"===p){if("yes"===o||"true"===o){return true;}return 0!==parseInt(o,10);}if("number"===p){return 0!==o;}return q;},number:function(o,p,q){if("string"===p){return parseFloat(o);}return q;},string:function(o,p,q){gpf.interfaces.ignoreParameter(p);gpf.interfaces.ignoreParameter(q);if(o instanceof Date){return gpf.dateToComparableFormat(o);}return o.toString();},object:function(o,p,q){if(q instanceof Date&&"string"===p){return gpf.dateFromComparableFormat(o);}return q;}},n=Function;gpf.each=function(o,p,q){if(undefined===q){if(o instanceof Array){d.apply(this,arguments);}else{f.apply(this,arguments);}return undefined;}if(o instanceof Array){return c.apply(this,arguments);}return e.apply(this,arguments);};gpf.extend=function(o,p,q){var r;if(undefined===q){r=g;}else{r=h;}gpf.each.apply(arguments,[p,r]);return o;};gpf.extend(gpf,{_alpha:"abcdefghijklmnopqrstuvwxyz",_ALPHA:"ABCDEFGHIJKLMNOPQRSTUVWXYZ",_digit:"0123456789",_func:function(o){return new n(o);},value:function(o,p,q){var r=typeof o;if(!q){q=typeof p;}if(q===r){return o;}if("undefined"===r||!o){return p;}return m[q](o,r,p);},like:function(o,p,q){if(o===p){return true;}if(typeof o!==typeof p){return j(o,p,q);}if(null===o||null===p||"object"!==typeof o){return false;}return l(o,p,q);},clone:function(o){return gpf.json.parse(gpf.json.stringify(o));},test:function(o,p){var q;if(o instanceof Array){q=o.length;while(q>0){if(o[--q]===p){return q;}}}else{for(q in o){if(o.hasOwnProperty(q)&&o[q]===p){return q;}}}return undefined;},set:function(o,p){gpf.ASSERT(o instanceof Array,"gpf.set must be used with an Array");var q=o.length;while(q>0){if(o[--q]===p){return o;}}o.push(p);return o;},clear:function(o,p){var q;if(o instanceof Array){q=o.length;while(q>0){if(o[--q]===p){o.splice(q,1);break;}}}else{for(q in o){if(o.hasOwnProperty(q)&&o[q]===p){break;}}}return o;},xor:function(o,p){return o&&!p||!o&&p;},capitalize:function(o){return o.charAt(0).toUpperCase()+o.substr(1);},Callback:function(o,p){if(o){this._handler=o;}if(p){this._scope=p;}}});gpf.extend(gpf.Callback.prototype,{_handler:gpf._func(""),_scope:null,handler:function(){return this._handler;},scope:function(){return this._scope;},call:function(){var o=arguments[0],p=[],q=arguments.length,r;for(r=1;r<q;++r){p.push(arguments[r]);}return this.apply(o,p);},apply:function(o,p){var q=gpf.Callback.resolveScope(this._scope||o);return this._handler.apply(q,p||[]);}});gpf.extend(gpf.Callback,{resolveScope:function(o){if(null===o||undefined===o){o=gpf.context();}return o;},buildParamArray:function(o,p){var q,r,s;if(p){q=p.length;r=new Array(o+q);for(s=0;s<q;++s){r[o]=p[s];++o;}}else{r=new Array(o);}return r;},doApply:function(o,p,q){var r=arguments.length,s=3,t=0;while(s<r){q[t]=arguments[s];++s;++t;}return o.apply(p,q);},bind:function(o,p){var q=p+":boundToThis";gpf.ASSERT("function"===typeof o[p],"Only methods can be bound");if(undefined===o[q]){o[q]=function(){return o[p].apply(o,arguments);};}return o[q];}});var o=function(s){var t,u,v;this._listeners={};if(undefined!==s){this._events=s;u=s.length;for(t=0;t<u;++t){v=s[t];this["on"+v.charAt(0).toUpperCase()+v.substr(1)]=this._onEVENT(t);this._listeners[v]=[];}}},p=function(s){return function(){var t=[this._events[s]],u=arguments.length,v;for(v=0;v<u;++v){t.push(arguments[v]);}return this.addEventListener.apply(this,t);};},q=function(){o.apply(this,arguments);},r=function(s,t,u,v){this._type=s;if(undefined!==t){this._params=t;}if(u){this._cancelable=true;}if(v){this._scope=v;}};gpf.extend(o.prototype,{_listeners:{},_events:null,_onEVENT:function(s){var t=q.prototype._onEVENT.closures,u;if(!t){t=q.prototype._onEVENT.closures=[];}gpf.ASSERT(t.length>=s,"calls must be sequential");while(t.length<=s){u=t.length;t.push(p(u));}return t[s];},addEventListener:function(s,t,u,v){var w=this._listeners;if("boolean"===typeof u){v=u;u=undefined;}else{if(!u){u=null;}if(!v){v=false;}}if(t instanceof gpf.Callback){if(u&&u!==t.scope()){t=t.handler();}}if(!(t instanceof gpf.Callback)){t=new gpf.Callback(t,u);}if(undefined===w[s]){w[s]=[];}if(v){w[s].unshift(t);}else{w[s].push(t);}return this;},removeEventListener:function(s,t,u){var v=this._listeners[s],w,x;if(undefined!==v){if(t instanceof gpf.Callback){if(!u){u=t.scope();}t=t.handler();}x=v.length;while(x>0){w=v[--x];if(w.handler()===t&&w.scope()===u){v.splice(x,1);break;}}}return this;},_broadcastEvent:function(s,t){var u,v,w;if(s instanceof r){v=s.type();}else{v=s;}w=this._listeners[v];if(undefined===w){return this;}if(s instanceof r){for(u=0;u<w.length;++u){w[u].apply(s._scope,[s]);if(s._propagationStopped){break;}}}else{for(u=0;u<w.length;++u){w[u].apply(null,[s,t]);}}return this;}});q.prototype=new o;gpf.extend(q.prototype,{broadcastEvent:function(){return this._broadcastEvent.apply(this,arguments);}});gpf.extend(r.prototype,{_type:"",_params:{},_cancelable:false,_propagationStopped:false,_defaultPrevented:false,_scope:null,type:function(){return this._type;},scope:function(){return gpf.Callback.resolveScope(this._scope);},cancelable:function(){return this._cancelable;},preventDefault:function(){this._defaultPrevented=true;},defaultPrevented:function(){return this._defaultPrevented;},stopPropagation:function(){this._propagationStopped=true;},get:function(s){return this._params[s];},fire:function(s){return gpf.events.fire(this,s);}});gpf.events={Target:o,Broadcaster:q,Event:r,fire:function(s,t,u){var v;if(undefined===u){u=t;t=undefined;}if(!(s instanceof r)){s=new gpf.events.Event(s,t,true,this);}v=gpf.Callback.resolveScope(s._scope);if(u instanceof o){u._broadcastEvent(s);}else if("function"===typeof u||u instanceof gpf.Callback){u.apply(v,[s]);}else{u=u[s.type()];if(undefined!==typeof u){u.apply(v,[s]);}}return s;}};var s=0,t={},u=function(x){var y=x.scriptTag,z=x.headTag;y.onerror=y.onload=y.onreadystatechange=null;if(z&&y.parentNode){z.removeChild(y);}delete t[x.id];},v=function(){var x=t[this.id];if(!x.done&&(!this.readyState||this.readyState==="loaded"||this.readyState==="complete")){setTimeout(function(){x.done=true;gpf.events.fire("load",{url:x.src},x.eventsHandler);},0);u(x);}},w=function(){var x=t[this.id];if(!x.done){x.done=true;gpf.events.fire("error",{url:x.src},x.eventsHandler);u(x);}};gpf.http={include:function(x,y){var z={src:x,id:"__gpf_http_"+ ++s,headTag:document.getElementsByTagName("head")[0]||document.documentElement,scriptTag:document.createElement("script"),done:false},A;if(undefined===y){y=new gpf.events.Broadcaster(["load","error"]);}z.eventsHandler=y;t[z.id]=z;A=z.scriptTag;A.language="javascript";A.src=x;A.id=z.id;A.onload=A.onreadystatechange=v;A.onerror=w;if(undefined!==A.async){A.async=true;}setTimeout(function(){z.headTag.insertBefore(A,z.headTag.firstChild);},0);}};var x=function(z,A,B){if(!A){A=null;}if(!B){B=[];}return function(){z.apply(gpf.Callback.resolveScope(A),B);};},y;if("wscript"===gpf.host()){gpf._asyncQueue=[];y=function(z,A){return z._dt-A._dt;};gpf.defer=function(z,A,B,C){var D=x(z,B,C);if(!A){A=0;}D._dt=new Date(new Date- -A);gpf._asyncQueue.push(D);gpf._asyncQueue.sort(y);};gpf.runAsyncQueue=function(){var z=gpf._asyncQueue,A;while(z.length){A=z.shift();if(A._dt>new Date){WScript.Sleep(A._dt-new Date);}A();}};}else{gpf.defer=function(z,A,B,C){if(!A){A=0;}setTimeout(x(z,B,C),A);};gpf.runAsyncQueue=function(){};}var z=gpf._ALPHA+gpf._alpha+gpf._digit+"+/",A="0123456789ABCDEF",B=function(D,E,F,G){var H=D.length,I=gpf.bin.isPow2(H),J,K,L=[],M;if(-1<I&&(undefined===F||F*I<=32)){if(undefined===F){J=32;}else{J=F*I;}K=(1<<J-I)-1;J=(1<<I)-1;while(0!==E){M=E&J;L.unshift(D.charAt(M));E=E>>I&K;}}else{while(0!==E){M=E%H;L.unshift(D.charAt(M));E=(E-M)/H;}}if(undefined!==F){if(undefined===G){G=D.charAt(0);}while(L.length<F){L.unshift(G.charAt(L.length%G.length));}}else if(0===L.length){L=[D.charAt(0)];}return L.join("");},C=function(D,E,F){var G=D.length,H=0,I=0;if(undefined===F){F=D.charAt(0);}while(I<E.length){if(-1===F.indexOf(E.charAt(I))){break;}else{++I;}}while(I<E.length){H=G*H+D.indexOf(E.charAt(I++));}return H;};gpf.bin={pow2:function(D){return 1<<D;},isPow2:function(D){if(0<D&&0===(D&D-1)){var E=0;while(1<D){++E;D>>=1;}return E;}else{return-1;}},toBaseANY:B,fromBaseANY:C,toHexa:function(D,E,F){return B(A,D,E,F);},fromHexa:function(D,E){return C(A,D,E);},toBase64:function(D,E,F){return B(z,D,E,F);},fromBase64:function(D,E){return C(z,D,E);},test:function(D,E){return(D&E)===E;},clear:function(D,E){return D&~E;}};gpf.json={};if("undefined"===typeof JSON){var D=function(F){var G,H,I,J;G=F instanceof Array;H=[];for(I in F){if("function"===typeof F[I]){continue;}J=E(F[I]);if(G){H.push(J);}else{H.push(I+": "+J);}}if(G){return"["+H.join(", ")+"]";}else{return"("+H.join(", ")+")";}},E=function(F){var G=typeof F;if("undefined"===G||"function"===G){return;}else if("number"===G||"boolean"===G){return F.toString();}else if("string"===G){return gpf.escapeFor(F,"javascript");}if(null===F){return"null";}else{return D(F);}};gpf.json.stringify=E;gpf.json.parse=function(F){return gpf._func("return "+F)();};}else{gpf.json.stringify=JSON.stringify;gpf.json.parse=JSON.parse;}var I="public|protected|private|static".split("|"),J=0,K=1,L=3,M=true,N=gpf._alpha+gpf._ALPHA+gpf._digit+"_",O=function(Q){var R;Q=Q.toString();R=Q.indexOf("._super");if(-1===R){return false;}return-1===N.indexOf(Q.charAt(R+7));},P=function(Q,R){return function(){var S=this._super,T;this._super=Q;T=R.apply(this,arguments);if(undefined===S){delete this._super;}else{this._super=S;}return T;};};gpf.ClassDefinition=function(Q,R,S){this._Subs=[];if("function"===typeof Q){this._Constructor=Q;}else{this._name=Q;this._Base=R;this._definition=S;this._build();}};gpf.extend(gpf.ClassDefinition.prototype,{_name:"",name:function(){return this._name;},_Base:Object,Base:function(){return this._Base;},_Subs:[],Subs:function(){return this._Subs;},_attributes:null,attributes:function(){if(!this._attributes){this._attributes=new gpf.attributes.Map;}return this._attributes;},_Constructor:function(){},_defConstructor:null,Constructor:function(){return this._Constructor;},_definition:null,addMember:function(Q,R,S){var T=this._Constructor.prototype;gpf.ASSERT(Q!=="constructor","No constructor can be added");gpf.ASSERT(undefined===T[Q],"No member can be overridden");if(undefined===S){S=J;}else if("string"===typeof S){S=I.indexOf(S);if(-1===S){S=J;}}this._addMember(Q,R,S);},_addMember:function(Q,R,S){var T=this._Constructor.prototype;if(L===S){gpf.setReadOnlyProperty(T.constructor,Q,R);}else{T[Q]=R;}},_processMember:function(Q,R){var S=this._definition[Q],T=Q==="constructor",U,V,W;U=typeof S;if(L===R){this._addMember(Q,S,L);return;}if(T){V=this._Base;}else{V=this._Base.prototype[Q];}W=typeof V;if("undefined"!==W&&null!==V&&U!==W){gpf.Error.ClassMemberOverloadWithTypeChange();}if("function"===U&&"undefined"!==W&&O(S)){S=P(V,S);}if(T){this._defConstructor=S;}else{this._addMember(Q,S,R);}},_processAttribute:function(Q){var R,S=this._definition[Q];Q=Q.substr(1,Q.length-2);if(!this._attributes){this._attributes={};}R=this._attributes[Q];if(undefined===R){R=[];}this._attributes[Q]=R.concat(S);},_processDefWithVisibility:function(Q){var R=this._definition,S,T;T=I[Q];S=R[T];this._definition=S;try{for(T in S){if(S.hasOwnProperty(T)){if("["===T.charAt(0)&&"]"===T.charAt(T.length-1)){this._processAttribute(T);}else if("public"===T||"private"===T||"protected"===T||"static"===T){gpf.Error.ClassInvalidVisibility();}else{this._processMember(T,Q);}}}if("wscript"===gpf.host()&&S.constructor!==Object){this._processMember("constructor",Q);}}catch(e){throw e;}finally{this._definition=R;}},_processDefinition:function(){var Q=this._definition,R,S;for(R in Q){if(Q.hasOwnProperty(R)){if("["===R.charAt(0)&&"]"===R.charAt(R.length-1)){this._processAttribute(R);}else{S=I.indexOf(R);if(-1===S){if(R.charAt(0)==="_"){S=K;}else{S=J;}this._processMember(R,S);}else{this._processDefWithVisibility(S);}}}}if("wscript"===gpf.host()&&Q.constructor!==Object){this._processMember("constructor",J);}},_processAttributes:function(){var Q=this._attributes,R,S,T;if(Q){delete this._attributes;R=this._Constructor;S=R.prototype;for(T in Q){if(Q.hasOwnProperty(T)){if(T in S||T==="Class"){gpf.attributes.add(R,T,Q[T]);}else{console.error("gpf.define: Invalid attribute name '"+T+"'");}}}}},_build:function(){var Q,R,S;Q=gpf._func(H(this._name))(gpf);this._Constructor=Q;Q._gpf=this;M=false;R=new this._Base;M=true;Q.prototype=R;R.constructor=Q;S=gpf.classDef(this._Base);S.Subs().push(Q);this._processDefinition();this._processAttributes();}});gpf.classDef=function(Q){if(undefined===Q._gpf){Q._gpf=new gpf.ClassDefinition(Q);}return Q._gpf;};gpf._classInit=function(Q,R){if(M){var S=gpf.classDef(Q);if(S._defConstructor){S._defConstructor.apply(this,R);}else{S._Base.apply(this,R);}}};function F(){var Q=arguments[0],R=_CONSTRUCTOR_=function(){Q._classInit.apply(this,[R,arguments]);};return R;}function G(){var Q=arguments[0],R=function _CONSTRUCTOR_(){Q._classInit.apply(this,[R,arguments]);};return R;}function H(Q){var R,S,T,U;if(-1<Q.indexOf(".")){R=F;}else{R=G;}S=R.toString().replace("_CONSTRUCTOR_",Q);T=S.indexOf("{")+1;U=S.lastIndexOf("}")-1;return S.substr(T,U-T+1);}gpf.define=function(Q,R,S){var T,U,V,W,X;if("string"===typeof R){R=gpf.context(R);}else if("object"===typeof R){S=R;R=undefined;}if(undefined===R){R=Object;}if(-1<Q.indexOf(".")){U=Q.split(".");W=U.pop();V=gpf.context(U);}X=new gpf.ClassDefinition(Q,R,S||{});T=X.Constructor();if(undefined!==V){V[W]=T;}return T;};gpf._genDefHandler=function(Q,R){Q=Q+".";return function(S,T,U){var V;if(undefined===U&&"object"===typeof T){U=T;T=Q+R;}else if(undefined===T){T=Q+R;}if(-1===S.indexOf(".")){S=Q+S;}V=gpf.define(S,T,U);return V;};};var R=0,S=gpf._genDefHandler("gpf.attributes","Attribute");gpf.attributes={};function Q(T,U){U="$"+U;gpf[U]=function(){var V=gpf._func("return function "+U+"(args) {"+"this.constructor.apply(this, args);"+"};")();V.prototype=T.prototype;return function(){return new V(arguments);};}();}gpf._defAttr=function(T,U,V){var W=T.charAt(0)==="$",X,Y;if(W){T=T.substr(1);X=T+"Attribute";}else{X=T;}Y=S(X,U,V);if(W){Q(Y,T);}return Y;};gpf._defAttr("Attribute",{protected:{_member:"",_alterPrototype:function(T){gpf.interfaces.ignoreParameter(T);}},public:{member:function(){return this._member;}}});gpf._defAttr("$Alias",{private:{_name:""},protected:{_alterPrototype:function(T){Q(T.constructor,this._name);}},public:{constructor:function(T){this._name=T;}}});gpf.define("gpf.attributes.Array",{private:{_array:[]},public:{constructor:function(){this._array=[];},has:function(T){gpf.ASSERT("function"===typeof T,"Expected a class parameter");gpf.ASSERT(T.prototype instanceof gpf.attributes.Attribute,"Expected an Attribute-like class parameter");var U,V=this._array.length,W;for(U=0;U<V;++U){W=this._array[U];if(W instanceof T){return W;}}return null;},filter:function(T){gpf.ASSERT("function"===typeof T,"Expected a class parameter");gpf.ASSERT(T.prototype instanceof gpf.attributes.Attribute,"Expected an Attribute-like class parameter");var U,V=this._array.length,W,X=new gpf.attributes.Array;for(U=0;U<V;++U){W=this._array[U];if(W instanceof T){X._array.push(W);}}return X;},each:function(T,U,V){U=gpf.Callback.resolveScope(U);V=gpf.Callback.buildParamArray(1,V);var W,X=this._array.length,Y;for(W=0;W<X;++W){Y=gpf.Callback.doApply(T,U,V,this._array[W]);if(undefined!==Y){return Y;}}}}});gpf.define("gpf.attributes.Map",{private:{_members:{},_count:0,_copyTo:function(T,U,V){var W,X,Y,Z;if(this._count){for(W in this._members){if(this._members.hasOwnProperty(W)){X=this._members[W]._array;for(Y=0;Y<X.length;++Y){Z=X[Y];if(!U||U(W,Z,V)){T.add(W,Z);}}}}}},_filterCallback:function(T,U,V){gpf.interfaces.ignoreParameter(T);return U instanceof V;}},public:{constructor:function(T){this._members={};this._count=0;if(undefined!==T){this.fillFromObject(T);}},count:function(){return this._count;},add:function(T,U){var V=this._members[T];if(undefined===V){V=this._members[T]=new gpf.attributes.Array;}V._array.push(U);++this._count;},fillFromObject:function(T){var U=gpf.classDef(T.constructor),V;while(U){V=U.attributes();if(V){V._copyTo(this);}if(U.Base()!==Object){U=gpf.classDef(U.Base());}else{break;}}return this._count;},filter:function(T){gpf.ASSERT("function"===typeof T,"Expected a class parameter");gpf.ASSERT(T.prototype instanceof gpf.attributes.Attribute,"Expected an Attribute-like class parameter");var U=new gpf.attributes.Map;this._copyTo(U,this._filterCallback,T);return U;},member:function(T){var U=this._members[T];if(undefined===U){if(0===R){R=new gpf.attributes.Array;}U=R;}return U;},members:function(){var T=[],U;for(U in this._members){if(this._members.hasOwnProperty(U)){T.push(U);}}return T;},each:function(T,U,V){U=gpf.Callback.resolveScope(U);V=gpf.Callback.buildParamArray(2,V);var W,X;for(W in this._members){if(this._members.hasOwnProperty(W)){X=gpf.Callback.doApply(T,U,V,W,this._members[W]);if(undefined!==X){return X;}}}}}});gpf.attributes.add=function(T,U,V){var W,X,Y,Z;W=gpf.classDef(T).attributes();X=V.length;for(Y=0;Y<X;++Y){Z=V[Y];Z._member=U;W.add(U,Z);Z._alterPrototype(T.prototype);}};gpf.define("gpf.Error",{public:{code:0,name:"Error",message:""}});var T={"NotImplemented":"Not implemented","Abstract":"Abstract","AssertionFailed":"Assertion failed: {message}","ClassMemberOverloadWithTypeChange":"You can't overload a member to change its type","ClassInvalidVisibility":"Invalid visibility keyword","InterfaceExpected":"Expected interface not implemented: {name}","EnumerableInvalidMember":"$Enumerable can be associated to arrays only","PatternUnexpected":"Invalid syntax (unexpected)","PatternEmpty":"Empty pattern","PatternInvalidSyntax":"Invalid syntax","PatternEmptyGroup":"Syntax error (empty group)","HtmlHandlerMultiplicityError":"Too many $HtmlHandler attributes for '{member}'","HtmlHandlerMissing":"No $HtmlHandler attributes","HtmlHandlerNoDefault":"No default $HtmlHandler attribute","EngineStackUnderflow":"Stack underflow","EngineTypeCheck":"Type check","EncodingNotSupported":"Encoding not supported","EncodingEOFWithUnprocessedBytes":"Unexpected end of stream: unprocessed bytes","XmlInvalidName":"Invalid XML name"},U=function(X,Y){return function(Z){var ab=new gpf.Error,bb,cb;ab.code=X;ab.name=Y;if(Z){bb={};for(cb in Z){if(Z.hasOwnProperty(cb)){bb["{"+cb+"}"]=Z[cb].toString();}}ab.message=gpf.replaceEx(T[Y],bb);}else{ab.message=T[Y];}throw ab;};},name,code=0;for(name in T){if(T.hasOwnProperty(name)){++code;gpf.Error["CODE_"+name.toUpperCase()]=code;gpf.Error[name]=U(code,name);}}var X=function(ab){return gpf._func("return this."+ab+";");},Y=function(ab){return gpf._func("var r = this."+ab+"; if (0 < arguments.length) { this."+ab+" = arguments[0]; } return r;");},Z=gpf._defAttr("ClassAttribute");gpf._defAttr("$ClassProperty",Z,{_writeAllowed:false,_publicName:undefined,_visibility:undefined,constructor:function(ab,bb,cb){if(ab){this._writeAllowed=true;}if("string"===typeof bb){this._publicName=bb;}if("string"===typeof cb){this._visibility=cb;}},_alterPrototype:function(ab){var bb=this._member,cb=this._publicName,db=gpf.classDef(ab.constructor),eb;if(!cb){cb=bb.substr(1);}if(this._writeAllowed){eb=Y(bb);}else{eb=X(bb);}db.addMember(cb,eb,this._visibility);}});gpf._defAttr("$ClassEventMethod",Z,{});gpf._defAttr("$ClassExtension",Z,{_ofClass:0,_publicName:"",constructor:function(ab,bb){this._ofClass=ab;if("string"===typeof bb){this._publicName=bb;}}});gpf.interfaces={isImplementedBy:function(cb,db){var eb;for(eb in db.prototype){if("constructor"===eb||"extend"===eb){continue;}if(typeof db.prototype[eb]!==typeof cb[eb]){return false;}}return true;},query:function(cb,db,eb){var fb=null;if(gpf.interfaces.isImplementedBy(cb,db)){return cb;}else if(gpf.interfaces.isImplementedBy(cb,gpf.interfaces.IUnknown)){fb=cb.queryInterface(db);}if(null===fb&&eb){gpf.Error.InterfaceExpected({name:gpf.classDef(db).name()});}return fb;}};if(!gpf.interfaces.ignoreParameter){gpf.interfaces.ignoreParameter=function(){};}gpf._defIntrf=gpf._genDefHandler("gpf.interfaces","Interface");gpf._defIntrf("Interface");gpf._defIntrf("IEventTarget",{addEventListener:function(cb,db,eb,fb){gpf.interfaces.ignoreParameter(cb);gpf.interfaces.ignoreParameter(db);gpf.interfaces.ignoreParameter(eb);gpf.interfaces.ignoreParameter(fb);},removeEventListener:function(cb,db,eb){gpf.interfaces.ignoreParameter(cb);gpf.interfaces.ignoreParameter(db);gpf.interfaces.ignoreParameter(eb);}});gpf._defIntrf("IUnknown",{queryInterface:function(cb){gpf.interfaces.ignoreParameter(cb);return null;}});function ab(cb){var db=new gpf.attributes.Map(this).member("Class").filter(gpf.attributes.InterfaceImplementAttribute),eb,fb;for(eb=0;eb<db.length();++eb){fb=db.get(eb);if(fb._interfaceDefinition===cb){if(fb._builder){return fb._builder(this);}break;}}return null;}function bb(cb){return function(){var db=ab.apply(this,arguments);if(null===db){db=cb.apply(this,arguments);}return db;};}gpf._defAttr("$InterfaceImplement",{"[_interfaceDefinition]":[gpf.$ClassProperty(false,"which")],_interfaceDefinition:0,"[_builder]":[gpf.$ClassProperty(false,"how")],_builder:null,constructor:function(cb,db){this._interfaceDefinition=cb;if(db){this._builder=db;}},_alterPrototype:function(cb){if(!this._builder){return;}if(undefined!==cb.queryInterface){if(ab!==cb.queryInterface){cb.queryInterface=bb(cb.queryInterface);}}else{cb.queryInterface=ab;gpf.attributes.add(cb.constructor,"Class",[gpf.$InterfaceImplement(gpf.interfaces.IUnknown)]);}}});var eb=gpf.interfaces,fb=gpf.attributes;gpf._defIntrf("IEnumerable",{reset:function(){},moveNext:function(){return false;},current:function(){return null;}});function cb(gb){var hb=-1;return{reset:function(){hb=-1;},moveNext:function(){++hb;return hb<gb.length;},current:function(){return gb[hb];}};}function db(gb){var hb=new fb.Map(gb).filter(fb.EnumerableAttribute),ib=hb.members();gpf.ASSERT(ib.length===1,"Only one member can be defined as enumerable");return cb(gb[ib[0]]);}gpf._defAttr("$Enumerable",fb.ClassAttribute,{_alterPrototype:function(gb){if(!(gb[this._member]instanceof Array)){gpf.Error.EnumerableInvalidMember();}fb.add(gb.constructor,"Class",[new fb.InterfaceImplementAttribute(eb.IEnumerable,db)]);}});var gb=gpf.interfaces,hb=gpf.attributes,ib;ib=gpf._defIntrf("IReadOnlyArray",{length:function(){return 0;},get:function(jb){gb.ignoreParameter(jb);return undefined;}});gpf._defIntrf("IArray",ib,{set:function(jb,kb){gb.ignoreParameter(jb);gb.ignoreParameter(kb);return undefined;}});gpf._defAttr("ClassArrayInterfaceAttribute",hb.ClassAttribute,{"[Class]":[gpf.$Alias("ClassIArray")],_writeAllowed:false,constructor:function(jb){if(jb){this._writeAllowed=true;}},_alterPrototype:function(jb){var kb;if(this._writeAllowed){kb=gb.IArray;}else{kb=gb.IReadOnlyArray;}hb.add(jb.constructor,"Class",[gpf.$InterfaceImplement(kb)]);jb.length=gpf._func("return this."+this._member+".length;");jb.get=gpf._func("return this."+this._member+"[arguments[0]];");if(this._writeAllowed){jb.set=gpf._func("var i=arguments[0],"+"v=this."+this._name+"[i];this."+this._member+"[i]=arguments[1];return v;");}}});hb.add(hb.Array,"_array",[gpf.$ClassIArray(false)]);gpf.arrayOrItem=function(jb,kb){if(undefined===kb){return Array.prototype.slice.call(jb,0);}else if(0===jb.length){return undefined;}else if(-1===kb){return jb[jb.length-1];}else if(kb<-1||kb>jb.length-1){return undefined;}else{return jb[kb];}};var jb=gpf.interfaces,kb=256,lb=0,mb=1,nb=2,ob=3;gpf._defIntrf("IReadableStream",{read:function(pb,qb){gpf.interfaces.ignoreParameter(pb);gpf.interfaces.ignoreParameter(qb);},static:{EVENT_ERROR:"error",EVENT_DATA:"data",EVENT_END_OF_STREAM:"eos",EXCEPTION_READ_IN_PROGRESS:{message:"Read in progress"}}});gpf._defIntrf("IWritableStream",{write:function(pb,qb){gpf.interfaces.ignoreParameter(pb);gpf.interfaces.ignoreParameter(qb);},static:{EVENT_ERROR:"error",EVENT_READY:"ready",EXCEPTION_WRITE_IN_PROGRESS:{message:"Read in progress"}}});gpf._defIntrf("IStream",{read:function(pb,qb){gpf.interfaces.ignoreParameter(pb);gpf.interfaces.ignoreParameter(qb);},write:function(pb,qb){gpf.interfaces.ignoreParameter(pb);gpf.interfaces.ignoreParameter(qb);}});gpf._defIntrf("ITextStream",jb.IStream,{});gpf.stream={};gpf.define("gpf.stream.BufferedOnRead",{"[Class]":[gpf.$InterfaceImplement(jb.IReadableStream)],protected:{_buffer:[],_bufferLength:0,_readSize:kb,_addToBuffer:function(pb){gpf.interfaces.ignoreParameter(pb);gpf.Error.Abstract();},_endOfInputStream:function(){},_readFromBuffer:function(pb){gpf.ASSERT(0!==this._buffer.length,"Buffer is not empty");if("string"===this._buffer[0]){return this._readFromStringBuffer(pb);}else{return this._readFromByteBuffer(pb);}},_readFromStringBuffer:function(pb){var qb=gpf.stringExtractFromStringArray(this._buffer,pb);this._bufferLength-=qb.length;return qb;},_readFromByteBuffer:function(pb){this._bufferLength-=pb;return this._buffer.splice(0,pb);}},public:{constructor:function(pb){this._iStream=jb.query(pb,jb.IReadableStream,true);this._buffer=[];},read:function(pb,qb){var rb=this._iState,sb=this._bufferLength;if(mb===rb){throw jb.IReadableStream.EXCEPTION_READ_IN_PROGRESS;}else if(pb<sb||sb&&ob===rb){if(0===pb||pb>sb){pb=sb;}gpf.events.fire.apply(this,[jb.IReadableStream.EVENT_DATA,{buffer:this._readFromBuffer(pb)},qb]);}else if(ob===rb){gpf.events.fire.apply(this,[jb.IReadableStream.EVENT_END_OF_STREAM,qb]);}else{if(lb===this._iState){this._cbRead=new gpf.Callback(this._onRead,this);}this._iState=mb;this._size=pb;this._eventsHandler=qb;this._iStream.read(this._readSize,this._cbRead);}}},private:{_iStream:null,_cbRead:null,_iState:lb,_size:0,_eventsHandler:null,_onRead:function(pb){var qb=pb.type();if(qb===jb.IReadableStream.EVENT_END_OF_STREAM){this._iState=ob;this._endOfInputStream();return this.read(this._size,this._eventsHandler);}else if(qb===jb.IReadableStream.EVENT_ERROR){gpf.events.fire.apply(this,[pb,this._eventsHandler]);}else{this._iState=nb;this._addToBuffer(pb.get("buffer"));if(0<this._bufferLength){return this.read(this._size,this._eventsHandler);}else{this._iStream.read(kb,this._cbRead);}}}}});gpf.define("gpf.stream.BitReader","gpf.stream.BufferedOnRead",{"[Class]":[gpf.$InterfaceImplement(jb.IReadableStream)],protected:{_addToBuffer:function(pb){this._buffer=this._buffer.concat(pb);this._bufferLength+=pb.length*8;},_readFromBuffer:function(pb){var qb=this._buffer,rb=[],sb=this._bit,tb,ub=0,vb=0;tb=qb[0];while(0<pb){--pb;vb<<=1;if(0!==(tb&sb)){vb|=1;}--this._bufferLength;if(sb===1){qb.shift();tb=qb[0];sb=128;}else{sb>>=1;}if(ub===7){rb.push(vb);vb=0;ub=0;}else{++ub;}}if(ub!==0){rb.push(vb);}this._bit=sb;return rb;}},private:{_bit:128}});var pb=gpf.define("AbstractStreamReader",{public:{constructor:function(sb,tb){this._scope=gpf.Callback.resolveScope(sb);this._eventsHandler=tb;},read:function(sb){sb.read(this._readSize,gpf.Callback.bind(this,"callback"));}},protected:{_readSize:0,_consolidateBuffer:function(){gpf.Error.Abstract();return[];},_addBuffer:function(sb){gpf.interfaces.ignoreParameter(sb);gpf.Error.Abstract();}},private:{_scope:null,_eventsHandler:null,callback:function(sb){var tb=sb.type(),ub=sb.scope();if(tb===jb.IReadableStream.EVENT_END_OF_STREAM){gpf.events.fire.apply(this._scope,[jb.IReadableStream.EVENT_DATA,{buffer:this._consolidateBuffer()},this._eventsHandler]);}else if(tb===jb.IReadableStream.EVENT_ERROR){gpf.events.fire.apply(this._scope,[sb,this._eventsHandler]);}else{this._addBuffer(sb.get("buffer"));this.read(ub);}}}}),qb=gpf.define("StreamReader",pb,{public:{constructor:function(sb,tb,ub){this._super(sb,tb);this._concatMethod=ub;}},protected:{_consolidateBuffer:function(){return this._concatMethod(this._buffer);},_addBuffer:function(sb){this._buffer=this._concatMethod(this._buffer,sb);}},private:{_buffer:undefined,_concatMethod:null}}),rb=gpf.define("B64StreamReader",pb,{public:{constructor:function(sb,tb){this._super(sb,tb);this._buffer=[];}},protected:{_readSize:6,_consolidateBuffer:function(){return this._buffer.join("");},_addBuffer:function(sb){this._buffer.push(gpf.bin.toBase64(sb[0]));}},private:{_buffer:[]}});gpf.stream.readAll=function(sb,tb,ub){sb=gpf.interfaces.query(sb,jb.IReadableStream,true);new qb(this,ub,tb).read(sb);};gpf.stream.readAllAsB64=function(sb,tb){sb=new gpf.stream.BitReader(sb);new rb(this,tb).read(sb);};var tb=gpf.interfaces,ub={javascript:{"\\":"\\\\","\"":"\\\"","\n":"\\n","\r":"\\r","\t":"\\t"},xml:{"&":"&amp;","<":"&lt;",">":"&gt;"},html:{"&":"&amp;","<":"&lt;",">":"&gt;","\xE9":"&eacute;","\xE8":"&egrave;","\xEA":"&ecirc;","\xE1":"&aacute;","\xE0":"&agrave;"}},vb=gpf.define("StringStream",gpf.events.Target,{"[Class]":[gpf.$InterfaceImplement(gpf.interfaces.ITextStream)],public:{constructor:function(wb){if(undefined!==wb&&wb.length){this._buffer=[wb];}else{this._buffer=[];}},read:function(wb,xb){var yb;if(0===this._buffer.length){gpf.defer(gpf.events.fire,0,this,[tb.IReadableStream.EVENT_END_OF_STREAM,xb]);}else{yb=gpf.stringExtractFromStringArray(this._buffer,wb);gpf.defer(gpf.events.fire,0,this,[tb.IReadableStream.EVENT_DATA,{buffer:yb},xb]);}},write:function(wb,xb){gpf.ASSERT(wb&&wb.length,"Write must contain data");this._buffer.push(wb);gpf.events.fire.apply(this,[tb.IReadableStream.EVENT_READY,xb]);},consolidateString:function(){return this._buffer.join("");}},private:{_buffer:[]}});gpf.extend(gpf,{"[capitalize]":[gpf.$ClassExtension(String)],"[replaceEx]":[gpf.$ClassExtension(String)],replaceEx:function(wb,xb){var yb=wb,zb;for(zb in xb){if(xb.hasOwnProperty(zb)){if(-1<yb.indexOf(zb)){yb=yb.split(zb).join(xb[zb]);}}}return yb;},"[escapeFor]":[gpf.$ClassExtension(String)],escapeFor:function(wb,xb){var yb=ub[xb];if(undefined!==yb){wb=gpf.replaceEx(wb,yb);if("javascript"===xb){wb="\""+wb+"\"";}}return wb;},"[stringExtractFromStringArray]":[gpf.$ClassExtension(String,"fromStringArray")],stringExtractFromStringArray:function(wb,xb){var yb=wb.length,zb,Ab,Bb,Cb;if(!xb){zb=wb.splice(0,yb).join("");}else{Ab=0;do{Bb=wb[Ab];Cb=Bb.length;if(Cb<=xb){++Ab;xb-=Cb;}else{break;}}while(0<xb&&Ab<yb);if(0===xb){zb=wb.splice(0,Ab).join("");}else if(Ab<yb){zb=[];if(0<Ab){zb.push(wb.splice(0,Ab-1).join(""));}Bb=wb.shift();zb.push(Bb.substr(0,xb));wb.unshift(Bb.substr(xb));zb=zb.join("");}else{zb=wb.splice(0,yb).join("");}}return zb;},"[stringToStream]":[gpf.$ClassExtension(String,"toStream")],stringToStream:function(wb){return new vb(wb);},"[stringFromStream]":[gpf.$ClassExtension(String,"fromStream")],stringFromStream:function(wb,xb){if(wb instanceof vb){gpf.events.fire.apply(this,[tb.IReadableStream.EVENT_DATA,{buffer:wb.consolidateString()},xb]);}else{gpf.stream.readAll(wb,sb,xb);}}});function sb(wb,xb){if(undefined===wb){return[xb];}else if(undefined!==xb){wb.push(xb);return wb;}else{return wb.join("");}}var xb=gpf.interfaces,yb=gpf.define("ArrayStream",gpf.events.Target,{"[Class]":[gpf.$InterfaceImplement(gpf.interfaces.IStream)],public:{constructor:function(zb){if(undefined!==zb&&zb.length){this._buffer=[].concat(zb);}else{this._buffer=[];}},read:function(zb,Ab){var Bb;if(0===this._buffer.length){gpf.defer(gpf.events.fire,0,this,[xb.IReadableStream.EVENT_END_OF_STREAM,Ab]);}else if(undefined===zb||zb>this._buffer.length){Bb=this._buffer;this._buffer=[];gpf.defer(gpf.events.fire,0,this,[xb.IReadableStream.EVENT_DATA,{buffer:Bb},Ab]);}else{Bb=this._buffer.splice(0,zb);gpf.defer(gpf.events.fire,0,this,[xb.IReadableStream.EVENT_DATA,{buffer:Bb},Ab]);}},write:function(zb,Ab){gpf.ASSERT(zb&&zb.length,"Write must contain data");this._buffer=this._buffer.concat(zb);gpf.events.fire.apply(this,[xb.IWritableStream.EVENT_READY,Ab]);},consolidateArray:function(){return[].concat(this._buffer);}},private:{_buffer:[]}});gpf.extend(gpf,{"[arrayToStream]":[gpf.$ClassExtension(Array,"toStream")],arrayToStream:function(zb){return new yb(zb);},"[arrayFromStream]":[gpf.$ClassExtension(Array,"fromStream")],arrayFromStream:function(zb,Ab){if(zb instanceof yb){gpf.events.fire.apply(this,[xb.IReadableStream.EVENT_DATA,{buffer:zb.consolidateArray()},Ab]);return;}else{gpf.stream.readAll(zb,wb,Ab);}}});function wb(zb,Ab){if(undefined===zb){return Ab;}else if(undefined!==Ab){zb=zb.concat(Ab);return zb;}else{return zb;}}var zb=function(Ab){if(10>Ab){return"0"+Ab;}else{return Ab;}};;gpf.extend(gpf,{"[dateToComparableFormat]":[gpf.$ClassExtension(Date,"toComparableFormat")],dateToComparableFormat:function(Ab,Bb){if(undefined===Bb){Bb=true;}var Cb=[Ab.getFullYear(),"-",zb(Ab.getMonth()+1),"-",zb(Ab.getDate())];if(Bb){Cb.push(" ",zb(Ab.getHours()),":",zb(Ab.getMinutes()),":",zb(Ab.getSeconds()));}return Cb.join("");},"[dateFromComparableFormat]":[gpf.$ClassExtension(String)],dateFromComparableFormat:function(Ab){var Bb=new Date;Bb.setFullYear(parseInt(Ab.substr(0,4),10),parseInt(Ab.substr(5,2),10)-1,parseInt(Ab.substr(8,2),10));if(10<Ab.length){Bb.setHours(parseInt(Ab.substr(11,2),10),parseInt(Ab.substr(14,2),10),parseInt(Ab.substr(17,2),10),0);}else{Bb.setHours(0,0,0,0);}return Bb;}});gpf.define("gpf.Parser",{public:{constructor:function(){this.reset();},reset:function(Ab){this._pos=0;this._line=0;this._column=0;this._setParserState(Ab);},currentPos:function(){return{pos:this._pos,line:this._line,column:this._column};},parse:function(){var Ab=arguments.length,Bb,Cb;for(Bb=0;Bb<Ab;++Bb){Cb=arguments[Bb];if(null===Cb){this._finalizeParserState();}else{gpf.ASSERT("string"===typeof Cb,"string expected");this._parse(Cb);}}},setOutputHandler:function(Ab){gpf.ASSERT(Ab instanceof Array||Ab.apply,"Invalid output handler");this._outputHandler=Ab;}},protected:{_initialParserState:null,_ignoreCarriageReturn:false,_ignoreLineFeed:false,_finalizeParserState:function(){this._pState(0);},_setParserState:function(Ab){if(!Ab){Ab=this._initialParserState;}if(Ab!==this._pState){this._pState=Ab;}},_output:function(Ab){var Bb=this._outputHandler;if(Bb instanceof Array){Bb.push(Ab);}else if(null!==Bb){Bb.apply(this,[Ab]);}}},private:{_pos:0,_line:0,_column:0,_pState:null,_outputHandler:null,_parse:function(Ab){var Bb,Cb,Db,Eb,Fb=false;Bb=Ab.length;for(Cb=0;Cb<Bb;++Cb){Db=Ab.charAt(Cb);if("\r"===Db&&this._ignoreCarriageReturn){Db=0;}if("\n"===Db&&this._ignoreLineFeed){Fb=true;Db=0;}if(Db){Eb=this._pState.apply(this,[Db]);if(undefined!==Eb){this._setParserState(Eb);}}++this._pos;if("\n"===Db||Fb){++this._line;this._column=0;}else{++this._column;}}}},static:{FINALIZE:null}});gpf.define("gpf.ParserStream",gpf.stream.BufferedOnRead,{public:{constructor:function(Ab,Bb){this._super(Bb);this._parser=Ab;this._parser.setOutputHandler(new gpf.Callback(this._output,this));}},protected:{_addToBuffer:function(Ab){this._parser.parse(Ab);},_endOfInputStream:function(){this._parser.parse(gpf.Parser.FINALIZE);},_readFromBuffer:gpf.stream.BufferedOnRead.prototype._readFromStringBuffer},private:{_output:function(Ab){this._buffer.push(Ab);this._bufferLength+=Ab.length;}}});var Ab=gpf.bin.test,Bb=gpf.bin.clear,Cb=gpf._defIntrf("ITokenizer",{write:function(Jb){gpf.interfaces.ignoreParameter(Jb);return-1;}}),Db=gpf.define("PatternItem",{private:{"[_min]":[gpf.$ClassProperty(true)],_min:1,"[_max]":[gpf.$ClassProperty(true)],_max:1},public:{parse:function(Jb){gpf.interfaces.ignoreParameter(Jb);gpf.Error.Abstract();return Db.PARSE_IGNORED;},finalize:function(){},reset:function(Jb){gpf.interfaces.ignoreParameter(Jb);},write:function(Jb,Kb){gpf.interfaces.ignoreParameter(Jb);gpf.interfaces.ignoreParameter(Kb);gpf.Error.Abstract();return-1;}},static:{PARSE_IGNORED:0,PARSE_PROCESSED:1,PARSE_END_OF_PATTERN:2,PARSE_PROCESSED_EOP:3,CHARS_QUANTIFICATION:"?*+",WRITE_NO_MATCH:-1,WRITE_NEED_DATA:0,WRITE_MATCH:1,WRITE_PATTERN_END:2,WRITE_FINAL_MATCH:3}}),Eb=gpf.define("PatternChar",Db,{private:{_match:""},public:{parse:function(Jb){this._match=Jb;return Db.PARSE_PROCESSED_EOP;},write:function(Jb,Kb){gpf.interfaces.ignoreParameter(Jb);if(Kb===this._match){return Db.WRITE_FINAL_MATCH;}return Db.WRITE_NO_MATCH;}}}),Fb=gpf.define("PatternRange",Db,{private:{_inc:"",_exc:"",_inRange:false,_parse:function(Jb,Kb){var Lb,Mb;if("^"===Jb){this._exc=[];}else if("]"===Jb){if(this._inRange){gpf.Error.PatternInvalidSyntax();}return true;}else if("-"===Jb){if(this._inRange||0===Kb.length){gpf.Error.PatternInvalidSyntax();}this._inRange=true;}else{if(this._inRange){Lb=Kb[Kb.length-1].charCodeAt(0);Mb=Jb.charCodeAt(0);while(--Mb>Lb){Kb.push(String.fromCharCode(Mb));}Kb.push(Jb);delete this._inRange;}else{Kb.push(Jb);}}return false;}},public:{parse:function(Jb){var Kb;if(this.hasOwnProperty("_exc")){if("^"===Jb){gpf.Error.PatternInvalidSyntax();}Kb=this._exc;}else{Kb=this._inc;}if("["===Jb){if(this.hasOwnProperty("_inc")){gpf.Error.PatternInvalidSyntax();}this._inc=[];}else if(this._parse(Jb,Kb)){return Db.PARSE_PROCESSED_EOP;}return Db.PARSE_PROCESSED;},finalize:function(){this._inc=this._inc.join("");if(this.hasOwnProperty("_exc")){this._exc=this._exc.join("");}},write:function(Jb,Kb){gpf.interfaces.ignoreParameter(Jb);var Lb;if(this._inc.length){Lb=-1<this._inc.indexOf(Kb);}else{Lb=true;}if(Lb&&this._exc.length){Lb=-1===this._exc.indexOf(Kb);}if(Lb){return Db.WRITE_FINAL_MATCH;}else{return Db.WRITE_NO_MATCH;}}}}),Gb=gpf.define("PatternGroup",Db,{private:{_items:[],_choice:false,_optionals:[],_parsedParenthesis:false,_parsedItem:null,_getItems:function(Jb){if(this._choice){if(undefined===Jb){Jb=this._items.length-1;}return this._items[Jb];}return this._items;},_lastItem:function(){var Jb=this._getItems();return Jb[Jb.length-1];},_push:function(Jb){this._getItems().push(Jb);this._parsedItem=Jb;return Jb;},_parseItem:function(Jb){var Kb=this._parsedItem,Lb;if(Kb){Lb=Kb.parse(Jb);if(Ab(Lb,Db.PARSE_END_OF_PATTERN)){Kb.finalize();this._parsedItem=null;Lb=Bb(Lb,Db.PARSE_END_OF_PATTERN);}}else{Lb=0;}return Lb;},_parseQuantity:function(Jb){var Kb=this._lastItem();if("*"===Jb){Kb._min=0;Kb._max=0;}else if("+"===Jb){Kb._max=0;}else if("?"===Jb){Kb._min=0;}return Db.PARSE_PROCESSED;},_getOptional:function(Jb){var Kb;Kb=Jb.length;while(Kb--){if(0!==Jb[Kb].min()){++Kb;break;}}return Kb;},_reset:function(Jb,Kb){Kb.count=0;Kb.sub={};Jb.reset(Kb.sub);},_getItem:function(Jb,Kb){var Lb=this._getItems(Jb.choice);if(Kb<Lb.length){return Lb[Kb];}return null;},_writeNoMatch:function(Jb,Kb,Lb){if(Kb.count<Jb.min()||Kb.length>Kb.matchingLength+1){return Db.WRITE_NO_MATCH;}Jb=this._getItem(Kb,Kb.index+1);if(null===Jb){return Db.WRITE_NO_MATCH;}++Kb.index;this._reset(Jb,Kb);return this.write(Kb,Lb);},_writeMatch:function(Jb,Kb){var Lb=this._getItem(Kb,Kb.index+1),Mb;if(this._choice&&-1<Kb.choice){Mb=this._optionals[Kb.choice];}else{Mb=this._optionals[0];}++Kb.count;if(0===Jb.max()){this._reset(Jb,Kb);if(null!==Lb&&Mb>Kb.index){return Db.WRITE_NEED_DATA;}else{return Db.WRITE_MATCH;}}else if(Kb.count===Jb.max()){if(null===Lb){return Db.WRITE_FINAL_MATCH;}++Kb.index;this._reset(Lb,Kb);if(Mb<=Kb.index){return Db.WRITE_MATCH;}}return Db.WRITE_NEED_DATA;}},public:{constructor:function(){this._items=[];},parse:function(Jb){var Kb=this._parseItem(Jb);if(0!==Kb){return Kb;}if(-1<Db.CHARS_QUANTIFICATION.indexOf(Jb)){return this._parseQuantity(Jb);}if("|"===Jb){if(!this._choice){this._items=[this._items];this._choice=true;}this._items.push([]);return Db.PARSE_PROCESSED;}else if("["===Jb){this._push(new Fb);}else if("("===Jb){if(this._parsedParenthesis){this._push(new Gb);}else{this._parsedParenthesis=true;return Db.PARSE_PROCESSED;}}else if(")"===Jb){return Db.PARSE_PROCESSED_EOP;}else{this._push(new Eb);}return this._parseItem(Jb);},finalize:function(){var Jb,Kb,Lb;Lb=this._optionals=[];if(this._choice){Jb=this._items.length;for(Kb=0;Kb<Jb;++Kb){Lb.push(this._getOptional(this._items[Kb]));}}else{Lb.push(this._getOptional(this._items));}},reset:function(Jb){var Kb;Jb.index=0;if(this._choice){Jb.choice=-1;}Kb=this._getItems(0)[0];this._reset(Kb,Jb);},write:function(Jb,Kb){var Lb,Mb,Nb,Ob;if(this._choice&&-1===Jb.choice){Lb=this._items.length;for(Mb=0;Mb<Lb;++Mb){Nb=this._items[Mb][0];this._reset(Nb,Jb);Ob=Nb.write(Jb.sub,Kb);if(Db.WRITE_NO_MATCH!==Ob){Jb.choice=Mb;return this._writeMatch(Nb,Jb);}}if(Mb===Lb){return Db.WRITE_NO_MATCH;}}Nb=this._getItem(Jb,Jb.index);Ob=Nb.write(Jb.sub,Kb);if(Db.WRITE_NEED_DATA===Ob){return Ob;}else if(Db.WRITE_NO_MATCH===Ob){return this._writeNoMatch(Nb,Jb,Kb);}else{return this._writeMatch(Nb,Jb);}}}}),Hb=gpf.define("PatternParser",gpf.Parser,{private:{"[_patternItem]":[gpf.$ClassProperty()],_patternItem:null},protected:{_initialParserState:function(Jb){this._patternItem.parse(Jb);},_finalizeParserState:function(){var Jb=this._patternItem;Jb.parse(")");Jb.finalize();}},public:{constructor:function(){this._super.apply(this,arguments);this._patternItem=new Gb;this._patternItem.parse("(");}}}),Ib=gpf.define("PatternTokenizer",{"[Class]":[gpf.$InterfaceImplement(Cb)],private:{_patternItem:null,_stopMatching:false,_lastResult:0,_totalLength:0,_state:{}},public:{constructor:function(Jb){this._patternItem=Jb;this._state={};this._patternItem.reset(this._state);},write:function(Jb){var Kb;if(this._stopMatching){return this._lastResult;}++this._totalLength;Kb=this._patternItem.write(this._state,Jb);if(0<Kb){this._lastResult=this._totalLength;this._stopMatching=Ab(Kb,Db.WRITE_PATTERN_END);}else if(Db.WRITE_NO_MATCH===Kb){this._stopMatching=true;if(0===this._lastResult){this._lastResult=-1;}}return this._lastResult;}}});gpf.define("gpf.Pattern",{private:{_patternItem:null},public:{constructor:function(Jb){var Kb=new Hb;Kb.parse(Jb,null);this._patternItem=Kb.patternItem();},allocate:function(){return new Ib(this._patternItem);}}});var Jb="error",Kb="unknown",Lb="keyword",Mb="identifier",Nb="string",Ob="number",Pb="symbol",Qb="comment",Rb="space",Sb=99,Tb=0,Ub=gpf._alpha+gpf._ALPHA+"_$",Vb=2,Wb=3,Xb=4,Yb=5,Zb=6,ac=7,bc=8,cc=9,dc="(){}[]<>|&?,.;:!=+-*/%^~",ec=10,fc=11,gc=" \t\r\n",hc=12,ic=0,jc=0,kc=1,lc=2,mc=3,nc=4,oc=["Parsing aborted","Unknown token","Unterminated string","Unterminated comment","Invalid or unsupported string escape"],pc=function(){return{pos:0,line:0,column:0,state:Tb,chars:[],nextPos:0,nextLine:0,nextColumn:0,eventsHandler:null,that:null};},qc=("break,case,catch,continue,debugger,default,delete,do,"+"else,finally,for,function,if,in,instanceof,new,return,switch,"+"this,throw,try,typeof,var,void,while,with").split(","),rc=function(){var Cc={};Cc[Tb]=Kb;Cc[ec]=Pb;Cc[bc]=Qb;Cc[cc]=Qb;Cc[Wb]=Nb;Cc[Yb]=Nb;Cc[fc]=Ob;Cc[hc]=Rb;return Cc;}(),sc=function(Cc,Dc){var Ec,Fc,Gc,Hc={token:"",pos:Cc.pos,line:Cc.line,column:Cc.column,code:0,message:""};if(undefined!==Dc){Fc=Jb;Cc.state=Sb;Hc.code=Dc;Hc.message=oc[Dc-ic];}else{Ec=Cc.chars.join("");if(Vb===Cc.state){if(undefined!==gpf.test(qc,Ec)){Fc=Lb;}else{Fc=Mb;}}else{Fc=rc[Cc.state];}Hc.token=Ec;}Gc=gpf.events.fire.apply(Cc.that,[Fc,Hc,Cc.eventsHandler]);if(Gc.defaultPrevented()){sc(Cc,jc);}else if(undefined!==Dc){throw 0;}Cc.state=Tb;Cc.chars=[];Cc.pos=Cc.nextPos;Cc.line=Cc.nextLine;Cc.column=Cc.nextColumn;},tc=[0,function(Cc,Dc,Ec){gpf.interfaces.ignoreParameter(Dc);if(-1<"(){}[].,;:?".indexOf(Cc)){return false;}if(-1<"!^~*/%".indexOf(Cc)){return"="===Ec;}return"="===Ec||Cc===Ec;},function(Cc,Dc,Ec){if(-1<"+-|&".indexOf(Cc)){return false;}if("<"===Cc){return"<"===Dc[1]&&"="===Ec;}if(-1<"=!".indexOf(Cc)){return"="===Ec;}if(">"===Cc){return"="!==Dc[1]&&("="===Ec||">"===Ec);}return false;},function(Cc,Dc,Ec){return">"===Cc&&"="!==Dc[2]&&"="===Ec;},function(){return false;}],uc=function(Cc,Dc){var Ec=Cc[0];return tc[Cc.length](Ec,Cc,Dc);},vc=function(){var Cc={};Cc[Vb]=function(Dc,Ec){if(-1===Ub.indexOf(Ec)&&("0">Ec||Ec>"9")){sc(Dc);}else{Dc.chars.push(Ec);}};Cc[fc]=function(Dc,Ec){if("0">Ec||Ec>"9"){sc(Dc);}else{Dc.chars.push(Ec);}};Cc[Wb]=Cc[Yb]=function(Dc,Ec){Dc.chars.push(Ec);if("\\"===Ec){++Dc.state;}else if("\n"===Ec){sc(Dc,lc);}else if(Wb===Dc.state&&"\""===Ec){sc(Dc);return true;}else if(Yb===Dc.state&&"'"===Ec){sc(Dc);return true;}return false;};Cc[Xb]=Cc[Zb]=function(Dc,Ec){if("\\"===Ec||"r"===Ec||"n"===Ec||"t"===Ec||"\""===Ec||"'"===Ec){--Dc.state;Dc.chars.push(Ec);}else{sc(Dc,nc);}};Cc[ac]=function(Dc,Ec){if("/"===Ec){Dc.state=bc;Dc.chars.push(Ec);}else if("*"===Ec){Dc.state=cc;Dc.chars.push(Ec);}else{Dc.state=ec;if(uc(Dc.chars,Ec)){Dc.chars.push(Ec);}else{sc(Dc);}}};Cc[bc]=function(Dc,Ec){if("\n"===Ec){sc(Dc);}else{Dc.chars.push(Ec);}};Cc[cc]=function(Dc,Ec){Dc.chars.push(Ec);if("/"===Ec&&Dc.chars[Dc.chars.length-2]==="*"){sc(Dc);return true;}return false;};Cc[hc]=function(Dc,Ec){if(-1<gc.indexOf(Ec)){Dc.chars.push(Ec);}else{sc(Dc);}};Cc[ec]=function(Dc,Ec){if(-1<dc.indexOf(Ec)){if(uc(Dc.chars,Ec)){Dc.chars.push(Ec);}else{sc(Dc);}}else{sc(Dc);}};return Cc;}(),wc=function(Cc,Dc){Cc.chars=[Dc];if(-1<Ub.indexOf(Dc)){Cc.state=Vb;}else if("0"<=Dc&&Dc<="9"){Cc.state=fc;}else if("\""===Dc){Cc.state=Wb;}else if("'"===Dc){Cc.state=Yb;}else if("/"===Dc){Cc.state=ac;}else if(-1<dc.indexOf(Dc)){Cc.state=ec;}else if(-1<gc.indexOf(Dc)){Cc.state=hc;}else{sc(Cc,kc);}},xc=function(Cc,Dc){var Ec=vc[Cc.state];if(undefined!==Ec){if(Ec(Cc,Dc)){return;}}if(Tb===Cc.state){wc(Cc,Dc);}},yc=function(Cc,Dc){++Cc.nextPos;if("\n"===Dc){++Cc.nextLine;Cc.nextColumn=0;}else{++Cc.nextColumn;}},zc=function(Cc,Dc){xc(Cc,Dc);yc(Cc,Dc);},Ac=function(){var Cc={};Cc[Vb]=1;Cc[fc]=1;Cc[bc]=1;Cc[ec]=1;Cc[ac]=2;Cc[cc]=3;Cc[Wb]=4;Cc[Yb]=4;Cc[Xb]=4;Cc[Zb]=4;return Cc;}(),Bc=function(Cc){var Dc=Ac[Cc.state];if(1===Dc){sc(Cc);}else if(2===Dc){Cc.state=ec;sc(Cc);}else if(3===Dc){sc(Cc,mc);}else if(4===Dc){sc(Cc,lc);}gpf.ASSERT(Tb===Cc.state||Sb===Cc.state||hc===Cc.state,"Unexpected non-final state");};gpf.js={};gpf.extend(gpf.js,{keywords:function(){return qc;},tokenize:function(Cc,Dc){var Ec,Fc,Gc=pc();Gc.eventsHandler=Dc;Gc.that=this;try{for(Ec=0,Fc=Cc.length;Ec<Fc;++Ec){zc(Gc,Cc.charAt(Ec));}Bc(Gc);}catch(e){if("number"!==typeof e){throw e;}}},tokenizeEx:function(Cc,Dc,Ec){var Fc,Gc;if(undefined===Ec){Ec=pc();}Ec.eventsHandler=Dc;Ec.that=this;try{if(null===Cc){Bc(Ec);Ec=null;}else{for(Fc=0,Gc=Cc.length;Fc<Gc;++Fc){zc(Ec,Cc.charAt(Fc));}}}catch(e){if("number"!==typeof e){throw e;}}return Ec;}});(function(){"use strict";var Cc=function(Hc){var Ic=[],Jc=Hc.length,Kc,Lc;for(Kc=0;Kc<Jc;++Kc){Lc=Hc.charCodeAt(Kc);if(Lc<128){Ic.push(Lc);}else if(Lc>127&&Lc<2048){Ic.push(Lc>>6|192);Ic.push(Lc&63|128);}else{Ic.push(Lc>>12|224);Ic.push(Lc>>6&63|128);Ic.push(Lc&63|128);}}return Ic;},Dc=function(Hc,Ic){var Jc=[],Kc=Hc.length,Lc=0,Mc,Nc,Oc;while(Lc<Kc){Mc=Hc[Lc];if(Mc<128){Jc.push(String.fromCharCode(Mc));}else if(Mc>191&&Mc<224){if(Lc+1===Kc){break;}Nc=Hc[++Lc];Jc.push(String.fromCharCode((Mc&31)<<6|Nc&63));}else{if(Lc+2>=Kc){break;}Nc=Hc[++Lc];Oc=Hc[++Lc];Jc.push(String.fromCharCode((Mc&15)<<12|(Nc&63)<<6|Oc&63));}++Lc;}while(Lc<Kc){Ic.push(Hc[Lc++]);}return Jc.join("");},Ec={"utf-8":[Cc,Dc]},Fc=gpf.define("EncoderStream",gpf.stream.BufferedOnRead,{public:{constructor:function(Hc,Ic){this._super(Ic);this._encoder=Hc;}},protected:{_addToBuffer:function(Hc){this._buffer=this._buffer.concat(this._encoder(Hc));this._bufferLength=this._buffer.length;},_readFromBuffer:gpf.stream.BufferedOnRead.prototype._readFromByteBuffer},private:{_encoder:null}}),Gc=gpf.define("DecoderStream",gpf.stream.BufferedOnRead,{public:{constructor:function(Hc,Ic){this._super(Ic);this._decoder=Hc;}},protected:{_addToBuffer:function(Hc){var Ic;if(this._unprocessed.length){Hc=this._unprocessed.concat(Hc);}this._unprocessed=[];Ic=this._decoder(Hc,this._unprocessed);this._buffer.push(Ic);this._bufferLength+=Ic.length;},_endOfInputStream:function(){if(this._unprocessed.length){gpf.Error.EncodingEOFWithUnprocessedBytes();}},_readFromBuffer:gpf.stream.BufferedOnRead.prototype._readFromStringBuffer},private:{_decoder:null,_unprocessed:[]}});gpf.encoding={UTF_8:"utf-8",createEncoder:function(Hc,Ic){var Jc=Ec[Ic];if(undefined===Jc){gpf.Error.EncodingNotSupported();}return new Fc(Jc[0],Hc);},createDecoder:function(Hc,Ic){var Jc=Ec[Ic];if(undefined===Jc){gpf.Error.EncodingNotSupported();}return new Gc(Jc[1],Hc);}};}());gpf.html={};var Hc=gpf.interfaces;gpf.define("gpf.html.MarkdownParser","gpf.Parser",{public:{constructor:function(){this._super.apply(this,arguments);this._openedTags=[];}},protected:{_ignoreCarriageReturn:true,_initialParserState:function(Ic){var Jc,Kc=0<this._openedTags.length;if("#"===Ic){this._hLevel=1;Jc=this._parseTitle;}else if("*"===Ic||"0"<=Ic&&"9">=Ic){if(Ic!=="*"){this._numericList=1;}else{this._numericList=0;}Jc=this._parseList;Kc=false;}else if(" "!==Ic&&"\t"!==Ic&&"\n"!==Ic){if(Kc){this._output(" ");Kc=false;}else{this._openTag("p");}Jc=this._parseContent(Ic);if(!Jc){Jc=this._parseContent;}}if(Kc){this._closeTags();}return Jc;},_finalizeParserState:function(){this._closeTags();}},private:{_openedTags:[],_closeTags:function(){var Ic;while(this._openedTags.length){Ic=this._openedTags.pop();this._output("</"+Ic+">");if("p"===Ic){break;}}},_openList:function(Ic){var Jc,Kc=this._openedTags.length;while(Kc){Jc=this._openedTags.pop();--Kc;this._output("</"+Jc+">");if("li"===Jc){break;}}if(Kc){Jc=this._openedTags[Kc-1];if(Jc!==Ic){this._openedTags.pop();this._output("</"+Jc+">");}else{return;}}this._openTag(Ic);},_toggleTag:function(Ic){var Jc=this._openedTags.length;if(Jc&&this._openedTags[Jc-1]===Ic){this._openedTags.pop();this._output("</"+Ic+">");}else{this._openTag(Ic);}},_openTag:function(Ic){this._output("<"+Ic+">");this._openedTags.push(Ic);},_hLevel:1,_parseTitle:function(Ic){if("#"===Ic){++this._hLevel;}else{this._openTag("h"+this._hLevel);return this._parseText;}},_numericList:false,_parseList:function(Ic){var Jc=0<this._openedTags.length,Kc;if(" "===Ic){if(this._numericList){Kc="ol";}else{Kc="ul";}this._openList(Kc);this._openTag("li");}else if(this._numericList&&("0"<=Ic&&"9">=Ic||"."===Ic)){return;}else if("*"===Ic){if(Jc){this._output(" ");}this._openTag("strong");}return this._parseContent;},_handleEntities:function(Ic){if("<"===Ic){this._output("&lt;");}else if(">"===Ic){this._output("&gt;");}else if("&"===Ic){this._output("&amp;");}else{return false;}return true;},_escapeChar:"",_escapeCount:0,_parseEscape:function(Ic){var Jc=this._escapeChar,Kc;if(Ic===Jc){Kc=++this._escapeCount;if("-"===Jc&&3===Kc){this._output("&mdash;");return this._parseContent;}}else{Kc=this._escapeCount+1;while(--Kc){this._output(Jc);}this._setParserState(this._parseContent);return this._parseContent(Ic);}},_parseContent:function(Ic){if(this._handleEntities(Ic)){return;}if("*"===Ic){return this._parseItalic;}else if("`"===Ic){this._toggleTag("code");return;}else if("["===Ic){this._linkState=0;this._linkText=[];this._linkUrl=[];return this._parseLink;}else if("-"===Ic){this._escapeCount=1;this._escapeChar="-";return this._parseEscape;}else if("\n"===Ic){return null;}else{this._output(Ic);}},_parseItalic:function(Ic){if("*"===Ic){this._toggleTag("strong");}else{this._toggleTag("em");this._output(Ic);}return this._parseContent;},_parseText:function(Ic){if(this._handleEntities(Ic)){return;}if("\n"===Ic){this._closeTags();return null;}else{this._output(Ic);}},_linkText:[],_linkUrl:[],_linkState:0,_parseLink:function(Ic){var Jc=this._linkState;if("]"===Ic&&0===Jc){++this._linkState;}else if("("===Ic&&1===Jc){++this._linkState;}else if(")"===Ic&&2===Jc){this._output("<a href=\"");this._output(this._linkUrl.join(""));this._output("\">");this._output(this._linkText.join(""));this._output("</a>");return this._parseContent;}else if(0===Jc){this._linkText.push(Ic);}else if(2===Jc){this._linkUrl.push(Ic);}}}});gpf.define("gpf.html.File",{"[Class]":[gpf.$InterfaceImplement(gpf.interfaces.ITextStream)],public:{constructor:function(Ic){this._file=Ic;},name:function(){return this._file.name;},size:function(){return this._file.size;},read:function(Ic,Jc){var Kc=this,Lc=this._reader,Mc=this._file.size-this._pos,Nc;if(0===Mc){gpf.defer(gpf.events.fire,0,this,[Hc.IReadableStream.EVENT_END_OF_STREAM,Jc]);return;}this._eventsHandler=Jc;if(null===Lc){Lc=this._reader=new FileReader;Lc.onloadend=function(Oc){Kc._onLoadEnd(Oc);};}if(0===Ic||Ic>Mc){Ic=Mc;}Nc=this._file.slice(this._pos,Ic);this._pos+=Ic;Lc.readAsArrayBuffer(Nc);}},private:{_file:null,_reader:null,_pos:0,_eventsHandler:null,_onLoadEnd:function(Ic){var Jc=Ic.target,Kc,Lc,Mc,Nc;gpf.ASSERT(Jc===this._reader,"Unexpected change of reader");if(Jc.error){gpf.events.fire.apply(this,[Hc.IReadableStream.ERROR,{error:{name:Jc.error.name,message:Jc.error.message}},this._eventsHandler]);}else if(Jc.readyState===FileReader.DONE){Kc=new Int8Array(Jc.result);Lc=Kc.length;Mc=[];for(Nc=0;Nc<Lc;++Nc){Mc.push(Kc[Nc]);}gpf.events.fire.apply(this,[Hc.IReadableStream.EVENT_DATA,{buffer:Mc},this._eventsHandler]);}}}});var Ic=gpf._defAttr("HtmlAttribute",{}),Jc=gpf._defAttr("$HtmlHandler",Ic,{private:{_selector:"",_globalSelector:false},protected:{_select:function(Lc){var Mc=this._selector;if(Mc){if(this._globalSelector){return document.querySelector(Mc);}else{return Lc.querySelector(Mc);}}return undefined;}},public:{constructor:function(Lc,Mc){if(Lc){this._selector=Lc;}if(undefined!==Mc){this._globalSelector=Mc===true;}}}}),Kc=gpf._defAttr("$HtmlEvent",Jc,{private:{_event:""},public:{constructor:function(Lc,Mc,Nc){Jc.apply(this,[Mc,Nc]);this._event=Lc;}}});function Cc(Lc,Mc){var Nc;if(1!==Mc.length()){gpf.Error.HtmlHandlerMultiplicityError({member:Lc});}Nc=Mc.get(0);if(!(Nc instanceof Kc)){return Nc;}return null;}function Dc(Lc,Mc){var Nc=Cc(Lc,Mc);if(Nc&&!Nc._selector){return Nc;}}gpf.html.handle=function(Lc,Mc){var Nc=new gpf.attributes.Map(Lc).filter(Ic),Oc=Nc.filter(Jc),Pc,Qc;if(0===Oc.count()){gpf.Error.HtmlHandlerMissing();}Pc=Oc.each(Dc);if(undefined===Pc){gpf.Error.HtmlHandlerNoDefault();}Pc=Pc.member();if(undefined===Mc){Mc=Lc[Pc];gpf.ASSERT(Mc,"Handle not previously set");}else{if("string"===typeof Mc){Mc=document.querySelector(Mc);}gpf.ASSERT(Mc,"Selector does not resolve to DOM");if(!Mc){return;}Lc[Pc]=Mc;}Oc.each(Ec,Lc,[Mc]);Qc=Nc.filter(Kc);if(0<Qc.count()){Qc.each(Fc,Lc,[Mc]);}return Mc;};function Ec(Lc,Mc,Nc){var Oc=Cc(Lc,Mc);if(!Oc||!Oc._selector){return;}Nc=Oc._select(Nc);if(!Nc){return;}this[Lc]=Nc;}function Fc(Lc,Mc,Nc){Mc.each(Gc,this,[Lc,Nc]);}function Gc(Lc,Mc,Nc){var Oc=Lc._event,Pc=Mc+":$HtmlEvent("+Oc+","+Lc._selector+")";Nc=Lc._select(Nc);if(!Nc){return;}if(!this[Pc]){Nc.addEventListener(Oc,gpf.Callback.bind(this,Mc));this[Pc]=true;}}gpf.extend(gpf.html,{hasClass:function(Lc,Mc){var Nc,Oc,Pc;if("string"===typeof Mc){Mc=[Mc];}gpf.ASSERT(Mc instanceof Array,"Expected array");Nc=Lc.className.split(" ");Oc=Mc.length;for(Pc=0;Pc<Oc;++Pc){if(undefined!==gpf.test(Nc,Mc[Pc])){return true;}}return false;},addClass:function(Lc,Mc){var Nc,Oc,Pc,Qc;if("string"===typeof Mc){Mc=[Mc];}gpf.ASSERT(Mc instanceof Array,"Expected array");Nc=Lc.className.split(" ");Oc=Nc.length;Pc=Mc.length;for(Qc=0;Qc<Pc;++Qc){gpf.set(Nc,Mc[Qc]);}if(Oc!==Nc.length){Lc.className=Nc.join(" ");}return Lc;},removeClass:function(Lc,Mc){var Nc,Oc,Pc,Qc;if("string"===typeof Mc){Mc=[Mc];}gpf.ASSERT(Mc instanceof Array,"Expected array");Nc=Lc.className.split(" ");Oc=Nc.length;Pc=Mc.length;for(Qc=0;Qc<Pc;++Qc){gpf.clear(Nc,Mc[Qc]);}if(Oc!==Nc.length){Lc.className=Nc.join(" ");}return Lc;}});var Lc=gpf.interfaces,Mc=gpf.attributes;;gpf.xml={};gpf._defIntrf("IXmlSerializable",{toXml:function(Nc,Oc){Lc.ignoreParameter(Nc);Lc.ignoreParameter(Oc);}});gpf._defIntrf("IXmlContentHandler",{characters:function(Nc,Oc){Lc.ignoreParameter(Nc);Lc.ignoreParameter(Oc);},endDocument:function(Nc){Lc.ignoreParameter(Nc);},endElement:function(Nc){Lc.ignoreParameter(Nc);},endPrefixMapping:function(Nc){Lc.ignoreParameter(Nc);},ignorableWhitespace:function(Nc,Oc){Lc.ignoreParameter(Nc);Lc.ignoreParameter(Oc);},processingInstruction:function(Nc,Oc,Pc){Lc.ignoreParameter(Nc);Lc.ignoreParameter(Oc);Lc.ignoreParameter(Pc);},setDocumentLocator:function(Nc){Lc.ignoreParameter(Nc);},skippedEntity:function(Nc){Lc.ignoreParameter(Nc);},startDocument:function(Nc){Lc.ignoreParameter(Nc);},startElement:function(Nc,Oc,Pc,Qc,Rc){Lc.ignoreParameter(Nc);Lc.ignoreParameter(Oc);Lc.ignoreParameter(Pc);Lc.ignoreParameter(Qc);Lc.ignoreParameter(Rc);},startPrefixMapping:function(Nc,Oc){Lc.ignoreParameter(Nc);Lc.ignoreParameter(Oc);}});var Nc=gpf._defAttr("XmlAttribute",{_alterPrototype:function(bd){if(undefined===bd.toXml){Mc.add(bd.constructor,"Class",[gpf.$InterfaceImplement(Lc.IXmlSerializable)]);bd.toXml=Yc;Mc.add(bd.constructor,"Class",[gpf.$InterfaceImplement(Lc.IXmlContentHandler,ad)]);}}}),Oc=gpf._defAttr("$XmlIgnore",Nc,{}),Pc=gpf._defAttr("$XmlAttribute",Nc,{"[_name]":[gpf.$ClassProperty()],_name:"",constructor:function(bd){gpf.ASSERT(gpf.xml.isValidName(bd),"Valid XML attribute name");this._name=bd;}}),Qc=gpf._defAttr("XmlRawElementAttribute",Nc,{"[_name]":[gpf.$ClassProperty()],_name:"",constructor:function(bd){gpf.ASSERT(gpf.xml.isValidName(bd),"Valid XML element name");this._name=bd;}}),Rc=gpf._defAttr("$XmlElement",Qc,{"[_objClass]":[gpf.$ClassProperty()],_objClass:null,constructor:function(bd,cd){this._super(bd);if(cd){this._objClass=cd;}}}),Sc=gpf._defAttr("$XmlList",Qc,{}),Tc=function(bd,cd){var dd,ed,fd=null,gd=null,hd;for(dd=0;dd<bd.length();++dd){ed=bd.get(dd);if(!(ed instanceof Rc)){continue;}hd=ed.objClass();if(hd){if(cd instanceof hd){if(!gd||hd.prototype instanceof gd.objClass()){gd=ed;}}}else if(!fd){fd=ed;}}if(null!==gd){return gd;}else{return fd;}},Uc=function(bd,cd,dd,ed){var fd;if(cd instanceof Array||ed.has(Sc)||"object"===dd||ed.has(Rc)){return"";}fd=ed.has(Pc);if(fd&&fd.name()){bd=fd.name();}else{if("_"===bd.charAt(0)){bd=bd.substr(1);}}return bd;},Vc=function(bd,cd,dd,ed){var fd,gd,hd,id,jd,kd,ld,md;fd=bd[cd];if(fd instanceof Date){fd=gpf.dateToComparableFormat(fd,true);}gd=ed.member(cd);if("_"===cd.charAt(0)){cd=cd.substr(1);}hd=gd.has(Sc);if(fd instanceof Array||hd){if(hd&&hd.name()){id=true;dd.startElement("",hd.name());}gd=gd.filter(Rc);for(jd=0;jd<fd.length;++jd){kd=fd[jd];ld=Tc(gd,kd);if(ld&&ld.name()){md=ld.name();}else{md="item";}Xc(kd,dd,md);}if(id){dd.endElement();}return;}hd=gd.has(Rc);if(hd&&hd.name()){md=hd.name();}Xc(fd,dd,md);},Wc=function(bd,cd,dd,ed){var fd,gd,hd,id,jd,kd=0,ld=0,md;for(gd in bd.constructor.prototype){hd=bd[gd];if(hd instanceof Date){hd=gpf.dateToComparableFormat(hd,true);}id=typeof hd;if("function"===id){continue;}fd=ed.member(gd);if(fd.has(Oc)){continue;}jd=Uc(gd,hd,id,fd);if(jd){if(0===ld){ld={};}ld[jd]=hd.toString();}else{if(0===kd){kd=[];}kd.push(gd);}}cd.startElement("",dd,dd,ld);if(kd){for(md=0;md<kd.length;++md){Vc(bd,kd[md],cd,ed);}}},Xc=function(bd,cd,dd){var ed=new Mc.Map(bd).filter(Nc),fd;if(!dd){fd=ed.member("Class").has(Rc);if(fd){dd=fd.name();}else{dd=gpf.classDef(bd.constructor).name();if(!dd){dd="object";}}}if("object"!==typeof bd){cd.startElement("",dd);cd.characters(gpf.value(bd,""));}else{Wc(bd,cd,dd,ed);}cd.endElement();},Yc=function(bd){Xc(this,Lc.query(bd,Lc.IXmlContentHandler,true));},Zc=gpf.define("FromXmlContentHandler",{"[Class]":[gpf.$InterfaceImplement(Lc.IXmlContentHandler)],_target:null,_firstElement:true,_forward:[],constructor:function(bd){this._target=bd;this._firstElement=true;this._forward=[];},_fillFromAttributes:function(bd){var cd=new Mc.Map(this._target),dd=this._target.constructor.prototype,ed,fd,gd;for(ed in dd){if("function"===typeof dd[ed]){continue;}fd=cd.member(ed).filter(Pc);if(0<fd.length()){gpf.ASSERT(fd.length()===1);gd=fd.get(0).name();}else{if(ed.charAt(0)==="_"){gd=ed.substr(1);}else{continue;}}if(gd in bd){this._target[ed]=gpf.value(bd[gd],dd[ed]);}}},_fillFromElement:function(bd,cd,dd,ed){var fd=new Mc.Map(this._target).filter(Qc),gd=this._forward[0],hd,id,jd,kd,ld,md;gpf.interfaces.ignoreParameter(bd);gpf.interfaces.ignoreParameter(dd);gpf.interfaces.ignoreParameter(ed);if(undefined===gd){hd=fd.members();}else{gpf.ASSERT(gd.type!==0,"No content handler here");hd=[gd.member];}for(id=0;id<hd.length;++id){jd=hd[id];kd=fd.member(jd);for(ld=0;ld<kd.length();++ld){md=kd.get(ld);if(md.name()===cd){if(this._fillFromRawElement(jd,md)){return;}}}}},_fillFromRawElement:function(bd,cd){var dd,ed;if(cd instanceof Rc){if(cd.objClass()){dd=new(cd.objClass());this._target[bd]=dd;ed=Lc.query(dd,Lc.IXmlContentHandler);}if(ed){ed={type:0,iXCH:ed};}else{ed={type:1,member:bd,buffer:[]};}}else if(cd instanceof Sc){this._target[bd]=[];ed={type:2,member:bd};}if(ed){ed.depth=1;this._forward.unshift(ed);return true;}else{return false;}},characters:function(bd){var cd=this._forward[0];if(undefined!==cd){if(0===cd.type){cd.iXCH.characters.apply(cd.iXCH,arguments);}else if(1===cd.type){cd.buffer.push(bd);}}},endDocument:function(){},endElement:function(){var bd=this._forward[0],cd,dd;if(undefined!==bd){if(0===bd.type){bd.iXCH.endElement.apply(bd.iXCH,arguments);}else if(1===bd.type){cd=this._target[bd.member];dd=bd.buffer.join("");if(cd instanceof Array){cd.push(dd);}else{this._target[bd.member]=gpf.value(dd,cd);}}if(0===--bd.depth){this._forward.shift();}}},endPrefixMapping:function(bd){Lc.ignoreParameter(bd);},ignorableWhitespace:function(bd){Lc.ignoreParameter(bd);},processingInstruction:function(bd,cd){Lc.ignoreParameter(bd);Lc.ignoreParameter(cd);},setDocumentLocator:function(bd){Lc.ignoreParameter(bd);},skippedEntity:function(bd){Lc.ignoreParameter(bd);},startDocument:function(){},startElement:function(bd,cd,dd,ed){var fd=this._forward[0];gpf.interfaces.ignoreParameter(bd);gpf.interfaces.ignoreParameter(cd);gpf.interfaces.ignoreParameter(dd);if(undefined!==fd){if(0===fd.type){++fd.depth;fd.iXCH.startElement.apply(fd.iXCH,arguments);}else{this._fillFromElement.apply(this,arguments);}}else if(this._firstElement){this._firstElement=false;this._fillFromAttributes(ed);}else{this._fillFromElement.apply(this,arguments);}},startPrefixMapping:function(bd,cd){Lc.ignoreParameter(bd);Lc.ignoreParameter(cd);}}),ad=function(bd){return new Zc(bd);};gpf.define("gpf.xml.Writer",{"[Class]":[gpf.$InterfaceImplement(Lc.IXmlContentHandler)],_stream:null,_branch:[],_pendingPrefixMappings:[],constructor:function(bd){this._stream=bd;this._branch=[];this._pendingPrefixMappings=[];},_closeLeafForContent:function(){var bd;if(this._branch.length){bd=this._branch[this._branch.length-1];if(!bd.hasContent){this._stream.write(">");bd.hasContent=true;}}},characters:function(bd){this._closeLeafForContent();this._stream.write(bd);},endDocument:function(){},endElement:function(){var bd=this._branch.pop(),cd=this._stream;if(bd.hasContent){cd.write("</");cd.write(bd.qName);cd.write(">");}else{cd.write("/>");}},endPrefixMapping:function(bd){gpf.interfaces.ignoreParameter(bd);},ignorableWhitespace:function(bd){this._closeLeafForContent();this._stream.write(bd);},processingInstruction:function(bd,cd){var dd=this._stream;dd.write("<?");dd.write(bd);dd.write(" ");dd.write(gpf.escapeFor(cd,"xml"));dd.write("?>");},setDocumentLocator:function(bd){gpf.interfaces.ignoreParameter(bd);},skippedEntity:function(bd){gpf.interfaces.ignoreParameter(bd);},startDocument:function(){},startElement:function(bd,cd,dd,ed){var fd,gd,hd,id=this._stream;if(undefined===dd&&!bd){dd=cd;}this._closeLeafForContent();var jd={hasContent:false,qName:dd};this._branch.push(jd);id.write("<");id.write(dd);if(ed){for(fd in ed){if(ed.hasOwnProperty(fd)){id.write(" ");id.write(fd);id.write("=\"");gd=gpf.escapeFor(ed[fd].toString(),"xml");if(-1<gd.indexOf("\"")){gd=gpf.replaceEx(gd,{"\"":"&quot;"});}id.write(gd);id.write("\"");}}}if(this._pendingPrefixMappings.length){for(hd=0;hd<this._pendingPrefixMappings.length;++hd){id.write(" ");id.write(this._pendingPrefixMappings);}this._pendingPrefixMappings=[];}},startPrefixMapping:function(bd,cd){var dd=["xmlns:",bd,":\"",gpf.escapeFor(cd,"xml"),"\""].join(""),ed=this._branch[this._branch.length],fd=this._stream;if(ed.hasContent){this._pendingPrefixMappings.push(dd);}else{fd.write(" ");fd.write(dd);}}});gpf.xml.convert=function(bd,cd){var dd,ed;dd=Lc.query(cd,Lc.IXmlContentHandler,true);if("string"===typeof bd){gpf.Error.NotImplemented();}else if("object"===typeof bd){ed=Lc.query(bd,Lc.IXmlSerializable);if(null!==ed){ed.toXml(dd);}else{new gpf.xml.ConstNode(bd).toXml(dd);}}};var bd=gpf._alpha+gpf._ALPHA+"_",cd=bd+"012345789.-";gpf.extend(gpf.xml,{isValidName:function(dd){var ed;if(0===dd.length||-1===bd.indexOf(dd.charAt(0))){return false;}for(ed=1;ed<dd.length;++ed){if(-1===cd.indexOf(dd.charAt(ed))){return false;}}return true;},toValidName:function(dd){var ed;if(gpf.xml.isValidName(dd)){return dd;}ed="_"+dd;if(!gpf.xml.isValidName(ed)){gpf.Error.XmlInvalidName();}return ed;}});var dd=gpf.interfaces;gpf.extend(gpf.xml,{NODE_INVALID:0,NODE_ELEMENT:1,NODE_ATTRIBUTE:2,NODE_TEXT:3,NODE_ENTITY_REFERENCE:5,NODE_PROCESSING_INSTRUCTION:7,NODE_COMMENT:8,NODE_DOCUMENT:9});gpf._defIntrf("IXmlConstNode",{attributes:function(ed){gpf.interfaces.ignoreParameter(ed);return"";},children:function(ed){if(undefined===ed){return[];}else{return undefined;}},localName:function(){return"";},namespaceURI:function(){return"";},nextSibling:function(){return null;},nodeName:function(){return"";},nodeType:function(){return 0;},nodeValue:function(){return null;},ownerDocument:function(){return null;},parentNode:function(){return null;},prefix:function(){return"";},previousSibling:function(){return null;},textContent:function(){return"";}});gpf.define("gpf.xml.ConstNode",{"[Class]":[gpf.$InterfaceImplement(dd.IXmlConstNode),gpf.$InterfaceImplement(dd.IXmlSerializable)],_obj:null,_name:"",_parentNode:null,_attributes:{},_elements:{},_children:[],constructor:function(ed,fd){this._obj=ed;this._attributes=null;this._elements=null;this._children=null;if(undefined===fd){this._name="root";}else{this._name=fd;}},_members:function(){var ed,fd,gd;this._attributes={};this._elements={};if("object"===typeof this._obj&&!(this._obj instanceof Array)){for(ed in this._obj){if(this._obj.hasOwnProperty(ed)){fd=this._obj[ed];if(null===fd){continue;}gd=gpf.xml.toValidName(ed);if("object"===typeof fd){this._elements[ed]=gd;}else{this._attributes[ed]=gd;}}}}},attributes:function(ed){var fd,gd,hd;if(null===this._attributes){this._members();}if(undefined===ed){fd={};for(gd in this._attributes){if(this._attributes.hasOwnProperty(gd)){hd=this._attributes[gd];fd[hd]=this._obj[gd];}}return fd;}for(gd in this._attributes){if(this._attributes.hasOwnProperty(gd)){if(ed===this._attributes[gd]){return this._obj[gd];}}}return undefined;},children:function(ed){var fd,gd,hd,id;if(null===this._children){if(null===this._elements){this._members();}this._children=[];if(this._obj instanceof Array){for(fd=0;fd<this._obj.length;++fd){gd=new gpf.xml.ConstNode(this._obj[fd],"item");gd._parentNode=this;this._children.push(gd);}}else{for(hd in this._elements){if(this._elements.hasOwnProperty(hd)){id=this._elements[hd];gd=new gpf.xml.ConstNode(this._obj[hd],id);gd._parentNode=this;this._children.push(gd);}}}}return gpf.arrayOrItem(this._children,ed);},localName:function(){return this._name;},namespaceURI:function(){return"";},nextSibling:function(){var ed;if(null!==this._parentNode){ed=gpf.test(this._parentNode._children,this);if(undefined!==ed&&ed<this._parentNode._children.length-1){return this._parentNode._children[ed+1];}}return null;},nodeName:function(){return this._name;},nodeType:function(){return gpf.xml.NODE_ELEMENT;},nodeValue:function(){return this._obj;},ownerDocument:function(){return null;},parentNode:function(){return this._parentNode;},prefix:function(){return"";},previousSibling:function(){var ed;if(null!==this._parentNode){ed=gpf.test(this._parentNode._children,this);if(0<ed){return this._parentNode._children[ed-1];}}return null;},textContent:function(){if("object"!==typeof this._obj){return gpf.value(this._obj,"");}else{return"";}},toXml:function(ed){gpf.xml.nodeToXml(this,ed);}});gpf.xml.nodeToXml=function(ed,fd){var gd=ed.localName(),hd=ed.attributes(),id=ed.children(),jd=ed.textContent(),kd;fd.startElement("",gd,gd,hd);if(jd){fd.characters(jd);}else{for(kd=0;kd<id.length;++kd){gpf.xml.nodeToXml(id[kd],fd);}}fd.endElement();};function ed(kd,ld,md,nd){var od,pd;for(od=0;od<kd.length;++od){pd=kd[od];ld(pd,md,nd);}}function fd(kd,ld,md){var nd=kd.children(),od,pd,qd;for(pd=0;pd<nd.length;++pd){qd=true;od=nd[pd];if(ld.name&&od.localName()!==ld.name){qd=false;}else if(ld.text&&od.textContent()!==ld.text){qd=false;}if(qd){md.push(od);}if(undefined!==ld.relative&&!ld.relative){fd(od,ld,md);}}}function gd(kd,ld,md){var nd,od,pd;if(ld.name){pd=kd.attributes(ld.name);if(undefined!==pd&&(!ld.text||pd===ld.text)){md.push(kd);}}else{nd=kd.attributes();for(od in nd){if(nd.hasOwnProperty(od)){pd=nd[od];if(!ld.text||pd===ld.text){md.push(kd);break;}}}}}function hd(kd,ld,md){if(gpf.xml.NODE_ELEMENT===ld.type){ed(kd,fd,ld,md);}else if(gpf.xml.NODE_ATTRIBUTE===ld.type){ed(kd,gd,ld,md);}}function id(kd,ld,md){var nd,od,pd,qd,rd;if(ld.and){od=ld.and;pd=0;}else if(ld.or){od=ld.or;pd=1;}for(qd=0;qd<od.length;++qd){rd=od[qd];if(rd.and||rd.or){nd=[];id(kd,rd,nd);}else{nd=jd(kd,rd);}if(0===pd&&nd.length===0){return;}if(1===pd&&nd.length!==0){md.push(kd);return;}}if(0===pd){md.push(kd);}}function jd(kd,ld){var md,nd=[kd];while(ld){md=[];hd(nd,ld,md);if(0===md.length){return[];}nd=md;if(ld.filter){md=[];ed(nd,id,ld.filter,md);if(0===md.length){return[];}nd=md;}ld=ld.then;}return md;}gpf.define("gpf.xml.XPath",{_xpath:null,constructor:function(kd){this._reset();if("string"===typeof kd){this._xpath=this._compile(kd);}else{this._xpath=kd;}},_reset:function(){},_compile:function(kd){gpf.interfaces.ignoreParameter(kd);this._xpath=null;},selectNodes:function(kd){return jd(kd,this._xpath);}});}));