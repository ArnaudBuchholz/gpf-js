
(function (a, b) {"use strict";if (typeof define === "function" && define.amd) {define(["exports"], b);} else if (typeof exports !== "undefined") {b(exports);} else {b(a.gpf = {});}}(this, function (a) {"use strict";var a, b;if ("undefined" !== typeof WScript) {a = "wscript";b = function () {return this;}.apply(null, []);b.console = {log: function (c) {WScript.Echo("    " + c);},info: function (c) {WScript.Echo("[?] " + c);},warn: function (c) {WScript.Echo("/!\\ " + c);},error: function (c) {WScript.Echo("(X) " + c);}};} else if ("undefined" !== typeof module && module.exports) {a = "nodejs";b = global;} else if ("undefined" !== typeof window) {a = "browser";b = window;} else {a = "unknown";b = this;}gpf.host = function () {return a;};gpf.context = function (c) {var d, e, f;if (undefined === c) {return b;} else {if ("string" === typeof c) {c = c.split(".");}d = c.length;e = 0;if (c[0] === "gpf") {f = gpf;++e;} else {f = b;}for (; e < d; ++e) {f = f[c[e]];if (undefined === f) {break;}}return f;}};gpf.loaded = function (c) {if (c) {c();}return true;};gpf.NOT_IMPLEMENTED = function () {console.error("Not implemented");throw { message: "Not implemented" };};gpf.ASSERT = function () {};var c = function (o, p, q) {var r, s = o.length, t;for (t = 0; t < s; ++t) {r = p.apply(this, [t,o[t]]);if (undefined !== r) {return r;}}return q;}, d = function (o, p) {var q = o.length, r;for (r = 0; r < q; ++r) {p.apply(this, [r,o[r]]);}}, e = function (o, p, q) {var r, s;for (s in o) {if (o.hasOwnProperty(s)) {r = p.apply(this, [s,o[s]]);if (undefined !== r) {return r;}}}return q;}, f = function (o, p) {var q;for (q in o) {if (o.hasOwnProperty(q)) {p.apply(this, [q,o[q]]);}}}, g = function (o, p) {this[0][o] = p;}, h = function (o, p) {var q = this[0], r = this[2];if (undefined !== q[o]) {r(q, o, p);} else {q[o] = p;}}, i = function (o, p, q) {var r, s, t, u = o.length;for (r = 0; r < u; ++r) {s = o[r].a;t = o[r].b;if (s === p && t === q || t === p && s === q) {return r;}}return undefined;}, j = function (o, p, q) {if (q && ("object" === typeof o || "object" === typeof p)) {if (o instanceof String || p instanceof String) {return o.toString() === p.toString();}if (o instanceof Number || p instanceof Number) {return o.valueOf() === p.valueOf();}return false;}return false;}, k = function (o, p, q, r) {if (o !== p) {if (typeof o !== typeof p && !j(o, p, q)) {return false;}if (null === o || null === p || "object" !== typeof o) {return false;}if (undefined === i(r.done, o, p)) {r.todo.push(o);r.todo.push(p);}}return true;}, l = function (o, p, q) {var r, s, t = {todo: [o,p],done: []};while (0 !== t.todo.length) {p = t.todo.pop();o = t.todo.pop();if (o.prototype !== p.prototype) {return false;}t.done.push({a: o,b: p});s = 0;for (r in o) {if (o.hasOwnProperty(r)) {++s;if (!k(o[r], p[r], q, t)) {return false;}}}for (r in p) {if (p.hasOwnProperty(r)) {--s;}}if (0 !== s) {return false;}}return true;}, m = {boolean: function (o, p, q) {if ("string" === p) {if ("yes" === o || "true" === o) {return true;}return 0 !== parseInt(o, 10);}if ("number" === p) {return 0 !== o;}return q;},number: function (o, p, q) {if ("string" === p) {return parseFloat(o);}return q;},string: function (o, p, q) {gpf.interfaces.ignoreParameter(p);gpf.interfaces.ignoreParameter(q);if (o instanceof Date) {return gpf.dateToComparableFormat(o);}return o.toString();},object: function (o, p, q) {if (q instanceof Date && "string" === p) {return gpf.dateFromComparableFormat(o);}return q;}}, n = Function;gpf.each = function (o, p, q) {if (undefined === q) {if (o instanceof Array) {d.apply(this, arguments);} else {f.apply(this, arguments);}return undefined;}if (o instanceof Array) {return c.apply(this, arguments);}return e.apply(this, arguments);};gpf.extend = function (o, p, q) {var r;if (undefined === q) {r = g;} else {r = h;}gpf.each.apply(arguments, [p,r]);return o;};gpf.extend(gpf, {_alpha: "abcdefghijklmnopqrstuvwxyz",_ALPHA: "ABCDEFGHIJKLMNOPQRSTUVWXYZ",_func: function (o) {return new n(o);},value: function (o, p, q) {var r = typeof o;if (!q) {q = typeof p;}if (q === r) {return o;}if ("undefined" === r || !o) {return p;}return m[q](o, r, p);},like: function (o, p, q) {if (o === p) {return true;}if (typeof o !== typeof p) {return j(o, p, q);}if (null === o || null === p || "object" !== typeof o) {return false;}return l(o, p, q);},clone: function (o) {return gpf.json.parse(gpf.json.stringify(o));},test: function (o, p) {var q;if (o instanceof Array) {q = o.length;while (q > 0) {if (o[--q] === p) {return q;}}} else {for (q in o) {if (o.hasOwnProperty(q) && o[q] === p) {return q;}}}return undefined;},set: function (o, p) {gpf.ASSERT(o instanceof Array, "gpf.set must be used with an Array");var q = o.length;while (q > 0) {if (o[--q] === p) {return o;}}o.push(p);return o;},clear: function (o, p) {var q;if (o instanceof Array) {q = o.length;while (q > 0) {if (o[--q] === p) {o.splice(q, 1);break;}}} else {for (q in o) {if (o.hasOwnProperty(q) && o[q] === p) {break;}}}return o;},xor: function (o, p) {return o && !p || !o && p;},capitalize: function (o) {return o.charAt(0).toUpperCase() + o.substr(1);},Callback: function (o, p) {if (o) {this._handler = o;}if (p) {this._scope = p;}}});gpf.extend(gpf.Callback.prototype, {_handler: gpf._func(""),_scope: null,handler: function () {return this._handler;},scope: function () {return this._scope;},call: function () {var o = arguments[0], p = [], q = arguments.length, r;for (r = 1; r < q; ++r) {p.push(arguments[r]);}return this.apply(o, p);},apply: function (o, p) {var q = gpf.Callback.resolveScope(this._scope || o);return this._handler.apply(q, p);}});gpf.Callback.resolveScope = function (o) {if (!o) {o = gpf.context();}return o;};var o = function (s) {var t, u, v;this._listeners = {};if (undefined !== s) {this._events = s;u = s.length;for (t = 0; t < u; ++t) {v = s[t];this["on" + v.charAt(0).toUpperCase() + v.substr(1)] = this._onEVENT(t);this._listeners[v] = [];}}}, p = function (s) {return function () {var t = this._events[s], u = arguments.length, v;for (v = 0; v < u; ++v) {t.push(arguments[v]);}return this.addEventListener.apply(this, t);};}, q = function () {o.apply(this, arguments);}, r = function (s, t, u, v) {this._type = s;if (undefined !== t) {this._params = t;}if (u) {this._cancelable = true;}if (v) {this._scope = v;}};gpf.extend(o.prototype, {_listeners: {},_events: null,_onEVENT: function (s) {var t = q.prototype._onEVENT.closures, u;if (!t) {t = q.prototype._onEVENT.closures = [];}gpf.ASSERT(t.length >= s, "calls must be sequential");while (t.length <= s) {u = t.length;t.push(p(u));}return t[s];},addEventListener: function (s, t, u, v) {var w = this._listeners;if ("boolean" === typeof u) {v = u;u = undefined;} else {if (!u) {u = null;}if (!v) {v = false;}}if (t instanceof gpf.Callback) {if (u && u !== t.scope()) {t = t.handler();}}if (!(t instanceof gpf.Callback)) {t = new gpf.Callback(t, u);}if (undefined === w[s]) {w[s] = [];}if (v) {w[s].unshift(t);} else {w[s].push(t);}return this;},removeEventListener: function (s, t, u) {var v = this._listeners[s], w, x;if (undefined !== v) {if (t instanceof gpf.Callback) {if (!u) {u = t.scope();}t = t.handler();}x = v.length;while (x > 0) {w = v[--x];if (w.handler() === t && w.scope() === u) {v.splice(x, 1);break;}}}return this;},_broadcastEvent: function (s, t) {var u, v, w;if (s instanceof r) {v = s.type();} else {v = s;}w = this._listeners[v];if (undefined === w) {return this;}if (s instanceof r) {for (u = 0; u < w.length; ++u) {w[u].apply(s._scope, [s]);if (s._propagationStopped) {break;}}} else {for (u = 0; u < w.length; ++u) {w[u].apply(null, [s,t]);}}return this;}});q.prototype = new o;gpf.extend(q.prototype, { broadcastEvent: function () {return this._broadcastEvent.apply(this, arguments);} });gpf.extend(r.prototype, {_type: "",_params: {},_cancelable: false,_propagationStopped: false,_defaultPrevented: false,_scope: null,type: function () {return this._type;},scope: function () {return gpf.Callback.resolveScope(this._scope);},cancelable: function () {return this._cancelable;},preventDefault: function () {this._defaultPrevented = true;},defaultPrevented: function () {return this._defaultPrevented;},stopPropagation: function () {this._propagationStopped = true;},get: function (s) {return this._params[s];},fire: function (s) {return gpf.events.fire(this, s);}});gpf.events = {Target: o,Broadcaster: q,Event: r,fire: function (s, t, u) {var v;if (undefined === u) {u = t;t = undefined;}if (!(s instanceof r)) {s = new gpf.events.Event(s, t, true, this);}v = gpf.Callback.resolveScope(s._scope);if (u instanceof q) {u.broadcastEvent(s);} else if ("function" === typeof u || u instanceof gpf.Callback) {u.apply(v, [s]);} else {u = u[s.type()];if (undefined !== typeof u) {u.apply(v, [s]);}}return s;}};var s = 0, t = {}, u = function (x) {var y = x.scriptTag, z = x.headTag;y.onerror = y.onload = y.onreadystatechange = null;if (z && y.parentNode) {z.removeChild(y);}delete t[x.id];}, v = function () {var x = t[this.id];if (!x.done && (!this.readyState || this.readyState === "loaded" || this.readyState === "complete")) {setTimeout(function () {x.done = true;gpf.events.fire("load", { url: x.src }, x.eventsHandler);}, 0);u(x);}}, w = function () {var x = t[this.id];if (!x.done) {x.done = true;gpf.events.fire("error", { url: x.src }, x.eventsHandler);u(x);}};gpf.http = { include: function (x, y) {var z = {src: x,id: "__gpf_http_" + ++s,headTag: document.getElementsByTagName("head")[0] || document.documentElement,scriptTag: document.createElement("script"),done: false}, A;if (undefined === y) {y = new gpf.events.Broadcaster(["load","error"]);}z.eventsHandler = y;t[z.id] = z;A = z.scriptTag;A.language = "javascript";A.src = x;A.id = z.id;A.onload = A.onreadystatechange = v;A.onerror = w;if (undefined !== A.async) {A.async = true;}setTimeout(function () {z.headTag.insertBefore(A, z.headTag.firstChild);}, 0);} };var x = [], y = function (z, A, B) {if (!A) {A = null;}if (!B) {B = [];}return function () {z.apply(gpf.Callback.resolveScope(A), B);};};if ("wscript" === gpf.host()) {gpf.defer = function (z, A, B, C) {gpf.interfaces.ignoreParameter(A);x.push(y(z, B, C));};gpf.runAsyncQueue = function () {var z;while (x.length) {z = x.shift();z();}};} else {gpf.defer = function (z, A, B, C) {if (!A) {A = 0;}setTimeout(y(z, B, C), A);};gpf.runAsyncQueue = function () {};}var z = gpf._ALPHA + gpf._alpha + "0123456789+/", A = "0123456789ABCDEF", B = function (D, E, F, G) {var H = D.length, I = gpf.bin.isPow2(H), J, K, L = [], M;if (-1 < I && (undefined === F || F * I <= 32)) {if (undefined === F) {J = 32;} else {J = F * I;}K = (1 << J - I) - 1;J = (1 << I) - 1;while (0 !== E) {M = E & J;L.unshift(D.charAt(M));E = E >> I & K;}} else {while (0 !== E) {M = E % H;L.unshift(D.charAt(M));E = (E - M) / H;}}if (undefined !== F) {if (undefined === G) {G = D.charAt(0);}while (L.length < F) {L.unshift(G.charAt(L.length % G.length));}} else if (0 === L.length) {L = [D.charAt(0)];}return L.join("");}, C = function (D, E, F) {var G = D.length, H = 0, I = 0;if (undefined === F) {F = D.charAt(0);}while (I < E.length) {if (-1 === F.indexOf(E.charAt(I))) {break;} else {++I;}}while (I < E.length) {H = G * H + D.indexOf(E.charAt(I++));}return H;};gpf.bin = {pow2: function (D) {return 1 << D;},isPow2: function (D) {if (0 < D && 0 === (D & D - 1)) {var E = 0;while (1 < D) {++E;D >>= 1;}return E;} else {return -1;}},toBaseANY: B,fromBaseANY: C,toHexa: function (D, E, F) {return B(A, D, E, F);},fromHexa: function (D, E) {return C(A, D, E);},toBase64: function (D, E, F) {return B(z, D, E, F);},fromBase64: function (D, E) {return C(z, D, E);}};gpf.json = {};if ("undefined" === typeof JSON) {var D = function (F) {var G, H, I, J;G = F instanceof Array;H = [];for (I in F) {if ("function" === typeof F[I]) {continue;}J = E(F[I]);if (G) {H.push(J);} else {H.push(I + ": " + J);}}if (G) {return "[" + H.join(", ") + "]";} else {return "(" + H.join(", ") + ")";}}, E = function (F) {var G = typeof F;if ("undefined" === G || "function" === G) {return;} else if ("number" === G || "boolean" === G) {return F.toString();} else if ("string" === G) {return gpf.escapeFor(F, "javascript");}if (null === F) {return "null";} else {return D(F);}};gpf.json.stringify = E;gpf.json.parse = function (F) {return gpf._func("return " + F)();};} else {gpf.json.stringify = JSON.stringify;gpf.json.parse = JSON.parse;}var J = "public|protected|private|static".split("|"), K = 0, L = 3, M = true;gpf.ClassDefinition = function (N, O, P) {this._Subs = [];if ("function" === typeof N) {this._Constructor = N;} else {this._name = N;this._Base = O;this._definition = P;this._build();}};gpf.extend(gpf.ClassDefinition.prototype, {_name: "",name: function () {return this._name;},_Base: Object,Base: function () {return this._Base;},_Subs: [],Subs: function () {return this._Subs;},_attributes: null,attributes: function () {if (!this._attributes) {this._attributes = new gpf.attributes.Map;}return this._attributes;},_Constructor: function () {},_defConstructor: null,Constructor: function () {return this._Constructor;},_definition: null,_processMember: function (N, O) {var P = this._Constructor.prototype, Q = this._definition[N], R, S, T, U;R = typeof Q;if (L === O) {P.constructor[N] = Q;return;}S = this._Base.prototype[N];T = typeof S;if ("undefined" !== T && null !== S && R !== T) {throw { message: "You can't overload a member to change its type" };}if ("function" === R && "undefined" !== T) {U = N;if ("_" === U.charAt(0)) {U = U.substr(1);}U = gpf.capitalize(U);P["_base" + U] = S;}if ("constructor" === N) {this._defConstructor = Q;} else {P[N] = Q;}},_processAttribute: function (N) {var O, P = this._definition[N];N = N.substr(1, N.length - 2);if (!this._attributes) {this._attributes = {};}O = this._attributes[N];if (undefined === O) {O = [];}this._attributes[N] = O.concat(P);},_processDefWithVisibility: function (N) {var O = this._definition, P, Q;Q = J[N];P = O[Q];this._definition = P;try {for (Q in P) {if (P.hasOwnProperty(Q)) {if ("[" === Q.charAt(0) && "]" === Q.charAt(Q.length - 1)) {this._processAttribute(Q);} else if ("public" === Q || "private" === Q || "protected" === Q || "static" === Q) {throw { message: "Invalid visibility keyword" };} else {this._processMember(Q, N);}}}if ("wscript" === gpf.host() && P.constructor !== Object) {this._processMember("constructor", N);}} catch (e) {throw e;} finally {this._definition = O;}},_processDefinition: function () {var N = this._definition, O, P;for (O in N) {if (N.hasOwnProperty(O)) {if ("[" === O.charAt(0) && "]" === O.charAt(O.length - 1)) {this._processAttribute(O);} else {P = J.indexOf(O);if (-1 === P) {this._processMember(O, K);} else {this._processDefWithVisibility(P);}}}}if ("wscript" === gpf.host() && N.constructor !== Object) {this._processMember("constructor", K);}},_processAttributes: function () {var N = this._attributes, O, P, Q;if (N) {delete this._attributes;O = this._Constructor;P = O.prototype;for (Q in N) {if (N.hasOwnProperty(Q)) {if (Q in P || Q === "Class") {gpf.attributes.add(O, Q, N[Q]);} else {console.error("gpf.define: Invalid attribute name '" + Q + "'");}}}}},_build: function () {var N, O, P;N = gpf._func(H(this._name))(gpf);this._Constructor = N;N._gpf = this;M = false;O = new this._Base;M = true;N.prototype = O;O.constructor = N;P = gpf.classDef(this._Base);P.Subs().push(N);this._processDefinition();this._processAttributes();if (this._defConstructor) {O._baseConstructor = I(this._Base);}}});gpf.classDef = function (N) {if (undefined === N._gpf) {N._gpf = new gpf.ClassDefinition(N);}return N._gpf;};gpf._classInit = function (N, O) {if (M) {var P = gpf.classDef(N);if (P._defConstructor) {P._defConstructor.apply(this, O);} else {P._Base.apply(this, O);}}};function F() {var N = arguments[0], O = _CONSTRUCTOR_ = function () {N._classInit.apply(this, [O,arguments]);};return O;}function G() {var N = arguments[0], O = function _CONSTRUCTOR_() {N._classInit.apply(this, [O,arguments]);};return O;}function H(N) {var O, P, Q, R;if (-1 < N.indexOf(".")) {O = F;} else {O = G;}P = O.toString().replace("_CONSTRUCTOR_", N);Q = P.indexOf("{") + 1;R = P.lastIndexOf("}") - 1;return P.substr(Q, R - Q + 1);}function I(N) {return function () {N.apply(this, arguments);};}gpf.define = function (N, O, P) {var Q, R, S, T, U;if ("string" === typeof O) {O = gpf.context(O);} else if ("object" === typeof O) {P = O;O = undefined;}if (undefined === O) {O = Object;}if (-1 < N.indexOf(".")) {R = N.split(".");T = R.pop();S = gpf.context(R);}U = new gpf.ClassDefinition(N, O, P || {});Q = U.Constructor();if (undefined !== S) {S[T] = Q;}return Q;};gpf._genDefHandler = function (N, O) {N = N + ".";return function (P, Q, R) {var S;if (undefined === R && "object" === typeof Q) {R = Q;Q = N + O;} else if (undefined === Q) {Q = N + O;}if (-1 === P.indexOf(".")) {P = N + P;}S = gpf.define(P, Q, R);return S;};};var O = 0, P = gpf._genDefHandler("gpf.attributes", "Attribute");gpf.attributes = {};function N(Q, R) {R = "$" + R;gpf[R] = function () {var S = gpf._func("return function " + R + "(args) {" + "this.constructor.apply(this, args);" + "};")();S.prototype = Q.prototype;return function () {return new S(arguments);};}();}gpf._defAttr = function (Q, R, S) {var T = Q.charAt(0) === "$", U, V;if (T) {Q = Q.substr(1);U = Q + "Attribute";} else {U = Q;}V = P(U, R, S);if (T) {N(V, Q);}return V;};gpf._defAttr("Attribute", {_member: "",member: function (Q) {var R = this._member;if (Q) {this._member = Q;}return R;},alterPrototype: function (Q) {gpf.interfaces.ignoreParameter(Q);}});gpf._defAttr("$Alias", {_name: "",constructor: function (Q) {this._name = Q;},alterPrototype: function (Q) {N(Q.constructor, this._name);}});gpf.define("gpf.attributes.Array", {_array: [],constructor: function () {this._array = [];},has: function (Q) {gpf.ASSERT("function" === typeof Q);var R, S;for (R = 0; R < this._array.length; ++R) {S = this._array[R];if (S instanceof Q) {return S;}}return null;},filter: function (Q) {gpf.ASSERT("function" === typeof Q);var R, S, T = new gpf.attributes.Array;for (R = 0; R < this._array.length; ++R) {S = this._array[R];if (S instanceof Q) {T._array.push(S);}}return T;}});gpf.define("gpf.attributes.Map", {_members: {},_count: 0,constructor: function (Q) {this._members = {};this._count = 0;if (undefined !== Q) {this.fillFromObject(Q);}},count: function () {return this._count;},add: function (Q, R) {var S = this._members[Q];if (undefined === S) {S = this._members[Q] = new gpf.attributes.Array;}S._array.push(R);++this._count;},_copyTo: function (Q, R, S) {var T, U, V, W;if (this._count) {for (T in this._members) {if (this._members.hasOwnProperty(T)) {U = this._members[T]._array;for (V = 0; V < U.length; ++V) {W = U[V];if (!R || R(T, W, S)) {Q.add(T, W);}}}}}},_filterCallback: function (Q, R, S) {gpf.interfaces.ignoreParameter(Q);return R instanceof S;},fillFromObject: function (Q) {var R = gpf.classDef(Q.constructor), S;while (R) {S = R.attributes();if (S) {S._copyTo(this);}if (R.Base() !== Object) {R = gpf.classDef(R.Base());} else {break;}}return this._count;},filter: function (Q) {gpf.ASSERT("function" === typeof Q);var R = new gpf.attributes.Map;this._copyTo(R, this._filterCallback, Q);return R;},member: function (Q) {var R = this._members[Q];if (undefined === R) {if (0 === O) {O = new gpf.attributes.Array;}R = O;}return R;},members: function () {var Q = [], R;for (R in this._members) {if (this._members.hasOwnProperty(R)) {Q.push(R);}}return Q;}});gpf.attributes.add = function (Q, R, S) {var T, U, V, W;T = gpf.classDef(Q).attributes();U = S.length;for (V = 0; V < U; ++V) {W = S[V];W.member(R);T.add(R, W);W.alterPrototype(Q.prototype);}};gpf.define("gpf.Error", {_message: "",_name: "",constructor: function (Q, R, S) {this._message = Q;if (R) {this._name = R;} else {this._name = "Error";}if (S) {gpf.extend(this, S);}},message: function () {return this._message;},name: function () {return this._name;}});var Q = function (T) {return gpf._func("return this." + T + ";");}, R = function (T) {return gpf._func("var r = this." + T + "; if (0 < arguments.length) { this." + T + " = arguments[0]; } return r;");}, S = gpf._defAttr("ClassAttribute");gpf._defAttr("$ClassProperty", S, {_writeAllowed: false,_publicName: "",constructor: function (T, U) {if (T) {this._writeAllowed = true;}if ("string" === typeof U) {this._publicName = U;}},alterPrototype: function (T) {var U = this._member, V = this._publicName;if (!V) {V = U.substr(1);}if (this._writeAllowed) {T[V] = R(U);} else {T[V] = Q(U);}}});gpf._defAttr("$ClassEventMethod", S, {});gpf._defAttr("$ClassExtension", S, {_ofClass: 0,_publicName: "",constructor: function (T, U) {this._ofClass = T;if ("string" === typeof U) {this._publicName = U;}}});gpf.interfaces = {isImplementedBy: function (V, W) {var X;for (X in W.prototype) {if ("constructor" === X || "extend" === X) {continue;}if (typeof W.prototype[X] !== typeof V[X]) {return false;}}return true;},query: function (V, W, X) {var Y = null;if (gpf.interfaces.isImplementedBy(V, W)) {return V;} else if (gpf.interfaces.isImplementedBy(V, gpf.interfaces.IUnknown)) {Y = V.queryInterface(W);}if (null === Y && X) {throw { message: "expected " + gpf.classDef(W).name() };}return Y;}};if (!gpf.interfaces.ignoreParameter) {gpf.interfaces.ignoreParameter = function () {};}gpf._defIntrf = gpf._genDefHandler("gpf.interfaces", "Interface");gpf._defIntrf("Interface");gpf._defIntrf("IEventTarget", {addEventListener: function (V, W, X, Y) {gpf.interfaces.ignoreParameter(V);gpf.interfaces.ignoreParameter(W);gpf.interfaces.ignoreParameter(X);gpf.interfaces.ignoreParameter(Y);},removeEventListener: function (V, W, X) {gpf.interfaces.ignoreParameter(V);gpf.interfaces.ignoreParameter(W);gpf.interfaces.ignoreParameter(X);}});gpf._defIntrf("IUnknown", { queryInterface: function (V) {gpf.interfaces.ignoreParameter(V);return null;} });function T(V) {var W = new gpf.attributes.Map(this).member("Class").filter(gpf.attributes.InterfaceImplementAttribute), X, Y;for (X = 0; X < W.length(); ++X) {Y = W.get(X);if (Y._interfaceDefinition === V) {if (Y._builder) {return Y._builder(this);}break;}}return null;}function U(V) {return function () {var W = T.apply(this, arguments);if (null === W) {W = V.apply(this, arguments);}return W;};}gpf._defAttr("$InterfaceImplement", {"[_interfaceDefinition]": [gpf.$ClassProperty(false, "which")],_interfaceDefinition: 0,"[_builder]": [gpf.$ClassProperty(false, "how")],_builder: null,constructor: function (V, W) {this._interfaceDefinition = V;if (W) {this._builder = W;}},alterPrototype: function (V) {if (!this._builder) {return;}if (undefined !== V.queryInterface) {if (T !== V.queryInterface) {V.queryInterface = U(V.queryInterface);}} else {V.queryInterface = T;gpf.attributes.add(V.constructor, "Class", [gpf.$InterfaceImplement(gpf.interfaces.IUnknown)]);}}});var X = gpf.interfaces, Y = gpf.attributes;gpf._defIntrf("IEnumerable", {reset: function () {},moveNext: function () {return false;},current: function () {return null;}});function V(Z) {var ab = -1;return {reset: function () {ab = -1;},moveNext: function () {++ab;return ab < Z.length;},current: function () {return Z[ab];}};}function W(Z) {var ab = new Y.Map(Z).filter(Y.EnumerableAttribute), bb = ab.members();gpf.ASSERT(bb.length === 1);return V(Z[bb[0]]);}gpf._defAttr("$Enumerable", Y.ClassAttribute, { alterPrototype: function (Z) {if (!(Z[this._member] instanceof Array)) {throw { message: "$Enumerable can be associated to arrays only" };}Y.add(Z.constructor, "Class", [new Y.InterfaceImplementAttribute(X.IEnumerable, W)]);} });var Z = gpf.interfaces, ab = gpf.attributes, bb;bb = gpf._defIntrf("IReadOnlyArray", {length: function () {return 0;},get: function (cb) {Z.ignoreParameter(cb);return undefined;}});gpf._defIntrf("IArray", bb, { set: function (cb, db) {Z.ignoreParameter(cb);Z.ignoreParameter(db);return undefined;} });gpf._defAttr("ClassArrayInterfaceAttribute", ab.ClassAttribute, {"[Class]": [gpf.$Alias("ClassIArray")],_writeAllowed: false,constructor: function (cb) {if (cb) {this._writeAllowed = true;}},alterPrototype: function (cb) {var db;if (this._writeAllowed) {db = Z.IArray;} else {db = Z.IReadOnlyArray;}ab.add(cb.constructor, "Class", [gpf.$InterfaceImplement(db)]);cb.length = gpf._func("return this." + this._member + ".length;");cb.get = gpf._func("return this." + this._member + "[arguments[0]];");if (this._writeAllowed) {cb.set = gpf._func("var i=arguments[0]," + "v=this." + this._name + "[i];this." + this._member + "[i]=arguments[1];return v;");}}});ab.add(ab.Array, "_array", [gpf.$ClassIArray(false)]);gpf.arrayOrItem = function (cb, db) {if (undefined === db) {return Array.prototype.slice.call(cb, 0);} else if (0 === cb.length) {return undefined;} else if (-1 === db) {return cb[cb.length - 1];} else if (db < -1 || db > cb.length - 1) {return undefined;} else {return cb[db];}};var cb = gpf.interfaces;gpf._defIntrf("IReadableStream", {read: function (db, eb) {gpf.interfaces.ignoreParameter(db);gpf.interfaces.ignoreParameter(eb);},static: {EVENT_ERROR: "error",EVENT_DATA: "data",EVENT_END_OF_STREAM: "eos",EXCEPTION_READ_IN_PROGRESS: { message: "Read in progress" }}});gpf._defIntrf("IWritableStream", {write: function (db, eb) {gpf.interfaces.ignoreParameter(db);gpf.interfaces.ignoreParameter(eb);},static: {EVENT_ERROR: "error",EVENT_READY: "ready",EXCEPTION_WRITE_IN_PROGRESS: { message: "Read in progress" }}});gpf._defIntrf("IStream", {read: function (db, eb) {gpf.interfaces.ignoreParameter(db);gpf.interfaces.ignoreParameter(eb);},write: function (db, eb) {gpf.interfaces.ignoreParameter(db);gpf.interfaces.ignoreParameter(eb);}});gpf._defIntrf("ITextStream", cb.IStream, {});cb.ITextStream._write = function () {var db, eb;for (db = 0; db < arguments.length; ++db) {eb = arguments[db];if (null !== eb && "string" !== typeof eb) {eb = eb.toString();}this.write_(eb);}if (0 === db) {this.write_(null);}};var eb = gpf.interfaces, fb = {javascript: {"\\": "\\\\","\"": "\\\"","\n": "\\n","\r": "\\r","\t": "\\t"},xml: {"&": "&amp;","<": "&lt;",">": "&gt;"},html: {"&": "&amp;","<": "&lt;",">": "&gt;","\xE9": "&eacute;","\xE8": "&egrave;","\xEA": "&ecirc;","\xE1": "&aacute;","\xE0": "&agrave;"}}, gb = gpf.define("StringStream", gpf.events.Target, {"[Class]": [gpf.$InterfaceImplement(gpf.interfaces.ITextStream)],_buffer: [],_pos: 0,constructor: function (hb) {if (undefined !== hb && hb.length) {this._buffer = [hb];} else {this._buffer = [];}this._pos = 0;},read: function (hb, ib) {var jb, kb, lb;if (0 === this._buffer.length) {gpf.defer(gpf.events.fire, 0, this, [eb.IReadableStream.EVENT_END_OF_STREAM,ib]);} else if (undefined === hb) {gpf.defer(gpf.events.fire, 0, this, [eb.IReadableStream.EVENT_DATA,{ buffer: this.consolidateString() },ib]);} else {jb = this._buffer[0];kb = jb.length;if (hb > kb - this._pos) {hb = kb - this._pos;}lb = jb.substr(this._pos, hb);this._pos += hb;if (this._pos === kb) {this._buffer.shift();this._pos = 0;}gpf.defer(gpf.events.fire, 0, this, [eb.IReadableStream.EVENT_DATA,{ buffer: lb },ib]);}},write: function (hb, ib) {if (hb && hb.length) {this._buffer.push(hb);}gpf.events.fire.apply(this, [eb.IReadableStream.EVENT_READY,ib]);},consolidateString: function () {if (this._pos !== 0) {this._buffer.unshift(this._buffer.shift().substr(this._pos));}return this._buffer.join("");}});gpf.extend(gpf, {"[capitalize]": [gpf.$ClassExtension(String)],"[replaceEx]": [gpf.$ClassExtension(String)],replaceEx: function (hb, ib) {var jb = hb, kb;for (kb in ib) {if (ib.hasOwnProperty(kb)) {if (-1 < jb.indexOf(kb)) {jb = jb.split(kb).join(ib[kb]);}}}return jb;},"[escapeFor]": [gpf.$ClassExtension(String)],escapeFor: function (hb, ib) {var jb = fb[ib];if (undefined !== jb) {hb = gpf.replaceEx(hb, jb);if ("javascript" === ib) {hb = "\"" + hb + "\"";}}return hb;},"[stringExtractFromStringArray]": [gpf.$ClassExtension(String, "fromStringArray")],stringExtractFromStringArray: function (hb, ib) {var jb = hb.length, kb, lb, mb, nb;if (0 === ib) {kb = hb.splice(0, jb).join("");} else {lb = 0;do {mb = hb[lb];nb = mb.length;if (nb <= ib) {++lb;ib -= nb;} else {break;}} while (0 < ib && lb < jb);if (0 === ib) {kb = hb.splice(0, lb).join("");} else if (lb < jb) {kb = [];if (0 < lb) {kb.push(hb.splice(0, lb - 1).join(""));}mb = hb.shift();kb.push(mb.substr(0, ib));hb.unshift(mb.substr(ib));kb = kb.join("");} else {kb = hb.splice(0, jb).join("");}}return kb;},"[stringToStream]": [gpf.$ClassExtension(String, "toStream")],stringToStream: function (hb) {return new gb(hb);},"[stringFromStream]": [gpf.$ClassExtension(String, "fromStream")],stringFromStream: function (hb, ib) {var jb, kb, lb;if (hb instanceof gb) {jb = hb.consolidateString();gpf.events.fire.apply(this, [eb.IReadableStream.EVENT_READY,{ buffer: jb },ib]);return;}hb = gpf.interfaces.query(hb, eb.IReadableStream, true);lb = {buffer: [],eventsHandler: ib};kb = new gpf.Callback(db, lb);lb.callback = kb;hb.read(0, kb);}});function db(hb) {var ib = hb.type(), jb = hb.scope();if (ib === eb.IReadableStream.EVENT_END_OF_STREAM) {gpf.events.fire.apply(this, [eb.IReadableStream.EVENT_READY,{ string: this.buffer.join("") },this.eventsHandler]);} else if (ib === eb.IReadableStream.EVENT_ERROR) {gpf.events.fire.apply(this, [hb,this.eventsHandler]);} else {this.buffer.push(hb.get("buffer"));jb.read(0, this.callback);return;}delete this.callback;}var hb = function (ib) {if (10 > ib) {return "0" + ib;} else {return ib;}};;gpf.extend(gpf, {"[dateToComparableFormat]": [gpf.$ClassExtension(Date, "toComparableFormat")],dateToComparableFormat: function (ib, jb) {if (undefined === jb) {jb = true;}var kb = [ib.getFullYear(),"-",hb(ib.getMonth() + 1),"-",hb(ib.getDate())];if (jb) {kb.push(" ", hb(ib.getHours()), ":", hb(ib.getMinutes()), ":", hb(ib.getSeconds()));}return kb.join("");},"[dateFromComparableFormat]": [gpf.$ClassExtension(String)],dateFromComparableFormat: function (ib) {var jb = new Date;jb.setFullYear(parseInt(ib.substr(0, 4), 10), parseInt(ib.substr(5, 2), 10) - 1, parseInt(ib.substr(8, 2), 10));if (10 < ib.length) {jb.setHours(parseInt(ib.substr(11, 2), 10), parseInt(ib.substr(14, 2), 10), parseInt(ib.substr(17, 2), 10), 0);} else {jb.setHours(0, 0, 0, 0);}return jb;}});var ib = gpf.interfaces, jb = 256, kb = 0, lb = 1, mb = 2, nb = 3, ob = gpf._defIntrf("ITokenizer", { write: function (wb) {gpf.interfaces.ignoreParameter(wb);return -1;} }), pb = gpf.define("PatternItem", {"[_type]": [gpf.$ClassProperty()],_type: -1,"[_parent]": [gpf.$ClassProperty(true)],_parent: null,next: function (wb) {if (undefined === wb) {return this._next;} else {this._next = wb;wb.parent(this._parent);}},_next: null,"[_min]": [gpf.$ClassProperty(true)],_min: 1,"[_max]": [gpf.$ClassProperty(true)],_max: 1,constructor: function (wb) {this._type = wb;},add: function (wb, xb) {gpf.interfaces.ignoreParameter(wb);gpf.interfaces.ignoreParameter(xb);},finalize: function () {},reset: function (wb) {gpf.interfaces.ignoreParameter(wb);},write: function (wb, xb) {gpf.interfaces.ignoreParameter(wb);gpf.interfaces.ignoreParameter(xb);return -1;}}), qb = gpf.define("PatternSimpleItem", pb, {"[_seq]": [gpf.$ClassProperty(false, "sequence")],_seq: "",constructor: function () {this._baseConstructor(pb.TYPE_SIMPLE);this._seq = [];},add: function (wb, xb) {gpf.interfaces.ignoreParameter(xb);this._seq.push(wb);},finalize: function () {this._seq = this._seq.join("");},reset: function (wb) {wb.pos = 0;},write: function (wb, xb) {if (xb !== this._seq.charAt(wb.pos)) {return pb.WRITE_NO_MATCH;}++wb.pos;if (wb.pos < this._seq.length) {return pb.WRITE_NEED_DATA;} else {return pb.WRITE_MATCH;}}}), rb = gpf.define("PatternRangeItem", pb, {_inc: "",_exc: "",constructor: function () {this._baseConstructor(pb.TYPE_RANGE);this._inc = [];},hasExclude: function () {return this.hasOwnProperty("_exc");},enterExclude: function () {this._exc = [];},add: function (wb, xb) {var yb, zb, Ab;if (this.hasExclude()) {yb = this._exc;} else {yb = this._inc;}if (xb) {zb = yb[yb.length - 1].charCodeAt(0);Ab = wb.charCodeAt(0);while (--Ab > zb) {yb.push(String.fromCharCode(Ab));}yb.push(wb);} else {yb.push(wb);}},finalize: function () {this._inc = this._inc.join("");if (this.hasExclude()) {this._exc = this._exc.join("");}},write: function (wb, xb) {gpf.interfaces.ignoreParameter(wb);var yb;if (this._inc.length) {yb = -1 < this._inc.indexOf(xb);} else {yb = true;}if (yb && this._exc.length) {yb = -1 === this._exc.indexOf(xb);}if (yb) {return pb.WRITE_MATCH;} else {return pb.WRITE_NO_MATCH;}}}), sb = gpf.define("PatternChoiceItem", pb, {_choices: [],next: function (wb) {if (undefined === wb) {return null;} else {var xb = wb.parent(), yb;this._choices.push(wb);wb.parent(this);if (1 === this._choices.length) {if (null === xb) {return;}if (xb.type() !== pb.TYPE_GROUP) {throw { message: "Unexpected" };}yb = gpf.test(xb._items, wb);if (undefined === yb) {throw { message: "Unexpected" };}xb._items[yb] = this;this._parent = xb;}}},constructor: function () {this._baseConstructor(pb.TYPE_CHOICE);this._choices = [];},write: function (wb, xb) {var yb = {}, zb, Ab, Bb;for (zb = this._choices.length; zb > 0;) {Ab = this._choices[--zb];Ab.reset(yb);Bb = Ab.write(yb, xb);if (pb.WRITE_NO_MATCH !== Bb) {wb.replaceItem = Ab;gpf.extend(wb, yb);return Bb;}}return pb.WRITE_NO_MATCH;}}), tb = gpf.define("PatternGroupItem", pb, {_items: [],next: function (wb) {if (undefined === wb) {return this._next;} else {if (this._items.length) {this._next = wb;wb.parent(this._parent);} else {this._items.push(wb);wb.parent(this);}}},constructor: function () {this._baseConstructor(pb.TYPE_GROUP);this._items = [];},reset: function (wb) {this._items[0].reset(wb);},write: function (wb, xb) {var yb = this._items[0];wb.replaceItem = yb;return yb.write(wb, xb);}}), ub = gpf.define("PatternParserContext", {_root: null,_item: null,_inRange: false,_afterChar: null,parse: null,constructor: function () {this.parse = this._stateItem;},root: function () {if (null === this._item) {throw { message: "Empty pattern" };}this._item.finalize();if (this.parse !== this._stateItem && this.parse !== this._stateCount) {throw { message: "Invalid syntax" };}return this._root;},_getItem: function (wb, xb) {var yb = this._item, zb;if (xb || null === yb || wb !== yb.type()) {zb = pb.create(wb);if (null !== yb) {yb.finalize();yb.next(zb);} else {this._root = zb;}this._item = zb;yb = zb;}return yb;},_stateItem: function (wb) {if ("[" === wb) {this._getItem(pb.TYPE_RANGE, true);this.parse = this._stateCharMatchRange;} else if ("(" === wb) {this._getItem(pb.TYPE_GROUP, true);} else {this._getItem(pb.TYPE_SIMPLE);this._afterChar = this._stateCount;this._stateChar(wb);}},_stateCharMatchRange: function (wb) {var xb = this._getItem(pb.TYPE_RANGE);if ("^" === wb && !xb.hasExclude()) {xb.enterExclude();} else if ("]" === wb) {this.parse = this._stateCount;} else {this._inRange = false;this._afterChar = this._stateCharRangeSep;this._stateChar(wb);}},_stateCharRangeSep: function (wb) {if ("-" === wb) {this._inRange = true;this._afterChar = this._stateCharMatchRange;this.parse = this._stateChar;} else {this._stateCharMatchRange(wb);}},_stateChar: function (wb) {if ("\\" === wb) {this.parse = this._stateEscapedChar;} else {this._item.add(wb, this._inRange);this.parse = this._afterChar;}},_stateEscapedChar: function (wb) {this._item.add(wb, this._inRange);this.parse = this._afterChar;},_stateCountByChar: {"?": function () {var wb = this._splitSimpleOnMinMax();wb.min(0);},"+": function () {var wb = this._splitSimpleOnMinMax();wb.max(0);},"*": function () {var wb = this._splitSimpleOnMinMax();wb.min(0);wb.max(0);},"|": function () {var wb = this._item, xb = wb.parent();if (null === xb || xb.type() !== pb.TYPE_CHOICE) {xb = pb.create(pb.TYPE_CHOICE);xb.next(wb);}if (wb === this._root) {this._root = xb;}wb.finalize();this._item = xb;},")": function () {var wb = this._item;wb.finalize();while (wb.type() !== pb.TYPE_GROUP) {wb = wb.parent();}if (wb === this._item) {throw { message: "Syntax error (empty group)" };}this._item = wb;return 0;}},_splitSimpleOnMinMax: function () {var wb = this._item, xb;if (wb.type() === pb.TYPE_SIMPLE && wb.sequence().length > 1) {xb = wb.sequence().pop();wb = this._getItem(pb.TYPE_SIMPLE, true);wb.add(xb);}return wb;},_stateCount: function (wb) {var xb = this._stateCountByChar[wb];if (undefined === xb) {this._stateItem(wb);} else {if (undefined === xb.apply(this, arguments)) {this.parse = this._stateItem;}}}}), vb = gpf.define("PatternTokenizer", {"[Class]": [gpf.$InterfaceImplement(ob)],_pattern: null,_item: null,_state: {result: 0,length: 0,matchingLength: 0,count: 0},constructor: function (wb) {this._pattern = wb;this._item = wb._root;this._state = {result: 0,length: 0,matchingLength: 0,count: 0};this._item.reset(this._state);},_getNext: function (wb) {var xb = wb.next();while (null === xb) {wb = wb.parent();if (null === wb) {break;}xb = wb.next();}return xb;},_writeNoMatch: function (wb) {var xb = this._state, yb = this._item;if (xb.count < yb.min() || xb.length > xb.matchingLength + 1) {xb.result = -1;this._item = null;return -1;}yb = this._getNext(yb);if (null === yb) {if (0 === xb.matchingLength) {xb.result = -1;} else {xb.result = xb.matchingLength;}this._item = null;return xb.result;}yb.reset(xb);this._item = yb;xb.count = 0;--xb.length;return this.write(wb);},_writeMatch: function () {var wb = this._state, xb = this._item, yb = this._getNext(xb);wb.matchingLength = wb.length;++wb.count;if (0 === xb.max()) {xb.reset(wb);if (null !== yb) {wb.result = pb.WRITE_NEED_DATA;} else {wb.result = wb.length;}} else if (wb.count === xb.max()) {xb = yb;this._item = xb;if (null === xb) {wb.result = wb.length;} else {xb.reset(wb);wb.count = 0;wb.result = 0;if (0 === xb.min()) {yb = this._getNext(xb);while (yb && 0 === yb.min()) {yb = this._getNext(yb);}if (!yb) {wb.result = wb.matchingLength;}}}} else {wb.result = pb.WRITE_NEED_DATA;}return wb.result;},write: function (wb) {var xb, yb = this._state, zb = this._item;if (null !== zb) {xb = zb.write(yb, wb);++yb.length;if (undefined !== yb.replaceItem) {this._item = yb.replaceItem;}if (pb.WRITE_NEED_DATA === xb) {return yb.result;}if (pb.WRITE_NO_MATCH === xb) {return this._writeNoMatch(wb);} else {return this._writeMatch();}}return yb.result;}});gpf.extend(pb, {TYPE_SIMPLE: 0,TYPE_RANGE: 1,TYPE_CHOICE: 2,TYPE_GROUP: 3,WRITE_NO_MATCH: -1,WRITE_NEED_DATA: 0,WRITE_MATCH: 1,_factory: null,create: function (wb) {var xb = pb._factory;if (!xb) {xb = pb._factory = {};xb[this.TYPE_SIMPLE] = qb;xb[this.TYPE_RANGE] = rb;xb[this.TYPE_CHOICE] = sb;xb[this.TYPE_GROUP] = tb;}return new xb[wb];}});gpf.define("gpf.Pattern", {_root: null,constructor: function (wb) {var xb = new ub, yb, zb = wb.length;for (yb = 0; yb < zb; ++yb) {xb.parse(wb.charAt(yb));}this._root = xb.root();},allocate: function () {return new vb(this);}});gpf.define("gpf.Parser", {public: {constructor: function () {this.reset();},reset: function (wb) {this._pos = 0;this._line = 0;this._column = 0;this._setParserState(wb);},currentPos: function () {return {pos: this._pos,line: this._line,column: this._column};},parse: function () {var wb = arguments.length, xb, yb;for (xb = 0; xb < wb; ++xb) {yb = arguments[xb];if (null === yb) {this._finalizeParserState();} else {gpf.ASSERT("string" === typeof yb);this._parse(yb);}}},setOutputHandler: function (wb) {gpf.ASSERT(wb instanceof Array || wb.apply);this._outputHandler = wb;}},protected: {_initialParserState: null,_ignoreCarriageReturn: false,_ignoreLineFeed: false,_finalizeParserState: function () {this._pState(0);},_setParserState: function (wb) {if (!wb) {wb = this._initialParserState;}if (wb !== this._pState) {this._pState = wb;}},_output: function (wb) {var xb = this._outputHandler;if (xb instanceof Array) {xb.push(wb);} else if (null !== xb) {xb.apply(this, [wb]);}}},private: {_pos: 0,_line: 0,_column: 0,_pState: null,_outputHandler: null,_parse: function (wb) {var xb, yb, zb, Ab, Bb = false;xb = wb.length;for (yb = 0; yb < xb; ++yb) {zb = wb.charAt(yb);if ("\r" === zb && this._ignoreCarriageReturn) {zb = 0;}if ("\n" === zb && this._ignoreLineFeed) {Bb = true;zb = 0;}if (zb) {Ab = this._pState(zb);if (undefined !== Ab) {this._setParserState(Ab);}}++this._pos;if ("\n" === zb || Bb) {++this._line;this._column = 0;} else {++this._column;}}}},static: { FINALIZE: null }});gpf.define("gpf.ParserStream", {"[Class]": [gpf.$InterfaceImplement(ib.IReadableStream)],public: {constructor: function (wb, xb) {this._parser = wb;this._parser.setOutputHandler(new gpf.Callback(this._output, this));this._iStream = ib.query(xb, ib.IReadableStream, true);this._outputBuffer = [];},read: function (wb, xb) {var yb = this._iState, zb, Ab = this._outputBufferLength;if (lb === yb) {throw ib.IReadableStream.EXCEPTION_READ_IN_PROGRESS;} else if (wb < Ab || Ab && nb === yb) {zb = gpf.stringExtractFromStringArray(this._outputBuffer, wb);this._outputBufferLength -= zb.length;gpf.events.fire.apply(this, [ib.IReadableStream.EVENT_DATA,{ buffer: zb },xb]);} else if (nb === yb) {gpf.events.fire.apply(this, [ib.IReadableStream.EVENT_END_OF_STREAM,xb]);} else {if (kb === this._iState) {this._cbRead = new gpf.Callback(this._onRead, this);}this._iState = lb;this._size = wb;this._eventsHandler = xb;this._iStream.read(jb, this._cbRead);}}},private: {_parser: null,_iStream: null,_cbRead: null,_outputBuffer: [],_outputBufferLength: 0,_iState: kb,_size: 0,_eventsHandler: null,_onRead: function (wb) {var xb = wb.type();if (xb === ib.IReadableStream.EVENT_END_OF_STREAM) {this._iState = nb;this._parser.parse(gpf.Parser.FINALIZE);return this.read(this._size, this._eventsHandler);} else if (xb === ib.IReadableStream.EVENT_ERROR) {gpf.events.fire.apply(this, [wb,this._eventsHandler]);} else {this._iState = mb;this._parser.parse(wb.get("buffer"));if (0 < this._outputBufferLength) {return this.read(this._size, this._eventsHandler);} else {this._iStream.read(jb, this._cbRead);}}},_output: function (wb) {this._outputBuffer.push(wb);this._outputBufferLength += wb.length;}}});var wb = "error", xb = "unknown", yb = "keyword", zb = "identifier", Ab = "string", Bb = "number", Cb = "symbol", Db = "comment", Eb = "space", Fb = 99, Gb = 0, Hb = gpf._alpha + gpf._ALPHA + "_$", Ib = 2, Jb = 3, Kb = 4, Lb = 5, Mb = 6, Nb = 7, Ob = 8, Pb = 9, Qb = "(){}[]<>|&?,.;:!=+-*/%^~", Rb = 10, Sb = 11, Tb = " \t\r\n", Ub = 12, Vb = 0, Wb = 0, Xb = 1, Yb = 2, Zb = 3, ac = 4, bc = ["Parsing aborted","Unknown token","Unterminated string","Unterminated comment","Invalid or unsupported string escape"], cc = function () {return {pos: 0,line: 0,column: 0,state: Gb,chars: [],nextPos: 0,nextLine: 0,nextColumn: 0,eventsHandler: null,that: null};}, dc = ("break,case,catch,continue,debugger,default,delete,do," + "else,finally,for,function,if,in,instanceof,new,return,switch," + "this,throw,try,typeof,var,void,while,with").split(","), ec = function () {var pc = {};pc[Gb] = xb;pc[Rb] = Cb;pc[Ob] = Db;pc[Pb] = Db;pc[Jb] = Ab;pc[Lb] = Ab;pc[Sb] = Bb;pc[Ub] = Eb;return pc;}(), fc = function (pc, qc) {var rc, sc, tc, uc = {token: "",pos: pc.pos,line: pc.line,column: pc.column,code: 0,message: ""};if (undefined !== qc) {sc = wb;pc.state = Fb;uc.code = qc;uc.message = bc[qc - Vb];} else {rc = pc.chars.join("");if (Ib === pc.state) {if (undefined !== gpf.test(dc, rc)) {sc = yb;} else {sc = zb;}} else {sc = ec[pc.state];}uc.token = rc;}tc = gpf.events.fire.apply(pc.that, [sc,uc,pc.eventsHandler]);if (tc.defaultPrevented()) {fc(pc, Wb);} else if (undefined !== qc) {throw 0;}pc.state = Gb;pc.chars = [];pc.pos = pc.nextPos;pc.line = pc.nextLine;pc.column = pc.nextColumn;}, gc = [0,function (pc, qc, rc) {gpf.interfaces.ignoreParameter(qc);if (-1 < "(){}[].,;:?".indexOf(pc)) {return false;}if (-1 < "!^~*/%".indexOf(pc)) {return "=" === rc;}return "=" === rc || pc === rc;},function (pc, qc, rc) {if (-1 < "+-|&".indexOf(pc)) {return false;}if ("<" === pc) {return "<" === qc[1] && "=" === rc;}if (-1 < "=!".indexOf(pc)) {return "=" === rc;}if (">" === pc) {return "=" !== qc[1] && ("=" === rc || ">" === rc);}return false;},function (pc, qc, rc) {return ">" === pc && "=" !== qc[2] && "=" === rc;},function () {return false;}], hc = function (pc, qc) {var rc = pc[0];return gc[pc.length](rc, pc, qc);}, ic = function () {var pc = {};pc[Ib] = function (qc, rc) {if (-1 === Hb.indexOf(rc) && ("0" > rc || rc > "9")) {fc(qc);} else {qc.chars.push(rc);}};pc[Sb] = function (qc, rc) {if ("0" > rc || rc > "9") {fc(qc);} else {qc.chars.push(rc);}};pc[Jb] = pc[Lb] = function (qc, rc) {qc.chars.push(rc);if ("\\" === rc) {++qc.state;} else if ("\n" === rc) {fc(qc, Yb);} else if (Jb === qc.state && "\"" === rc) {fc(qc);return true;} else if (Lb === qc.state && "'" === rc) {fc(qc);return true;}return false;};pc[Kb] = pc[Mb] = function (qc, rc) {if ("\\" === rc || "r" === rc || "n" === rc || "t" === rc || "\"" === rc || "'" === rc) {--qc.state;qc.chars.push(rc);} else {fc(qc, ac);}};pc[Nb] = function (qc, rc) {if ("/" === rc) {qc.state = Ob;qc.chars.push(rc);} else if ("*" === rc) {qc.state = Pb;qc.chars.push(rc);} else {qc.state = Rb;if (hc(qc.chars, rc)) {qc.chars.push(rc);} else {fc(qc);}}};pc[Ob] = function (qc, rc) {if ("\n" === rc) {fc(qc);} else {qc.chars.push(rc);}};pc[Pb] = function (qc, rc) {qc.chars.push(rc);if ("/" === rc && qc.chars[qc.chars.length - 2] === "*") {fc(qc);return true;}return false;};pc[Ub] = function (qc, rc) {if (-1 < Tb.indexOf(rc)) {qc.chars.push(rc);} else {fc(qc);}};pc[Rb] = function (qc, rc) {if (-1 < Qb.indexOf(rc)) {if (hc(qc.chars, rc)) {qc.chars.push(rc);} else {fc(qc);}} else {fc(qc);}};return pc;}(), jc = function (pc, qc) {pc.chars = [qc];if (-1 < Hb.indexOf(qc)) {pc.state = Ib;} else if ("0" <= qc && qc <= "9") {pc.state = Sb;} else if ("\"" === qc) {pc.state = Jb;} else if ("'" === qc) {pc.state = Lb;} else if ("/" === qc) {pc.state = Nb;} else if (-1 < Qb.indexOf(qc)) {pc.state = Rb;} else if (-1 < Tb.indexOf(qc)) {pc.state = Ub;} else {fc(pc, Xb);}}, kc = function (pc, qc) {var rc = ic[pc.state];if (undefined !== rc) {if (rc(pc, qc)) {return;}}if (Gb === pc.state) {jc(pc, qc);}}, lc = function (pc, qc) {++pc.nextPos;if ("\n" === qc) {++pc.nextLine;pc.nextColumn = 0;} else {++pc.nextColumn;}}, mc = function (pc, qc) {kc(pc, qc);lc(pc, qc);}, nc = function () {var pc = {};pc[Ib] = 1;pc[Sb] = 1;pc[Ob] = 1;pc[Rb] = 1;pc[Nb] = 2;pc[Pb] = 3;pc[Jb] = 4;pc[Lb] = 4;pc[Kb] = 4;pc[Mb] = 4;return pc;}(), oc = function (pc) {var qc = nc[pc.state];if (1 === qc) {fc(pc);} else if (2 === qc) {pc.state = Rb;fc(pc);} else if (3 === qc) {fc(pc, Zb);} else if (4 === qc) {fc(pc, Yb);}gpf.ASSERT(Gb === pc.state || Fb === pc.state || Ub === pc.state, "Unexpected non-final state");};gpf.js = {};gpf.extend(gpf.js, {keywords: function () {return dc;},tokenize: function (pc, qc) {var rc, sc, tc = cc();tc.eventsHandler = qc;tc.that = this;try {for (rc = 0, sc = pc.length; rc < sc; ++rc) {mc(tc, pc.charAt(rc));}oc(tc);} catch (e) {if ("number" !== typeof e) {throw e;}}},tokenizeEx: function (pc, qc, rc) {var sc, tc;if (undefined === rc) {rc = cc();}rc.eventsHandler = qc;rc.that = this;try {if (null === pc) {oc(rc);rc = null;} else {for (sc = 0, tc = pc.length; sc < tc; ++sc) {mc(rc, pc.charAt(sc));}}} catch (e) {if ("number" !== typeof e) {throw e;}}return rc;}});gpf.html = {};var pc = gpf.interfaces;gpf.define("gpf.html.MarkdownParser", "gpf.Parser", {public: { constructor: function () {this._baseConstructor(arguments);this._openedTags = [];} },protected: {_ignoreCarriageReturn: true,_initialParserState: function (qc) {var rc, sc = 0 < this._openedTags.length;if ("#" === qc) {this._hLevel = 1;rc = this._parseTitle;} else if ("*" === qc || "0" <= qc && "9" >= qc) {if (qc !== "*") {this._numericList = 1;} else {this._numericList = 0;}rc = this._parseList;sc = false;} else if (" " !== qc && "\t" !== qc && "\n" !== qc) {if (sc) {this._output(" ");sc = false;} else {this._openTag("p");}rc = this._parseContent(qc);if (!rc) {rc = this._parseContent;}}if (sc) {this._closeTags();}return rc;},_finalizeParserState: function () {this._closeTags();}},private: {_openedTags: [],_closeTags: function () {var qc;while (this._openedTags.length) {qc = this._openedTags.pop();this._output("</" + qc + ">");if ("p" === qc) {break;}}},_openList: function (qc) {var rc, sc = this._openedTags.length;while (sc) {rc = this._openedTags.pop();--sc;this._output("</" + rc + ">");if ("li" === rc) {break;}}if (sc) {rc = this._openedTags[sc - 1];if (rc !== qc) {this._openedTags.pop();this._output("</" + rc + ">");} else {return;}}this._openTag(qc);},_toggleTag: function (qc) {var rc = this._openedTags.length;if (rc && this._openedTags[rc - 1] === qc) {this._openedTags.pop();this._output("</" + qc + ">");} else {this._openTag(qc);}},_openTag: function (qc) {this._output("<" + qc + ">");this._openedTags.push(qc);},_hLevel: 1,_parseTitle: function (qc) {if ("#" === qc) {++this._hLevel;} else {this._openTag("h" + this._hLevel);return this._parseText;}},_numericList: false,_parseList: function (qc) {var rc = 0 < this._openedTags.length, sc;if (" " === qc) {if (this._numericList) {sc = "ol";} else {sc = "ul";}this._openList(sc);this._openTag("li");} else if (this._numericList && ("0" <= qc && "9" >= qc || "." === qc)) {return;} else if ("*" === qc) {if (rc) {this._output(" ");}this._openTag("strong");}return this._parseContent;},_handleEntities: function (qc) {if ("<" === qc) {this._output("&lt;");} else if (">" === qc) {this._output("&gt;");} else if ("&" === qc) {this._output("&amp;");} else {return false;}return true;},_escapeChar: "",_escapeCount: 0,_parseEscape: function (qc) {var rc = this._escapeChar, sc;if (qc === rc) {sc = ++this._escapeCount;if ("-" === rc && 3 === sc) {this._output("&mdash;");return this._parseContent;}} else {sc = this._escapeCount + 1;while (--sc) {this._output(rc);}this._setParserState(this._parseContent);return this._parseContent(qc);}},_parseContent: function (qc) {if (this._handleEntities(qc)) {return;}if ("*" === qc) {return this._parseItalic;} else if ("`" === qc) {this._toggleTag("code");return;} else if ("[" === qc) {this._linkState = 0;this._linkText = [];this._linkUrl = [];return this._parseLink;} else if ("-" === qc) {this._escapeCount = 1;this._escapeChar = "-";return this._parseEscape;} else if ("\n" === qc) {return null;} else {this._output(qc);}},_parseItalic: function (qc) {if ("*" === qc) {this._toggleTag("strong");} else {this._toggleTag("em");this._output(qc);}return this._parseContent;},_parseText: function (qc) {if (this._handleEntities(qc)) {return;}if ("\n" === qc) {this._closeTags();return null;} else {this._output(qc);}},_linkText: [],_linkUrl: [],_linkState: 0,_parseLink: function (qc) {var rc = this._linkState;if ("]" === qc && 0 === rc) {++this._linkState;} else if ("(" === qc && 1 === rc) {++this._linkState;} else if (")" === qc && 2 === rc) {this._output("<a href=\"");this._output(this._linkUrl.join(""));this._output("\">");this._output(this._linkText.join(""));this._output("</a>");return this._parseContent;} else if (0 === rc) {this._linkText.push(qc);} else if (2 === rc) {this._linkUrl.push(qc);}}}});gpf.define("gpf.html.File", {"[Class]": [gpf.$InterfaceImplement(gpf.interfaces.ITextStream)],public: {constructor: function (qc) {this._file = qc;},name: function () {return this._file.name;},size: function () {return this._file.size;},read: function (qc, rc) {var sc = this, tc = this._reader, uc = this._file.size - this._pos, vc;if (0 === uc) {gpf.defer(gpf.events.fire, 0, this, [pc.IReadableStream.EVENT_END_OF_STREAM,rc]);return;}this._eventsHandler = rc;if (null === tc) {tc = this._reader = new FileReader;tc.onloadend = function (wc) {sc._onLoadEnd(wc);};}if (0 === qc || qc > uc) {qc = uc;}vc = this._file.slice(this._pos, qc);this._pos += qc;tc.readAsArrayBuffer(vc);}},private: {_file: null,_reader: null,_pos: 0,_eventsHandler: null,_onLoadEnd: function (qc) {var rc = qc.target, sc, tc, uc, vc;gpf.ASSERT(rc === this._reader);if (rc.error) {gpf.events.fire.apply(this, [pc.IReadableStream.ERROR,{ error: {name: rc.error.name,message: rc.error.message} },this._eventsHandler]);} else if (rc.readyState === FileReader.DONE) {sc = new Int8Array(rc.result);tc = sc.length;uc = [];for (vc = 0; vc < tc; ++vc) {uc.push(sc[vc]);}gpf.events.fire.apply(this, [pc.IReadableStream.EVENT_DATA,{ buffer: uc },this._eventsHandler]);}}}});var qc = gpf.interfaces, rc = gpf.attributes;;gpf.xml = {};gpf._defIntrf("IXmlSerializable", { toXml: function (sc, tc) {qc.ignoreParameter(sc);qc.ignoreParameter(tc);} });gpf._defIntrf("IXmlContentHandler", {characters: function (sc, tc) {qc.ignoreParameter(sc);qc.ignoreParameter(tc);},endDocument: function (sc) {qc.ignoreParameter(sc);},endElement: function (sc) {qc.ignoreParameter(sc);},endPrefixMapping: function (sc) {qc.ignoreParameter(sc);},ignorableWhitespace: function (sc, tc) {qc.ignoreParameter(sc);qc.ignoreParameter(tc);},processingInstruction: function (sc, tc, uc) {qc.ignoreParameter(sc);qc.ignoreParameter(tc);qc.ignoreParameter(uc);},setDocumentLocator: function (sc) {qc.ignoreParameter(sc);},skippedEntity: function (sc) {qc.ignoreParameter(sc);},startDocument: function (sc) {qc.ignoreParameter(sc);},startElement: function (sc, tc, uc, vc, wc) {qc.ignoreParameter(sc);qc.ignoreParameter(tc);qc.ignoreParameter(uc);qc.ignoreParameter(vc);qc.ignoreParameter(wc);},startPrefixMapping: function (sc, tc) {qc.ignoreParameter(sc);qc.ignoreParameter(tc);}});var sc = gpf._defAttr("XmlAttribute", { alterPrototype: function (Gc) {if (undefined === Gc.toXml) {rc.add(Gc.constructor, "Class", [gpf.$InterfaceImplement(qc.IXmlSerializable)]);Gc.toXml = Dc;rc.add(Gc.constructor, "Class", [gpf.$InterfaceImplement(qc.IXmlContentHandler, Fc)]);}} }), tc = gpf._defAttr("$XmlIgnore", sc, {}), uc = gpf._defAttr("$XmlAttribute", sc, {"[_name]": [gpf.$ClassProperty()],_name: "",constructor: function (Gc) {gpf.ASSERT(gpf.xml.isValidName(Gc), "Valid XML attribute name");this._name = Gc;}}), vc = gpf._defAttr("XmlRawElementAttribute", sc, {"[_name]": [gpf.$ClassProperty()],_name: "",constructor: function (Gc) {gpf.ASSERT(gpf.xml.isValidName(Gc), "Valid XML element name");this._name = Gc;}}), wc = gpf._defAttr("$XmlElement", vc, {"[_objClass]": [gpf.$ClassProperty()],_objClass: null,constructor: function (Gc, Hc) {this._baseConstructor(Gc);if (Hc) {this._objClass = Hc;}}}), xc = gpf._defAttr("$XmlList", vc, {}), yc = function (Gc, Hc) {var Ic, Jc, Kc = null, Lc = null, Mc;for (Ic = 0; Ic < Gc.length(); ++Ic) {Jc = Gc.get(Ic);if (!(Jc instanceof wc)) {continue;}Mc = Jc.objClass();if (Mc) {if (Hc instanceof Mc) {if (!Lc || Mc.prototype instanceof Lc.objClass()) {Lc = Jc;}}} else if (!Kc) {Kc = Jc;}}if (null !== Lc) {return Lc;} else {return Kc;}}, zc = function (Gc, Hc, Ic, Jc) {var Kc;if (Hc instanceof Array || Jc.has(xc) || "object" === Ic || Jc.has(wc)) {return "";}Kc = Jc.has(uc);if (Kc && Kc.name()) {Gc = Kc.name();} else {if ("_" === Gc.charAt(0)) {Gc = Gc.substr(1);}}return Gc;}, Ac = function (Gc, Hc, Ic, Jc) {var Kc, Lc, Mc, Nc, Oc, Pc, Qc, Rc;Kc = Gc[Hc];if (Kc instanceof Date) {Kc = gpf.dateToComparableFormat(Kc, true);}Lc = Jc.member(Hc);if ("_" === Hc.charAt(0)) {Hc = Hc.substr(1);}Mc = Lc.has(xc);if (Kc instanceof Array || Mc) {if (Mc && Mc.name()) {Nc = true;Ic.startElement("", Mc.name());}Lc = Lc.filter(wc);for (Oc = 0; Oc < Kc.length; ++Oc) {Pc = Kc[Oc];Qc = yc(Lc, Pc);if (Qc && Qc.name()) {Rc = Qc.name();} else {Rc = "item";}Cc(Pc, Ic, Rc);}if (Nc) {Ic.endElement();}return;}Mc = Lc.has(wc);if (Mc && Mc.name()) {Rc = Mc.name();}Cc(Kc, Ic, Rc);}, Bc = function (Gc, Hc, Ic, Jc) {var Kc, Lc, Mc, Nc, Oc, Pc = 0, Qc = 0, Rc;for (Lc in Gc.constructor.prototype) {Mc = Gc[Lc];if (Mc instanceof Date) {Mc = gpf.dateToComparableFormat(Mc, true);}Nc = typeof Mc;if ("function" === Nc) {continue;}Kc = Jc.member(Lc);if (Kc.has(tc)) {continue;}Oc = zc(Lc, Mc, Nc, Kc);if (Oc) {if (0 === Qc) {Qc = {};}Qc[Oc] = Mc.toString();} else {if (0 === Pc) {Pc = [];}Pc.push(Lc);}}Hc.startElement("", Ic, Ic, Qc);if (Pc) {for (Rc = 0; Rc < Pc.length; ++Rc) {Ac(Gc, Pc[Rc], Hc, Jc);}}}, Cc = function (Gc, Hc, Ic) {var Jc = new rc.Map(Gc).filter(sc), Kc;if (!Ic) {Kc = Jc.member("Class").has(wc);if (Kc) {Ic = Kc.name();} else {Ic = gpf.classDef(Gc.constructor).name();if (!Ic) {Ic = "object";}}}if ("object" !== typeof Gc) {Hc.startElement("", Ic);Hc.characters(gpf.value(Gc, ""));} else {Bc(Gc, Hc, Ic, Jc);}Hc.endElement();}, Dc = function (Gc) {Cc(this, qc.query(Gc, qc.IXmlContentHandler, true));}, Ec = gpf.define("FromXmlContentHandler", {"[Class]": [gpf.$InterfaceImplement(qc.IXmlContentHandler)],_target: null,_firstElement: true,_forward: [],constructor: function (Gc) {this._target = Gc;this._firstElement = true;this._forward = [];},_fillFromAttributes: function (Gc) {var Hc = new rc.Map(this._target), Ic = this._target.constructor.prototype, Jc, Kc, Lc;for (Jc in Ic) {if ("function" === typeof Ic[Jc]) {continue;}Kc = Hc.member(Jc).filter(uc);if (0 < Kc.length()) {gpf.ASSERT(Kc.length() === 1);Lc = Kc.get(0).name();} else {if (Jc.charAt(0) === "_") {Lc = Jc.substr(1);} else {continue;}}if (Lc in Gc) {this._target[Jc] = gpf.value(Gc[Lc], Ic[Jc]);}}},_fillFromElement: function (Gc, Hc, Ic, Jc) {var Kc = new rc.Map(this._target).filter(vc), Lc = this._forward[0], Mc, Nc, Oc, Pc, Qc, Rc;gpf.interfaces.ignoreParameter(Gc);gpf.interfaces.ignoreParameter(Ic);gpf.interfaces.ignoreParameter(Jc);if (undefined === Lc) {Mc = Kc.members();} else {gpf.ASSERT(Lc.type !== 0, "No content handler here");Mc = [Lc.member];}for (Nc = 0; Nc < Mc.length; ++Nc) {Oc = Mc[Nc];Pc = Kc.member(Oc);for (Qc = 0; Qc < Pc.length(); ++Qc) {Rc = Pc.get(Qc);if (Rc.name() === Hc) {if (this._fillFromRawElement(Oc, Rc)) {return;}}}}},_fillFromRawElement: function (Gc, Hc) {var Ic, Jc;if (Hc instanceof wc) {if (Hc.objClass()) {Ic = new (Hc.objClass());this._target[Gc] = Ic;Jc = qc.query(Ic, qc.IXmlContentHandler);}if (Jc) {Jc = {type: 0,iXCH: Jc};} else {Jc = {type: 1,member: Gc,buffer: []};}} else if (Hc instanceof xc) {this._target[Gc] = [];Jc = {type: 2,member: Gc};}if (Jc) {Jc.depth = 1;this._forward.unshift(Jc);return true;} else {return false;}},characters: function (Gc) {var Hc = this._forward[0];if (undefined !== Hc) {if (0 === Hc.type) {Hc.iXCH.characters.apply(Hc.iXCH, arguments);} else if (1 === Hc.type) {Hc.buffer.push(Gc);}}},endDocument: function () {},endElement: function () {var Gc = this._forward[0], Hc, Ic;if (undefined !== Gc) {if (0 === Gc.type) {Gc.iXCH.endElement.apply(Gc.iXCH, arguments);} else if (1 === Gc.type) {Hc = this._target[Gc.member];Ic = Gc.buffer.join("");if (Hc instanceof Array) {Hc.push(Ic);} else {this._target[Gc.member] = gpf.value(Ic, Hc);}}if (0 === --Gc.depth) {this._forward.shift();}}},endPrefixMapping: function (Gc) {qc.ignoreParameter(Gc);},ignorableWhitespace: function (Gc) {qc.ignoreParameter(Gc);},processingInstruction: function (Gc, Hc) {qc.ignoreParameter(Gc);qc.ignoreParameter(Hc);},setDocumentLocator: function (Gc) {qc.ignoreParameter(Gc);},skippedEntity: function (Gc) {qc.ignoreParameter(Gc);},startDocument: function () {},startElement: function (Gc, Hc, Ic, Jc) {var Kc = this._forward[0];gpf.interfaces.ignoreParameter(Gc);gpf.interfaces.ignoreParameter(Hc);gpf.interfaces.ignoreParameter(Ic);if (undefined !== Kc) {if (0 === Kc.type) {++Kc.depth;Kc.iXCH.startElement.apply(Kc.iXCH, arguments);} else {this._fillFromElement.apply(this, arguments);}} else if (this._firstElement) {this._firstElement = false;this._fillFromAttributes(Jc);} else {this._fillFromElement.apply(this, arguments);}},startPrefixMapping: function (Gc, Hc) {qc.ignoreParameter(Gc);qc.ignoreParameter(Hc);}}), Fc = function (Gc) {return new Ec(Gc);};gpf.define("gpf.xml.Writer", {"[Class]": [gpf.$InterfaceImplement(qc.IXmlContentHandler)],_stream: null,_branch: [],_pendingPrefixMappings: [],constructor: function (Gc) {this._stream = Gc;this._branch = [];this._pendingPrefixMappings = [];},_closeLeafForContent: function () {var Gc;if (this._branch.length) {Gc = this._branch[this._branch.length - 1];if (!Gc.hasContent) {this._stream.write(">");Gc.hasContent = true;}}},characters: function (Gc) {this._closeLeafForContent();this._stream.write(Gc);},endDocument: function () {},endElement: function () {var Gc = this._branch.pop(), Hc = this._stream;if (Gc.hasContent) {Hc.write("</");Hc.write(Gc.qName);Hc.write(">");} else {Hc.write("/>");}},endPrefixMapping: function (Gc) {gpf.interfaces.ignoreParameter(Gc);},ignorableWhitespace: function (Gc) {this._closeLeafForContent();this._stream.write(Gc);},processingInstruction: function (Gc, Hc) {var Ic = this._stream;Ic.write("<?");Ic.write(Gc);Ic.write(" ");Ic.write(gpf.escapeFor(Hc, "xml"));Ic.write("?>");},setDocumentLocator: function (Gc) {gpf.interfaces.ignoreParameter(Gc);},skippedEntity: function (Gc) {gpf.interfaces.ignoreParameter(Gc);},startDocument: function () {},startElement: function (Gc, Hc, Ic, Jc) {var Kc, Lc, Mc, Nc = this._stream;if (undefined === Ic && !Gc) {Ic = Hc;}this._closeLeafForContent();var Oc = {hasContent: false,qName: Ic};this._branch.push(Oc);Nc.write("<");Nc.write(Ic);if (Jc) {for (Kc in Jc) {if (Jc.hasOwnProperty(Kc)) {Nc.write(" ");Nc.write(Kc);Nc.write("=\"");Lc = gpf.escapeFor(Jc[Kc].toString(), "xml");if (-1 < Lc.indexOf("\"")) {Lc = gpf.replaceEx(Lc, { "\"": "&quot;" });}Nc.write(Lc);Nc.write("\"");}}}if (this._pendingPrefixMappings.length) {for (Mc = 0; Mc < this._pendingPrefixMappings.length; ++Mc) {Nc.write(" ");Nc.write(this._pendingPrefixMappings);}this._pendingPrefixMappings = [];}},startPrefixMapping: function (Gc, Hc) {var Ic = ["xmlns:",Gc,":\"",gpf.escapeFor(Hc, "xml"),"\""].join(""), Jc = this._branch[this._branch.length], Kc = this._stream;if (Jc.hasContent) {this._pendingPrefixMappings.push(Ic);} else {Kc.write(" ");Kc.write(Ic);}}});gpf.xml.convert = function (Gc, Hc) {var Ic, Jc;Ic = qc.query(Hc, qc.IXmlContentHandler, true);if ("string" === typeof Gc) {gpf.NOT_IMPLEMENTED();} else if ("object" === typeof Gc) {Jc = qc.query(Gc, qc.IXmlSerializable);if (null !== Jc) {Jc.toXml(Ic);} else {new gpf.xml.ConstNode(Gc).toXml(Ic);}}};var Gc = gpf._alpha + gpf._ALPHA + "_", Hc = Gc + "012345789.-";gpf.extend(gpf.xml, {isValidName: function (Ic) {var Jc;if (0 === Ic.length || -1 === Gc.indexOf(Ic.charAt(0))) {return false;}for (Jc = 1; Jc < Ic.length; ++Jc) {if (-1 === Hc.indexOf(Ic.charAt(Jc))) {return false;}}return true;},toValidName: function (Ic) {var Jc;if (gpf.xml.isValidName(Ic)) {return Ic;}Jc = "_" + Ic;if (!gpf.xml.isValidName(Jc)) {throw { message: "Invalid name" };}return Jc;}});var Ic = gpf.interfaces;gpf.extend(gpf.xml, {NODE_INVALID: 0,NODE_ELEMENT: 1,NODE_ATTRIBUTE: 2,NODE_TEXT: 3,NODE_ENTITY_REFERENCE: 5,NODE_PROCESSING_INSTRUCTION: 7,NODE_COMMENT: 8,NODE_DOCUMENT: 9});gpf._defIntrf("IXmlConstNode", {attributes: function (Jc) {gpf.interfaces.ignoreParameter(Jc);return "";},children: function (Jc) {if (undefined === Jc) {return [];} else {return undefined;}},localName: function () {return "";},namespaceURI: function () {return "";},nextSibling: function () {return null;},nodeName: function () {return "";},nodeType: function () {return 0;},nodeValue: function () {return null;},ownerDocument: function () {return null;},parentNode: function () {return null;},prefix: function () {return "";},previousSibling: function () {return null;},textContent: function () {return "";}});gpf.define("gpf.xml.ConstNode", {"[Class]": [gpf.$InterfaceImplement(Ic.IXmlConstNode),gpf.$InterfaceImplement(Ic.IXmlSerializable)],_obj: null,_name: "",_parentNode: null,_attributes: {},_elements: {},_children: [],constructor: function (Jc, Kc) {this._obj = Jc;this._attributes = null;this._elements = null;this._children = null;if (undefined === Kc) {this._name = "root";} else {this._name = Kc;}},_members: function () {var Jc, Kc, Lc;this._attributes = {};this._elements = {};if ("object" === typeof this._obj && !(this._obj instanceof Array)) {for (Jc in this._obj) {if (this._obj.hasOwnProperty(Jc)) {Kc = this._obj[Jc];if (null === Kc) {continue;}Lc = gpf.xml.toValidName(Jc);if ("object" === typeof Kc) {this._elements[Jc] = Lc;} else {this._attributes[Jc] = Lc;}}}}},attributes: function (Jc) {var Kc, Lc, Mc;if (null === this._attributes) {this._members();}if (undefined === Jc) {Kc = {};for (Lc in this._attributes) {if (this._attributes.hasOwnProperty(Lc)) {Mc = this._attributes[Lc];Kc[Mc] = this._obj[Lc];}}return Kc;}for (Lc in this._attributes) {if (this._attributes.hasOwnProperty(Lc)) {if (Jc === this._attributes[Lc]) {return this._obj[Lc];}}}return undefined;},children: function (Jc) {var Kc, Lc, Mc, Nc;if (null === this._children) {if (null === this._elements) {this._members();}this._children = [];if (this._obj instanceof Array) {for (Kc = 0; Kc < this._obj.length; ++Kc) {Lc = new gpf.xml.ConstNode(this._obj[Kc], "item");Lc._parentNode = this;this._children.push(Lc);}} else {for (Mc in this._elements) {if (this._elements.hasOwnProperty(Mc)) {Nc = this._elements[Mc];Lc = new gpf.xml.ConstNode(this._obj[Mc], Nc);Lc._parentNode = this;this._children.push(Lc);}}}}return gpf.arrayOrItem(this._children, Jc);},localName: function () {return this._name;},namespaceURI: function () {return "";},nextSibling: function () {var Jc;if (null !== this._parentNode) {Jc = gpf.test(this._parentNode._children, this);if (undefined !== Jc && Jc < this._parentNode._children.length - 1) {return this._parentNode._children[Jc + 1];}}return null;},nodeName: function () {return this._name;},nodeType: function () {return gpf.xml.NODE_ELEMENT;},nodeValue: function () {return this._obj;},ownerDocument: function () {return null;},parentNode: function () {return this._parentNode;},prefix: function () {return "";},previousSibling: function () {var Jc;if (null !== this._parentNode) {Jc = gpf.test(this._parentNode._children, this);if (0 < Jc) {return this._parentNode._children[Jc - 1];}}return null;},textContent: function () {if ("object" !== typeof this._obj) {return gpf.value(this._obj, "");} else {return "";}},toXml: function (Jc) {gpf.xml.nodeToXml(this, Jc);}});gpf.xml.nodeToXml = function (Jc, Kc) {var Lc = Jc.localName(), Mc = Jc.attributes(), Nc = Jc.children(), Oc = Jc.textContent(), Pc;Kc.startElement("", Lc, Lc, Mc);if (Oc) {Kc.characters(Oc);} else {for (Pc = 0; Pc < Nc.length; ++Pc) {gpf.xml.nodeToXml(Nc[Pc], Kc);}}Kc.endElement();};function Jc(Pc, Qc, Rc, Sc) {var Tc, Uc;for (Tc = 0; Tc < Pc.length; ++Tc) {Uc = Pc[Tc];Qc(Uc, Rc, Sc);}}function Kc(Pc, Qc, Rc) {var Sc = Pc.children(), Tc, Uc, Vc;for (Uc = 0; Uc < Sc.length; ++Uc) {Vc = true;Tc = Sc[Uc];if (Qc.name && Tc.localName() !== Qc.name) {Vc = false;} else if (Qc.text && Tc.textContent() !== Qc.text) {Vc = false;}if (Vc) {Rc.push(Tc);}if (undefined !== Qc.relative && !Qc.relative) {Kc(Tc, Qc, Rc);}}}function Lc(Pc, Qc, Rc) {var Sc, Tc, Uc;if (Qc.name) {Uc = Pc.attributes(Qc.name);if (undefined !== Uc && (!Qc.text || Uc === Qc.text)) {Rc.push(Pc);}} else {Sc = Pc.attributes();for (Tc in Sc) {if (Sc.hasOwnProperty(Tc)) {Uc = Sc[Tc];if (!Qc.text || Uc === Qc.text) {Rc.push(Pc);break;}}}}}function Mc(Pc, Qc, Rc) {if (gpf.xml.NODE_ELEMENT === Qc.type) {Jc(Pc, Kc, Qc, Rc);} else if (gpf.xml.NODE_ATTRIBUTE === Qc.type) {Jc(Pc, Lc, Qc, Rc);}}function Nc(Pc, Qc, Rc) {var Sc, Tc, Uc, Vc, Wc;if (Qc.and) {Tc = Qc.and;Uc = 0;} else if (Qc.or) {Tc = Qc.or;Uc = 1;}for (Vc = 0; Vc < Tc.length; ++Vc) {Wc = Tc[Vc];if (Wc.and || Wc.or) {Sc = [];Nc(Pc, Wc, Sc);} else {Sc = Oc(Pc, Wc);}if (0 === Uc && Sc.length === 0) {return;}if (1 === Uc && Sc.length !== 0) {Rc.push(Pc);return;}}if (0 === Uc) {Rc.push(Pc);}}function Oc(Pc, Qc) {var Rc, Sc = [Pc];while (Qc) {Rc = [];Mc(Sc, Qc, Rc);if (0 === Rc.length) {return [];}Sc = Rc;if (Qc.filter) {Rc = [];Jc(Sc, Nc, Qc.filter, Rc);if (0 === Rc.length) {return [];}Sc = Rc;}Qc = Qc.then;}return Rc;}gpf.define("gpf.xml.XPath", {_xpath: null,constructor: function (Pc) {this._reset();if ("string" === typeof Pc) {this._xpath = this._compile(Pc);} else {this._xpath = Pc;}},_reset: function () {},_compile: function (Pc) {gpf.interfaces.ignoreParameter(Pc);this._xpath = null;},selectNodes: function (Pc) {return Oc(Pc, this._xpath);}});}));