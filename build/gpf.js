
(function(a,b){"use strict";if(typeof define==="function"&&define.amd){define(["exports"],b);}else if(typeof exports!=="undefined"){b(exports);}else{b(a.gpf={});}}(this,function(a){"use strict";var a,b;if("undefined"!==typeof WScript){a="wscript";b=function(){return this;}.apply(null,[]);b.console={log:function(c){WScript.Echo("    "+c);},info:function(c){WScript.Echo("[?] "+c);},warn:function(c){WScript.Echo("/!\\ "+c);},error:function(c){WScript.Echo("(X) "+c);}};}else if("undefined"!==typeof module&&module.exports){a="nodejs";b=global;}else if("undefined"!==typeof window){a="browser";b=window;}else{a="unknown";b=this;}gpf.host=function(){return a;};gpf.context=function(c){var d,e,f;if(undefined===c){return b;}else{if("string"===typeof c){c=c.split(".");}d=c.length;e=0;if(c[0]==="gpf"){f=gpf;++e;}else{f=b;}for(;e<d;++e){f=f[c[e]];if(undefined===f){break;}}return f;}};gpf.loaded=function(c){if(c){c();}return true;};gpf.ASSERT=function(){};(function(){"use strict";if(undefined===Array.prototype.indexOf){Array.prototype.indexOf=function(c){var d=this.length;while(d--){if(this[d]===c){return d;}}return-1;};}if(undefined===Object.defineProperty){gpf.setReadOnlyProperty=function(c,d,e){c[d]=e;return c;};}else{gpf.setReadOnlyProperty=function(c,d,e){Object.defineProperty(c,d,{enumerable:true,configurable:false,writable:false,value:e});return c;};}}());var c=function(p,q,r){var s,t=p.length,u;for(u=0;u<t;++u){s=q.apply(this,[u,p[u]]);if(undefined!==s){return s;}}return r;},d=function(p,q){var r=p.length,s;for(s=0;s<r;++s){q.apply(this,[s,p[s]]);}},e=function(p,q,r){var s,t;for(t in p){if(p.hasOwnProperty(t)){s=q.apply(this,[t,p[t]]);if(undefined!==s){return s;}}}return r;},f=function(p,q){var r;for(r in p){if(p.hasOwnProperty(r)){q.apply(this,[r,p[r]]);}}},g=function(p,q){this[0][p]=q;},h=function(p,q){var r=this[0],s=this[2];if(undefined!==r[p]){s(r,p,q);}else{r[p]=q;}},i=function(p,q,r){var s,t,u,v=p.length;for(s=0;s<v;++s){t=p[s].a;u=p[s].b;if(t===q&&u===r||u===q&&t===r){return s;}}return undefined;},j=function(p,q,r){if(r&&("object"===typeof p||"object"===typeof q)){if(p instanceof String||q instanceof String){return p.toString()===q.toString();}if(p instanceof Number||q instanceof Number){return p.valueOf()===q.valueOf();}return false;}return false;},k=function(p,q,r,s){if(p!==q){if(typeof p!==typeof q&&!j(p,q,r)){return false;}if(null===p||null===q||"object"!==typeof p){return false;}if(undefined===i(s.done,p,q)){s.todo.push(p);s.todo.push(q);}}return true;},l=function(p,q,r){var s,t,u={todo:[p,q],done:[]};while(0!==u.todo.length){q=u.todo.pop();p=u.todo.pop();if(p.prototype!==q.prototype){return false;}u.done.push({a:p,b:q});t=0;for(s in p){if(p.hasOwnProperty(s)){++t;if(!k(p[s],q[s],r,u)){return false;}}}for(s in q){if(q.hasOwnProperty(s)){--t;}}if(0!==t){return false;}}return true;},m={boolean:function(p,q,r){if("string"===q){if("yes"===p||"true"===p){return true;}return 0!==parseInt(p,10);}if("number"===q){return 0!==p;}return r;},number:function(p,q,r){if("string"===q){return parseFloat(p);}return r;},string:function(p,q,r){gpf.interfaces.ignoreParameter(q);gpf.interfaces.ignoreParameter(r);if(p instanceof Date){return gpf.dateToComparableFormat(p);}return p.toString();},object:function(p,q,r){if(r instanceof Date&&"string"===q){return gpf.dateFromComparableFormat(p);}return r;}},n=Function,o=function(){return undefined;};gpf.each=function(p,q,r){if(undefined===r){if(p instanceof Array){d.apply(this,arguments);}else{f.apply(this,arguments);}return undefined;}if(p instanceof Array){return c.apply(this,arguments);}return e.apply(this,arguments);};gpf.extend=function(p,q,r){var s;if(undefined===r){s=g;}else{s=h;}gpf.each.apply(arguments,[q,s]);return p;};gpf.extend(gpf,{_alpha:"abcdefghijklmnopqrstuvwxyz",_ALPHA:"ABCDEFGHIJKLMNOPQRSTUVWXYZ",_digit:"0123456789",_func:function(p){return new n(p);},emptyFunction:function(){return o;},value:function(p,q,r){var s=typeof p;if(!r){r=typeof q;}if(r===s){return p;}if("undefined"===s||!p){return q;}return m[r](p,s,q);},like:function(p,q,r){if(p===q){return true;}if(typeof p!==typeof q){return j(p,q,r);}if(null===p||null===q||"object"!==typeof p){return false;}return l(p,q,r);},clone:function(p){return gpf.json.parse(gpf.json.stringify(p));},test:function(p,q){var r;if(p instanceof Array){r=p.length;while(r>0){if(p[--r]===q){return r;}}}else{for(r in p){if(p.hasOwnProperty(r)&&p[r]===q){return r;}}}return undefined;},set:function(p,q){gpf.ASSERT(p instanceof Array,"gpf.set must be used with an Array");var r=p.length;while(r>0){if(p[--r]===q){return p;}}p.push(q);return p;},clear:function(p,q){var r;if(p instanceof Array){r=p.length;while(r>0){if(p[--r]===q){p.splice(r,1);break;}}}else{for(r in p){if(p.hasOwnProperty(r)&&p[r]===q){break;}}}return p;},xor:function(p,q){return p&&!q||!p&&q;},capitalize:function(p){return p.charAt(0).toUpperCase()+p.substr(1);},Callback:function(p,q){if(p){this._handler=p;}if(q){this._scope=q;}}});gpf.extend(gpf.Callback.prototype,{_handler:gpf._func(""),_scope:null,handler:function(){return this._handler;},scope:function(){return this._scope;},call:function(){var p=arguments[0],q=[],r=arguments.length,s;for(s=1;s<r;++s){q.push(arguments[s]);}return this.apply(p,q);},apply:function(p,q){var r=gpf.Callback.resolveScope(this._scope||p);return this._handler.apply(r,q||[]);}});gpf.extend(gpf.Callback,{resolveScope:function(p){if(null===p||undefined===p){p=gpf.context();}return p;},buildParamArray:function(p,q){var r,s,t;if(q){r=q.length;s=new Array(p+r);for(t=0;t<r;++t){s[p]=q[t];++p;}}else{s=new Array(p);}return s;},doApply:function(p,q,r){var s=arguments.length,t=3,u=0;while(t<s){r[u]=arguments[t];++t;++u;}return p.apply(q,r);},bind:function(p,q){gpf.ASSERT("string"===typeof q,"Provide method name");var r=q+":boundToThis";gpf.ASSERT("function"===typeof p[q],"Only methods can be bound");if(undefined===p[r]){p[r]=function(){return p[q].apply(p,arguments);};}return p[r];}});var p=function(t){var u,v,w;this._listeners={};if(undefined!==t){this._events=t;v=t.length;for(u=0;u<v;++u){w=t[u];this["on"+w.charAt(0).toUpperCase()+w.substr(1)]=this._onEVENT(u);this._listeners[w]=[];}}},q=function(t){return function(){var u=[this._events[t]],v=arguments.length,w;for(w=0;w<v;++w){u.push(arguments[w]);}return this.addEventListener.apply(this,u);};},r=function(){p.apply(this,arguments);},s=function(t,u,v,w){this._type=t;if(undefined!==u){this._params=u;}if(v){this._cancelable=true;}if(w){this._scope=w;}};gpf.extend(p.prototype,{_listeners:{},_events:null,_onEVENT:function(t){var u=r.prototype._onEVENT.closures,v;if(!u){u=r.prototype._onEVENT.closures=[];}gpf.ASSERT(u.length>=t,"calls must be sequential");while(u.length<=t){v=u.length;u.push(q(v));}return u[t];},addEventListener:function(t,u,v,w){var x=this._listeners;if("boolean"===typeof v){w=v;v=undefined;}else{if(!v){v=null;}if(!w){w=false;}}if(u instanceof gpf.Callback){if(v&&v!==u.scope()){u=u.handler();}}if(!(u instanceof gpf.Callback)){u=new gpf.Callback(u,v);}if(undefined===x[t]){x[t]=[];}if(w){x[t].unshift(u);}else{x[t].push(u);}return this;},removeEventListener:function(t,u,v){var w=this._listeners[t],x,y;if(undefined!==w){if(u instanceof gpf.Callback){if(!v){v=u.scope();}u=u.handler();}y=w.length;while(y>0){x=w[--y];if(x.handler()===u&&x.scope()===v){w.splice(y,1);break;}}}return this;},_broadcastEvent:function(t,u){var v,w,x;if(t instanceof s){w=t.type();}else{w=t;}x=this._listeners[w];if(undefined===x){return this;}if(t instanceof s){for(v=0;v<x.length;++v){x[v].apply(t._scope,[t]);if(t._propagationStopped){break;}}}else{for(v=0;v<x.length;++v){x[v].apply(null,[t,u]);}}return this;}});r.prototype=new p;gpf.extend(r.prototype,{broadcastEvent:function(){return this._broadcastEvent.apply(this,arguments);}});gpf.extend(s.prototype,{_type:"",_params:{},_cancelable:false,_propagationStopped:false,_defaultPrevented:false,_scope:null,type:function(){return this._type;},scope:function(){return gpf.Callback.resolveScope(this._scope);},cancelable:function(){return this._cancelable;},preventDefault:function(){this._defaultPrevented=true;},defaultPrevented:function(){return this._defaultPrevented;},stopPropagation:function(){this._propagationStopped=true;},get:function(t){return this._params[t];},fire:function(t){return gpf.events.fire(this,t);}});gpf.events={Target:p,Broadcaster:r,Event:s,fire:function(t,u,v){var w;if(undefined===v){v=u;u=undefined;}if(!(t instanceof s)){t=new gpf.events.Event(t,u,true,this);}w=gpf.Callback.resolveScope(t._scope);if(v instanceof p){v._broadcastEvent(t);}else if("function"===typeof v||v instanceof gpf.Callback){v.apply(w,[t]);}else{v=v[t.type()];if(undefined!==typeof v){v.apply(w,[t]);}}return t;}};var t=0,u={},v=function(y){var z=y.scriptTag,A=y.headTag;z.onerror=z.onload=z.onreadystatechange=null;if(A&&z.parentNode){A.removeChild(z);}delete u[y.id];},w=function(){var y=u[this.id];if(!y.done&&(!this.readyState||this.readyState==="loaded"||this.readyState==="complete")){setTimeout(function(){y.done=true;gpf.events.fire("load",{url:y.src},y.eventsHandler);},0);v(y);}},x=function(){var y=u[this.id];if(!y.done){y.done=true;gpf.events.fire("error",{url:y.src},y.eventsHandler);v(y);}};gpf.http={include:function(y,z){var A={src:y,id:"__gpf_http_"+ ++t,headTag:document.getElementsByTagName("head")[0]||document.documentElement,scriptTag:document.createElement("script"),done:false},B;if(undefined===z){z=new gpf.events.Broadcaster(["load","error"]);}A.eventsHandler=z;u[A.id]=A;B=A.scriptTag;B.language="javascript";B.src=y;B.id=A.id;B.onload=B.onreadystatechange=w;B.onerror=x;if(undefined!==B.async){B.async=true;}setTimeout(function(){A.headTag.insertBefore(B,A.headTag.firstChild);},0);}};var y=function(A,B,C){if(!B){B=null;}if(!C){C=[];}return function(){A.apply(gpf.Callback.resolveScope(B),C);};},z;if("wscript"===gpf.host()){gpf._asyncQueue=[];z=function(A,B){return A._dt-B._dt;};gpf.defer=function(A,B,C,D){var E=y(A,C,D);if(!B){B=0;}E._dt=new Date(new Date- -B);gpf._asyncQueue.push(E);gpf._asyncQueue.sort(z);};gpf.runAsyncQueue=function(){var A=gpf._asyncQueue,B;while(A.length){B=A.shift();if(B._dt>new Date){WScript.Sleep(B._dt-new Date);}B();}};}else{gpf.defer=function(A,B,C,D){if(!B){B=0;}setTimeout(y(A,C,D),B);};gpf.runAsyncQueue=function(){};}var A=gpf._ALPHA+gpf._alpha+gpf._digit+"+/",B="0123456789ABCDEF",C=function(E,F,G,H){var I=E.length,J=gpf.bin.isPow2(I),K,L,M=[],N;if(-1<J&&(undefined===G||G*J<=32)){if(undefined===G){K=32;}else{K=G*J;}L=(1<<K-J)-1;K=(1<<J)-1;while(0!==F){N=F&K;M.unshift(E.charAt(N));F=F>>J&L;}}else{while(0!==F){N=F%I;M.unshift(E.charAt(N));F=(F-N)/I;}}if(undefined!==G){if(undefined===H){H=E.charAt(0);}while(M.length<G){M.unshift(H.charAt(M.length%H.length));}}else if(0===M.length){M=[E.charAt(0)];}return M.join("");},D=function(E,F,G){var H=E.length,I=0,J=0;if(undefined===G){G=E.charAt(0);}while(J<F.length){if(-1===G.indexOf(F.charAt(J))){break;}else{++J;}}while(J<F.length){I=H*I+E.indexOf(F.charAt(J++));}return I;};gpf.bin={pow2:function(E){return 1<<E;},isPow2:function(E){if(0<E&&0===(E&E-1)){var F=0;while(1<E){++F;E>>=1;}return F;}else{return-1;}},toBaseANY:C,fromBaseANY:D,toHexa:function(E,F,G){return C(B,E,F,G);},fromHexa:function(E,F){return D(B,E,F);},toBase64:function(E,F,G){return C(A,E,F,G);},fromBase64:function(E,F){return D(A,E,F);},test:function(E,F){return(E&F)===F;},clear:function(E,F){return E&~F;}};gpf.json={};if("undefined"===typeof JSON){var E=function(G){var H,I,J,K;H=G instanceof Array;I=[];for(J in G){if("function"===typeof G[J]){continue;}K=F(G[J]);if(H){I.push(K);}else{I.push(J+": "+K);}}if(H){return"["+I.join(", ")+"]";}else{return"("+I.join(", ")+")";}},F=function(G){var H=typeof G;if("undefined"===H||"function"===H){return;}else if("number"===H||"boolean"===H){return G.toString();}else if("string"===H){return gpf.escapeFor(G,"javascript");}if(null===G){return"null";}else{return E(G);}};gpf.json.stringify=F;gpf.json.parse=function(G){return gpf._func("return "+G)();};}else{gpf.json.stringify=JSON.stringify;gpf.json.parse=JSON.parse;}var J="public|protected|private|static".split("|"),K=0,L=1,M=3,N=true,O=0,P=gpf._alpha+gpf._ALPHA+gpf._digit+"_",Q=function(S){var T;S=S.toString();T=S.indexOf("._super");if(-1===T){return false;}return-1===P.indexOf(S.charAt(T+7));},R=function(S,T){return function(){var U=this._super,V;this._super=S;V=T.apply(this,arguments);if(undefined===U){delete this._super;}else{this._super=U;}return V;};};gpf.ClassDefinition=function(S,T,U){this._uid=++O;this._Subs=[];if("function"===typeof S){this._Constructor=S;}else{this._name=S;this._Base=T;this._definition=U;this._build();}};gpf.extend(gpf.ClassDefinition.prototype,{_uid:0,uid:function(){return this._uid;},_name:"",name:function(){return this._name;},nameOnly:function(){var S=this._name,T=S.lastIndexOf(".");if(-1===T){return S;}else{return S.substr(T+1);}},_Base:Object,Base:function(){return this._Base;},_Subs:[],Subs:function(){return this._Subs;},_attributes:null,attributes:function(){if(!this._attributes){this._attributes=new gpf.attributes.Map;}return this._attributes;},_Constructor:function(){},_defConstructor:null,Constructor:function(){return this._Constructor;},_definition:null,addMember:function(S,T,U){var V=this._Constructor.prototype;gpf.ASSERT(S!=="constructor","No constructor can be added");gpf.ASSERT(undefined===V[S],"No member can be overridden");if(undefined===U){U=K;}else if("string"===typeof U){U=J.indexOf(U);if(-1===U){U=K;}}this._addMember(S,T,U);},_addMember:function(S,T,U){var V=this._Constructor.prototype;if(M===U){gpf.setReadOnlyProperty(V.constructor,S,T);}else{V[S]=T;}},_processMember:function(S,T){var U=this._definition[S],V=S==="constructor",W,X,Y;W=typeof U;if(M===T){this._addMember(S,U,M);return;}if(V){X=this._Base;}else{X=this._Base.prototype[S];}Y=typeof X;if("undefined"!==Y&&null!==X&&W!==Y){gpf.Error.ClassMemberOverloadWithTypeChange();}if("function"===W&&"undefined"!==Y&&Q(U)){U=R(X,U);}if(V){this._defConstructor=U;}else{this._addMember(S,U,T);}},_processAttribute:function(S){var T,U=this._definition[S];S=S.substr(1,S.length-2);if(!this._attributes){this._attributes={};}T=this._attributes[S];if(undefined===T){T=[];}this._attributes[S]=T.concat(U);},_processDefWithVisibility:function(S){var T=this._definition,U,V;V=J[S];U=T[V];this._definition=U;try{for(V in U){if(U.hasOwnProperty(V)){if("["===V.charAt(0)&&"]"===V.charAt(V.length-1)){this._processAttribute(V);}else if("public"===V||"private"===V||"protected"===V||"static"===V){gpf.Error.ClassInvalidVisibility();}else{this._processMember(V,S);}}}if("wscript"===gpf.host()&&U.constructor!==Object){this._processMember("constructor",S);}}catch(e){throw e;}finally{this._definition=T;}},_processDefinition:function(){var S=this._definition,T,U;for(T in S){if(S.hasOwnProperty(T)){if("["===T.charAt(0)&&"]"===T.charAt(T.length-1)){this._processAttribute(T);}else{U=J.indexOf(T);if(-1===U){if(T.charAt(0)==="_"){U=L;}else{U=K;}this._processMember(T,U);}else{this._processDefWithVisibility(U);}}}}if("wscript"===gpf.host()&&S.constructor!==Object){this._processMember("constructor",K);}},_processAttributes:function(){var S=this._attributes,T,U,V;if(S){delete this._attributes;T=this._Constructor;U=T.prototype;for(V in S){if(S.hasOwnProperty(V)){if(V in U||V==="Class"){gpf.attributes.add(T,V,S[V]);}else{console.error("gpf.define: Invalid attribute name '"+V+"'");}}}}},_build:function(){var S,T,U;S=gpf._func(I(this._name))(gpf);this._Constructor=S;S._gpf=this;N=false;T=new this._Base;N=true;S.prototype=T;T.constructor=S;U=gpf.classDef(this._Base);U.Subs().push(S);this._processDefinition();this._processAttributes();}});gpf.classDef=function(S){if(undefined===S._gpf){S._gpf=new gpf.ClassDefinition(S);}return S._gpf;};gpf._classInit=function(S,T){if(N){var U=gpf.classDef(S);if(U._defConstructor){U._defConstructor.apply(this,T);}else{U._Base.apply(this,T);}}};function G(){var S=arguments[0],T=_CONSTRUCTOR_=function(){S._classInit.apply(this,[T,arguments]);};return T;}function H(){var S=arguments[0],T=function _CONSTRUCTOR_(){S._classInit.apply(this,[T,arguments]);};return T;}function I(S){var T,U,V,W;if(-1<S.indexOf(".")){T=G;}else{T=H;}U=T.toString().replace("_CONSTRUCTOR_",S);V=U.indexOf("{")+1;W=U.lastIndexOf("}")-1;return U.substr(V,W-V+1);}gpf.define=function(S,T,U){var V,W,X,Y,Z;if("string"===typeof T){T=gpf.context(T);}else if("object"===typeof T){U=T;T=undefined;}if(undefined===T){T=Object;}if(-1<S.indexOf(".")){W=S.split(".");Y=W.pop();X=gpf.context(W);}Z=new gpf.ClassDefinition(S,T,U||{});V=Z.Constructor();if(undefined!==X){X[Y]=V;}return V;};gpf._genDefHandler=function(S,T){S=S+".";return function(U,V,W){var X;if(undefined===W&&"object"===typeof V){W=V;V=S+T;}else if(undefined===V){V=S+T;}if(-1===U.indexOf(".")){U=S+U;}X=gpf.define(U,V,W);return X;};};var T=0,U=gpf._genDefHandler("gpf.attributes","Attribute");gpf.attributes={};function S(V,W){W="$"+W;gpf[W]=function(){var X=gpf._func("return function "+W+"(args) {"+"this.constructor.apply(this, args);"+"};")();X.prototype=V.prototype;return function(){return new X(arguments);};}();}gpf._defAttr=function(V,W,X){var Y=V.charAt(0)==="$",Z,ab;if(Y){V=V.substr(1);Z=V+"Attribute";}else{Z=V;}ab=U(Z,W,X);if(Y){S(ab,V);}return ab;};gpf._defAttr("Attribute",{protected:{_member:"",_alterPrototype:function(V){gpf.interfaces.ignoreParameter(V);}},public:{member:function(){return this._member;}}});gpf._defAttr("$Alias",{private:{_name:""},protected:{_alterPrototype:function(V){S(V.constructor,this._name);}},public:{constructor:function(V){this._name=V;}}});gpf.define("gpf.attributes.Array",{private:{_array:[]},public:{constructor:function(){this._array=[];},has:function(V){gpf.ASSERT("function"===typeof V,"Expected a class parameter");gpf.ASSERT(V.prototype instanceof gpf.attributes.Attribute,"Expected an Attribute-like class parameter");var W,X=this._array,Y=X.length,Z;for(W=0;W<Y;++W){Z=X[W];if(Z instanceof V){return Z;}}return null;},filter:function(V){gpf.ASSERT("function"===typeof V,"Expected a class parameter");gpf.ASSERT(V.prototype instanceof gpf.attributes.Attribute,"Expected an Attribute-like class parameter");var W,X=this._array,Y=X.length,Z,ab=new gpf.attributes.Array,bb=ab._array;for(W=0;W<Y;++W){Z=X[W];if(Z instanceof V){bb.push(Z);}}return ab;},each:function(V,W,X){W=gpf.Callback.resolveScope(W);X=gpf.Callback.buildParamArray(1,X);var Y,Z=this._array,ab=Z.length,bb;for(Y=0;Y<ab;++Y){bb=gpf.Callback.doApply(V,W,X,Z[Y]);if(undefined!==bb){return bb;}}}}});gpf.define("gpf.attributes.Map",{private:{_members:{},_count:0,_copyTo:function(V,W,X){var Y=this._members,Z,ab,bb,cb;if(this._count){for(Z in Y){if(Y.hasOwnProperty(Z)){ab=Y[Z]._array;for(bb=0;bb<ab.length;++bb){cb=ab[bb];if(!W||W(Z,cb,X)){V.add(Z,cb);}}}}}},_filterCallback:function(V,W,X){gpf.interfaces.ignoreParameter(V);return W instanceof X;}},public:{constructor:function(V){this._members={};this._count=0;if(undefined!==V){this.fillFromObject(V);}},count:function(){return this._count;},add:function(V,W){var X=this._members[V];if(undefined===X){X=this._members[V]=new gpf.attributes.Array;}X._array.push(W);++this._count;},fillFromObject:function(V){return this.fillFromClassDef(gpf.classDef(V.constructor));},fillFromClassDef:function(V){var W;while(V){W=V.attributes();if(W){W._copyTo(this);}if(V.Base()!==Object){V=gpf.classDef(V.Base());}else{break;}}return this._count;},filter:function(V){gpf.ASSERT("function"===typeof V,"Expected a class parameter");gpf.ASSERT(V.prototype instanceof gpf.attributes.Attribute,"Expected an Attribute-like class parameter");var W=new gpf.attributes.Map;this._copyTo(W,this._filterCallback,V);return W;},member:function(V){var W=this._members[V];if(undefined===W){if(0===T){T=new gpf.attributes.Array;}W=T;}return W;},members:function(){var V=this._members,W=[],X;for(X in V){if(V.hasOwnProperty(X)){W.push(X);}}return W;},each:function(V,W,X){W=gpf.Callback.resolveScope(W);X=gpf.Callback.buildParamArray(2,X);var Y=this._members,Z,ab;for(Z in Y){if(Y.hasOwnProperty(Z)){ab=gpf.Callback.doApply(V,W,X,Z,Y[Z]);if(undefined!==ab){return ab;}}}},addTo:function(V){var W=this._members,X;for(X in W){if(W.hasOwnProperty(X)){gpf.attributes.add(V,X,W[X]);}}}}});gpf.attributes.add=function(V,W,X){var Y,Z,ab,bb;Y=gpf.classDef(V).attributes();Z=X.length;for(ab=0;ab<Z;++ab){bb=X[ab];bb._member=W;Y.add(W,bb);bb._alterPrototype(V.prototype);}};gpf.define("gpf.Error",{public:{code:0,name:"Error",message:""}});var V={"NotImplemented":"Not implemented","Abstract":"Abstract","AssertionFailed":"Assertion failed: {message}","ClassMemberOverloadWithTypeChange":"You can't overload a member to change its type","ClassInvalidVisibility":"Invalid visibility keyword","InterfaceExpected":"Expected interface not implemented: {name}","EnumerableInvalidMember":"$Enumerable can be associated to arrays only","PatternUnexpected":"Invalid syntax (unexpected)","PatternEmpty":"Empty pattern","PatternInvalidSyntax":"Invalid syntax","PatternEmptyGroup":"Syntax error (empty group)","HtmlHandlerMultiplicityError":"Too many $HtmlHandler attributes for '{member}'","HtmlHandlerMissing":"No $HtmlHandler attributes","HtmlHandlerNoDefault":"No default $HtmlHandler attribute","EngineStackUnderflow":"Stack underflow","EngineTypeCheck":"Type check","EncodingNotSupported":"Encoding not supported","EncodingEOFWithUnprocessedBytes":"Unexpected end of stream: unprocessed bytes","XmlInvalidName":"Invalid XML name"},W=function(Z,ab){return function(bb){var cb=new gpf.Error,db,eb;cb.code=Z;cb.name=ab;if(bb){db={};for(eb in bb){if(bb.hasOwnProperty(eb)){db["{"+eb+"}"]=bb[eb].toString();}}cb.message=gpf.replaceEx(V[ab],db);}else{cb.message=V[ab];}throw cb;};},name,code=0;for(name in V){if(V.hasOwnProperty(name)){++code;gpf.Error["CODE_"+name.toUpperCase()]=code;gpf.Error[name]=W(code,name);}}var Z=function(cb){return gpf._func("return this."+cb+";");},ab=function(cb){return gpf._func("var r = this."+cb+"; if (0 < arguments.length) { this."+cb+" = arguments[0]; } return r;");},bb=gpf._defAttr("ClassAttribute");gpf._defAttr("$ClassProperty",bb,{private:{_writeAllowed:false,_publicName:undefined,_visibility:undefined},protected:{_alterPrototype:function(cb){var db=this._member,eb=this._publicName,fb=gpf.classDef(cb.constructor),gb;if(!eb){eb=db.substr(1);}if(this._writeAllowed){gb=ab(db);}else{gb=Z(db);}fb.addMember(eb,gb,this._visibility);}},public:{constructor:function(cb,db,eb){if(cb){this._writeAllowed=true;}if("string"===typeof db){this._publicName=db;}if("string"===typeof eb){this._visibility=eb;}}}});gpf._defAttr("$ClassEventHandler",bb,{});gpf._defAttr("$ClassExtension",bb,{private:{_ofClass:gpf.emptyFunction(),_publicName:""},public:{constructor:function(cb,db){this._ofClass=cb;if("string"===typeof db){this._publicName=db;}}}});gpf.interfaces={isImplementedBy:function(eb,fb){var gb;for(gb in fb.prototype){if("constructor"===gb||"extend"===gb){continue;}if(typeof fb.prototype[gb]!==typeof eb[gb]){return false;}}return true;},query:function(eb,fb,gb){var hb=null;if(gpf.interfaces.isImplementedBy(eb,fb)){return eb;}else if(gpf.interfaces.isImplementedBy(eb,gpf.interfaces.IUnknown)){hb=eb.queryInterface(fb);}if(null===hb&&gb){gpf.Error.InterfaceExpected({name:gpf.classDef(fb).name()});}return hb;}};if(!gpf.interfaces.ignoreParameter){gpf.interfaces.ignoreParameter=function(){};}gpf._defIntrf=gpf._genDefHandler("gpf.interfaces","Interface");gpf._defIntrf("Interface");gpf._defIntrf("IEventTarget",{addEventListener:function(eb,fb,gb,hb){gpf.interfaces.ignoreParameter(eb);gpf.interfaces.ignoreParameter(fb);gpf.interfaces.ignoreParameter(gb);gpf.interfaces.ignoreParameter(hb);},removeEventListener:function(eb,fb,gb){gpf.interfaces.ignoreParameter(eb);gpf.interfaces.ignoreParameter(fb);gpf.interfaces.ignoreParameter(gb);}});gpf._defIntrf("IUnknown",{queryInterface:function(eb){gpf.interfaces.ignoreParameter(eb);return null;}});function cb(eb){var fb=new gpf.attributes.Map(this).member("Class").filter(gpf.attributes.InterfaceImplementAttribute),gb,hb;for(gb=0;gb<fb.length();++gb){hb=fb.get(gb);if(hb._interfaceDefinition===eb){if(hb._builder){return hb._builder(this);}break;}}return null;}function db(eb){return function(){var fb=cb.apply(this,arguments);if(null===fb){fb=eb.apply(this,arguments);}return fb;};}gpf._defAttr("$InterfaceImplement",{private:{"[_interfaceDefinition]":[gpf.$ClassProperty(false,"which")],_interfaceDefinition:gpf.emptyFunction(),"[_builder]":[gpf.$ClassProperty(false,"how")],_builder:null},protected:{_alterPrototype:function(eb){var fb=this._interfaceDefinition.prototype,gb=gpf.classDef(this._interfaceDefinition),hb,ib;ib=new gpf.attributes.Map;ib.fillFromClassDef(gb);ib.addTo(eb.constructor);if(!this._builder){for(hb in fb){if(!(hb in eb)){eb[hb]=fb[hb];}}return;}if(undefined!==eb.queryInterface){if(cb!==eb.queryInterface){eb.queryInterface=db(eb.queryInterface);}}else{eb.queryInterface=cb;gpf.attributes.add(eb.constructor,"Class",[gpf.$InterfaceImplement(gpf.interfaces.IUnknown)]);}}},public:{constructor:function(eb,fb){this._interfaceDefinition=eb;if(fb){this._builder=fb;}}}});var gb=gpf.interfaces,hb=gpf.attributes;gpf._defIntrf("IEnumerable",{reset:function(){},moveNext:function(){return false;},current:function(){return null;}});function eb(ib){var jb=-1;return{reset:function(){jb=-1;},moveNext:function(){++jb;return jb<ib.length;},current:function(){return ib[jb];}};}function fb(ib){var jb=new hb.Map(ib).filter(hb.EnumerableAttribute),kb=jb.members();gpf.ASSERT(kb.length===1,"Only one member can be defined as enumerable");return eb(ib[kb[0]]);}gpf._defAttr("$Enumerable",hb.ClassAttribute,{_alterPrototype:function(ib){if(!(ib[this._member]instanceof Array)){gpf.Error.EnumerableInvalidMember();}hb.add(ib.constructor,"Class",[new hb.InterfaceImplementAttribute(gb.IEnumerable,fb)]);}});var ib=gpf.interfaces,jb=gpf.attributes,kb;kb=gpf._defIntrf("IReadOnlyArray",{length:function(){return 0;},get:function(lb){ib.ignoreParameter(lb);return undefined;}});gpf._defIntrf("IArray",kb,{set:function(lb,mb){ib.ignoreParameter(lb);ib.ignoreParameter(mb);return undefined;}});gpf._defAttr("ClassArrayInterfaceAttribute",jb.ClassAttribute,{"[Class]":[gpf.$Alias("ClassIArray")],_writeAllowed:false,constructor:function(lb){if(lb){this._writeAllowed=true;}},_alterPrototype:function(lb){var mb;if(this._writeAllowed){mb=ib.IArray;}else{mb=ib.IReadOnlyArray;}jb.add(lb.constructor,"Class",[gpf.$InterfaceImplement(mb)]);lb.length=gpf._func("return this."+this._member+".length;");lb.get=gpf._func("return this."+this._member+"[arguments[0]];");if(this._writeAllowed){lb.set=gpf._func("var i=arguments[0],"+"v=this."+this._name+"[i];this."+this._member+"[i]=arguments[1];return v;");}}});jb.add(jb.Array,"_array",[gpf.$ClassIArray(false)]);gpf.arrayOrItem=function(lb,mb){if(undefined===mb){return Array.prototype.slice.call(lb,0);}else if(0===lb.length){return undefined;}else if(-1===mb){return lb[lb.length-1];}else if(mb<-1||mb>lb.length-1){return undefined;}else{return lb[mb];}};var lb=gpf.interfaces,mb=256,nb=0,ob=1,pb=2,qb=3;gpf._defIntrf("IReadableStream",{"[read]":[gpf.$ClassEventHandler()],read:function(rb,sb){gpf.interfaces.ignoreParameter(rb);gpf.interfaces.ignoreParameter(sb);},static:{EVENT_ERROR:"error",EVENT_DATA:"data",EVENT_END_OF_STREAM:"eos",EXCEPTION_READ_IN_PROGRESS:{message:"Read in progress"}}});gpf._defIntrf("IWritableStream",{"[write]":[gpf.$ClassEventHandler()],write:function(rb,sb){gpf.interfaces.ignoreParameter(rb);gpf.interfaces.ignoreParameter(sb);},static:{EVENT_ERROR:"error",EVENT_READY:"ready",EXCEPTION_WRITE_IN_PROGRESS:{message:"Read in progress"}}});gpf._defIntrf("IStream",{"[read]":[gpf.$ClassEventHandler()],read:function(rb,sb){gpf.interfaces.ignoreParameter(rb);gpf.interfaces.ignoreParameter(sb);},"[write]":[gpf.$ClassEventHandler()],write:function(rb,sb){gpf.interfaces.ignoreParameter(rb);gpf.interfaces.ignoreParameter(sb);}});gpf._defIntrf("ITextStream",lb.IStream,{});gpf.stream={};gpf.define("gpf.stream.BufferedOnRead",{"[Class]":[gpf.$InterfaceImplement(lb.IReadableStream)],protected:{_buffer:[],_bufferLength:0,_readSize:mb,_addToBuffer:function(rb){gpf.interfaces.ignoreParameter(rb);gpf.Error.Abstract();},_endOfInputStream:function(){},_readFromBuffer:function(rb){gpf.ASSERT(0!==this._buffer.length,"Buffer is not empty");if("string"===this._buffer[0]){return this._readFromStringBuffer(rb);}else{return this._readFromByteBuffer(rb);}},_readFromStringBuffer:function(rb){var sb=gpf.stringExtractFromStringArray(this._buffer,rb);this._bufferLength-=sb.length;return sb;},_readFromByteBuffer:function(rb){this._bufferLength-=rb;return this._buffer.splice(0,rb);}},public:{constructor:function(rb){this._iStream=lb.query(rb,lb.IReadableStream,true);this._buffer=[];},read:function(rb,sb){var tb=this._iState,ub=this._bufferLength;if(ob===tb){throw lb.IReadableStream.EXCEPTION_READ_IN_PROGRESS;}else if(rb<ub||ub&&qb===tb){if(0===rb||rb>ub){rb=ub;}gpf.events.fire.apply(this,[lb.IReadableStream.EVENT_DATA,{buffer:this._readFromBuffer(rb)},sb]);}else if(qb===tb){gpf.events.fire.apply(this,[lb.IReadableStream.EVENT_END_OF_STREAM,sb]);}else{if(nb===this._iState){this._cbRead=new gpf.Callback(this._onRead,this);}this._iState=ob;this._size=rb;this._eventsHandler=sb;this._iStream.read(this._readSize,this._cbRead);}}},private:{_iStream:null,_cbRead:null,_iState:nb,_size:0,_eventsHandler:null,_onRead:function(rb){var sb=rb.type();if(sb===lb.IReadableStream.EVENT_END_OF_STREAM){this._iState=qb;this._endOfInputStream();return this.read(this._size,this._eventsHandler);}else if(sb===lb.IReadableStream.EVENT_ERROR){gpf.events.fire.apply(this,[rb,this._eventsHandler]);}else{this._iState=pb;this._addToBuffer(rb.get("buffer"));if(0<this._bufferLength){return this.read(this._size,this._eventsHandler);}else{this._iStream.read(mb,this._cbRead);}}}}});gpf.define("gpf.stream.BitReader","gpf.stream.BufferedOnRead",{"[Class]":[gpf.$InterfaceImplement(lb.IReadableStream)],protected:{_addToBuffer:function(rb){this._buffer=this._buffer.concat(rb);this._bufferLength+=rb.length*8;},_readFromBuffer:function(rb){var sb=this._buffer,tb=[],ub=this._bit,vb,wb=0,xb=0;vb=sb[0];while(0<rb){--rb;xb<<=1;if(0!==(vb&ub)){xb|=1;}--this._bufferLength;if(ub===1){sb.shift();vb=sb[0];ub=128;}else{ub>>=1;}if(wb===7){tb.push(xb);xb=0;wb=0;}else{++wb;}}if(wb!==0){tb.push(xb);}this._bit=ub;return tb;}},private:{_bit:128}});var rb=gpf.define("AbstractStreamReader",{public:{constructor:function(ub,vb){this._scope=gpf.Callback.resolveScope(ub);this._eventsHandler=vb;},read:function(ub){ub.read(this._readSize,gpf.Callback.bind(this,"callback"));}},protected:{_readSize:0,_consolidateBuffer:function(){gpf.Error.Abstract();return[];},_addBuffer:function(ub){gpf.interfaces.ignoreParameter(ub);gpf.Error.Abstract();}},private:{_scope:null,_eventsHandler:null,callback:function(ub){var vb=ub.type(),wb=ub.scope();if(vb===lb.IReadableStream.EVENT_END_OF_STREAM){gpf.events.fire.apply(this._scope,[lb.IReadableStream.EVENT_DATA,{buffer:this._consolidateBuffer()},this._eventsHandler]);}else if(vb===lb.IReadableStream.EVENT_ERROR){gpf.events.fire.apply(this._scope,[ub,this._eventsHandler]);}else{this._addBuffer(ub.get("buffer"));this.read(wb);}}}}),sb=gpf.define("StreamReader",rb,{public:{constructor:function(ub,vb,wb){this._super(ub,vb);this._concatMethod=wb;}},protected:{_consolidateBuffer:function(){return this._concatMethod(this._buffer);},_addBuffer:function(ub){this._buffer=this._concatMethod(this._buffer,ub);}},private:{_buffer:undefined,_concatMethod:null}}),tb=gpf.define("B64StreamReader",rb,{public:{constructor:function(ub,vb){this._super(ub,vb);this._buffer=[];}},protected:{_readSize:6,_consolidateBuffer:function(){return this._buffer.join("");},_addBuffer:function(ub){this._buffer.push(gpf.bin.toBase64(ub[0]));}},private:{_buffer:[]}});gpf.stream.readAll=function(ub,vb,wb){ub=gpf.interfaces.query(ub,lb.IReadableStream,true);new sb(this,wb,vb).read(ub);};gpf.stream.readAllAsB64=function(ub,vb){ub=new gpf.stream.BitReader(ub);new tb(this,vb).read(ub);};var vb=gpf.interfaces,wb={javascript:{"\\":"\\\\","\"":"\\\"","\n":"\\n","\r":"\\r","\t":"\\t"},xml:{"&":"&amp;","<":"&lt;",">":"&gt;"},html:{"&":"&amp;","<":"&lt;",">":"&gt;","\xE9":"&eacute;","\xE8":"&egrave;","\xEA":"&ecirc;","\xE1":"&aacute;","\xE0":"&agrave;"}},xb=gpf.define("StringStream",{"[Class]":[gpf.$InterfaceImplement(gpf.interfaces.ITextStream)],public:{constructor:function(yb){if(undefined!==yb&&yb.length){this._buffer=[yb];}else{this._buffer=[];}},read:function(yb,zb){var Ab;if(0===this._buffer.length){gpf.defer(gpf.events.fire,0,this,[vb.IReadableStream.EVENT_END_OF_STREAM,zb]);}else{Ab=gpf.stringExtractFromStringArray(this._buffer,yb);gpf.defer(gpf.events.fire,0,this,[vb.IReadableStream.EVENT_DATA,{buffer:Ab},zb]);}},write:function(yb,zb){gpf.ASSERT(yb&&yb.length,"Write must contain data");this._buffer.push(yb);gpf.events.fire.apply(this,[vb.IReadableStream.EVENT_READY,zb]);},consolidateString:function(){return this._buffer.join("");}},private:{_buffer:[]}});gpf.extend(gpf,{"[capitalize]":[gpf.$ClassExtension(String)],"[replaceEx]":[gpf.$ClassExtension(String)],replaceEx:function(yb,zb){var Ab=yb,Bb;for(Bb in zb){if(zb.hasOwnProperty(Bb)){if(-1<Ab.indexOf(Bb)){Ab=Ab.split(Bb).join(zb[Bb]);}}}return Ab;},"[escapeFor]":[gpf.$ClassExtension(String)],escapeFor:function(yb,zb){var Ab=wb[zb];if(undefined!==Ab){yb=gpf.replaceEx(yb,Ab);if("javascript"===zb){yb="\""+yb+"\"";}}return yb;},"[stringExtractFromStringArray]":[gpf.$ClassExtension(String,"fromStringArray")],stringExtractFromStringArray:function(yb,zb){var Ab=yb.length,Bb,Cb,Db,Eb;if(!zb){Bb=yb.splice(0,Ab).join("");}else{Cb=0;do{Db=yb[Cb];Eb=Db.length;if(Eb<=zb){++Cb;zb-=Eb;}else{break;}}while(0<zb&&Cb<Ab);if(0===zb){Bb=yb.splice(0,Cb).join("");}else if(Cb<Ab){Bb=[];if(0<Cb){Bb.push(yb.splice(0,Cb-1).join(""));}Db=yb.shift();Bb.push(Db.substr(0,zb));yb.unshift(Db.substr(zb));Bb=Bb.join("");}else{Bb=yb.splice(0,Ab).join("");}}return Bb;},"[stringToStream]":[gpf.$ClassExtension(String,"toStream")],stringToStream:function(yb){return new xb(yb);},"[stringFromStream]":[gpf.$ClassExtension(String,"fromStream")],stringFromStream:function(yb,zb){if(yb instanceof xb){gpf.events.fire.apply(this,[vb.IReadableStream.EVENT_DATA,{buffer:yb.consolidateString()},zb]);}else{gpf.stream.readAll(yb,ub,zb);}}});function ub(yb,zb){if(undefined===yb){return[zb];}else if(undefined!==zb){yb.push(zb);return yb;}else{return yb.join("");}}var zb=gpf.interfaces,Ab=gpf.define("ArrayStream",{"[Class]":[gpf.$InterfaceImplement(gpf.interfaces.IStream)],public:{constructor:function(Bb){if(undefined!==Bb&&Bb.length){this._buffer=[].concat(Bb);}else{this._buffer=[];}},read:function(Bb,Cb){var Db;if(0===this._buffer.length){gpf.defer(gpf.events.fire,0,this,[zb.IReadableStream.EVENT_END_OF_STREAM,Cb]);}else if(undefined===Bb||Bb>this._buffer.length){Db=this._buffer;this._buffer=[];gpf.defer(gpf.events.fire,0,this,[zb.IReadableStream.EVENT_DATA,{buffer:Db},Cb]);}else{Db=this._buffer.splice(0,Bb);gpf.defer(gpf.events.fire,0,this,[zb.IReadableStream.EVENT_DATA,{buffer:Db},Cb]);}},write:function(Bb,Cb){gpf.ASSERT(Bb&&Bb.length,"Write must contain data");this._buffer=this._buffer.concat(Bb);gpf.events.fire.apply(this,[zb.IWritableStream.EVENT_READY,Cb]);},consolidateArray:function(){return[].concat(this._buffer);}},private:{_buffer:[]}});gpf.extend(gpf,{"[arrayToStream]":[gpf.$ClassExtension(Array,"toStream")],arrayToStream:function(Bb){return new Ab(Bb);},"[arrayFromStream]":[gpf.$ClassExtension(Array,"fromStream")],arrayFromStream:function(Bb,Cb){if(Bb instanceof Ab){gpf.events.fire.apply(this,[zb.IReadableStream.EVENT_DATA,{buffer:Bb.consolidateArray()},Cb]);return;}else{gpf.stream.readAll(Bb,yb,Cb);}}});function yb(Bb,Cb){if(undefined===Bb){return Cb;}else if(undefined!==Cb){Bb=Bb.concat(Cb);return Bb;}else{return Bb;}}var Bb=function(Cb){if(10>Cb){return"0"+Cb;}else{return Cb;}};gpf.extend(gpf,{"[dateToComparableFormat]":[gpf.$ClassExtension(Date,"toComparableFormat")],dateToComparableFormat:function(Cb,Db){if(undefined===Db){Db=true;}var Eb=[Cb.getFullYear(),"-",Bb(Cb.getMonth()+1),"-",Bb(Cb.getDate())];if(Db){Eb.push(" ",Bb(Cb.getHours()),":",Bb(Cb.getMinutes()),":",Bb(Cb.getSeconds()));}return Eb.join("");},"[dateFromComparableFormat]":[gpf.$ClassExtension(String)],dateFromComparableFormat:function(Cb){var Db=new Date;Db.setFullYear(parseInt(Cb.substr(0,4),10),parseInt(Cb.substr(5,2),10)-1,parseInt(Cb.substr(8,2),10));if(10<Cb.length){Db.setHours(parseInt(Cb.substr(11,2),10),parseInt(Cb.substr(14,2),10),parseInt(Cb.substr(17,2),10),0);}else{Db.setHours(0,0,0,0);}return Db;}});var Cb=function(Eb){var Fb;if(this._list.length){Fb=this._list.shift();this._pos=0;gpf.events.fire.apply(this,[gpf.Promise.THEN,Eb,Fb]);}},Db=function(Eb){var Fb,Gb;while(this._list.length){Fb=this._list.shift();if(undefined===Gb){Gb=gpf.events.fire.apply(this,[gpf.Promise.FAIL,Eb,Fb]);}else{gpf.events.fire.apply(this,[Gb,Fb]);}if(Gb._propagationStopped){break;}}};gpf.define("gpf.Promise",{private:{_list:[],_pos:0},public:{constructor:function(){this._list=[];},then:function(Eb){this._list.splice(this._pos,0,Eb);++this._pos;return this;},resolve:function(Eb){gpf.defer(Cb,0,this,[Eb]);},reject:function(Eb){gpf.defer(Db,0,this,[Eb]);}},static:{THEN:"then",REJECT:"reject"}});var Eb=gpf.interfaces,Fb={},Gb=function(Lb){return function(){this._calls.push(new Jb(true,Lb,arguments,0));this._start();return this;};},Hb=function(Lb,Mb){return function(){this._calls.push(new Jb(false,Lb,arguments,Mb));this._start();return this;};},Ib=function(Lb){var Mb={public:{},static:{interface:Lb}},Nb=Mb.public,Ob=new gpf.attributes.Map,Pb=Lb.prototype,Qb,Rb;Ob.fillFromClassDef(gpf.classDef(Lb));for(Qb in Pb){if(Pb.hasOwnProperty(Qb)){Rb=Pb[Qb];if("constructor"===Qb){continue;}gpf.ASSERT("function"===typeof Rb,"Only methods");if(Ob.member(Qb).has(gpf.attributes.ClassEventHandlerAttribute)){Nb[Qb]=Hb(Qb,Rb.length);}else{Nb[Qb]=Gb(Qb);}}}return Mb;},Jb=gpf.define("MethodCall",{private:{_synchronous:true,_name:"",_args:[],_length:0},public:{constructor:function(Lb,Mb,Nb,Ob){this._synchronous=Lb;this._name=Mb;this._args=Nb;this._length=Ob;},apply:function(Lb,Mb){var Nb=this._args,Ob=Lb[this._name],Pb,Qb,Rb;if(this._synchronous){Ob.apply(Lb,Nb);Mb.call();}else{Qb=this._length;Pb=new Array(Qb);Pb[--Qb]=Mb;if(Qb>Nb.length){Qb=Nb.length;}for(Rb=0;Rb<Qb;++Rb){Pb[Rb]=Nb[Rb];}Ob.apply(Lb,Pb);}}}}),Kb=gpf.define("WrapInterface",{private:{_iHandler:null,_calls:[],_callback:null,_catch:null,_finally:null,_finalEventType:"done",_asyncResult:function(Lb){var Mb=this._iHandler,Nb;if(Lb&&Lb.type()==="error"){if(this._catch){gpf.events.fire.apply(Mb,[Lb,this._catch]);}return;}Nb=this._calls;if(Nb.length){Nb.shift().apply(Mb,this._callback);}else if(this._finally){gpf.events.fire.apply(Mb,[this._finalEventType,this._finally]);}},_needStart:true,_start:function(){if(this._needStart){this._needStart=false;gpf.defer(this._asyncResult,0,this);}}},public:{constructor:function(Lb){this._iHandler=Eb.query(Lb,this.constructor.interface);this._calls=[];this._callback=new gpf.Callback(this._asyncResult,this);},$catch:function(Lb){this._catch=Lb;this._start();return this;},$finally:function(Lb,Mb){this._finally=Lb;if(Mb){this._finalEventType=Mb;}this._start();return this;}}});Eb.wrap=function(Lb){var Mb=gpf.classDef(Lb),Nb=Fb[Mb.uid()],Ob;if(undefined===Nb){if(Lb===Eb.Interface){Nb=Kb;}else{Ob=Eb.wrap(Mb.Base());Nb=gpf.define("Wrap"+Mb.nameOnly(),Ob,Ib(Lb));}Fb[Mb.uid()]=Nb;}return Nb;};gpf.define("gpf.Parser",{public:{constructor:function(){this.reset();},reset:function(Lb){this._pos=0;this._line=0;this._column=0;this._setParserState(Lb);},currentPos:function(){return{pos:this._pos,line:this._line,column:this._column};},parse:function(){var Lb=arguments.length,Mb,Nb;for(Mb=0;Mb<Lb;++Mb){Nb=arguments[Mb];if(null===Nb){this._finalizeParserState();}else{gpf.ASSERT("string"===typeof Nb,"string expected");this._parse(Nb);}}},setOutputHandler:function(Lb){gpf.ASSERT(Lb instanceof Array||Lb.apply,"Invalid output handler");this._outputHandler=Lb;}},protected:{_initialParserState:null,_ignoreCarriageReturn:false,_ignoreLineFeed:false,_finalizeParserState:function(){this._pState(0);},_setParserState:function(Lb){if(!Lb){Lb=this._initialParserState;}if(Lb!==this._pState){this._pState=Lb;}},_output:function(Lb){var Mb=this._outputHandler;if(Mb instanceof Array){Mb.push(Lb);}else if(null!==Mb){Mb.apply(this,[Lb]);}}},private:{_pos:0,_line:0,_column:0,_pState:null,_outputHandler:null,_parse:function(Lb){var Mb,Nb,Ob,Pb,Qb=false;Mb=Lb.length;for(Nb=0;Nb<Mb;++Nb){Ob=Lb.charAt(Nb);if("\r"===Ob&&this._ignoreCarriageReturn){Ob=0;}if("\n"===Ob&&this._ignoreLineFeed){Qb=true;Ob=0;}if(Ob){Pb=this._pState.apply(this,[Ob]);if(undefined!==Pb){this._setParserState(Pb);}}++this._pos;if("\n"===Ob||Qb){++this._line;this._column=0;}else{++this._column;}}}},static:{FINALIZE:null}});gpf.define("gpf.ParserStream",gpf.stream.BufferedOnRead,{public:{constructor:function(Lb,Mb){this._super(Mb);this._parser=Lb;this._parser.setOutputHandler(new gpf.Callback(this._output,this));}},protected:{_addToBuffer:function(Lb){this._parser.parse(Lb);},_endOfInputStream:function(){this._parser.parse(gpf.Parser.FINALIZE);},_readFromBuffer:gpf.stream.BufferedOnRead.prototype._readFromStringBuffer},private:{_output:function(Lb){this._buffer.push(Lb);this._bufferLength+=Lb.length;}}});var Lb=gpf.bin.test,Mb=gpf.bin.clear,Nb=gpf._defIntrf("ITokenizer",{write:function(Ub){gpf.interfaces.ignoreParameter(Ub);return-1;}}),Ob=gpf.define("PatternItem",{private:{"[_min]":[gpf.$ClassProperty(true)],_min:1,"[_max]":[gpf.$ClassProperty(true)],_max:1},public:{parse:function(Ub){gpf.interfaces.ignoreParameter(Ub);gpf.Error.Abstract();return Ob.PARSE_IGNORED;},finalize:function(){},reset:function(Ub){gpf.interfaces.ignoreParameter(Ub);},write:function(Ub,Vb){gpf.interfaces.ignoreParameter(Ub);gpf.interfaces.ignoreParameter(Vb);gpf.Error.Abstract();return-1;}},static:{PARSE_IGNORED:0,PARSE_PROCESSED:1,PARSE_END_OF_PATTERN:2,PARSE_PROCESSED_EOP:3,CHARS_QUANTIFICATION:"?*+",WRITE_NO_MATCH:-1,WRITE_NEED_DATA:0,WRITE_MATCH:1,WRITE_PATTERN_END:2,WRITE_FINAL_MATCH:3}}),Pb=gpf.define("PatternChar",Ob,{private:{_match:""},public:{parse:function(Ub){this._match=Ub;return Ob.PARSE_PROCESSED_EOP;},write:function(Ub,Vb){gpf.interfaces.ignoreParameter(Ub);if(Vb===this._match){return Ob.WRITE_FINAL_MATCH;}return Ob.WRITE_NO_MATCH;}}}),Qb=gpf.define("PatternRange",Ob,{private:{_inc:"",_exc:"",_inRange:false,_parse:function(Ub,Vb){var Wb,Xb;if("^"===Ub){this._exc=[];}else if("]"===Ub){if(this._inRange){gpf.Error.PatternInvalidSyntax();}return true;}else if("-"===Ub){if(this._inRange||0===Vb.length){gpf.Error.PatternInvalidSyntax();}this._inRange=true;}else{if(this._inRange){Wb=Vb[Vb.length-1].charCodeAt(0);Xb=Ub.charCodeAt(0);while(--Xb>Wb){Vb.push(String.fromCharCode(Xb));}Vb.push(Ub);delete this._inRange;}else{Vb.push(Ub);}}return false;}},public:{parse:function(Ub){var Vb;if(this.hasOwnProperty("_exc")){if("^"===Ub){gpf.Error.PatternInvalidSyntax();}Vb=this._exc;}else{Vb=this._inc;}if("["===Ub){if(this.hasOwnProperty("_inc")){gpf.Error.PatternInvalidSyntax();}this._inc=[];}else if(this._parse(Ub,Vb)){return Ob.PARSE_PROCESSED_EOP;}return Ob.PARSE_PROCESSED;},finalize:function(){this._inc=this._inc.join("");if(this.hasOwnProperty("_exc")){this._exc=this._exc.join("");}},write:function(Ub,Vb){gpf.interfaces.ignoreParameter(Ub);var Wb;if(this._inc.length){Wb=-1<this._inc.indexOf(Vb);}else{Wb=true;}if(Wb&&this._exc.length){Wb=-1===this._exc.indexOf(Vb);}if(Wb){return Ob.WRITE_FINAL_MATCH;}else{return Ob.WRITE_NO_MATCH;}}}}),Rb=gpf.define("PatternGroup",Ob,{private:{_items:[],_choice:false,_optionals:[],_parsedParenthesis:false,_parsedItem:null,_getItems:function(Ub){if(this._choice){if(undefined===Ub){Ub=this._items.length-1;}return this._items[Ub];}return this._items;},_lastItem:function(){var Ub=this._getItems();return Ub[Ub.length-1];},_push:function(Ub){this._getItems().push(Ub);this._parsedItem=Ub;return Ub;},_parseItem:function(Ub){var Vb=this._parsedItem,Wb;if(Vb){Wb=Vb.parse(Ub);if(Lb(Wb,Ob.PARSE_END_OF_PATTERN)){Vb.finalize();this._parsedItem=null;Wb=Mb(Wb,Ob.PARSE_END_OF_PATTERN);}}else{Wb=0;}return Wb;},_parseQuantity:function(Ub){var Vb=this._lastItem();if("*"===Ub){Vb._min=0;Vb._max=0;}else if("+"===Ub){Vb._max=0;}else if("?"===Ub){Vb._min=0;}return Ob.PARSE_PROCESSED;},_getOptional:function(Ub){var Vb;Vb=Ub.length;while(Vb--){if(0!==Ub[Vb].min()){++Vb;break;}}return Vb;},_reset:function(Ub,Vb){Vb.count=0;Vb.sub={};Ub.reset(Vb.sub);},_getItem:function(Ub,Vb){var Wb=this._getItems(Ub.choice);if(Vb<Wb.length){return Wb[Vb];}return null;},_writeNoMatch:function(Ub,Vb,Wb){if(Vb.count<Ub.min()||Vb.length>Vb.matchingLength+1){return Ob.WRITE_NO_MATCH;}Ub=this._getItem(Vb,Vb.index+1);if(null===Ub){return Ob.WRITE_NO_MATCH;}++Vb.index;this._reset(Ub,Vb);return this.write(Vb,Wb);},_writeMatch:function(Ub,Vb){var Wb=this._getItem(Vb,Vb.index+1),Xb;if(this._choice&&-1<Vb.choice){Xb=this._optionals[Vb.choice];}else{Xb=this._optionals[0];}++Vb.count;if(0===Ub.max()){this._reset(Ub,Vb);if(null!==Wb&&Xb>Vb.index){return Ob.WRITE_NEED_DATA;}else{return Ob.WRITE_MATCH;}}else if(Vb.count===Ub.max()){if(null===Wb){return Ob.WRITE_FINAL_MATCH;}++Vb.index;this._reset(Wb,Vb);if(Xb<=Vb.index){return Ob.WRITE_MATCH;}}return Ob.WRITE_NEED_DATA;}},public:{constructor:function(){this._items=[];},parse:function(Ub){var Vb=this._parseItem(Ub);if(0!==Vb){return Vb;}if(-1<Ob.CHARS_QUANTIFICATION.indexOf(Ub)){return this._parseQuantity(Ub);}if("|"===Ub){if(!this._choice){this._items=[this._items];this._choice=true;}this._items.push([]);return Ob.PARSE_PROCESSED;}else if("["===Ub){this._push(new Qb);}else if("("===Ub){if(this._parsedParenthesis){this._push(new Rb);}else{this._parsedParenthesis=true;return Ob.PARSE_PROCESSED;}}else if(")"===Ub){return Ob.PARSE_PROCESSED_EOP;}else{this._push(new Pb);}return this._parseItem(Ub);},finalize:function(){var Ub,Vb,Wb;Wb=this._optionals=[];if(this._choice){Ub=this._items.length;for(Vb=0;Vb<Ub;++Vb){Wb.push(this._getOptional(this._items[Vb]));}}else{Wb.push(this._getOptional(this._items));}},reset:function(Ub){var Vb;Ub.index=0;if(this._choice){Ub.choice=-1;}Vb=this._getItems(0)[0];this._reset(Vb,Ub);},write:function(Ub,Vb){var Wb,Xb,Yb,Zb;if(this._choice&&-1===Ub.choice){Wb=this._items.length;for(Xb=0;Xb<Wb;++Xb){Yb=this._items[Xb][0];this._reset(Yb,Ub);Zb=Yb.write(Ub.sub,Vb);if(Ob.WRITE_NO_MATCH!==Zb){Ub.choice=Xb;return this._writeMatch(Yb,Ub);}}if(Xb===Wb){return Ob.WRITE_NO_MATCH;}}Yb=this._getItem(Ub,Ub.index);Zb=Yb.write(Ub.sub,Vb);if(Ob.WRITE_NEED_DATA===Zb){return Zb;}else if(Ob.WRITE_NO_MATCH===Zb){return this._writeNoMatch(Yb,Ub,Vb);}else{return this._writeMatch(Yb,Ub);}}}}),Sb=gpf.define("PatternParser",gpf.Parser,{private:{"[_patternItem]":[gpf.$ClassProperty()],_patternItem:null},protected:{_initialParserState:function(Ub){this._patternItem.parse(Ub);},_finalizeParserState:function(){var Ub=this._patternItem;Ub.parse(")");Ub.finalize();}},public:{constructor:function(){this._super.apply(this,arguments);this._patternItem=new Rb;this._patternItem.parse("(");}}}),Tb=gpf.define("PatternTokenizer",{"[Class]":[gpf.$InterfaceImplement(Nb)],private:{_patternItem:null,_stopMatching:false,_lastResult:0,_totalLength:0,_state:{}},public:{constructor:function(Ub){this._patternItem=Ub;this._state={};this._patternItem.reset(this._state);},write:function(Ub){var Vb;if(this._stopMatching){return this._lastResult;}++this._totalLength;Vb=this._patternItem.write(this._state,Ub);if(0<Vb){this._lastResult=this._totalLength;this._stopMatching=Lb(Vb,Ob.WRITE_PATTERN_END);}else if(Ob.WRITE_NO_MATCH===Vb){this._stopMatching=true;if(0===this._lastResult){this._lastResult=-1;}}return this._lastResult;}}});gpf.define("gpf.Pattern",{private:{_patternItem:null},public:{constructor:function(Ub){var Vb=new Sb;Vb.parse(Ub,null);this._patternItem=Vb.patternItem();},allocate:function(){return new Tb(this._patternItem);}}});var Ub="error",Vb="unknown",Wb="keyword",Xb="identifier",Yb="string",Zb="number",ac="symbol",bc="comment",cc="space",dc=99,ec=0,fc=gpf._alpha+gpf._ALPHA+"_$",gc=2,hc=3,ic=4,jc=5,kc=6,lc=7,mc=8,nc=9,oc="(){}[]<>|&?,.;:!=+-*/%^~",pc=10,qc=11,rc=" \t\r\n",sc=12,tc=0,uc=0,vc=1,wc=2,xc=3,yc=4,zc=["Parsing aborted","Unknown token","Unterminated string","Unterminated comment","Invalid or unsupported string escape"],Ac=function(){return{pos:0,line:0,column:0,state:ec,chars:[],nextPos:0,nextLine:0,nextColumn:0,eventsHandler:null,that:null};},Bc=("break,case,catch,continue,debugger,default,delete,do,"+"else,finally,for,function,if,in,instanceof,new,return,switch,"+"this,throw,try,typeof,var,void,while,with").split(","),Cc=function(){var Nc={};Nc[ec]=Vb;Nc[pc]=ac;Nc[mc]=bc;Nc[nc]=bc;Nc[hc]=Yb;Nc[jc]=Yb;Nc[qc]=Zb;Nc[sc]=cc;return Nc;}(),Dc=function(Nc,Oc){var Pc,Qc,Rc,Sc={token:"",pos:Nc.pos,line:Nc.line,column:Nc.column,code:0,message:""};if(undefined!==Oc){Qc=Ub;Nc.state=dc;Sc.code=Oc;Sc.message=zc[Oc-tc];}else{Pc=Nc.chars.join("");if(gc===Nc.state){if(undefined!==gpf.test(Bc,Pc)){Qc=Wb;}else{Qc=Xb;}}else{Qc=Cc[Nc.state];}Sc.token=Pc;}Rc=gpf.events.fire.apply(Nc.that,[Qc,Sc,Nc.eventsHandler]);if(Rc.defaultPrevented()){Dc(Nc,uc);}else if(undefined!==Oc){throw 0;}Nc.state=ec;Nc.chars=[];Nc.pos=Nc.nextPos;Nc.line=Nc.nextLine;Nc.column=Nc.nextColumn;},Ec=[0,function(Nc,Oc,Pc){gpf.interfaces.ignoreParameter(Oc);if(-1<"(){}[].,;:?".indexOf(Nc)){return false;}if(-1<"!^~*/%".indexOf(Nc)){return"="===Pc;}return"="===Pc||Nc===Pc;},function(Nc,Oc,Pc){if(-1<"+-|&".indexOf(Nc)){return false;}if("<"===Nc){return"<"===Oc[1]&&"="===Pc;}if(-1<"=!".indexOf(Nc)){return"="===Pc;}if(">"===Nc){return"="!==Oc[1]&&("="===Pc||">"===Pc);}return false;},function(Nc,Oc,Pc){return">"===Nc&&"="!==Oc[2]&&"="===Pc;},function(){return false;}],Fc=function(Nc,Oc){var Pc=Nc[0];return Ec[Nc.length](Pc,Nc,Oc);},Gc=function(){var Nc={};Nc[gc]=function(Oc,Pc){if(-1===fc.indexOf(Pc)&&("0">Pc||Pc>"9")){Dc(Oc);}else{Oc.chars.push(Pc);}};Nc[qc]=function(Oc,Pc){if("0">Pc||Pc>"9"){Dc(Oc);}else{Oc.chars.push(Pc);}};Nc[hc]=Nc[jc]=function(Oc,Pc){Oc.chars.push(Pc);if("\\"===Pc){++Oc.state;}else if("\n"===Pc){Dc(Oc,wc);}else if(hc===Oc.state&&"\""===Pc){Dc(Oc);return true;}else if(jc===Oc.state&&"'"===Pc){Dc(Oc);return true;}return false;};Nc[ic]=Nc[kc]=function(Oc,Pc){if("\\"===Pc||"r"===Pc||"n"===Pc||"t"===Pc||"\""===Pc||"'"===Pc){--Oc.state;Oc.chars.push(Pc);}else{Dc(Oc,yc);}};Nc[lc]=function(Oc,Pc){if("/"===Pc){Oc.state=mc;Oc.chars.push(Pc);}else if("*"===Pc){Oc.state=nc;Oc.chars.push(Pc);}else{Oc.state=pc;if(Fc(Oc.chars,Pc)){Oc.chars.push(Pc);}else{Dc(Oc);}}};Nc[mc]=function(Oc,Pc){if("\n"===Pc){Dc(Oc);}else{Oc.chars.push(Pc);}};Nc[nc]=function(Oc,Pc){Oc.chars.push(Pc);if("/"===Pc&&Oc.chars[Oc.chars.length-2]==="*"){Dc(Oc);return true;}return false;};Nc[sc]=function(Oc,Pc){if(-1<rc.indexOf(Pc)){Oc.chars.push(Pc);}else{Dc(Oc);}};Nc[pc]=function(Oc,Pc){if(-1<oc.indexOf(Pc)){if(Fc(Oc.chars,Pc)){Oc.chars.push(Pc);}else{Dc(Oc);}}else{Dc(Oc);}};return Nc;}(),Hc=function(Nc,Oc){Nc.chars=[Oc];if(-1<fc.indexOf(Oc)){Nc.state=gc;}else if("0"<=Oc&&Oc<="9"){Nc.state=qc;}else if("\""===Oc){Nc.state=hc;}else if("'"===Oc){Nc.state=jc;}else if("/"===Oc){Nc.state=lc;}else if(-1<oc.indexOf(Oc)){Nc.state=pc;}else if(-1<rc.indexOf(Oc)){Nc.state=sc;}else{Dc(Nc,vc);}},Ic=function(Nc,Oc){var Pc=Gc[Nc.state];if(undefined!==Pc){if(Pc(Nc,Oc)){return;}}if(ec===Nc.state){Hc(Nc,Oc);}},Jc=function(Nc,Oc){++Nc.nextPos;if("\n"===Oc){++Nc.nextLine;Nc.nextColumn=0;}else{++Nc.nextColumn;}},Kc=function(Nc,Oc){Ic(Nc,Oc);Jc(Nc,Oc);},Lc=function(){var Nc={};Nc[gc]=1;Nc[qc]=1;Nc[mc]=1;Nc[pc]=1;Nc[lc]=2;Nc[nc]=3;Nc[hc]=4;Nc[jc]=4;Nc[ic]=4;Nc[kc]=4;return Nc;}(),Mc=function(Nc){var Oc=Lc[Nc.state];if(1===Oc){Dc(Nc);}else if(2===Oc){Nc.state=pc;Dc(Nc);}else if(3===Oc){Dc(Nc,xc);}else if(4===Oc){Dc(Nc,wc);}gpf.ASSERT(ec===Nc.state||dc===Nc.state||sc===Nc.state,"Unexpected non-final state");};gpf.js={};gpf.extend(gpf.js,{keywords:function(){return Bc;},"[tokenize]":[gpf.$ClassEventHandler()],tokenize:function(Nc,Oc){var Pc,Qc,Rc=Ac();Rc.eventsHandler=Oc;Rc.that=this;try{for(Pc=0,Qc=Nc.length;Pc<Qc;++Pc){Kc(Rc,Nc.charAt(Pc));}Mc(Rc);}catch(e){if("number"!==typeof e){throw e;}}},tokenizeEx:function(Nc,Oc,Pc){var Qc,Rc;if(undefined===Pc){Pc=Ac();}Pc.eventsHandler=Oc;Pc.that=this;try{if(null===Nc){Mc(Pc);Pc=null;}else{for(Qc=0,Rc=Nc.length;Qc<Rc;++Qc){Kc(Pc,Nc.charAt(Qc));}}}catch(e){if("number"!==typeof e){throw e;}}return Pc;}});(function(){"use strict";var Nc=function(Sc){var Tc=[],Uc=Sc.length,Vc,Wc;for(Vc=0;Vc<Uc;++Vc){Wc=Sc.charCodeAt(Vc);if(Wc<128){Tc.push(Wc);}else if(Wc>127&&Wc<2048){Tc.push(Wc>>6|192);Tc.push(Wc&63|128);}else{Tc.push(Wc>>12|224);Tc.push(Wc>>6&63|128);Tc.push(Wc&63|128);}}return Tc;},Oc=function(Sc,Tc){var Uc=[],Vc=Sc.length,Wc=0,Xc,Yc,Zc;while(Wc<Vc){Xc=Sc[Wc];if(Xc<128){Uc.push(String.fromCharCode(Xc));}else if(Xc>191&&Xc<224){if(Wc+1===Vc){break;}Yc=Sc[++Wc];Uc.push(String.fromCharCode((Xc&31)<<6|Yc&63));}else{if(Wc+2>=Vc){break;}Yc=Sc[++Wc];Zc=Sc[++Wc];Uc.push(String.fromCharCode((Xc&15)<<12|(Yc&63)<<6|Zc&63));}++Wc;}while(Wc<Vc){Tc.push(Sc[Wc++]);}return Uc.join("");},Pc={"utf-8":[Nc,Oc]},Qc=gpf.define("EncoderStream",gpf.stream.BufferedOnRead,{public:{constructor:function(Sc,Tc){this._super(Tc);this._encoder=Sc;}},protected:{_addToBuffer:function(Sc){this._buffer=this._buffer.concat(this._encoder(Sc));this._bufferLength=this._buffer.length;},_readFromBuffer:gpf.stream.BufferedOnRead.prototype._readFromByteBuffer},private:{_encoder:null}}),Rc=gpf.define("DecoderStream",gpf.stream.BufferedOnRead,{public:{constructor:function(Sc,Tc){this._super(Tc);this._decoder=Sc;}},protected:{_addToBuffer:function(Sc){var Tc;if(this._unprocessed.length){Sc=this._unprocessed.concat(Sc);}this._unprocessed=[];Tc=this._decoder(Sc,this._unprocessed);this._buffer.push(Tc);this._bufferLength+=Tc.length;},_endOfInputStream:function(){if(this._unprocessed.length){gpf.Error.EncodingEOFWithUnprocessedBytes();}},_readFromBuffer:gpf.stream.BufferedOnRead.prototype._readFromStringBuffer},private:{_decoder:null,_unprocessed:[]}});gpf.encoding={UTF_8:"utf-8",createEncoder:function(Sc,Tc){var Uc=Pc[Tc];if(undefined===Uc){gpf.Error.EncodingNotSupported();}return new Qc(Uc[0],Sc);},createDecoder:function(Sc,Tc){var Uc=Pc[Tc];if(undefined===Uc){gpf.Error.EncodingNotSupported();}return new Rc(Uc[1],Sc);}};}());gpf.html={};var Sc=gpf.interfaces;gpf.define("gpf.html.MarkdownParser","gpf.Parser",{public:{constructor:function(){this._super.apply(this,arguments);this._openedTags=[];}},protected:{_ignoreCarriageReturn:true,_initialParserState:function(Tc){var Uc,Vc=0<this._openedTags.length;if("#"===Tc){this._hLevel=1;Uc=this._parseTitle;}else if("*"===Tc||"0"<=Tc&&"9">=Tc){if(Tc!=="*"){this._numericList=1;}else{this._numericList=0;}Uc=this._parseList;Vc=false;}else if(" "!==Tc&&"\t"!==Tc&&"\n"!==Tc){if(Vc){this._output(" ");Vc=false;}else{this._openTag("p");}Uc=this._parseContent(Tc);if(!Uc){Uc=this._parseContent;}}if(Vc){this._closeTags();}return Uc;},_finalizeParserState:function(){this._closeTags();}},private:{_openedTags:[],_closeTags:function(){var Tc;while(this._openedTags.length){Tc=this._openedTags.pop();this._output("</"+Tc+">");if("p"===Tc){break;}}},_openList:function(Tc){var Uc,Vc=this._openedTags.length;while(Vc){Uc=this._openedTags.pop();--Vc;this._output("</"+Uc+">");if("li"===Uc){break;}}if(Vc){Uc=this._openedTags[Vc-1];if(Uc!==Tc){this._openedTags.pop();this._output("</"+Uc+">");}else{return;}}this._openTag(Tc);},_toggleTag:function(Tc){var Uc=this._openedTags.length;if(Uc&&this._openedTags[Uc-1]===Tc){this._openedTags.pop();this._output("</"+Tc+">");}else{this._openTag(Tc);}},_openTag:function(Tc){this._output("<"+Tc+">");this._openedTags.push(Tc);},_hLevel:1,_parseTitle:function(Tc){if("#"===Tc){++this._hLevel;}else{this._openTag("h"+this._hLevel);return this._parseText;}},_numericList:false,_parseList:function(Tc){var Uc=0<this._openedTags.length,Vc;if(" "===Tc){if(this._numericList){Vc="ol";}else{Vc="ul";}this._openList(Vc);this._openTag("li");}else if(this._numericList&&("0"<=Tc&&"9">=Tc||"."===Tc)){return;}else if("*"===Tc){if(Uc){this._output(" ");}this._openTag("strong");}return this._parseContent;},_handleEntities:function(Tc){if("<"===Tc){this._output("&lt;");}else if(">"===Tc){this._output("&gt;");}else if("&"===Tc){this._output("&amp;");}else{return false;}return true;},_escapeChar:"",_escapeCount:0,_parseEscape:function(Tc){var Uc=this._escapeChar,Vc;if(Tc===Uc){Vc=++this._escapeCount;if("-"===Uc&&3===Vc){this._output("&mdash;");return this._parseContent;}}else{Vc=this._escapeCount+1;while(--Vc){this._output(Uc);}this._setParserState(this._parseContent);return this._parseContent(Tc);}},_parseContent:function(Tc){if(this._handleEntities(Tc)){return;}if("*"===Tc){return this._parseItalic;}else if("`"===Tc){this._toggleTag("code");return;}else if("["===Tc){this._linkState=0;this._linkText=[];this._linkUrl=[];return this._parseLink;}else if("-"===Tc){this._escapeCount=1;this._escapeChar="-";return this._parseEscape;}else if("\n"===Tc){return null;}else{this._output(Tc);}},_parseItalic:function(Tc){if("*"===Tc){this._toggleTag("strong");}else{this._toggleTag("em");this._output(Tc);}return this._parseContent;},_parseText:function(Tc){if(this._handleEntities(Tc)){return;}if("\n"===Tc){this._closeTags();return null;}else{this._output(Tc);}},_linkText:[],_linkUrl:[],_linkState:0,_parseLink:function(Tc){var Uc=this._linkState;if("]"===Tc&&0===Uc){++this._linkState;}else if("("===Tc&&1===Uc){++this._linkState;}else if(")"===Tc&&2===Uc){this._output("<a href=\"");this._output(this._linkUrl.join(""));this._output("\">");this._output(this._linkText.join(""));this._output("</a>");return this._parseContent;}else if(0===Uc){this._linkText.push(Tc);}else if(2===Uc){this._linkUrl.push(Tc);}}}});gpf.define("gpf.html.File",{"[Class]":[gpf.$InterfaceImplement(gpf.interfaces.ITextStream)],public:{constructor:function(Tc){this._file=Tc;},name:function(){return this._file.name;},size:function(){return this._file.size;},read:function(Tc,Uc){var Vc=this,Wc=this._reader,Xc=this._file.size-this._pos,Yc;if(0===Xc){gpf.defer(gpf.events.fire,0,this,[Sc.IReadableStream.EVENT_END_OF_STREAM,Uc]);return;}this._eventsHandler=Uc;if(null===Wc){Wc=this._reader=new FileReader;Wc.onloadend=function(Zc){Vc._onLoadEnd(Zc);};}if(0===Tc||Tc>Xc){Tc=Xc;}Yc=this._file.slice(this._pos,Tc);this._pos+=Tc;Wc.readAsArrayBuffer(Yc);}},private:{_file:null,_reader:null,_pos:0,_eventsHandler:null,_onLoadEnd:function(Tc){var Uc=Tc.target,Vc,Wc,Xc,Yc;gpf.ASSERT(Uc===this._reader,"Unexpected change of reader");if(Uc.error){gpf.events.fire.apply(this,[Sc.IReadableStream.ERROR,{error:{name:Uc.error.name,message:Uc.error.message}},this._eventsHandler]);}else if(Uc.readyState===FileReader.DONE){Vc=new Int8Array(Uc.result);Wc=Vc.length;Xc=[];for(Yc=0;Yc<Wc;++Yc){Xc.push(Vc[Yc]);}gpf.events.fire.apply(this,[Sc.IReadableStream.EVENT_DATA,{buffer:Xc},this._eventsHandler]);}}}});var Tc=gpf._defAttr("HtmlAttribute",{}),Uc=gpf._defAttr("$HtmlHandler",Tc,{private:{_selector:"",_globalSelector:false},protected:{_select:function(Wc){var Xc=this._selector;if(Xc){if(this._globalSelector){return document.querySelector(Xc);}else{return Wc.querySelector(Xc);}}return undefined;}},public:{constructor:function(Wc,Xc){if(Wc){this._selector=Wc;}if(undefined!==Xc){this._globalSelector=Xc===true;}}}}),Vc=gpf._defAttr("$HtmlEvent",Uc,{private:{_event:""},public:{constructor:function(Wc,Xc,Yc){Uc.apply(this,[Xc,Yc]);this._event=Wc;}}});function Nc(Wc,Xc){var Yc;if(1!==Xc.length()){gpf.Error.HtmlHandlerMultiplicityError({member:Wc});}Yc=Xc.get(0);if(!(Yc instanceof Vc)){return Yc;}return null;}function Oc(Wc,Xc){var Yc=Nc(Wc,Xc);if(Yc&&!Yc._selector){return Yc;}}gpf.html.handle=function(Wc,Xc){var Yc=new gpf.attributes.Map(Wc).filter(Tc),Zc=Yc.filter(Uc),ad,bd;if(0===Zc.count()){gpf.Error.HtmlHandlerMissing();}ad=Zc.each(Oc);if(undefined===ad){gpf.Error.HtmlHandlerNoDefault();}ad=ad.member();if(undefined===Xc){Xc=Wc[ad];gpf.ASSERT(Xc,"Handle not previously set");}else{if("string"===typeof Xc){Xc=document.querySelector(Xc);}gpf.ASSERT(Xc,"Selector does not resolve to DOM");if(!Xc){return;}Wc[ad]=Xc;}Zc.each(Pc,Wc,[Xc]);bd=Yc.filter(Vc);if(0<bd.count()){bd.each(Qc,Wc,[Xc]);}return Xc;};function Pc(Wc,Xc,Yc){var Zc=Nc(Wc,Xc);if(!Zc||!Zc._selector){return;}Yc=Zc._select(Yc);if(!Yc){return;}this[Wc]=Yc;}function Qc(Wc,Xc,Yc){Xc.each(Rc,this,[Wc,Yc]);}function Rc(Wc,Xc,Yc){var Zc=Wc._event,ad=Xc+":$HtmlEvent("+Zc+","+Wc._selector+")";Yc=Wc._select(Yc);if(!Yc){return;}if(!this[ad]){Yc.addEventListener(Zc,gpf.Callback.bind(this,Xc));this[ad]=true;}}gpf.extend(gpf.html,{hasClass:function(Wc,Xc){var Yc,Zc,ad;if("string"===typeof Xc){Xc=[Xc];}gpf.ASSERT(Xc instanceof Array,"Expected array");Yc=Wc.className.split(" ");Zc=Xc.length;for(ad=0;ad<Zc;++ad){if(undefined!==gpf.test(Yc,Xc[ad])){return true;}}return false;},addClass:function(Wc,Xc){var Yc,Zc,ad,bd;if("string"===typeof Xc){Xc=[Xc];}gpf.ASSERT(Xc instanceof Array,"Expected array");Yc=Wc.className.split(" ");Zc=Yc.length;ad=Xc.length;for(bd=0;bd<ad;++bd){gpf.set(Yc,Xc[bd]);}if(Zc!==Yc.length){Wc.className=Yc.join(" ");}return Wc;},removeClass:function(Wc,Xc){var Yc,Zc,ad,bd;if("string"===typeof Xc){Xc=[Xc];}gpf.ASSERT(Xc instanceof Array,"Expected array");Yc=Wc.className.split(" ");Zc=Yc.length;ad=Xc.length;for(bd=0;bd<ad;++bd){gpf.clear(Yc,Xc[bd]);}if(Zc!==Yc.length){Wc.className=Yc.join(" ");}return Wc;}});var Wc=gpf.interfaces,Xc=gpf.attributes;gpf.xml={};gpf._defIntrf("IXmlSerializable",{"[toXml]":[gpf.$ClassEventHandler()],toXml:function(Yc,Zc){Wc.ignoreParameter(Yc);Wc.ignoreParameter(Zc);}});gpf._defIntrf("IXmlContentHandler",{"[characters]":[gpf.$ClassEventHandler()],characters:function(Yc,Zc){Wc.ignoreParameter(Yc);Wc.ignoreParameter(Zc);},"[endDocument]":[gpf.$ClassEventHandler()],endDocument:function(Yc){Wc.ignoreParameter(Yc);},"[endElement]":[gpf.$ClassEventHandler()],endElement:function(Yc){Wc.ignoreParameter(Yc);},endPrefixMapping:function(Yc){Wc.ignoreParameter(Yc);},"[ignorableWhitespace]":[gpf.$ClassEventHandler()],ignorableWhitespace:function(Yc,Zc){Wc.ignoreParameter(Yc);Wc.ignoreParameter(Zc);},"[processingInstruction]":[gpf.$ClassEventHandler()],processingInstruction:function(Yc,Zc,ad){Wc.ignoreParameter(Yc);Wc.ignoreParameter(Zc);Wc.ignoreParameter(ad);},setDocumentLocator:function(Yc){Wc.ignoreParameter(Yc);},skippedEntity:function(Yc){Wc.ignoreParameter(Yc);},"[startDocument]":[gpf.$ClassEventHandler()],startDocument:function(Yc){Wc.ignoreParameter(Yc);},"[startElement]":[gpf.$ClassEventHandler()],startElement:function(Yc,Zc,ad,bd,cd){Wc.ignoreParameter(Yc);Wc.ignoreParameter(Zc);Wc.ignoreParameter(ad);Wc.ignoreParameter(bd);Wc.ignoreParameter(cd);},startPrefixMapping:function(Yc,Zc){Wc.ignoreParameter(Yc);Wc.ignoreParameter(Zc);}});var Yc=gpf._defAttr("XmlAttribute",{protected:{_alterPrototype:function(md){if(undefined===md.toXml){Xc.add(md.constructor,"Class",[gpf.$InterfaceImplement(Wc.IXmlSerializable)]);md.toXml=jd;Xc.add(md.constructor,"Class",[gpf.$InterfaceImplement(Wc.IXmlContentHandler,ld)]);}}}}),Zc=gpf._defAttr("$XmlIgnore",Yc,{}),ad=gpf._defAttr("$XmlAttribute",Yc,{private:{"[_name]":[gpf.$ClassProperty()],_name:""},public:{constructor:function(md){gpf.ASSERT(gpf.xml.isValidName(md),"Valid XML attribute name");this._name=md;}}}),bd=gpf._defAttr("XmlRawElementAttribute",Yc,{private:{"[_name]":[gpf.$ClassProperty()],_name:""},public:{constructor:function(md){gpf.ASSERT(gpf.xml.isValidName(md),"Valid XML element name");this._name=md;}}}),cd=gpf._defAttr("$XmlElement",bd,{private:{"[_objClass]":[gpf.$ClassProperty()],_objClass:null},public:{constructor:function(md,nd){this._super(md);if(nd){this._objClass=nd;}}}}),dd=gpf._defAttr("$XmlList",bd,{}),ed=function(md,nd){var od,pd,qd=null,rd=null,sd;for(od=0;od<md.length();++od){pd=md.get(od);if(!(pd instanceof cd)){continue;}sd=pd.objClass();if(sd){if(nd instanceof sd){if(!rd||sd.prototype instanceof rd.objClass()){rd=pd;}}}else if(!qd){qd=pd;}}if(null!==rd){return rd;}else{return qd;}},fd=function(md,nd,od,pd){var qd;if(nd instanceof Array||pd.has(dd)||"object"===od||pd.has(cd)){return"";}qd=pd.has(ad);if(qd&&qd.name()){md=qd.name();}else{if("_"===md.charAt(0)){md=md.substr(1);}}return md;},gd=function(md,nd,od,pd){var qd,rd,sd,td,ud,vd,wd,xd;qd=md[nd];if(qd instanceof Date){qd=gpf.dateToComparableFormat(qd,true);}rd=pd.member(nd);if("_"===nd.charAt(0)){nd=nd.substr(1);}sd=rd.has(dd);if(qd instanceof Array||sd){if(sd&&sd.name()){td=true;od.startElement("",sd.name());}rd=rd.filter(cd);for(ud=0;ud<qd.length;++ud){vd=qd[ud];wd=ed(rd,vd);if(wd&&wd.name()){xd=wd.name();}else{xd="item";}id(vd,od,xd);}if(td){od.endElement();}return;}sd=rd.has(cd);if(sd&&sd.name()){xd=sd.name();}id(qd,od,xd);},hd=function(md,nd,od,pd){var qd,rd,sd,td,ud,vd=0,wd=0,xd;for(rd in md.constructor.prototype){sd=md[rd];if(sd instanceof Date){sd=gpf.dateToComparableFormat(sd,true);}td=typeof sd;if("function"===td){continue;}qd=pd.member(rd);if(qd.has(Zc)){continue;}ud=fd(rd,sd,td,qd);if(ud){if(0===wd){wd={};}wd[ud]=sd.toString();}else{if(0===vd){vd=[];}vd.push(rd);}}nd.startElement("",od,od,wd);if(vd){for(xd=0;xd<vd.length;++xd){gd(md,vd[xd],nd,pd);}}},id=function(md,nd,od){var pd=new Xc.Map(md).filter(Yc),qd;if(!od){qd=pd.member("Class").has(cd);if(qd){od=qd.name();}else{od=gpf.classDef(md.constructor).name();if(!od){od="object";}}}if("object"!==typeof md){nd.startElement("",od);nd.characters(gpf.value(md,""));}else{hd(md,nd,od,pd);}nd.endElement();},jd=function(md,nd){var od=gpf.interfaces.wrap(Wc.IXmlContentHandler),pd=new od(md);pd.$catch(nd).$finally(nd,"ready");id(this,pd);},kd=gpf.define("FromXmlContentHandler",{"[Class]":[gpf.$InterfaceImplement(Wc.IXmlContentHandler)],_target:null,_firstElement:true,_forward:[],constructor:function(md){this._target=md;this._firstElement=true;this._forward=[];},_fillFromAttributes:function(md){var nd=new Xc.Map(this._target),od=this._target.constructor.prototype,pd,qd,rd;for(pd in od){if("function"===typeof od[pd]){continue;}qd=nd.member(pd).filter(ad);if(0<qd.length()){gpf.ASSERT(qd.length()===1,"Expected one attribute only");rd=qd.get(0).name();}else{if(pd.charAt(0)==="_"){rd=pd.substr(1);}else{continue;}}if(rd in md){this._target[pd]=gpf.value(md[rd],od[pd]);}}},_fillFromElement:function(md,nd,od,pd){var qd=new Xc.Map(this._target).filter(bd),rd=this._forward[0],sd,td,ud,vd,wd,xd;gpf.interfaces.ignoreParameter(md);gpf.interfaces.ignoreParameter(od);gpf.interfaces.ignoreParameter(pd);if(undefined===rd){sd=qd.members();}else{gpf.ASSERT(rd.type!==0,"No content handler here");sd=[rd.member];}for(td=0;td<sd.length;++td){ud=sd[td];vd=qd.member(ud);for(wd=0;wd<vd.length();++wd){xd=vd.get(wd);if(xd.name()===nd){if(this._fillFromRawElement(ud,xd)){return;}}}}},_fillFromRawElement:function(md,nd){var od,pd;if(nd instanceof cd){if(nd.objClass()){od=new(nd.objClass());this._target[md]=od;pd=Wc.query(od,Wc.IXmlContentHandler);}if(pd){pd={type:0,iXCH:pd};}else{pd={type:1,member:md,buffer:[]};}}else if(nd instanceof dd){this._target[md]=[];pd={type:2,member:md};}if(pd){pd.depth=1;this._forward.unshift(pd);return true;}else{return false;}},characters:function(md,nd){var od=this._forward[0];if(undefined!==od){if(0===od.type){od.iXCH.characters.apply(od.iXCH,arguments);}else if(1===od.type){od.buffer.push(md);}}gpf.events.fire.apply(this,["ready",nd]);},endDocument:function(md){gpf.events.fire.apply(this,["ready",md]);},endElement:function(md){var nd=this._forward[0],od,pd;if(undefined!==nd){if(0===nd.type){nd.iXCH.endElement.apply(nd.iXCH,arguments);}else if(1===nd.type){od=this._target[nd.member];pd=nd.buffer.join("");if(od instanceof Array){od.push(pd);}else{this._target[nd.member]=gpf.value(pd,od);}}if(0===--nd.depth){this._forward.shift();}}gpf.events.fire.apply(this,["ready",md]);},endPrefixMapping:function(md){Wc.ignoreParameter(md);},ignorableWhitespace:function(md,nd){Wc.ignoreParameter(md);gpf.events.fire.apply(this,["ready",nd]);},processingInstruction:function(md,nd,od){Wc.ignoreParameter(md);Wc.ignoreParameter(nd);gpf.events.fire.apply(this,["ready",od]);},setDocumentLocator:function(md){Wc.ignoreParameter(md);},skippedEntity:function(md){Wc.ignoreParameter(md);},startDocument:function(md){gpf.events.fire.apply(this,["ready",md]);},startElement:function(md,nd,od,pd,qd){var rd=this._forward[0];gpf.interfaces.ignoreParameter(md);gpf.interfaces.ignoreParameter(nd);gpf.interfaces.ignoreParameter(od);if(undefined!==rd){if(0===rd.type){++rd.depth;rd.iXCH.startElement.apply(rd.iXCH,arguments);}else{this._fillFromElement.apply(this,arguments);}}else if(this._firstElement){this._firstElement=false;this._fillFromAttributes(pd);}else{this._fillFromElement.apply(this,arguments);}gpf.events.fire.apply(this,["ready",qd]);},startPrefixMapping:function(md,nd){Wc.ignoreParameter(md);Wc.ignoreParameter(nd);}}),ld=function(md){return new kd(md);};gpf.define("gpf.xml.Writer",{"[Class]":[gpf.$InterfaceImplement(Wc.IXmlContentHandler)],private:{_stream:null,_branch:[],_pendingPrefixMappings:[],_buffer:[],_eventsHandler:null,_closeLeafForContent:function(){var md;if(this._branch.length){md=this._branch[this._branch.length-1];if(!md.hasContent){this._buffer.push(">");md.hasContent=true;}}},_flush:function(md){this._eventsHandler=md;this._flushed();},_flushed:function(md){var nd;if(md&&md.type()===Wc.IWritableStream.EVENT_ERROR){gpf.events.fire.apply(this,[md,this._eventsHandler]);}else if(0===this._buffer.length){nd=this._eventsHandler;this._eventsHandler=null;gpf.events.fire.apply(this,[Wc.IWritableStream.EVENT_READY,nd]);}else{this._stream.write(this._buffer.shift(),gpf.Callback.bind(this,"_flushed"));}}},public:{constructor:function(md){this._stream=Wc.query(md,Wc.IWritableStream,true);this._branch=[];this._pendingPrefixMappings=[];this._buffer=[];},characters:function(md,nd){gpf.ASSERT(null===this._eventsHandler,"Write in progress");this._closeLeafForContent();this._buffer.push(md);this._flush(nd);},endDocument:function(md){gpf.ASSERT(null===this._eventsHandler,"Write in progress");this._flush(md);},endElement:function(md){gpf.ASSERT(null===this._eventsHandler,"Write in progress");var nd=this._branch.pop();if(nd.hasContent){this._buffer.push("</",nd.qName,">");}else{this._buffer.push("/>");}this._flush(md);},endPrefixMapping:function(md){gpf.interfaces.ignoreParameter(md);},ignorableWhitespace:function(md,nd){gpf.ASSERT(null===this._eventsHandler,"Write in progress");this._closeLeafForContent();this._buffer.push(md);this._flush(nd);},processingInstruction:function(md,nd,od){gpf.ASSERT(null===this._eventsHandler,"Write in progress");this._buffer.push("<?",md," ",gpf.escapeFor(nd,"xml"),"?>");this._flush(od);},setDocumentLocator:function(md){gpf.interfaces.ignoreParameter(md);},skippedEntity:function(md){gpf.interfaces.ignoreParameter(md);},startDocument:function(md){gpf.ASSERT(null===this._eventsHandler,"Write in progress");this._flush(md);},startElement:function(md,nd,od,pd,qd){gpf.ASSERT(null===this._eventsHandler,"Write in progress");var rd,sd,td,ud;if(undefined===od&&!md){od=nd;}this._closeLeafForContent();var vd={hasContent:false,qName:od};this._branch.push(vd);this._buffer.push("<",od);if(pd){for(rd in pd){if(pd.hasOwnProperty(rd)){this._buffer.push(" ",rd,"=\"");sd=gpf.escapeFor(pd[rd].toString(),"xml");if(-1<sd.indexOf("\"")){sd=gpf.replaceEx(sd,{"\"":"&quot;"});}this._buffer.push(sd,"\"");}}}td=this._pendingPrefixMappings.length;if(td){for(ud=0;ud<td;++ud){this._buffer.push(" ",this._pendingPrefixMappings[ud]);}this._pendingPrefixMappings=[];}this._flush(qd);},startPrefixMapping:function(md,nd){this._pendingPrefixMappings.push(["xmlns:",md,":\"",gpf.escapeFor(nd,"xml"),"\""].join(""));}}});gpf.xml.convert=function(md,nd,od){var pd;if("string"===typeof md){gpf.Error.NotImplemented();}else if("object"===typeof md){pd=Wc.query(md,Wc.IXmlSerializable);if(null===pd){pd=new gpf.xml.ConstNode(md);}pd.toXml(nd,od);}};var md=gpf._alpha+gpf._ALPHA+"_",nd=md+"012345789.-";gpf.extend(gpf.xml,{isValidName:function(od){var pd;if(0===od.length||-1===md.indexOf(od.charAt(0))){return false;}for(pd=1;pd<od.length;++pd){if(-1===nd.indexOf(od.charAt(pd))){return false;}}return true;},toValidName:function(od){var pd;if(gpf.xml.isValidName(od)){return od;}pd="_"+od;if(!gpf.xml.isValidName(pd)){gpf.Error.XmlInvalidName();}return pd;}});var pd=gpf.interfaces;gpf.extend(gpf.xml,{NODE_INVALID:0,NODE_ELEMENT:1,NODE_ATTRIBUTE:2,NODE_TEXT:3,NODE_ENTITY_REFERENCE:5,NODE_PROCESSING_INSTRUCTION:7,NODE_COMMENT:8,NODE_DOCUMENT:9});gpf._defIntrf("IXmlConstNode",{attributes:function(qd){gpf.interfaces.ignoreParameter(qd);return"";},children:function(qd){if(undefined===qd){return[];}else{return undefined;}},localName:function(){return"";},namespaceURI:function(){return"";},nextSibling:function(){return null;},nodeName:function(){return"";},nodeType:function(){return 0;},nodeValue:function(){return null;},ownerDocument:function(){return null;},parentNode:function(){return null;},prefix:function(){return"";},previousSibling:function(){return null;},textContent:function(){return"";}});gpf.define("gpf.xml.ConstNode",{"[Class]":[gpf.$InterfaceImplement(pd.IXmlConstNode),gpf.$InterfaceImplement(pd.IXmlSerializable)],_obj:null,_name:"",_parentNode:null,_attributes:{},_elements:{},_children:[],constructor:function(qd,rd){this._obj=qd;this._attributes=null;this._elements=null;this._children=null;if(undefined===rd){this._name="root";}else{this._name=rd;}},_members:function(){var qd,rd,sd;this._attributes={};this._elements={};if("object"===typeof this._obj&&!(this._obj instanceof Array)){for(qd in this._obj){if(this._obj.hasOwnProperty(qd)){rd=this._obj[qd];if(null===rd){continue;}sd=gpf.xml.toValidName(qd);if("object"===typeof rd){this._elements[qd]=sd;}else{this._attributes[qd]=sd;}}}}},attributes:function(qd){var rd,sd,td;if(null===this._attributes){this._members();}if(undefined===qd){rd={};for(sd in this._attributes){if(this._attributes.hasOwnProperty(sd)){td=this._attributes[sd];rd[td]=this._obj[sd];}}return rd;}for(sd in this._attributes){if(this._attributes.hasOwnProperty(sd)){if(qd===this._attributes[sd]){return this._obj[sd];}}}return undefined;},children:function(qd){var rd,sd,td,ud;if(null===this._children){if(null===this._elements){this._members();}this._children=[];if(this._obj instanceof Array){for(rd=0;rd<this._obj.length;++rd){sd=new gpf.xml.ConstNode(this._obj[rd],"item");sd._parentNode=this;this._children.push(sd);}}else{for(td in this._elements){if(this._elements.hasOwnProperty(td)){ud=this._elements[td];sd=new gpf.xml.ConstNode(this._obj[td],ud);sd._parentNode=this;this._children.push(sd);}}}}return gpf.arrayOrItem(this._children,qd);},localName:function(){return this._name;},namespaceURI:function(){return"";},nextSibling:function(){var qd;if(null!==this._parentNode){qd=gpf.test(this._parentNode._children,this);if(undefined!==qd&&qd<this._parentNode._children.length-1){return this._parentNode._children[qd+1];}}return null;},nodeName:function(){return this._name;},nodeType:function(){return gpf.xml.NODE_ELEMENT;},nodeValue:function(){return this._obj;},ownerDocument:function(){return null;},parentNode:function(){return this._parentNode;},prefix:function(){return"";},previousSibling:function(){var qd;if(null!==this._parentNode){qd=gpf.test(this._parentNode._children,this);if(0<qd){return this._parentNode._children[qd-1];}}return null;},textContent:function(){if("object"!==typeof this._obj){return gpf.value(this._obj,"");}else{return"";}},toXml:function(qd,rd){gpf.xml.nodeToXml(this,qd,rd);}});function od(qd,rd){var sd=qd.localName(),td=qd.attributes(),ud=qd.children(),vd=qd.textContent(),wd;rd.startElement("",sd,sd,td);if(vd){rd.characters(vd);}else{for(wd=0;wd<ud.length;++wd){od(ud[wd],rd);}}rd.endElement();}gpf.xml.nodeToXml=function(qd,rd,sd){var td=gpf.interfaces.wrap(pd.IXmlContentHandler),ud=new td(rd);ud.$catch(sd).$finally(sd,"ready");od(qd,ud);};function qd(wd,xd,yd,zd){var Ad,Bd;for(Ad=0;Ad<wd.length;++Ad){Bd=wd[Ad];xd(Bd,yd,zd);}}function rd(wd,xd,yd){var zd=wd.children(),Ad,Bd,Cd;for(Bd=0;Bd<zd.length;++Bd){Cd=true;Ad=zd[Bd];if(xd.name&&Ad.localName()!==xd.name){Cd=false;}else if(xd.text&&Ad.textContent()!==xd.text){Cd=false;}if(Cd){yd.push(Ad);}if(undefined!==xd.relative&&!xd.relative){rd(Ad,xd,yd);}}}function sd(wd,xd,yd){var zd,Ad,Bd;if(xd.name){Bd=wd.attributes(xd.name);if(undefined!==Bd&&(!xd.text||Bd===xd.text)){yd.push(wd);}}else{zd=wd.attributes();for(Ad in zd){if(zd.hasOwnProperty(Ad)){Bd=zd[Ad];if(!xd.text||Bd===xd.text){yd.push(wd);break;}}}}}function td(wd,xd,yd){if(gpf.xml.NODE_ELEMENT===xd.type){qd(wd,rd,xd,yd);}else if(gpf.xml.NODE_ATTRIBUTE===xd.type){qd(wd,sd,xd,yd);}}function ud(wd,xd,yd){var zd,Ad,Bd,Cd,Dd;if(xd.and){Ad=xd.and;Bd=0;}else if(xd.or){Ad=xd.or;Bd=1;}for(Cd=0;Cd<Ad.length;++Cd){Dd=Ad[Cd];if(Dd.and||Dd.or){zd=[];ud(wd,Dd,zd);}else{zd=vd(wd,Dd);}if(0===Bd&&zd.length===0){return;}if(1===Bd&&zd.length!==0){yd.push(wd);return;}}if(0===Bd){yd.push(wd);}}function vd(wd,xd){var yd,zd=[wd];while(xd){yd=[];td(zd,xd,yd);if(0===yd.length){return[];}zd=yd;if(xd.filter){yd=[];qd(zd,ud,xd.filter,yd);if(0===yd.length){return[];}zd=yd;}xd=xd.then;}return yd;}gpf.define("gpf.xml.XPath",{_xpath:null,constructor:function(wd){this._reset();if("string"===typeof wd){this._xpath=this._compile(wd);}else{this._xpath=wd;}},_reset:function(){},_compile:function(wd){gpf.interfaces.ignoreParameter(wd);this._xpath=null;},selectNodes:function(wd){return vd(wd,this._xpath);}});}));