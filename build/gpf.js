!function(a,b){"use strict";if("function"==typeof define&&define.amd)define(["exports"],b);else if("undefined"!=typeof exports)b(exports);else if("undefined"!=typeof module&&module.exports)b(module.exports);else{var c={};b(c),a.gpf=c}}(this,function(a){"use strict";function b(){}function c(a,b,c){var d,e=a.length;for(d=0;d<e;++d)b.call(c,a[d],d,a)}function d(a,b,c){for(var d in a)a.hasOwnProperty(d)&&b.call(c,a[d],d,a)}function e(b,c){b||(console.warn("ASSERTION FAILED: "+c),a.Error.assertionFailed({message:c}))}function f(a,b){void 0===b&&(b="Assertion with no message",a=!1),e(a,b)}function g(a){d(a,e)}function h(a,b){var c;return 0===a.length?Xa(b):(c=[].concat(a),c.push(b),Xa.apply(null,c))}function i(a,b){return Va("string"==typeof b&&b.length,"Source expected (or use _gpfEmptyFunc)"),h(a,b)}function j(a,b){return void 0===b&&(b=a,a=[]),i(a,b)}function k(a){return a.charAt(0).toUpperCase()+a.substr(1)}function l(a,b){var c=a;return d(b,function(a,b){c=c.split(b).join(a)}),c}function m(a,b){return"javascript"===b?'"'+a+'"':a}function n(a,b){return Va(void 0!==Ya[b],"Unknown language"),m(l(a,Ya[b]),b)}function o(a,b){d(b,function(b,c){void 0===a[c]&&(a[c]=b)})}function p(a,b){b&&o(a.prototype,b)}function q(a,b){b&&o(a,b)}function r(a,b){var c=b.on;p(c,b.methods),q(c,b.statics)}function s(a,b){return void 0!==b?a.bind(b):a}function t(a,b){for(var c=a.length,d=0;d<c;)a.hasOwnProperty(d)&&b(a[d],d,a),++d}function u(a,b,c){for(var d=a.length;c<d;){if(a.hasOwnProperty(c)&&!0!==b(a[c],c,a))return!1;++c}return!0}function v(a,b){return u(a,b,0)}function w(a,b){var c,d=b.length;for(c=0;c<d;++c)a.push(b.charAt(c))}function x(a){var b=[];return"string"==typeof a?w(b,a):c(a,function(a){b.push(a)},0),b}function y(a){var b=x(a),c=arguments[1];return"function"==typeof c&&(b=b.map(c,arguments[2])),b}function z(a){return new Array(a).join(" ").split(" ").map(function(a,b){return"p"+b})}function A(a){var b=["var C = this, l = arguments.length;","if (0 === l) { return new C();}"];return a.forEach(function(c,d){var e=d+1;b.push("if ("+e+" === l) { return new C("+a.slice(0,e).join(", ")+");}")}),b.join("\r\n")}function B(a){var b=z(a);return j(b,A(b))}function C(a,b){return b.length>Za.length&&(Za=B(b.length)),Za.apply(a,b)}function D(a){return 10>a?"0"+a:a}function E(a){if(a[1]<12&&a[2]<32&&a[3]<24&&a[4]<60&&a[5]<60)return a}function F(a,b){b?a.push(parseInt(b,10)):a.push(0)}function G(a){var b,c=[],d=a.length;for(b=1;b<d;++b)F(c,a[b]);return c}function H(a){var b;if(a)return b=G(a),--b[1],E(b)}function I(a){if("string"==typeof a)return $a.lastIndex=0,H($a.exec(a))}function J(){var a=arguments[0],b=I(a);return b?new _a(_a.UTC.apply(_a.UTC,b)):C(_a,arguments)}function K(){var a,b,c=["prototype","UTC","parse","now"],d=c.length;for(a=0;a<d;++a)b=c[a],J[b]=_a[b]}function L(){K();var a=!1;try{var b=new Date("2003-01-22T22:45:34.075Z"),c=new Date("2003-01-22");a=2003===b.getUTCFullYear()&&0===b.getUTCMonth()&&22===b.getUTCDate()&&22===b.getUTCHours()&&45===b.getUTCMinutes()&&34===b.getUTCSeconds()&&75===b.getUTCMilliseconds()&&2003===c.getUTCFullYear()&&0===c.getUTCMonth()&&22===c.getUTCDate()}catch(e_){}a||(Ra.Date=J)}function M(a){return"var me = this;\nreturn function ("+z(a).join(", ")+") {\n   var args = _gpfArrayPrototypeSlice.call(arguments, 0);\n    return me.apply(thisArg, prependArgs.concat(args));\n};"}function N(){var a=b.toString.call(this),c=a.indexOf("function"),d=a.indexOf("(",c);return a.substr(c+9,d-c-9).replace(bb,"").trim()}function O(a,b,c){function d(a){return function(b){e&&(e=!1,a(b))}}var e=!0;try{a(d(b),d(c))}catch(e_){e&&(e=!1,c(e_))}}function P(){var a=this;a._handlers.forEach(function(b){b.process(a)}),a._handlers=[]}function Q(a){var b=this;b._state=!1,b._value=a,P.call(b)}function R(a){var b=this;try{if(Va(a!==b,"A promise cannot be resolved with itself."),a&&("object"==typeof a||"function"==typeof a)){var c=a.then;if("function"==typeof c)return void O(c.bind(a),R.bind(b),Q.bind(b))}b._state=!0,b._value=a,P.call(b)}catch(e_){Q.call(b,e_)}}function S(){}function T(a,b){return a.dt-b.dt}function U(a,b){Va("number"==typeof b,"Timeout is required");var c={id:++eb,dt:new Date((new Date).getTime()+b),cb:a};return db.push(c),db.sort(T),eb}function V(a){var b;db.every(function(c,d){return c.id!==a||(b=d,!1)})||db.splice(b,1)}function W(){for(var a,b,c=db;c.length;)a=c.shift(),b=new Date,a.dt>b&&fb(a.dt-b),a.cb()}function X(a){return function(b,c){"function"!=typeof b&&a($(b),c)}}function Y(a){var b,e;return b=a instanceof Array,e=[],b?(c(a,X(function(a){e.push(a)})),"["+e.join(",")+"]"):(d(a,X(function(a,b){e.push(n(b,"javascript")+":"+a)})),"{"+e.join(",")+"}")}function Z(a){return a.toString()}function $(a){return ib[typeof a](a)}function _(a){return j("return "+a)()}function aa(a,b){if(void 0!==a)return a[b]}function ba(a,b){var c=a[b];return void 0===c&&(c=a[b]={}),c}function ca(b,c){var d;return"gpf"===b[0]?(d=a,b=b.slice(1)):d=Ra,b.reduce(c,d)}function da(a,b){var c;return c=b?ba:aa,ca(a,c)}function ea(a,b){this[b]=a}function fa(a,b){return Sa(b),[].slice.call(arguments,1).forEach(function(b){d(b,ea,a)}),a}function ga(a,b,c){function d(a){this._buildMessage(a)}return d.prototype=new jb,fa(d.prototype,{code:a,name:b,message:c}),d.prototype.constructor=d,jb[k(b)]=d,function(a){throw new d(a)}}function ha(a,b,c){var d=ga(a,b,c);return d.CODE=a,d.NAME=b,d.MESSAGE=c,d}function ia(b,c){Sa(b),d(c,function(b,c){var d=++kb;a.Error["CODE_"+c.toUpperCase()]=d,a.Error[c]=ha(d,c,b)})}function ja(a){return a.trim()}function ka(a,b){var c=a.compatibleName();c&&(b.name=c)}function la(a,b,c){a.length&&(c.parameters=new RegExp("\\(\\s*(\\w+(?:\\s*,\\s*\\w+)*)\\s*\\)").exec(b)[1].split(",").map(ja))}function ma(a,b){var c=ja(new RegExp("{((?:.*\\n)*.*)}").exec(a)[1]);c&&(b.body=c)}function na(a,c){var d=b.toString.call(a).replace(bb,"");la(a,d,c),ma(d,c)}function oa(a){var b={};return ka(a,b),na(a,b),b}function pa(a){return a.name?" "+a.name:""}function qa(a){return a.parameters?a.parameters.join(", "):""}function ra(a){return a.body?a.body.toString():""}function sa(a){return"function"+pa(a)+"("+qa(a)+') {\n\t"use strict"\n'+ra(a)+"\n}"}function ta(a,b){var c=Object.keys(b),d=c.map(function(a){return b[a]});return j(c,"return "+a).apply(null,d)}function ua(a,b){return ta(sa(a),b||{})}function va(a){var b;return d(lb,function(c,d){a["$"+d]&&(b=c)}),b}function wa(b){var c=lb[b.$type];return void 0===c&&a.Error.invalidEntityType(),c}function xa(a){var b,c=va(a);return c||(c=wa(a)),b=new c(a),b.check(),b}function ya(a){Va(a&&"object"==typeof a,"Expected an entity definition"),this._initialDefinition=a}function za(a){return a.split(",").map(function(a){return"$"+a})}function Aa(){this._name||a.Error.missingEntityName()}function Ba(a,b){Sa(a),"$"===b.charAt(0)?this._check$Property(b):this._checkProperty(b)}function Ca(a){ya.call(this,a)}function Da(a){return"string"==typeof a?da(a.split(".")):a}function Ea(b){return ua({name:b._name,body:"if (!(this instanceof a._instanceBuilder)) $.Error.classConstructorFunction();\na._resolvedConstructor.apply(this, arguments);"},{$:a,a:b})}function Fa(a,b){var c=oa(a);return c.body="this.$super=s;var r=m.apply(this,arguments);delete this.$super;\nreturn r;",ua(c,{m:a,s:b})}function Ga(a,b){return new RegExp("\\.\\$super\\b").exec(a)?Fa(a,b):a}function Ha(a,c){return c||(c=b),Ga(a,c)}function Ia(a){var b=xa(a);return b.getInstanceBuilder()}var Ja,Ka,La,Ma,Na="0.1.6",Oa={BROWSER:"browser",NODEJS:"nodejs",PHANTOMJS:"phantomjs",RHINO:"rhino",UNKNOWN:"unknown",WSCRIPT:"wscript"},Pa=Oa.UNKNOWN,Qa=!1,Ra=this,Sa=b,Ta=b;"undefined"!=typeof WScript?(Pa=Oa.WSCRIPT,Qa=!0):"undefined"!=typeof print&&"undefined"!=typeof java?(Pa=Oa.RHINO,Qa=!1):"undefined"!=typeof phantom&&phantom.version?(Pa=Oa.PHANTOMJS,Qa="\\"===require("fs").separator,Ra=window):"undefined"!=typeof module&&module.exports?(Pa=Oa.NODEJS,Ma=require("path"),Qa="\\"===Ma.sep,Ra=global):"undefined"!=typeof window&&(Pa=Oa.BROWSER,Ra=window),a.hosts={browser:Oa.BROWSER,nodejs:Oa.NODEJS,phantomjs:Oa.PHANTOMJS,rhino:Oa.RHINO,unknown:Oa.UNKNOWN,wscript:Oa.WSCRIPT},a.host=function(){return Pa},a.version=function(){return Na},Oa.BROWSER===Pa&&(Ta=function(a){window.location="https://arnaudbuchholz.github.io/gpf/exit.html?"+(a||0)},Ja=window,Ka=document,La=Ka.getElementsByTagName("head")[0]||Ka.documentElement),Oa.NODEJS===Pa&&(Ta=function(a){process.exit(a)}),Oa.PHANTOMJS===Pa&&(Ta=function(a){phantom.exit(a)},Ja=window,Ka=document,La=Ka.getElementsByTagName("head")[0]||Ka.documentElement),Oa.RHINO===Pa&&(Ra.console={log:function(a){print("    "+a)},info:function(a){print("[?] "+a)},warn:function(a){print("/!\\ "+a)},error:function(a){print("(X) "+a)}},Ta=function(a){java.lang.System.exit(a)}),Oa.WSCRIPT===Pa&&(Ra.console={log:function(a){WScript.Echo("    "+a)},info:function(a){WScript.Echo("[?] "+a)},warn:function(a){WScript.Echo("/!\\ "+a)},error:function(a){WScript.Echo("(X) "+a)}},Ta=function(a){WScript.Quit(a)});var Ua=function(a){return Array.isArray(a)};Oa.BROWSER===Pa&&(Ja.HTMLCollection||Ja.NodeList)&&(Ua=function(a){return Array.isArray(a)||a instanceof Ja.HTMLCollection||a instanceof Ja.NodeList}),a.isArrayLike=Ua,a.forEach=function(a,b,e){return Ua(a)?void c(a,b,e):void d(a,b,e)};var Va,Wa;a.assert=f,a.asserts=g,Va=b,Wa=b;var Xa=Function;"break,case,class,catch,const,continue,debugger,default,delete,do,else,export,extends,finally,for,function,if,import,in,instanceof,let,new,return,super,switch,this,throw,try,typeof,var,void,while,with,yield".split(",");Oa.NODEJS===Pa&&(a.node={}),a.web={};var Ya={};Ya.javascript={"\\":"\\\\",'"':'\\"',"\n":"\\n","\r":"\\r","\t":"\\t"},Ya.xml={"&":"&amp;","<":"&lt;",">":"&gt;"},r("Array",{on:Array,methods:{every:function(a){return v(this,s(a,arguments[1]))},filter:function(a){var b=[];return a=s(a,arguments[1]),t(this,function(c,d,e){a(c,d,e)&&b.push(c)}),b},forEach:function(a){t(this,s(a,arguments[1]))},indexOf:function(a){var b=-1;return u(this,function(c,d){return c!==a||(b=d,!1)},arguments[1]||0),b},map:function(a){var b=new Array(this.length);return a=s(a,arguments[1]),t(this,function(c,d,e){b[d]=a(c,d,e)}),b},some:function(a){return a=s(a,arguments[1]),!v(this,function(b,c,d){return!a(b,c,d)})},reduce:function(a){var b,c=arguments[1],d=this.length,e=0;for(b=void 0===c?this[e++]:c;e<d;++e)b=a(b,this[e],e,this);return b}},statics:{from:y,isArray:function(a){return"[object Array]"==={}.toString.call(a)}}});var Za=B(10);r("Date",{on:Date,methods:{toISOString:function(){return this.getUTCFullYear()+"-"+D(this.getUTCMonth()+1)+"-"+D(this.getUTCDate())+"T"+D(this.getUTCHours())+":"+D(this.getUTCMinutes())+":"+D(this.getUTCSeconds())+"."+(this.getUTCMilliseconds()/1e3).toFixed(3).slice(2,5)+"Z"}}});var $a=new RegExp("^([0-9][0-9][0-9][0-9])\\-([0-9][0-9])\\-([0-9][0-9])(?:T([0-9][0-9])\\:([0-9][0-9])\\:([0-9][0-9])(?:\\.([0-9][0-9][0-9])Z)?)?$"),_a=Ra.Date;L();var ab=Array.prototype.slice;r("Function",{on:Function,methods:{bind:function(a){var b=this,c=ab.call(arguments,1),d=M(Math.max(this.length-c.length,0));return j(["thisArg","prependArgs","_gpfArrayPrototypeSlice"],d).call(b,a,c,ab)}}});var bb=new RegExp("//.*$|/\\*(?:[^\\*]*|\\*[^/]*)\\*/","gm");!function(){function a(){}return"functionName"!==a.name}()?Function.prototype.compatibleName=function(){return this.name}:Function.prototype.compatibleName=N,r("Object",{on:Object,statics:{create:function(){function a(){}return function(b){a.prototype=b;var c=new a;return a.prototype=null,c.__proto__||(c.__proto__=b),c}}(),getPrototypeOf:function(a){return a.__proto__?a.__proto__:a.constructor.prototype},keys:function(a){var b,c=[];for(b in a)a.hasOwnProperty(b)&&c.push(b);return c},values:function(a){var b,c=[];for(b in a)a.hasOwnProperty(b)&&c.push(a[b]);return c}}}),r("String",{on:String,methods:{trim:function(){var a=new RegExp("^[\\s\ufeff\xa0]+|[\\s\ufeff\xa0]+$","g");return function(){return this.replace(a,"")}}()}});var cb=a.Promise=function(a){O(a,R.bind(this),Q.bind(this))};S.prototype={onFulfilled:null,onRejected:null,resolve:null,reject:null,process:function(a){var b=this;return null===a._state?(a.hasOwnProperty("_handlers")||(a._handlers=[]),void a._handlers.push(b)):void setTimeout(function(){var c,d;if(c=a._state?b.onFulfilled:b.onRejected,null===c)return void(a._state?b.resolve(a._value):b.reject(a._value));try{d=c(a._value)}catch(e_){return void b.reject(e_)}b.resolve(d)},0)}},cb.prototype={_state:null,_value:null,_handlers:[],then:function(a,b){var c=this;return new cb(function(d,e){var f=new S;void 0!==a&&(f.onFulfilled=a),void 0!==b&&(f.onRejected=b),f.resolve=d,f.reject=e,f.process(c)})},"catch":function(a){return this.then(null,a)}},cb.resolve=function(a){return new cb(function(b){b(a)})},cb.reject=function(a){return new cb(function(b,c){Sa(b),c(a)})},cb.all=function(a){return 0===a.length?cb.resolve([]):new cb(function(b,c){function d(f,g){try{if(f&&f instanceof cb)return void f.then(function(a){d(a,g)},c);a[g]=f,0===--e&&b(a)}catch(e_){c(e_)}}var e=a.length;a.forEach(d)})},cb.race=function(a){return new cb(function(b,c){a.forEach(function(a){a.then(b,c)})})},void 0===Ra.Promise&&(Ra.Promise=cb);var db=[],eb=0,fb=b;a.handleTimeout=b,"undefined"==typeof setTimeout&&(Oa.WSCRIPT===Pa?fb=function(a){WScript.Sleep(a)}:Oa.RHINO===Pa?fb=java.lang.Thread.sleep:console.warn("No implementation for setTimeout"),Ra.setTimeout=U,Ra.clearTimeout=V,a.handleTimeout=W);var gb,hb,ib={undefined:b,"function":b,number:Z,"boolean":Z,string:function(a){return n(a,"javascript")},object:function(a){return null===a?"null":Y(a)}};"undefined"==typeof JSON?(gb=$,hb=_,Ra.JSON={stringify:gb,parse:hb}):(gb=JSON.stringify,hb=JSON.parse),a.context=function(a){return void 0===a?Ra:da(a.split("."))},a.extend=fa,Ya.html=fa(Ya.xml,{"\xe0":"&agrave;","\xe1":"&aacute;","\xe8":"&egrave;","\xe9":"&eacute;","\xea":"&ecirc;"});var jb=a.Error=function(){};jb.prototype=new Error,fa(jb.prototype,{constructor:jb,code:0,name:"Error",message:"",_buildMessage:function(a){var b;a&&(b={},d(a,function(a,c){b["{"+c+"}"]=a.toString()}),this.message=l(this.message,b))}});var kb=0;ia("error",{notImplemented:"Not implemented",abstractMethod:"Abstract method",assertionFailed:"Assertion failed: {message}",invalidParameter:"Invalid parameter"}),ia("define/detect",{invalidEntityType:"Invalid entity type"});var lb={};ya.prototype={constructor:ya,_initialDefinition:{}},ia("define/check",{invalidEntity$Property:"Invalid entity $ property",missingEntityName:"Missing entity name",invalidEntityNamespace:"Invalid entity namespace"}),fa(ya.prototype,{_type:"",_allowed$Properties:za("type,name,namespace"),_check$Property:function(b){-1===this._allowed$Properties.indexOf(b)&&a.Error.invalidEntity$Property()},_checkProperty:j(["name"]," "),_checkProperties:function(){d(this._initialDefinition,Ba,this)},_name:"",_readName:function(){var a=this._initialDefinition;this._name=a["$"+this._type]||a.$name},_checkNameIsNotEmpty:Aa,_checkName:Aa,_namespace:"",_extractRelativeNamespaceFromName:function(){var a=new RegExp("(.*)\\.([^\\.]+)$").exec(this._name);if(a)return this._name=a[2],a[1]},_readNamespace:function(){var a=[this._initialDefinition.$namespace,this._extractRelativeNamespaceFromName()].filter(function(a){return a});a.length>0&&(this._namespace=a.join("."))},_checkNamespace:function(){new RegExp("^(:?[a-z_$][a-zA-Z0-9]+(:?\\.[a-z_$][a-zA-Z0-9]+)*)?$").exec(this._namespace)||a.Error.invalidEntityNamespace()},check:function(){this._checkProperties(),this._readName(),this._checkNameIsNotEmpty(),this._readNamespace(),this._checkName(),this._checkNamespace()}}),fa(ya.prototype,{_instanceBuilder:null,getInstanceBuilder:function(){return this._instanceBuilder||this._setInstanceBuilder(this._build()),this._instanceBuilder},_setInstanceBuilder:function(a){this._namespace&&(da(this._namespace.split("."),!0)[this._name]=a),this._instanceBuilder=a},_build:b}),Ca.prototype=Object.create(ya.prototype),fa(Ca.prototype,{constructor:Ca,_type:"class"}),lb["class"]=Ca,ia("define/class/check",{invalidClassName:"Invalid class name",invalidClassProperty:"Invalid class property",invalidClassExtend:"Invalid class extend"}),fa(Ca.prototype,{_allowed$Properties:ya.prototype._allowed$Properties.concat(za("class,extend")),_checkMemberName:function(b){new RegExp("^[a-z_][a-zA-Z0-9]*$").exec(b)||a.Error.invalidClassProperty()},_reservedNames:"super,class,public,private,protected,static,mixin".split(","),_checkReservedMemberName:function(b){-1!==this._reservedNames.indexOf(b)&&a.Error.invalidClassProperty()},_checkProperty:function(a){ya.prototype._checkProperty.call(this,a),this._checkMemberName(a),this._checkReservedMemberName(a)},_checkName:function(){ya.prototype._checkName.call(this),new RegExp("^[A-Z_$][a-zA-Z0-9]*$").exec(this._name)||a.Error.invalidClassName()},_extend:Object,_readExtend:function(){var a=Da(this._initialDefinition.$extend);a&&(this._extend=a)},_checkExtend:function(){"function"!=typeof this._extend&&a.Error.invalidClassExtend()},check:function(){ya.prototype.check.call(this),this._readExtend(),this._checkExtend()}}),ia("define/class/constructor",{"classConstructorFunction":"This is a class constructor function, use with new"}),fa(Ca.prototype,{_resolvedConstructor:b}),fa(Ca.prototype,{_build:function(){var a=Ea(this),b=Object.create(this._extend.prototype);return a.prototype=b,b.constructor=a,this._buildPrototype(b),this._resolveConstructor(),a},_addMethodToPrototype:function(a,b,c){a[b]=Ha(c,this._extend.prototype[b])},_addMemberToPrototype:function(a,b,c){"function"==typeof c?this._addMethodToPrototype(a,b,c):a[b]=c},_buildPrototype:function(a){d(this._initialDefinition,function(b,c){"$"!==c.charAt(0)&&"constructor"!==c&&this._addMemberToPrototype(a,c,b)},this)},_resolveConstructor:function(){this._initialDefinition.hasOwnProperty("constructor")?this._resolvedConstructor=Ha(this._initialDefinition.constructor,this._extend):this._resolvedConstructor=this._extend}}),a.define=Ia});