
(function (a, b) {"use strict";if (typeof define === "function" && define.amd) {define(["exports"], b);} else if (typeof exports !== "undefined") {b(exports);} else {b(a.gpf = {});}}(this, function (a) {"use strict";var a, b;if ("undefined" !== typeof WScript) {a = "wscript";b = function () {return this;}.apply(null, []);b.console = {log: function (c) {WScript.Echo("    " + c);},info: function (c) {WScript.Echo("[?] " + c);},warn: function (c) {WScript.Echo("/!\\ " + c);},error: function (c) {WScript.Echo("(X) " + c);}};} else if ("undefined" !== typeof module && module.exports) {a = "nodejs";b = global;} else if ("undefined" !== typeof window) {a = "browser";b = window;} else {a = "unknown";b = this;}gpf.host = function () {return a;};gpf.context = function (c) {var d, e, f;if (undefined === c) {return b;} else {if ("string" === typeof c) {c = c.split(".");}d = c.length;e = 0;if (c[0] === "gpf") {f = gpf;++e;} else {f = b;}for (; e < d; ++e) {f = f[c[e]];if (undefined === f) {break;}}return f;}};gpf.loaded = function (c) {if (c) {c();}return true;};gpf.NOT_IMPLEMENTED = function () {console.error("Not implemented");throw { message: "Not implemented" };};gpf.ASSERT = function () {};var c = function (o, p, q) {var r, s = o.length, t;for (t = 0; t < s; ++t) {r = p.apply(this, [t,o[t]]);if (undefined !== r) {return r;}}return q;}, d = function (o, p) {var q = o.length, r;for (r = 0; r < q; ++r) {p.apply(this, [r,o[r]]);}}, e = function (o, p, q) {var r, s;for (s in o) {if (o.hasOwnProperty(s)) {r = p.apply(this, [s,o[s]]);if (undefined !== r) {return r;}}}return q;}, f = function (o, p) {var q;for (q in o) {if (o.hasOwnProperty(q)) {p.apply(this, [q,o[q]]);}}}, g = function (o, p) {this[0][o] = p;}, h = function (o, p) {var q = this[0], r = this[2];if (undefined !== q[o]) {r(q, o, p);} else {q[o] = p;}}, i = function (o, p, q) {var r, s, t, u = o.length;for (r = 0; r < u; ++r) {s = o[r].a;t = o[r].b;if (s === p && t === q || t === p && s === q) {return r;}}return undefined;}, j = function (o, p, q) {if (q && ("object" === typeof o || "object" === typeof p)) {if (o instanceof String || p instanceof String) {return o.toString() === p.toString();}if (o instanceof Number || p instanceof Number) {return o.valueOf() === p.valueOf();}return false;}return false;}, k = function (o, p, q, r) {if (o !== p) {if (typeof o !== typeof p && !j(o, p, q)) {return false;}if (null === o || null === p || "object" !== typeof o) {return false;}if (undefined === i(r.done, o, p)) {r.todo.push(o);r.todo.push(p);}}return true;}, l = function (o, p, q) {var r, s, t = {todo: [o,p],done: []};while (0 !== t.todo.length) {p = t.todo.pop();o = t.todo.pop();if (o.prototype !== p.prototype) {return false;}t.done.push({a: o,b: p});s = 0;for (r in o) {if (o.hasOwnProperty(r)) {++s;if (!k(o[r], p[r], q, t)) {return false;}}}for (r in p) {if (p.hasOwnProperty(r)) {--s;}}if (0 !== s) {return false;}}return true;}, m = {boolean: function (o, p, q) {if ("string" === p) {if ("yes" === o || "true" === o) {return true;}return 0 !== parseInt(o, 10);}if ("number" === p) {return 0 !== o;}return q;},number: function (o, p, q) {if ("string" === p) {return parseFloat(o);}return q;},string: function (o, p, q) {gpf.interfaces.ignoreParameter(p);gpf.interfaces.ignoreParameter(q);if (o instanceof Date) {return gpf.dateToComparableFormat(o);}return o.toString();},object: function (o, p, q) {if (q instanceof Date && "string" === p) {return gpf.dateFromComparableFormat(o);}return q;}}, n = Function;gpf.each = function (o, p, q) {if (undefined === q) {if (o instanceof Array) {d.apply(this, arguments);} else {f.apply(this, arguments);}return undefined;}if (o instanceof Array) {return c.apply(this, arguments);}return e.apply(this, arguments);};gpf.extend = function (o, p, q) {var r;if (undefined === q) {r = g;} else {r = h;}gpf.each.apply(arguments, [p,r]);return o;};gpf.extend(gpf, {_alpha: "abcdefghijklmnopqrstuvwxyz",_ALPHA: "ABCDEFGHIJKLMNOPQRSTUVWXYZ",_func: function (o) {return new n(o);},value: function (o, p, q) {var r = typeof o;if (!q) {q = typeof p;}if (q === r) {return o;}if ("undefined" === r || !o) {return p;}return m[q](o, r, p);},like: function (o, p, q) {if (o === p) {return true;}if (typeof o !== typeof p) {return j(o, p, q);}if (null === o || null === p || "object" !== typeof o) {return false;}return l(o, p, q);},clone: function (o) {return gpf.json.parse(gpf.json.stringify(o));},test: function (o, p) {var q;if (o instanceof Array) {for (q = 0; q < o.length; ++q) {if (o[q] === p) {return q;}}} else {for (q in o) {if (o.hasOwnProperty(q) && o[q] === p) {return q;}}}return undefined;},set: function (o, p) {gpf.ASSERT(o instanceof Array, "gpf.set must be used with an Array");var q, r = o.length;for (q = 0; q < r; ++q) {if (o[q] === p) {return o;}}o.push(p);return o;},clear: function (o, p) {var q;if (o instanceof Array) {for (q = 0; q < o.length; ++q) {if (o[q] === p) {o.splice(q, 1);break;}}} else {for (q in o) {if (o.hasOwnProperty(q) && o[q] === p) {break;}}}return o;},xor: function (o, p) {return o && !p || !o && p;}});var o = function (q) {var r, s;this._listeners = {};if (undefined !== q) {this._events = q;for (r = 0; r < q.length; ++r) {s = q[r];this["on" + s.charAt(0).toUpperCase() + s.substr(1)] = this._onEVENT(r);this._listeners[s] = [];}} else {this._events = null;}}, p = function (q, r, s, t) {this._type = q;if (undefined === r) {r = {};}this._params = r;this._cancelable = s ? true : false;this._propagationStopped = false;this._defaultPrevented = false;if (undefined !== t) {this._that = t;} else {this._that = t;}};gpf.extend(o.prototype, {_onEVENT: function (q) {var r = o.prototype._onEVENT.closures, s;if (!r) {r = o.prototype._onEVENT.closures = [];}gpf.ASSERT(r.length >= q, "calls must be sequential");while (r.length <= q) {s = r.length;r.push(gpf._func("return this.addEventListener(this._events[" + s + "],arguments[0],arguments[1]);"));}return r[q];},addEventListener: function (q, r, s) {var t = this._listeners;if (!s) {s = false;}if (undefined === t[q]) {t[q] = [];}if (s) {t[q].unshift(r);} else {t[q].push(r);}return this;},removeEventListener: function (q, r) {if (undefined !== this._listeners[q]) {gpf.clear(this._listeners[q], r);}},broadcastEvent: function (q, r) {var s, t, u;if (q instanceof p) {t = q.type();} else {t = q;}u = this._listeners[t];if (undefined === u) {return this;}if (q instanceof p) {for (s = 0; s < u.length; ++s) {u[s].apply(q._that, [q]);if (q._propagationStopped) {break;}}} else {for (s = 0; s < u.length; ++s) {u[s].apply(null, [q,r]);}}return this;}});gpf.extend(p.prototype, {type: function () {return this._type;},cancelable: function () {return this._cancelable;},preventDefault: function () {this._defaultPrevented = true;},defaultPrevented: function () {return this._defaultPrevented;},stopPropagation: function () {this._propagationStopped = true;},get: function (q) {return this._params[q];},fire: function (q) {return gpf.events.fire(this, q);}});gpf.events = {Broadcaster: o,Event: p,fire: function (q, r, s) {if (q instanceof p) {s = r;} else {q = new gpf.events.Event(q, r, true, this);}if (s instanceof o) {s.broadcastEvent(q);} else if (q._that) {s.apply(q._that, [q]);} else {s(q);}return q;}};var q = 0, r = {}, s = function (v) {var w = v.scriptTag, x = v.headTag;w.onerror = w.onload = w.onreadystatechange = null;if (x && w.parentNode) {x.removeChild(w);}delete r[v.id];}, t = function () {var v = r[this.id];if (!v.done && (!this.readyState || this.readyState === "loaded" || this.readyState === "complete")) {setTimeout(function () {v.done = true;gpf.events.fire("load", { url: v.src }, v.eventsHandler);}, 0);s(v);}}, u = function () {var v = r[this.id];if (!v.done) {v.done = true;gpf.events.fire("error", { url: v.src }, v.eventsHandler);s(v);}};gpf.http = { include: function (v, w) {var x = {src: v,id: "__gpf_http_" + ++q,headTag: document.getElementsByTagName("head")[0] || document.documentElement,scriptTag: document.createElement("script"),done: false}, y;if (undefined === w) {w = new gpf.events.Broadcaster(["load","error"]);}x.eventsHandler = w;r[x.id] = x;y = x.scriptTag;y.language = "javascript";y.src = v;y.id = x.id;y.onload = y.onreadystatechange = t;y.onerror = u;if (undefined !== y.async) {y.async = true;}setTimeout(function () {x.headTag.insertBefore(y, x.headTag.firstChild);}, 0);return w;} };var v = gpf._ALPHA + gpf._alpha + "0123456789+/", w = "0123456789ABCDEF", x = function (z, A, B, C) {var D = z.length, E = gpf.bin.isPow2(D), F, G, H = [], I;if (-1 < E && (undefined === B || B * E <= 32)) {if (undefined === B) {F = 32;} else {F = B * E;}G = (1 << F - E) - 1;F = (1 << E) - 1;while (0 !== A) {I = A & F;H.unshift(z.charAt(I));A = A >> E & G;}} else {while (0 !== A) {I = A % D;H.unshift(z.charAt(I));A = (A - I) / D;}}if (undefined !== B) {if (undefined === C) {C = z.charAt(0);}while (H.length < B) {H.unshift(C.charAt(H.length % C.length));}} else if (0 === H.length) {H = [z.charAt(0)];}return H.join("");}, y = function (z, A, B) {var C = z.length, D = 0, E = 0;if (undefined === B) {B = z.charAt(0);}while (E < A.length) {if (-1 === B.indexOf(A.charAt(E))) {break;} else {++E;}}while (E < A.length) {D = C * D + z.indexOf(A.charAt(E++));}return D;};gpf.bin = {pow2: function (z) {return 1 << z;},isPow2: function (z) {if (0 < z && 0 === (z & z - 1)) {var A = 0;while (1 < z) {++A;z >>= 1;}return A;} else {return -1;}},toBaseANY: x,fromBaseANY: y,toHexa: function (z, A, B) {return x(w, z, A, B);},fromHexa: function (z, A) {return y(w, z, A);},toBase64: function (z, A, B) {return x(v, z, A, B);},fromBase64: function (z, A) {return y(v, z, A);}};gpf.json = {};if ("undefined" === typeof JSON) {var z = function (B) {var C, D, E, F;C = B instanceof Array;D = [];for (E in B) {if ("function" === typeof B[E]) {continue;}F = A(B[E]);if (C) {D.push(F);} else {D.push(E + ": " + F);}}if (C) {return "[" + D.join(", ") + "]";} else {return "(" + D.join(", ") + ")";}}, A = function (B) {var C = typeof B;if ("undefined" === C || "function" === C) {return;} else if ("number" === C || "boolean" === C) {return B.toString();} else if ("string" === C) {return gpf.escapeFor(B, "javascript");}if (null === B) {return "null";} else {return z(B);}};gpf.json.stringify = A;gpf.json.parse = function (B) {return gpf._func("return " + B)();};} else {gpf.json.stringify = JSON.stringify;gpf.json.parse = JSON.parse;}var K = 0, L = 1, M = 2, N = 3, O = true;function B() {this._Subs = [];}gpf.extend(B.prototype, {_name: "",name: function () {return this._name;},_Base: null,Base: function () {return this._Base;},_Subs: [],Subs: function () {return this._Subs;},_attributes: null,attributes: function () {if (!this._attributes) {this._attributes = new gpf.attributes.Map;}return this._attributes;},_constructor: function () {}});gpf.classInfo = function (P) {if (undefined === P._gpf) {P._gpf = new B;}return P._gpf;};gpf._classInit = function (P, Q) {if (O) {gpf.classInfo(P)._constructor.apply(this, Q);}};function C(P, Q, R, S, T) {var U = P[S], V, W, X, Y;if (N === T) {R.constructor[S] = U;return;}V = typeof U;W = Q[S];X = typeof W;if ("undefined" !== X && V !== X) {throw { message: "You can't overload a member to change its type" };}if ("function" === V && "undefined" !== X) {Y = S;if ("_" === Y.charAt(0)) {Y = Y.substr(1);}Y = Y.charAt(0).toUpperCase() + Y.substr(1);R["_base" + Y] = W;}if ("constructor" === S) {gpf.classInfo(R.constructor)._constructor = U;} else {R[S] = U;}}function D(P, Q, R) {var S = R[Q], T = P[Q];Q = Q.substr(1, Q.length - 2);if (undefined === S) {S = [];}R[Q] = S.concat(T);}function E(P, Q, R, S, T) {var U;for (U in P) {if (P.hasOwnProperty(U)) {if ("[" === U.charAt(0) && "]" === U.charAt(U.length - 1)) {D(P, U, S);} else if ("public" === U || "private" === U || "protected" === U || "static" === U) {throw { message: "Invalid visibility keyword" };} else {C(P, Q, R, U, T);}}}if ("wscript" === gpf.host() && P.constructor !== Object) {C(P, Q, R, "constructor", T);}}function F(P, Q, R, S) {var T;for (T in P) {if (P.hasOwnProperty(T)) {if ("[" === T.charAt(0) && "]" === T.charAt(T.length - 1)) {D(P, T, S);} else if ("public" === T) {E(P[T], Q, R, S, K);} else if ("private" === T) {E(P[T], Q, R, S, M);} else if ("protected" === T) {E(P[T], Q, R, S, L);} else if ("static" === T) {E(P[T], Q, R, S, N);} else {C(P, Q, R, T, K);}}}if ("wscript" === gpf.host() && P.constructor !== Object) {C(P, Q, R, "constructor", K);}}function G(P, Q, R) {var S;for (S in P) {if (P.hasOwnProperty(S)) {if (S in R || S === "Class") {gpf.attributes.add(Q, S, P[S]);} else {console.error("gpf.Class::extend: Invalid attribute name '" + S + "'");}}}}function H() {var P = arguments[0], Q = function _CONSTRUCTOR_() {P._classInit.apply(this, [Q,arguments]);};return Q;}function I(P) {var Q = H.toString().replace("_CONSTRUCTOR_", P), R = Q.indexOf("{") + 1, S = Q.lastIndexOf("}") - 1;return Q.substr(R, S - R + 1);}function J(P, Q, R) {var S = Q.prototype, T, U, V, W, X = {};T = gpf._func(I(P))(gpf);O = false;U = new Q;O = true;T.prototype = U;U.constructor = T;V = gpf.classInfo(T);V._name = P;V._Base = Q;W = gpf.classInfo(Q);W.Subs().push(T);F(R, S, U, X);G(X, T, U);if (!V.hasOwnProperty("_constructor")) {V._constructor = Q;}return T;}gpf.define = function (P, Q, R) {var S, T, U;if ("string" === typeof Q) {Q = gpf.context(Q);} else if ("object" === typeof Q) {R = Q;Q = undefined;}if (undefined === Q) {Q = Object;}if (-1 < P.indexOf(".")) {U = P.split(".");P = U.pop();T = gpf.context(U);}S = J(P, Q, R || {});if (undefined !== T) {T[P] = S;}return S;};gpf._genDefHandler = function (P, Q) {P = P + ".";return function (R, S, T) {var U;if (undefined === T && "object" === typeof S) {T = S;S = P + Q;} else if (undefined === S) {S = P + Q;}if (-1 === R.indexOf(".")) {R = P + R;}U = gpf.define(R, S, T);return U;};};var Q = 0, R = gpf._genDefHandler("gpf.attributes", "Attribute");gpf.attributes = {};function P(S, T) {T = "$" + T;gpf[T] = function () {var U = gpf._func("return function " + T + "(args) {" + "this.constructor.apply(this, args);" + "};")();U.prototype = S.prototype;return function () {return new U(arguments);};}();}gpf._defAttr = function (S, T, U) {var V = S.charAt(0) === "$", W, X;if (V) {S = S.substr(1);W = S + "Attribute";} else {W = S;}X = R(W, T, U);if (V) {P(X, S);}return X;};gpf._defAttr("Attribute", {_member: "",member: function (S) {var T = this._member;if (S) {this._member = S;}return T;},alterPrototype: function (S) {gpf.interfaces.ignoreParameter(S);}});gpf._defAttr("$Alias", {_name: "",constructor: function (S) {this._name = S;},alterPrototype: function (S) {P(S.constructor, this._name);}});gpf.define("gpf.attributes.Array", {_array: [],constructor: function () {this._array = [];},has: function (S) {gpf.ASSERT("function" === typeof S);var T, U;for (T = 0; T < this._array.length; ++T) {U = this._array[T];if (U instanceof S) {return U;}}return null;},filter: function (S) {gpf.ASSERT("function" === typeof S);var T, U, V = new gpf.attributes.Array;for (T = 0; T < this._array.length; ++T) {U = this._array[T];if (U instanceof S) {V._array.push(U);}}return V;}});gpf.define("gpf.attributes.Map", {_members: {},_count: 0,constructor: function (S) {this._members = {};this._count = 0;if (undefined !== S) {this.fillFromObject(S);}},count: function () {return this._count;},add: function (S, T) {var U = this._members[S];if (undefined === U) {U = this._members[S] = new gpf.attributes.Array;}U._array.push(T);++this._count;},_copyTo: function (S, T, U) {var V, W, X, Y;if (this._count) {for (V in this._members) {if (this._members.hasOwnProperty(V)) {W = this._members[V]._array;for (X = 0; X < W.length; ++X) {Y = W[X];if (!T || T(V, Y, U)) {S.add(V, Y);}}}}}},_filterCallback: function (S, T, U) {gpf.interfaces.ignoreParameter(S);return T instanceof U;},fillFromObject: function (S) {var T = gpf.classInfo(S.constructor), U;while (T) {U = T.attributes();if (U) {U._copyTo(this);}if (T.Base()) {T = gpf.classInfo(T.Base());} else {break;}}return this._count;},filter: function (S) {gpf.ASSERT("function" === typeof S);var T = new gpf.attributes.Map;this._copyTo(T, this._filterCallback, S);return T;},member: function (S) {var T = this._members[S];if (undefined === T) {if (0 === Q) {Q = new gpf.attributes.Array;}T = Q;}return T;},members: function () {var S = [], T;for (T in this._members) {if (this._members.hasOwnProperty(T)) {S.push(T);}}return S;}});gpf.attributes.add = function (S, T, U) {var V, W, X, Y;V = gpf.classInfo(S).attributes();W = U.length;for (X = 0; X < W; ++X) {Y = U[X];Y.member(T);V.add(T, Y);Y.alterPrototype(S.prototype);}};gpf.define("gpf.Error", {_message: "",_name: "",constructor: function (S, T, U) {this._message = S;if (T) {this._name = T;} else {this._name = "Error";}if (U) {gpf.extend(this, U);}},message: function () {return this._message;},name: function () {return this._name;}});var S = function (V) {return gpf._func("return this." + V + ";");}, T = function (V) {return gpf._func("var r = this." + V + "; if (0 < arguments.length) { this." + V + " = arguments[0]; } return r;");}, U = gpf._defAttr("ClassAttribute");gpf._defAttr("$ClassProperty", U, {_writeAllowed: false,_publicName: "",constructor: function (V, W) {if (V) {this._writeAllowed = true;}if ("string" === typeof W) {this._publicName = W;}},alterPrototype: function (V) {var W = this._member, X = this._publicName;if (!X) {X = W.substr(1);}if (this._writeAllowed) {V[X] = T(W);} else {V[X] = S(W);}}});gpf._defAttr("$ClassExtension", U, {_ofClass: 0,_publicName: "",constructor: function (V, W) {this._ofClass = V;if ("string" === typeof W) {this._publicName = W;}}});gpf.interfaces = {isImplementedBy: function (X, Y) {var Z;for (Z in Y.prototype) {if ("constructor" === Z || "extend" === Z) {continue;}if (typeof Y.prototype[Z] !== typeof X[Z]) {return false;}}return true;},query: function (X, Y) {if (gpf.interfaces.isImplementedBy(X, Y)) {return X;} else if (gpf.interfaces.isImplementedBy(X, gpf.interfaces.IUnknown)) {return X.queryInterface(Y);} else {return null;}}};if (!gpf.interfaces.ignoreParameter) {gpf.interfaces.ignoreParameter = function () {};}gpf._defIntrf = gpf._genDefHandler("gpf.interfaces", "Interface");gpf._defIntrf("Interface");gpf._defIntrf("IUnknown", { queryInterface: function (X) {gpf.interfaces.ignoreParameter(X);return null;} });function V(X) {var Y = new gpf.attributes.Map(this).member("Class").filter(gpf.attributes.InterfaceImplementAttribute), Z, ab;for (Z = 0; Z < Y.length(); ++Z) {ab = Y.get(Z);if (ab._interfaceDefinition === X) {if (ab._builder) {return ab._builder(this);}break;}}return null;}function W(X) {return function () {var Y = V.apply(this, arguments);if (null === Y) {Y = X.apply(this, arguments);}return Y;};}gpf._defAttr("$InterfaceImplement", {"[_interfaceDefinition]": [gpf.$ClassProperty(false, "which")],_interfaceDefinition: 0,"[_builder]": [gpf.$ClassProperty(false, "how")],_builder: null,constructor: function (X, Y) {this._interfaceDefinition = X;if (Y) {this._builder = Y;}},alterPrototype: function (X) {if (!this._builder) {return;}if (undefined !== X.queryInterface) {if (V !== X.queryInterface) {X.queryInterface = W(X.queryInterface);}} else {X.queryInterface = V;gpf.attributes.add(X.constructor, "Class", [gpf.$InterfaceImplement(gpf.interfaces.IUnknown)]);}}});var Z = gpf.interfaces, ab = gpf.attributes;gpf._defIntrf("IEnumerable", {reset: function () {},moveNext: function () {return false;},current: function () {return null;}});function X(bb) {var cb = -1;return {reset: function () {cb = -1;},moveNext: function () {++cb;return cb < bb.length;},current: function () {return bb[cb];}};}function Y(bb) {var cb = new ab.Map(bb).filter(ab.EnumerableAttribute), db = cb.members();gpf.ASSERT(db.length === 1);return X(bb[db[0]]);}gpf._defAttr("$Enumerable", ab.ClassAttribute, { alterPrototype: function (bb) {if (!(bb[this._member] instanceof Array)) {throw { message: "$Enumerable can be associated to arrays only" };}ab.add(bb.constructor, "Class", [new ab.InterfaceImplementAttribute(Z.IEnumerable, Y)]);} });var bb = gpf.interfaces, cb = gpf.attributes, db;db = gpf._defIntrf("IReadOnlyArray", {length: function () {return 0;},get: function (eb) {bb.ignoreParameter(eb);return undefined;}});gpf._defIntrf("IArray", db, { set: function (eb, fb) {bb.ignoreParameter(eb);bb.ignoreParameter(fb);return undefined;} });gpf._defAttr("ClassArrayInterfaceAttribute", cb.ClassAttribute, {"[Class]": [gpf.$Alias("ClassIArray")],_writeAllowed: false,constructor: function (eb) {if (eb) {this._writeAllowed = true;}},alterPrototype: function (eb) {var fb;if (this._writeAllowed) {fb = bb.IArray;} else {fb = bb.IReadOnlyArray;}cb.add(eb.constructor, "Class", [gpf.$InterfaceImplement(fb)]);eb.length = gpf._func("return this." + this._member + ".length;");eb.get = gpf._func("return this." + this._member + "[arguments[0]];");if (this._writeAllowed) {eb.set = gpf._func("var i=arguments[0]," + "v=this." + this._name + "[i];this." + this._member + "[i]=arguments[1];return v;");}}});cb.add(cb.Array, "_array", [gpf.$ClassIArray(false)]);gpf.arrayOrItem = function (eb, fb) {if (undefined === fb) {return Array.prototype.slice.call(eb, 0);} else if (0 === eb.length) {return undefined;} else if (-1 === fb) {return eb[eb.length - 1];} else if (fb < -1 || fb > eb.length - 1) {return undefined;} else {return eb[fb];}};var eb = gpf.interfaces;gpf._defIntrf("ITextStream", {read: function (fb) {gpf.interfaces.ignoreParameter(fb);return "";},write: function () {}});eb.ITextStream._write = function () {var fb, gb;for (fb = 0; fb < arguments.length; ++fb) {gb = arguments[fb];if (null !== gb && "string" !== typeof gb) {gb = gb.toString();}this.write_(gb);}if (0 === fb) {this.write_(null);}};var fb = {javascript: {"\\": "\\\\","\"": "\\\"","\n": "\\n","\r": "\\r","\t": "\\t"},xml: {"&": "&amp;","<": "&lt;",">": "&gt;"},html: {"&": "&amp;","<": "&lt;",">": "&gt;","\xE9": "&eacute;","\xE8": "&egrave;","\xEA": "&ecirc;","\xE1": "&aacute;","\xE0": "&agrave;"}}, gb = gpf.define("StringStream", {"[Class]": [gpf.$InterfaceImplement(gpf.interfaces.ITextStream)],_buffer: [],_pos: 0,constructor: function (hb) {if (undefined !== hb && hb.length) {this._buffer = [hb];} else {this._buffer = [];}this._pos = 0;},read: function (hb) {var ib, jb, kb;if (0 === this._buffer.length) {return null;} else {ib = this._buffer[0];jb = ib.length;if (hb > jb - this._pos) {hb = jb - this._pos;}kb = ib.substr(this._pos, hb);this._pos += hb;if (this._pos === jb) {this._buffer.shift();this._pos = 0;}return kb;}},write: gpf.interfaces.ITextStream._write,write_: function (hb) {if (null === hb) {this._buffer = [];this._pos = 0;} else {this._buffer.push(hb);}},consolidateString: function () {if (this._pos !== 0) {this._buffer.unshift(this._buffer.shift().substr(this._pos));}return this._buffer.join("");}});gpf.extend(gpf, {"[replaceEx]": [gpf.$ClassExtension(String)],replaceEx: function (hb, ib) {var jb = hb, kb;for (kb in ib) {if (ib.hasOwnProperty(kb)) {if (-1 < jb.indexOf(kb)) {jb = jb.split(kb).join(ib[kb]);}}}return jb;},"[escapeFor]": [gpf.$ClassExtension(String)],escapeFor: function (hb, ib) {var jb = fb[ib];if (undefined !== jb) {hb = gpf.replaceEx(hb, jb);if ("javascript" === ib) {hb = "\"" + hb + "\"";}}return hb;},"[stringToStream]": [gpf.$ClassExtension(String, "toStream")],stringToStream: function (hb) {return new gb(hb);},"[stringFromStream]": [gpf.$ClassExtension(String, "fromStream")],stringFromStream: function (hb) {if (hb instanceof gb) {return hb.consolidateString();} else {gpf.NOT_IMPLEMENTED();return null;}}});var hb = function (ib) {if (10 > ib) {return "0" + ib;} else {return ib;}};;gpf.extend(gpf, {"[dateToComparableFormat]": [gpf.$ClassExtension(Date, "toComparableFormat")],dateToComparableFormat: function (ib, jb) {if (undefined === jb) {jb = true;}var kb = [ib.getFullYear(),"-",hb(ib.getMonth() + 1),"-",hb(ib.getDate())];if (jb) {kb.push(" ", hb(ib.getHours()), ":", hb(ib.getMinutes()), ":", hb(ib.getSeconds()));}return kb.join("");},"[dateFromComparableFormat]": [gpf.$ClassExtension(String)],dateFromComparableFormat: function (ib) {var jb = new Date;jb.setFullYear(parseInt(ib.substr(0, 4), 10), parseInt(ib.substr(5, 2), 10) - 1, parseInt(ib.substr(8, 2), 10));if (10 < ib.length) {jb.setHours(parseInt(ib.substr(11, 2), 10), parseInt(ib.substr(14, 2), 10), parseInt(ib.substr(17, 2), 10), 0);} else {jb.setHours(0, 0, 0, 0);}return jb;}});var ib = gpf.interfaces, jb = gpf._defIntrf("ITokenizer", { write: function (rb) {gpf.interfaces.ignoreParameter(rb);return -1;} }), kb = gpf.define("PatternItem", {"[_type]": [gpf.$ClassProperty()],_type: -1,"[_parent]": [gpf.$ClassProperty(true)],_parent: null,next: function (rb) {if (undefined === rb) {return this._next;} else {this._next = rb;rb.parent(this._parent);}},_next: null,"[_min]": [gpf.$ClassProperty(true)],_min: 1,"[_max]": [gpf.$ClassProperty(true)],_max: 1,constructor: function (rb) {this._type = rb;},add: function (rb, sb) {gpf.interfaces.ignoreParameter(rb);gpf.interfaces.ignoreParameter(sb);},finalize: function () {},reset: function (rb) {gpf.interfaces.ignoreParameter(rb);},write: function (rb, sb) {gpf.interfaces.ignoreParameter(rb);gpf.interfaces.ignoreParameter(sb);return -1;}}), lb = gpf.define("PatternSimpleItem", kb, {"[_seq]": [gpf.$ClassProperty(false, "sequence")],_seq: "",constructor: function () {this._baseConstructor(kb.TYPE_SIMPLE);this._seq = [];},add: function (rb, sb) {gpf.interfaces.ignoreParameter(sb);this._seq.push(rb);},finalize: function () {this._seq = this._seq.join("");},reset: function (rb) {rb.pos = 0;},write: function (rb, sb) {if (sb !== this._seq.charAt(rb.pos)) {return kb.WRITE_NO_MATCH;}++rb.pos;if (rb.pos < this._seq.length) {return kb.WRITE_NEED_DATA;} else {return kb.WRITE_MATCH;}}}), mb = gpf.define("PatternRangeItem", kb, {_inc: "",_exc: "",constructor: function () {this._baseConstructor(kb.TYPE_RANGE);this._inc = [];},hasExclude: function () {return this.hasOwnProperty("_exc");},enterExclude: function () {this._exc = [];},add: function (rb, sb) {var tb, ub, vb;if (this.hasExclude()) {tb = this._exc;} else {tb = this._inc;}if (sb) {ub = tb[tb.length - 1].charCodeAt(0);vb = rb.charCodeAt(0);while (--vb > ub) {tb.push(String.fromCharCode(vb));}tb.push(rb);} else {tb.push(rb);}},finalize: function () {this._inc = this._inc.join("");if (this.hasExclude()) {this._exc = this._exc.join("");}},write: function (rb, sb) {gpf.interfaces.ignoreParameter(rb);var tb;if (this._inc.length) {tb = -1 < this._inc.indexOf(sb);} else {tb = true;}if (tb && this._exc.length) {tb = -1 === this._exc.indexOf(sb);}if (tb) {return kb.WRITE_MATCH;} else {return kb.WRITE_NO_MATCH;}}}), nb = gpf.define("PatternChoiceItem", kb, {_choices: [],next: function (rb) {if (undefined === rb) {return null;} else {var sb = rb.parent(), tb;this._choices.push(rb);rb.parent(this);if (1 === this._choices.length) {if (null === sb) {return;}if (sb.type() !== kb.TYPE_GROUP) {throw { message: "Unexpected" };}tb = gpf.test(sb._items, rb);if (undefined === tb) {throw { message: "Unexpected" };}sb._items[tb] = this;this._parent = sb;}}},constructor: function () {this._baseConstructor(kb.TYPE_CHOICE);this._choices = [];},write: function (rb, sb) {var tb = {}, ub, vb, wb;for (ub = this._choices.length; ub > 0;) {vb = this._choices[--ub];vb.reset(tb);wb = vb.write(tb, sb);if (kb.WRITE_NO_MATCH !== wb) {rb.replaceItem = vb;gpf.extend(rb, tb);return wb;}}return kb.WRITE_NO_MATCH;}}), ob = gpf.define("PatternGroupItem", kb, {_items: [],next: function (rb) {if (undefined === rb) {return this._next;} else {if (this._items.length) {this._next = rb;rb.parent(this._parent);} else {this._items.push(rb);rb.parent(this);}}},constructor: function () {this._baseConstructor(kb.TYPE_GROUP);this._items = [];},reset: function (rb) {this._items[0].reset(rb);},write: function (rb, sb) {var tb = this._items[0];rb.replaceItem = tb;return tb.write(rb, sb);}}), pb = gpf.define("PatternParserContext", {_root: null,_item: null,_inRange: false,_afterChar: null,parse: null,constructor: function () {this.parse = this._stateItem;},root: function () {if (null === this._item) {throw { message: "Empty pattern" };}this._item.finalize();if (this.parse !== this._stateItem && this.parse !== this._stateCount) {throw { message: "Invalid syntax" };}return this._root;},_getItem: function (rb, sb) {var tb = this._item, ub;if (sb || null === tb || rb !== tb.type()) {ub = kb.create(rb);if (null !== tb) {tb.finalize();tb.next(ub);} else {this._root = ub;}this._item = ub;tb = ub;}return tb;},_stateItem: function (rb) {if ("[" === rb) {this._getItem(kb.TYPE_RANGE, true);this.parse = this._stateCharMatchRange;} else if ("(" === rb) {this._getItem(kb.TYPE_GROUP, true);} else {this._getItem(kb.TYPE_SIMPLE);this._afterChar = this._stateCount;this._stateChar(rb);}},_stateCharMatchRange: function (rb) {var sb = this._getItem(kb.TYPE_RANGE);if ("^" === rb && !sb.hasExclude()) {sb.enterExclude();} else if ("]" === rb) {this.parse = this._stateCount;} else {this._inRange = false;this._afterChar = this._stateCharRangeSep;this._stateChar(rb);}},_stateCharRangeSep: function (rb) {if ("-" === rb) {this._inRange = true;this._afterChar = this._stateCharMatchRange;this.parse = this._stateChar;} else {this._stateCharMatchRange(rb);}},_stateChar: function (rb) {if ("\\" === rb) {this.parse = this._stateEscapedChar;} else {this._item.add(rb, this._inRange);this.parse = this._afterChar;}},_stateEscapedChar: function (rb) {this._item.add(rb, this._inRange);this.parse = this._afterChar;},_stateCountByChar: {"?": function () {var rb = this._splitSimpleOnMinMax();rb.min(0);},"+": function () {var rb = this._splitSimpleOnMinMax();rb.max(0);},"*": function () {var rb = this._splitSimpleOnMinMax();rb.min(0);rb.max(0);},"|": function () {var rb = this._item, sb = rb.parent();if (null === sb || sb.type() !== kb.TYPE_CHOICE) {sb = kb.create(kb.TYPE_CHOICE);sb.next(rb);}if (rb === this._root) {this._root = sb;}rb.finalize();this._item = sb;},")": function () {var rb = this._item;rb.finalize();while (rb.type() !== kb.TYPE_GROUP) {rb = rb.parent();}if (rb === this._item) {throw { message: "Syntax error (empty group)" };}this._item = rb;return 0;}},_splitSimpleOnMinMax: function () {var rb = this._item, sb;if (rb.type() === kb.TYPE_SIMPLE && rb.sequence().length > 1) {sb = rb.sequence().pop();rb = this._getItem(kb.TYPE_SIMPLE, true);rb.add(sb);}return rb;},_stateCount: function (rb) {var sb = this._stateCountByChar[rb];if (undefined === sb) {this._stateItem(rb);} else {if (undefined === sb.apply(this, arguments)) {this.parse = this._stateItem;}}}}), qb = gpf.define("PatternTokenizer", {"[Class]": [gpf.$InterfaceImplement(jb)],_pattern: null,_item: null,_state: {result: 0,length: 0,matchingLength: 0,count: 0},constructor: function (rb) {this._pattern = rb;this._item = rb._root;this._state = {result: 0,length: 0,matchingLength: 0,count: 0};this._item.reset(this._state);},_getNext: function (rb) {var sb = rb.next();while (null === sb) {rb = rb.parent();if (null === rb) {break;}sb = rb.next();}return sb;},_writeNoMatch: function (rb) {var sb = this._state, tb = this._item;if (sb.count < tb.min() || sb.length > sb.matchingLength + 1) {sb.result = -1;this._item = null;return -1;}tb = this._getNext(tb);if (null === tb) {if (0 === sb.matchingLength) {sb.result = -1;} else {sb.result = sb.matchingLength;}this._item = null;return sb.result;}tb.reset(sb);this._item = tb;sb.count = 0;--sb.length;return this.write(rb);},_writeMatch: function () {var rb = this._state, sb = this._item, tb = this._getNext(sb);rb.matchingLength = rb.length;++rb.count;if (0 === sb.max()) {sb.reset(rb);if (null !== tb) {rb.result = kb.WRITE_NEED_DATA;} else {rb.result = rb.length;}} else if (rb.count === sb.max()) {sb = tb;this._item = sb;if (null === sb) {rb.result = rb.length;} else {sb.reset(rb);rb.count = 0;rb.result = 0;if (0 === sb.min()) {tb = this._getNext(sb);while (tb && 0 === tb.min()) {tb = this._getNext(tb);}if (!tb) {rb.result = rb.matchingLength;}}}} else {rb.result = kb.WRITE_NEED_DATA;}return rb.result;},write: function (rb) {var sb, tb = this._state, ub = this._item;if (null !== ub) {sb = ub.write(tb, rb);++tb.length;if (undefined !== tb.replaceItem) {this._item = tb.replaceItem;}if (kb.WRITE_NEED_DATA === sb) {return tb.result;}if (kb.WRITE_NO_MATCH === sb) {return this._writeNoMatch(rb);} else {return this._writeMatch();}}return tb.result;}});gpf.extend(kb, {TYPE_SIMPLE: 0,TYPE_RANGE: 1,TYPE_CHOICE: 2,TYPE_GROUP: 3,WRITE_NO_MATCH: -1,WRITE_NEED_DATA: 0,WRITE_MATCH: 1,_factory: null,create: function (rb) {var sb = kb._factory;if (!sb) {sb = kb._factory = {};sb[this.TYPE_SIMPLE] = lb;sb[this.TYPE_RANGE] = mb;sb[this.TYPE_CHOICE] = nb;sb[this.TYPE_GROUP] = ob;}return new sb[rb];}});gpf.define("gpf.Pattern", {_root: null,constructor: function (rb) {var sb = new pb, tb, ub = rb.length;for (tb = 0; tb < ub; ++tb) {sb.parse(rb.charAt(tb));}this._root = sb.root();},allocate: function () {return new qb(this);}});gpf.define("gpf.Parser", {"[Class]": [gpf.$InterfaceImplement(ib.ITextStream)],_pos: 0,_line: 0,_column: 0,_state: 0,constructor: function () {this._init();},_init: function () {this._pos = 0;this._line = 0;this._column = 0;this._state = 0;},currentPos: function () {return {pos: this._pos,line: this._line,column: this._column};},_parse: function (rb) {gpf.interfaces.ignoreParameter(rb);},_reset: function () {},read: function (rb) {gpf.interfaces.ignoreParameter(rb);return "";},write: ib.ITextStream._write,write_: function (rb) {var sb, tb;if (null === rb) {this._reset();this._init();} else {for (sb = 0; sb < rb.length; ++sb) {tb = rb.charAt(sb);this._parse(tb);++this._pos;if ("\n" === tb) {++this._line;this._column = 0;} else {++this._column;}}}}});var rb = "error", sb = "unknown", tb = "keyword", ub = "identifier", vb = "string", wb = "number", xb = "symbol", yb = "comment", zb = "space", Ab = 99, Bb = 0, Cb = gpf._alpha + gpf._ALPHA + "_$", Db = 2, Eb = 3, Fb = 4, Gb = 5, Hb = 6, Ib = 7, Jb = 8, Kb = 9, Lb = "(){}[]<>|&?,.;:!=+-*/%^~", Mb = 10, Nb = 11, Ob = " \t\r\n", Pb = 12, Qb = 0, Rb = 0, Sb = 1, Tb = 2, Ub = 3, Vb = 4, Wb = ["Parsing aborted","Unknown token","Unterminated string","Unterminated comment","Invalid or unsupported string escape"], Xb = function () {return {pos: 0,line: 0,column: 0,state: Bb,chars: [],nextPos: 0,nextLine: 0,nextColumn: 0,eventsHandler: null,that: null};}, Yb = ("break,case,catch,continue,debugger,default,delete,do," + "else,finally,for,function,if,in,instanceof,new,return,switch," + "this,throw,try,typeof,var,void,while,with").split(","), Zb = function () {var kc = {};kc[Bb] = sb;kc[Mb] = xb;kc[Jb] = yb;kc[Kb] = yb;kc[Eb] = vb;kc[Gb] = vb;kc[Nb] = wb;kc[Pb] = zb;return kc;}(), ac = function (kc, lc) {var mc, nc, oc, pc = {token: "",pos: kc.pos,line: kc.line,column: kc.column,code: 0,message: ""};if (undefined !== lc) {nc = rb;kc.state = Ab;pc.code = lc;pc.message = Wb[lc - Qb];} else {mc = kc.chars.join("");if (Db === kc.state) {if (undefined !== gpf.test(Yb, mc)) {nc = tb;} else {nc = ub;}} else {nc = Zb[kc.state];}pc.token = mc;}oc = gpf.events.fire.apply(kc.that, [nc,pc,kc.eventsHandler]);if (oc.defaultPrevented()) {ac(kc, Rb);} else if (undefined !== lc) {throw 0;}kc.state = Bb;kc.chars = [];kc.pos = kc.nextPos;kc.line = kc.nextLine;kc.column = kc.nextColumn;}, bc = [0,function (kc, lc, mc) {gpf.interfaces.ignoreParameter(lc);if (-1 < "(){}[].,;:?".indexOf(kc)) {return false;}if (-1 < "!^~*/%".indexOf(kc)) {return "=" === mc;}return "=" === mc || kc === mc;},function (kc, lc, mc) {if (-1 < "+-|&".indexOf(kc)) {return false;}if ("<" === kc) {return "<" === lc[1] && "=" === mc;}if (-1 < "=!".indexOf(kc)) {return "=" === mc;}if (">" === kc) {return "=" !== lc[1] && ("=" === mc || ">" === mc);}return false;},function (kc, lc, mc) {return ">" === kc && "=" !== lc[2] && "=" === mc;},function () {return false;}], cc = function (kc, lc) {var mc = kc[0];return bc[kc.length](mc, kc, lc);}, dc = function () {var kc = {};kc[Db] = function (lc, mc) {if (-1 === Cb.indexOf(mc) && ("0" > mc || mc > "9")) {ac(lc);} else {lc.chars.push(mc);}};kc[Nb] = function (lc, mc) {if ("0" > mc || mc > "9") {ac(lc);} else {lc.chars.push(mc);}};kc[Eb] = kc[Gb] = function (lc, mc) {lc.chars.push(mc);if ("\\" === mc) {++lc.state;} else if ("\n" === mc) {ac(lc, Tb);} else if (Eb === lc.state && "\"" === mc) {ac(lc);return true;} else if (Gb === lc.state && "'" === mc) {ac(lc);return true;}return false;};kc[Fb] = kc[Hb] = function (lc, mc) {if ("\\" === mc || "r" === mc || "n" === mc || "t" === mc || "\"" === mc || "'" === mc) {--lc.state;lc.chars.push(mc);} else {ac(lc, Vb);}};kc[Ib] = function (lc, mc) {if ("/" === mc) {lc.state = Jb;lc.chars.push(mc);} else if ("*" === mc) {lc.state = Kb;lc.chars.push(mc);} else {lc.state = Mb;if (cc(lc.chars, mc)) {lc.chars.push(mc);} else {ac(lc);}}};kc[Jb] = function (lc, mc) {if ("\n" === mc) {ac(lc);} else {lc.chars.push(mc);}};kc[Kb] = function (lc, mc) {lc.chars.push(mc);if ("/" === mc && lc.chars[lc.chars.length - 2] === "*") {ac(lc);return true;}return false;};kc[Pb] = function (lc, mc) {if (-1 < Ob.indexOf(mc)) {lc.chars.push(mc);} else {ac(lc);}};kc[Mb] = function (lc, mc) {if (-1 < Lb.indexOf(mc)) {if (cc(lc.chars, mc)) {lc.chars.push(mc);} else {ac(lc);}} else {ac(lc);}};return kc;}(), ec = function (kc, lc) {kc.chars = [lc];if (-1 < Cb.indexOf(lc)) {kc.state = Db;} else if ("0" <= lc && lc <= "9") {kc.state = Nb;} else if ("\"" === lc) {kc.state = Eb;} else if ("'" === lc) {kc.state = Gb;} else if ("/" === lc) {kc.state = Ib;} else if (-1 < Lb.indexOf(lc)) {kc.state = Mb;} else if (-1 < Ob.indexOf(lc)) {kc.state = Pb;} else {ac(kc, Sb);}}, fc = function (kc, lc) {var mc = dc[kc.state];if (undefined !== mc) {if (mc(kc, lc)) {return;}}if (Bb === kc.state) {ec(kc, lc);}}, gc = function (kc, lc) {++kc.nextPos;if ("\n" === lc) {++kc.nextLine;kc.nextColumn = 0;} else {++kc.nextColumn;}}, hc = function (kc, lc) {fc(kc, lc);gc(kc, lc);}, ic = function () {var kc = {};kc[Db] = 1;kc[Nb] = 1;kc[Jb] = 1;kc[Mb] = 1;kc[Ib] = 2;kc[Kb] = 3;kc[Eb] = 4;kc[Gb] = 4;kc[Fb] = 4;kc[Hb] = 4;return kc;}(), jc = function (kc) {var lc = ic[kc.state];if (1 === lc) {ac(kc);} else if (2 === lc) {kc.state = Mb;ac(kc);} else if (3 === lc) {ac(kc, Ub);} else if (4 === lc) {ac(kc, Tb);}gpf.ASSERT(Bb === kc.state || Ab === kc.state || Pb === kc.state, "Unexpected non-final state");};gpf.js = {};gpf.extend(gpf.js, {keywords: function () {return Yb;},tokenize: function (kc, lc) {var mc, nc, oc = Xb();oc.eventsHandler = lc;oc.that = this;try {for (mc = 0, nc = kc.length; mc < nc; ++mc) {hc(oc, kc.charAt(mc));}jc(oc);} catch (e) {if ("number" !== typeof e) {throw e;}}},tokenizeEx: function (kc, lc, mc) {var nc, oc;if (undefined === mc) {mc = Xb();}mc.eventsHandler = lc;mc.that = this;try {if (null === kc) {jc(mc);mc = null;} else {for (nc = 0, oc = kc.length; nc < oc; ++nc) {hc(mc, kc.charAt(nc));}}} catch (e) {if ("number" !== typeof e) {throw e;}}return mc;}});var kc = gpf.interfaces, lc = gpf.attributes, mc = function () {throw { message: "Invalid parameter, " + "expected gpf.interfaces.IXmlContentHandler" };};;gpf.xml = {};gpf._defIntrf("IXmlSerializable", { toXml: function (nc) {kc.ignoreParameter(nc);} });gpf._defIntrf("IXmlContentHandler", {characters: function (nc) {kc.ignoreParameter(nc);},endDocument: function () {},endElement: function () {},endPrefixMapping: function (nc) {kc.ignoreParameter(nc);},ignorableWhitespace: function (nc) {kc.ignoreParameter(nc);},processingInstruction: function (nc, oc) {kc.ignoreParameter(nc);kc.ignoreParameter(oc);},setDocumentLocator: function (nc) {kc.ignoreParameter(nc);},skippedEntity: function (nc) {kc.ignoreParameter(nc);},startDocument: function () {},startElement: function (nc, oc, pc, qc) {kc.ignoreParameter(nc);kc.ignoreParameter(oc);kc.ignoreParameter(pc);kc.ignoreParameter(qc);},startPrefixMapping: function (nc, oc) {kc.ignoreParameter(nc);kc.ignoreParameter(oc);}});var nc = gpf._defAttr("XmlAttribute", { alterPrototype: function (Bc) {if (undefined === Bc.toXml) {lc.add(Bc.constructor, "Class", [gpf.$InterfaceImplement(kc.IXmlSerializable)]);Bc.toXml = yc;lc.add(Bc.constructor, "Class", [gpf.$InterfaceImplement(kc.IXmlContentHandler, Ac)]);}} }), oc = gpf._defAttr("$XmlIgnore", nc, {}), pc = gpf._defAttr("$XmlAttribute", nc, {"[_name]": [gpf.$ClassProperty()],_name: "",constructor: function (Bc) {gpf.ASSERT(gpf.xml.isValidName(Bc), "Valid XML attribute name");this._name = Bc;}}), qc = gpf._defAttr("XmlRawElementAttribute", nc, {"[_name]": [gpf.$ClassProperty()],_name: "",constructor: function (Bc) {gpf.ASSERT(gpf.xml.isValidName(Bc), "Valid XML element name");this._name = Bc;}}), rc = gpf._defAttr("$XmlElement", qc, {"[_objClass]": [gpf.$ClassProperty()],_objClass: null,constructor: function (Bc, Cc) {this._baseConstructor(Bc);if (Cc) {this._objClass = Cc;}}}), sc = gpf._defAttr("$XmlList", qc, {}), tc = function (Bc, Cc) {var Dc, Ec, Fc = null, Gc = null, Hc;for (Dc = 0; Dc < Bc.length(); ++Dc) {Ec = Bc.get(Dc);if (!(Ec instanceof rc)) {continue;}Hc = Ec.objClass();if (Hc) {if (Cc instanceof Hc) {if (!Gc || Hc.prototype instanceof Gc.objClass()) {Gc = Ec;}}} else if (!Fc) {Fc = Ec;}}if (null !== Gc) {return Gc;} else {return Fc;}}, uc = function (Bc, Cc, Dc, Ec) {var Fc;if (Cc instanceof Array || Ec.has(sc) || "object" === Dc || Ec.has(rc)) {return "";}Fc = Ec.has(pc);if (Fc && Fc.name()) {Bc = Fc.name();} else {if ("_" === Bc.charAt(0)) {Bc = Bc.substr(1);}}return Bc;}, vc = function (Bc, Cc, Dc, Ec) {var Fc, Gc, Hc, Ic, Jc, Kc, Lc, Mc;Fc = Bc[Cc];if (Fc instanceof Date) {Fc = gpf.dateToComparableFormat(Fc, true);}Gc = Ec.member(Cc);if ("_" === Cc.charAt(0)) {Cc = Cc.substr(1);}Hc = Gc.has(sc);if (Fc instanceof Array || Hc) {if (Hc && Hc.name()) {Ic = true;Dc.startElement("", Hc.name());}Gc = Gc.filter(rc);for (Jc = 0; Jc < Fc.length; ++Jc) {Kc = Fc[Jc];Lc = tc(Gc, Kc);if (Lc && Lc.name()) {Mc = Lc.name();} else {Mc = "item";}xc(Kc, Dc, Mc);}if (Ic) {Dc.endElement();}return;}Hc = Gc.has(rc);if (Hc && Hc.name()) {Mc = Hc.name();}xc(Fc, Dc, Mc);}, wc = function (Bc, Cc, Dc, Ec) {var Fc, Gc, Hc, Ic, Jc, Kc = 0, Lc = 0, Mc;for (Gc in Bc.constructor.prototype) {Hc = Bc[Gc];if (Hc instanceof Date) {Hc = gpf.dateToComparableFormat(Hc, true);}Ic = typeof Hc;if ("function" === Ic) {continue;}Fc = Ec.member(Gc);if (Fc.has(oc)) {continue;}Jc = uc(Gc, Hc, Ic, Fc);if (Jc) {if (0 === Lc) {Lc = {};}Lc[Jc] = Hc.toString();} else {if (0 === Kc) {Kc = [];}Kc.push(Gc);}}Cc.startElement("", Dc, Dc, Lc);if (Kc) {for (Mc = 0; Mc < Kc.length; ++Mc) {vc(Bc, Kc[Mc], Cc, Ec);}}}, xc = function (Bc, Cc, Dc) {var Ec = new lc.Map(Bc).filter(nc), Fc;if (!Dc) {Fc = Ec.member("Class").has(rc);if (Fc) {Dc = Fc.name();} else {Dc = gpf.classInfo(Bc.constructor).name();if (!Dc) {Dc = "object";}}}if ("object" !== typeof Bc) {Cc.startElement("", Dc);Cc.characters(gpf.value(Bc, ""));} else {wc(Bc, Cc, Dc, Ec);}Cc.endElement();}, yc = function (Bc) {var Cc = kc.query(Bc, kc.IXmlContentHandler);if (Cc) {xc(this, Cc);} else {mc();}}, zc = gpf.define("FromXmlContentHandler", {"[Class]": [gpf.$InterfaceImplement(kc.IXmlContentHandler)],_target: null,_firstElement: true,_forward: [],constructor: function (Bc) {this._target = Bc;this._firstElement = true;this._forward = [];},_fillFromAttributes: function (Bc) {var Cc = new lc.Map(this._target), Dc = this._target.constructor.prototype, Ec, Fc, Gc;for (Ec in Dc) {if ("function" === typeof Dc[Ec]) {continue;}Fc = Cc.member(Ec).filter(pc);if (0 < Fc.length()) {gpf.ASSERT(Fc.length() === 1);Gc = Fc.get(0).name();} else {if (Ec.charAt(0) === "_") {Gc = Ec.substr(1);} else {continue;}}if (Gc in Bc) {this._target[Ec] = gpf.value(Bc[Gc], Dc[Ec]);}}},_fillFromElement: function (Bc, Cc, Dc, Ec) {var Fc = new lc.Map(this._target).filter(qc), Gc = this._forward[0], Hc, Ic, Jc, Kc, Lc, Mc;gpf.interfaces.ignoreParameter(Bc);gpf.interfaces.ignoreParameter(Dc);gpf.interfaces.ignoreParameter(Ec);if (undefined === Gc) {Hc = Fc.members();} else {gpf.ASSERT(Gc.type !== 0, "No content handler here");Hc = [Gc.member];}for (Ic = 0; Ic < Hc.length; ++Ic) {Jc = Hc[Ic];Kc = Fc.member(Jc);for (Lc = 0; Lc < Kc.length(); ++Lc) {Mc = Kc.get(Lc);if (Mc.name() === Cc) {if (this._fillFromRawElement(Jc, Mc)) {return;}}}}},_fillFromRawElement: function (Bc, Cc) {var Dc, Ec;if (Cc instanceof rc) {if (Cc.objClass()) {Dc = new (Cc.objClass());this._target[Bc] = Dc;Ec = kc.query(Dc, kc.IXmlContentHandler);}if (Ec) {Ec = {type: 0,iXCH: Ec};} else {Ec = {type: 1,member: Bc,buffer: []};}} else if (Cc instanceof sc) {this._target[Bc] = [];Ec = {type: 2,member: Bc};}if (Ec) {Ec.depth = 1;this._forward.unshift(Ec);return true;} else {return false;}},characters: function (Bc) {var Cc = this._forward[0];if (undefined !== Cc) {if (0 === Cc.type) {Cc.iXCH.characters.apply(Cc.iXCH, arguments);} else if (1 === Cc.type) {Cc.buffer.push(Bc);}}},endDocument: function () {},endElement: function () {var Bc = this._forward[0], Cc, Dc;if (undefined !== Bc) {if (0 === Bc.type) {Bc.iXCH.endElement.apply(Bc.iXCH, arguments);} else if (1 === Bc.type) {Cc = this._target[Bc.member];Dc = Bc.buffer.join("");if (Cc instanceof Array) {Cc.push(Dc);} else {this._target[Bc.member] = gpf.value(Dc, Cc);}}if (0 === --Bc.depth) {this._forward.shift();}}},endPrefixMapping: function (Bc) {kc.ignoreParameter(Bc);},ignorableWhitespace: function (Bc) {kc.ignoreParameter(Bc);},processingInstruction: function (Bc, Cc) {kc.ignoreParameter(Bc);kc.ignoreParameter(Cc);},setDocumentLocator: function (Bc) {kc.ignoreParameter(Bc);},skippedEntity: function (Bc) {kc.ignoreParameter(Bc);},startDocument: function () {},startElement: function (Bc, Cc, Dc, Ec) {var Fc = this._forward[0];gpf.interfaces.ignoreParameter(Bc);gpf.interfaces.ignoreParameter(Cc);gpf.interfaces.ignoreParameter(Dc);if (undefined !== Fc) {if (0 === Fc.type) {++Fc.depth;Fc.iXCH.startElement.apply(Fc.iXCH, arguments);} else {this._fillFromElement.apply(this, arguments);}} else if (this._firstElement) {this._firstElement = false;this._fillFromAttributes(Ec);} else {this._fillFromElement.apply(this, arguments);}},startPrefixMapping: function (Bc, Cc) {kc.ignoreParameter(Bc);kc.ignoreParameter(Cc);}}), Ac = function (Bc) {return new zc(Bc);};gpf.define("gpf.xml.Writer", {"[Class]": [gpf.$InterfaceImplement(kc.IXmlContentHandler)],_stream: null,_branch: [],_pendingPrefixMappings: [],constructor: function (Bc) {this._stream = Bc;this._branch = [];this._pendingPrefixMappings = [];},_closeLeafForContent: function () {var Bc;if (this._branch.length) {Bc = this._branch[this._branch.length - 1];if (!Bc.hasContent) {this._stream.write(">");Bc.hasContent = true;}}},characters: function (Bc) {this._closeLeafForContent();this._stream.write(Bc);},endDocument: function () {},endElement: function () {var Bc = this._branch.pop(), Cc = this._stream;if (Bc.hasContent) {Cc.write("</");Cc.write(Bc.qName);Cc.write(">");} else {Cc.write("/>");}},endPrefixMapping: function (Bc) {gpf.interfaces.ignoreParameter(Bc);},ignorableWhitespace: function (Bc) {this._closeLeafForContent();this._stream.write(Bc);},processingInstruction: function (Bc, Cc) {var Dc = this._stream;Dc.write("<?");Dc.write(Bc);Dc.write(" ");Dc.write(gpf.escapeFor(Cc, "xml"));Dc.write("?>");},setDocumentLocator: function (Bc) {gpf.interfaces.ignoreParameter(Bc);},skippedEntity: function (Bc) {gpf.interfaces.ignoreParameter(Bc);},startDocument: function () {},startElement: function (Bc, Cc, Dc, Ec) {var Fc, Gc, Hc, Ic = this._stream;if (undefined === Dc && !Bc) {Dc = Cc;}this._closeLeafForContent();var Jc = {hasContent: false,qName: Dc};this._branch.push(Jc);Ic.write("<");Ic.write(Dc);if (Ec) {for (Fc in Ec) {if (Ec.hasOwnProperty(Fc)) {Ic.write(" ");Ic.write(Fc);Ic.write("=\"");Gc = gpf.escapeFor(Ec[Fc].toString(), "xml");if (-1 < Gc.indexOf("\"")) {Gc = gpf.replaceEx(Gc, { "\"": "&quot;" });}Ic.write(Gc);Ic.write("\"");}}}if (this._pendingPrefixMappings.length) {for (Hc = 0; Hc < this._pendingPrefixMappings.length; ++Hc) {Ic.write(" ");Ic.write(this._pendingPrefixMappings);}this._pendingPrefixMappings = [];}},startPrefixMapping: function (Bc, Cc) {var Dc = ["xmlns:",Bc,":\"",gpf.escapeFor(Cc, "xml"),"\""].join(""), Ec = this._branch[this._branch.length], Fc = this._stream;if (Ec.hasContent) {this._pendingPrefixMappings.push(Dc);} else {Fc.write(" ");Fc.write(Dc);}}});gpf.xml.convert = function (Bc, Cc) {var Dc, Ec;Dc = kc.query(Cc, kc.IXmlContentHandler);if (!Dc) {mc();}if ("string" === typeof Bc) {gpf.NOT_IMPLEMENTED();} else if ("object" === typeof Bc) {Ec = kc.query(Bc, kc.IXmlSerializable);if (null !== Ec) {Ec.toXml(Dc);} else {new gpf.xml.ConstNode(Bc).toXml(Dc);}}};var Bc = gpf._alpha + gpf._ALPHA + "_", Cc = Bc + "012345789.-";gpf.extend(gpf.xml, {isValidName: function (Dc) {var Ec;if (0 === Dc.length || -1 === Bc.indexOf(Dc.charAt(0))) {return false;}for (Ec = 1; Ec < Dc.length; ++Ec) {if (-1 === Cc.indexOf(Dc.charAt(Ec))) {return false;}}return true;},toValidName: function (Dc) {var Ec;if (gpf.xml.isValidName(Dc)) {return Dc;}Ec = "_" + Dc;if (!gpf.xml.isValidName(Ec)) {throw { message: "Invalid name" };}return Ec;}});var Dc = gpf.interfaces;gpf.extend(gpf.xml, {NODE_INVALID: 0,NODE_ELEMENT: 1,NODE_ATTRIBUTE: 2,NODE_TEXT: 3,NODE_ENTITY_REFERENCE: 5,NODE_PROCESSING_INSTRUCTION: 7,NODE_COMMENT: 8,NODE_DOCUMENT: 9});gpf._defIntrf("IXmlConstNode", {attributes: function (Ec) {gpf.interfaces.ignoreParameter(Ec);return "";},children: function (Ec) {if (undefined === Ec) {return [];} else {return undefined;}},localName: function () {return "";},namespaceURI: function () {return "";},nextSibling: function () {return null;},nodeName: function () {return "";},nodeType: function () {return 0;},nodeValue: function () {return null;},ownerDocument: function () {return null;},parentNode: function () {return null;},prefix: function () {return "";},previousSibling: function () {return null;},textContent: function () {return "";}});gpf.define("gpf.xml.ConstNode", {"[Class]": [gpf.$InterfaceImplement(Dc.IXmlConstNode),gpf.$InterfaceImplement(Dc.IXmlSerializable)],_obj: null,_name: "",_parentNode: null,_attributes: {},_elements: {},_children: [],constructor: function (Ec, Fc) {this._obj = Ec;this._attributes = null;this._elements = null;this._children = null;if (undefined === Fc) {this._name = "root";} else {this._name = Fc;}},_members: function () {var Ec, Fc, Gc;this._attributes = {};this._elements = {};if ("object" === typeof this._obj && !(this._obj instanceof Array)) {for (Ec in this._obj) {if (this._obj.hasOwnProperty(Ec)) {Fc = this._obj[Ec];if (null === Fc) {continue;}Gc = gpf.xml.toValidName(Ec);if ("object" === typeof Fc) {this._elements[Ec] = Gc;} else {this._attributes[Ec] = Gc;}}}}},attributes: function (Ec) {var Fc, Gc, Hc;if (null === this._attributes) {this._members();}if (undefined === Ec) {Fc = {};for (Gc in this._attributes) {if (this._attributes.hasOwnProperty(Gc)) {Hc = this._attributes[Gc];Fc[Hc] = this._obj[Gc];}}return Fc;}for (Gc in this._attributes) {if (this._attributes.hasOwnProperty(Gc)) {if (Ec === this._attributes[Gc]) {return this._obj[Gc];}}}return undefined;},children: function (Ec) {var Fc, Gc, Hc, Ic;if (null === this._children) {if (null === this._elements) {this._members();}this._children = [];if (this._obj instanceof Array) {for (Fc = 0; Fc < this._obj.length; ++Fc) {Gc = new gpf.xml.ConstNode(this._obj[Fc], "item");Gc._parentNode = this;this._children.push(Gc);}} else {for (Hc in this._elements) {if (this._elements.hasOwnProperty(Hc)) {Ic = this._elements[Hc];Gc = new gpf.xml.ConstNode(this._obj[Hc], Ic);Gc._parentNode = this;this._children.push(Gc);}}}}return gpf.arrayOrItem(this._children, Ec);},localName: function () {return this._name;},namespaceURI: function () {return "";},nextSibling: function () {var Ec;if (null !== this._parentNode) {Ec = gpf.test(this._parentNode._children, this);if (undefined !== Ec && Ec < this._parentNode._children.length - 1) {return this._parentNode._children[Ec + 1];}}return null;},nodeName: function () {return this._name;},nodeType: function () {return gpf.xml.NODE_ELEMENT;},nodeValue: function () {return this._obj;},ownerDocument: function () {return null;},parentNode: function () {return this._parentNode;},prefix: function () {return "";},previousSibling: function () {var Ec;if (null !== this._parentNode) {Ec = gpf.test(this._parentNode._children, this);if (0 < Ec) {return this._parentNode._children[Ec - 1];}}return null;},textContent: function () {if ("object" !== typeof this._obj) {return gpf.value(this._obj, "");} else {return "";}},toXml: function (Ec) {gpf.xml.nodeToXml(this, Ec);}});gpf.xml.nodeToXml = function (Ec, Fc) {var Gc = Ec.localName(), Hc = Ec.attributes(), Ic = Ec.children(), Jc = Ec.textContent(), Kc;Fc.startElement("", Gc, Gc, Hc);if (Jc) {Fc.characters(Jc);} else {for (Kc = 0; Kc < Ic.length; ++Kc) {gpf.xml.nodeToXml(Ic[Kc], Fc);}}Fc.endElement();};function Ec(Kc, Lc, Mc, Nc) {var Oc, Pc;for (Oc = 0; Oc < Kc.length; ++Oc) {Pc = Kc[Oc];Lc(Pc, Mc, Nc);}}function Fc(Kc, Lc, Mc) {var Nc = Kc.children(), Oc, Pc, Qc;for (Pc = 0; Pc < Nc.length; ++Pc) {Qc = true;Oc = Nc[Pc];if (Lc.name && Oc.localName() !== Lc.name) {Qc = false;} else if (Lc.text && Oc.textContent() !== Lc.text) {Qc = false;}if (Qc) {Mc.push(Oc);}if (undefined !== Lc.relative && !Lc.relative) {Fc(Oc, Lc, Mc);}}}function Gc(Kc, Lc, Mc) {var Nc, Oc, Pc;if (Lc.name) {Pc = Kc.attributes(Lc.name);if (undefined !== Pc && (!Lc.text || Pc === Lc.text)) {Mc.push(Kc);}} else {Nc = Kc.attributes();for (Oc in Nc) {if (Nc.hasOwnProperty(Oc)) {Pc = Nc[Oc];if (!Lc.text || Pc === Lc.text) {Mc.push(Kc);break;}}}}}function Hc(Kc, Lc, Mc) {if (gpf.xml.NODE_ELEMENT === Lc.type) {Ec(Kc, Fc, Lc, Mc);} else if (gpf.xml.NODE_ATTRIBUTE === Lc.type) {Ec(Kc, Gc, Lc, Mc);}}function Ic(Kc, Lc, Mc) {var Nc, Oc, Pc, Qc, Rc;if (Lc.and) {Oc = Lc.and;Pc = 0;} else if (Lc.or) {Oc = Lc.or;Pc = 1;}for (Qc = 0; Qc < Oc.length; ++Qc) {Rc = Oc[Qc];if (Rc.and || Rc.or) {Nc = [];Ic(Kc, Rc, Nc);} else {Nc = Jc(Kc, Rc);}if (0 === Pc && Nc.length === 0) {return;}if (1 === Pc && Nc.length !== 0) {Mc.push(Kc);return;}}if (0 === Pc) {Mc.push(Kc);}}function Jc(Kc, Lc) {var Mc, Nc = [Kc];while (Lc) {Mc = [];Hc(Nc, Lc, Mc);if (0 === Mc.length) {return [];}Nc = Mc;if (Lc.filter) {Mc = [];Ec(Nc, Ic, Lc.filter, Mc);if (0 === Mc.length) {return [];}Nc = Mc;}Lc = Lc.then;}return Mc;}gpf.define("gpf.xml.XPath", {_xpath: null,constructor: function (Kc) {this._reset();if ("string" === typeof Kc) {this._xpath = this._compile(Kc);} else {this._xpath = Kc;}},_reset: function () {},_compile: function (Kc) {gpf.interfaces.ignoreParameter(Kc);this._xpath = null;},selectNodes: function (Kc) {return Jc(Kc, this._xpath);}});}));