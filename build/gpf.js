
(function(a,b){"use strict";if(typeof define==="function"&&define.amd){define(["exports"],b);}else if(typeof exports!=="undefined"){b(exports);}else{b(a.gpf={});}}(this,function(a){"use strict";var a,b;if("undefined"!==typeof WScript){a="wscript";b=function(){return this;}.apply(null,[]);b.console={log:function(c){WScript.Echo("    "+c);},info:function(c){WScript.Echo("[?] "+c);},warn:function(c){WScript.Echo("/!\\ "+c);},error:function(c){WScript.Echo("(X) "+c);}};}else if("undefined"!==typeof module&&module.exports){a="nodejs";b=global;}else if("undefined"!==typeof window){a="browser";b=window;}else{a="unknown";b=this;}gpf.host=function(){return a;};gpf.context=function(c){var d,e,f;if(undefined===c){return b;}else{if("string"===typeof c){c=c.split(".");}d=c.length;e=0;if(c[0]==="gpf"){f=gpf;++e;}else{f=b;}for(;e<d;++e){f=f[c[e]];if(undefined===f){break;}}return f;}};gpf.loaded=function(c){if(c){c();}return true;};gpf.ASSERT=function(){};(function(){"use strict";if(undefined===Array.prototype.indexOf){Array.prototype.indexOf=function(c){var d=this.length;while(d--){if(this[d]===c){return d;}}return-1;};}if(undefined===Object.defineProperty){gpf.setReadOnlyProperty=function(c,d,e){c[d]=e;return c;};}else{gpf.setReadOnlyProperty=function(c,d,e){Object.defineProperty(c,d,{enumerable:true,configurable:false,writable:false,value:e});return c;};}}());var c=function(p,q,r){var s,t=p.length,u;for(u=0;u<t;++u){s=q.apply(this,[u,p[u]]);if(undefined!==s){return s;}}return r;},d=function(p,q){var r=p.length,s;for(s=0;s<r;++s){q.apply(this,[s,p[s]]);}},e=function(p,q,r){var s,t;for(t in p){if(p.hasOwnProperty(t)){s=q.apply(this,[t,p[t]]);if(undefined!==s){return s;}}}return r;},f=function(p,q){var r;for(r in p){if(p.hasOwnProperty(r)){q.apply(this,[r,p[r]]);}}},g=function(p,q){this[0][p]=q;},h=function(p,q){var r=this[0],s=this[2];if(undefined!==r[p]){s(r,p,q);}else{r[p]=q;}},i=function(p,q,r){var s,t,u,v=p.length;for(s=0;s<v;++s){t=p[s].a;u=p[s].b;if(t===q&&u===r||u===q&&t===r){return s;}}return undefined;},j=function(p,q,r){if(r&&("object"===typeof p||"object"===typeof q)){if(p instanceof String||q instanceof String){return p.toString()===q.toString();}if(p instanceof Number||q instanceof Number){return p.valueOf()===q.valueOf();}return false;}return false;},k=function(p,q,r,s){if(p!==q){if(typeof p!==typeof q&&!j(p,q,r)){return false;}if(null===p||null===q||"object"!==typeof p){return false;}if(undefined===i(s.done,p,q)){s.todo.push(p);s.todo.push(q);}}return true;},l=function(p,q,r){var s,t,u={todo:[p,q],done:[]};while(0!==u.todo.length){q=u.todo.pop();p=u.todo.pop();if(p.prototype!==q.prototype){return false;}u.done.push({a:p,b:q});t=0;for(s in p){if(p.hasOwnProperty(s)){++t;if(!k(p[s],q[s],r,u)){return false;}}}for(s in q){if(q.hasOwnProperty(s)){--t;}}if(0!==t){return false;}}return true;},m={boolean:function(p,q,r){if("string"===q){if("yes"===p||"true"===p){return true;}return 0!==parseInt(p,10);}if("number"===q){return 0!==p;}return r;},number:function(p,q,r){if("string"===q){return parseFloat(p);}return r;},string:function(p,q,r){gpf.interfaces.ignoreParameter(q);gpf.interfaces.ignoreParameter(r);if(p instanceof Date){return gpf.dateToComparableFormat(p);}return p.toString();},object:function(p,q,r){if(r instanceof Date&&"string"===q){return gpf.dateFromComparableFormat(p);}return r;}},n=Function,o=function(){return undefined;};gpf.each=function(p,q,r){if(undefined===r){if(p instanceof Array){d.apply(this,arguments);}else{f.apply(this,arguments);}return undefined;}if(p instanceof Array){return c.apply(this,arguments);}return e.apply(this,arguments);};gpf.extend=function(p,q,r){var s;if(undefined===r){s=g;}else{s=h;}gpf.each.apply(arguments,[q,s]);return p;};gpf.extend(gpf,{_alpha:"abcdefghijklmnopqrstuvwxyz",_ALPHA:"ABCDEFGHIJKLMNOPQRSTUVWXYZ",_digit:"0123456789",_func:function(p){if(!p){return o;}else{return new n(p);}},emptyFunction:function(){return o;},value:function(p,q,r){var s=typeof p;if(!r){r=typeof q;}if(r===s){return p;}if("undefined"===s||!p){return q;}return m[r](p,s,q);},like:function(p,q,r){if(p===q){return true;}if(typeof p!==typeof q){return j(p,q,r);}if(null===p||null===q||"object"!==typeof p){return false;}return l(p,q,r);},clone:function(p){return gpf.json.parse(gpf.json.stringify(p));},test:function(p,q){var r;if(p instanceof Array){r=p.length;while(r>0){if(p[--r]===q){return r;}}}else{for(r in p){if(p.hasOwnProperty(r)&&p[r]===q){return r;}}}return undefined;},set:function(p,q){gpf.ASSERT(p instanceof Array,"gpf.set must be used with an Array");var r=p.length;while(r>0){if(p[--r]===q){return p;}}p.push(q);return p;},clear:function(p,q){var r;if(p instanceof Array){r=p.length;while(r>0){if(p[--r]===q){p.splice(r,1);break;}}}else{for(r in p){if(p.hasOwnProperty(r)&&p[r]===q){break;}}}return p;},xor:function(p,q){return p&&!q||!p&&q;},capitalize:function(p){return p.charAt(0).toUpperCase()+p.substr(1);},Callback:function(p,q){if(p){this._handler=p;}if(q){this._scope=q;}}});gpf.extend(gpf.Callback.prototype,{_handler:gpf._func(""),_scope:null,handler:function(){return this._handler;},scope:function(){return this._scope;},call:function(){var p=arguments[0],q=[],r=arguments.length,s;for(s=1;s<r;++s){q.push(arguments[s]);}return this.apply(p,q);},apply:function(p,q){var r=gpf.Callback.resolveScope(this._scope||p);return this._handler.apply(r,q||[]);}});gpf.extend(gpf.Callback,{resolveScope:function(p){if(null===p||undefined===p){p=gpf.context();}return p;},buildParamArray:function(p,q){var r,s,t;if(q){r=q.length;s=new Array(p+r);for(t=0;t<r;++t){s[p]=q[t];++p;}}else{s=new Array(p);}return s;},doApply:function(p,q,r){var s=arguments.length,t=3,u=0;while(t<s){r[u]=arguments[t];++t;++u;}return p.apply(q,r);},bind:function(p,q){gpf.ASSERT("string"===typeof q,"Provide method name");var r=q+":boundToThis";gpf.ASSERT("function"===typeof p[q],"Only methods can be bound");if(undefined===p[r]){p[r]=function(){return p[q].apply(p,arguments);};}return p[r];}});var p=0,q=function(v,w,x){if(x instanceof r){x._broadcastEvent(v);}else if("function"===typeof x||x instanceof gpf.Callback){x.apply(w,[v]);}else{x=x[v.type()];if(undefined!==typeof x){x.apply(w,[v]);}}},r=function(v){var w,x,y;this._listeners={};if(undefined!==v){this._events=v;x=v.length;for(w=0;w<x;++w){y=v[w];this["on"+y.charAt(0).toUpperCase()+y.substr(1)]=this._onEVENT(w);this._listeners[y]=[];}}},s=function(v){return function(){var w=[this._events[v]],x=arguments.length,y;for(y=0;y<x;++y){w.push(arguments[y]);}return this.addEventListener.apply(this,w);};},t=function(){r.apply(this,arguments);},u=function(v,w,x,y){this._type=v;if(undefined!==w){this._params=w;}if(x){this._cancelable=true;}if(y){this._scope=y;}};gpf.extend(r.prototype,{_listeners:{},_events:null,_onEVENT:function(v){var w=t.prototype._onEVENT.closures,x;if(!w){w=t.prototype._onEVENT.closures=[];}gpf.ASSERT(w.length>=v,"calls must be sequential");while(w.length<=v){x=w.length;w.push(s(x));}return w[v];},addEventListener:function(v,w,x,y){var z=this._listeners;if("boolean"===typeof x){y=x;x=undefined;}else{if(!x){x=null;}if(!y){y=false;}}if(w instanceof gpf.Callback){if(x&&x!==w.scope()){w=w.handler();}}if(!(w instanceof gpf.Callback)){w=new gpf.Callback(w,x);}if(undefined===z[v]){z[v]=[];}if(y){z[v].unshift(w);}else{z[v].push(w);}return this;},removeEventListener:function(v,w,x){var y=this._listeners[v],z,A;if(undefined!==y){if(w instanceof gpf.Callback){if(!x){x=w.scope();}w=w.handler();}A=y.length;while(A>0){z=y[--A];if(z.handler()===w&&z.scope()===x){y.splice(A,1);break;}}}return this;},_broadcastEvent:function(v,w){var x,y,z;if(v instanceof u){y=v.type();}else{y=v;}z=this._listeners[y];if(undefined===z){return this;}if(v instanceof u){for(x=0;x<z.length;++x){z[x].apply(v._scope,[v]);if(v._propagationStopped){break;}}}else{for(x=0;x<z.length;++x){z[x].apply(null,[v,w]);}}return this;}});t.prototype=new r;gpf.extend(t.prototype,{broadcastEvent:function(){return this._broadcastEvent.apply(this,arguments);}});gpf.extend(u.prototype,{_type:"",_params:{},_cancelable:false,_propagationStopped:false,_defaultPrevented:false,_scope:null,type:function(){return this._type;},scope:function(){return gpf.Callback.resolveScope(this._scope);},cancelable:function(){return this._cancelable;},preventDefault:function(){this._defaultPrevented=true;},defaultPrevented:function(){return this._defaultPrevented;},stopPropagation:function(){this._propagationStopped=true;},get:function(v){return this._params[v];},fire:function(v){return gpf.events.fire(this,v);}});gpf.events={Target:r,Broadcaster:t,Event:u,fire:function(v,w,x){var y;if(undefined===x){x=w;w=undefined;}if(!(v instanceof u)){v=new gpf.events.Event(v,w,true,this);}y=gpf.Callback.resolveScope(v._scope);if(++p>10){gpf.defer(q,0,null,[v,y,x]);}else{q(v,y,x);}--p;return v;}};var v=0,w={},x=function(A){var B=A.scriptTag,C=A.headTag;B.onerror=B.onload=B.onreadystatechange=null;if(C&&B.parentNode){C.removeChild(B);}delete w[A.id];},y=function(){var A=w[this.id];if(!A.done&&(!this.readyState||this.readyState==="loaded"||this.readyState==="complete")){setTimeout(function(){A.done=true;gpf.events.fire("load",{url:A.src},A.eventsHandler);},0);x(A);}},z=function(){var A=w[this.id];if(!A.done){A.done=true;gpf.events.fire("error",{url:A.src},A.eventsHandler);x(A);}};gpf.http={include:function(A,B){var C={src:A,id:"__gpf_http_"+ ++v,headTag:document.getElementsByTagName("head")[0]||document.documentElement,scriptTag:document.createElement("script"),done:false},D;if(undefined===B){B=new gpf.events.Broadcaster(["load","error"]);}C.eventsHandler=B;w[C.id]=C;D=C.scriptTag;D.language="javascript";D.src=A;D.id=C.id;D.onload=D.onreadystatechange=y;D.onerror=z;if(undefined!==D.async){D.async=true;}setTimeout(function(){C.headTag.insertBefore(D,C.headTag.firstChild);},0);}};var A=function(C,D,E){if("string"===typeof C){C=gpf._func(C);}if(!D){D=null;}if(!E){E=[];}return function(){C.apply(gpf.Callback.resolveScope(D),E);};},B;gpf.runAsyncQueue=gpf._func();if("browser"===gpf.host()){A=function(C){C[0].apply(gpf.Callback.resolveScope(C[1]),C[2]);};gpf.defer=function(C,D,E,F){if("string"===typeof C){C=gpf._func(C);}if(!D){D=0;}setTimeout(A,D,[C,E,F]);};}else if("undefined"!==typeof setTimeout){gpf.defer=function(C,D,E,F){if(!D){D=0;}setTimeout(A(C,E,F),D);};}else{gpf._asyncQueue=[];B=function(C,D){return C._dt-D._dt;};gpf.defer=function(C,D,E,F){var G=A(C,E,F);if(!D){D=0;}G._dt=new Date(new Date- -D);gpf._asyncQueue.push(G);gpf._asyncQueue.sort(B);};gpf.runAsyncQueue=function(){var C=gpf._asyncQueue,D;while(C.length){D=C.shift();if(D._dt>new Date){WScript.Sleep(D._dt-new Date);}D();}};}var C=gpf._ALPHA+gpf._alpha+gpf._digit+"+/",D="0123456789ABCDEF",E=function(G,H,I,J){var K=G.length,L=gpf.bin.isPow2(K),M,N,O=[],P;if(-1<L&&(undefined===I||I*L<=32)){if(undefined===I){M=32;}else{M=I*L;}N=(1<<M-L)-1;M=(1<<L)-1;while(0!==H){P=H&M;O.unshift(G.charAt(P));H=H>>L&N;}}else{while(0!==H){P=H%K;O.unshift(G.charAt(P));H=(H-P)/K;}}if(undefined!==I){if(undefined===J){J=G.charAt(0);}while(O.length<I){O.unshift(J.charAt(O.length%J.length));}}else if(0===O.length){O=[G.charAt(0)];}return O.join("");},F=function(G,H,I){var J=G.length,K=0,L=0;if(undefined===I){I=G.charAt(0);}while(L<H.length){if(-1===I.indexOf(H.charAt(L))){break;}else{++L;}}while(L<H.length){K=J*K+G.indexOf(H.charAt(L++));}return K;};gpf.bin={pow2:function(G){return 1<<G;},isPow2:function(G){if(0<G&&0===(G&G-1)){var H=0;while(1<G){++H;G>>=1;}return H;}else{return-1;}},toBaseANY:E,fromBaseANY:F,toHexa:function(G,H,I){return E(D,G,H,I);},fromHexa:function(G,H){return F(D,G,H);},toBase64:function(G,H,I){return E(C,G,H,I);},fromBase64:function(G,H){return F(C,G,H);},test:function(G,H){return(G&H)===H;},clear:function(G,H){return G&~H;}};gpf.json={};if("undefined"===typeof JSON){var G=function(I){var J,K,L,M;J=I instanceof Array;K=[];for(L in I){if("function"===typeof I[L]){continue;}M=H(I[L]);if(J){K.push(M);}else{K.push(L+": "+M);}}if(J){return"["+K.join(", ")+"]";}else{return"("+K.join(", ")+")";}},H=function(I){var J=typeof I;if("undefined"===J||"function"===J){return;}else if("number"===J||"boolean"===J){return I.toString();}else if("string"===J){return gpf.escapeFor(I,"javascript");}if(null===I){return"null";}else{return G(I);}};gpf.json.stringify=H;gpf.json.parse=function(I){return gpf._func("return "+I)();};}else{gpf.json.stringify=JSON.stringify;gpf.json.parse=JSON.parse;}var L="public|protected|private|static".split("|"),M=0,N=1,O=3,P=true,Q=0,R=gpf._alpha+gpf._ALPHA+gpf._digit+"_",S=function(U){var V;U=U.toString();V=U.indexOf("._super");if(-1===V){return false;}return-1===R.indexOf(U.charAt(V+7));},T=function(U,V){return function(){var W=this._super,X;this._super=U;X=V.apply(this,arguments);if(undefined===W){delete this._super;}else{this._super=W;}return X;};};gpf.ClassDefinition=function(U,V,W){this._uid=++Q;this._Subs=[];if("function"===typeof U){this._Constructor=U;}else{this._name=U;this._Base=V;this._definition=W;this._build();}};gpf.extend(gpf.ClassDefinition.prototype,{_uid:0,uid:function(){return this._uid;},_name:"",name:function(){return this._name;},nameOnly:function(){var U=this._name,V=U.lastIndexOf(".");if(-1===V){return U;}else{return U.substr(V+1);}},_Base:Object,Base:function(){return this._Base;},_Subs:[],Subs:function(){return this._Subs;},_attributes:null,attributes:function(){if(!this._attributes){this._attributes=new gpf.attributes.Map;}return this._attributes;},_Constructor:function(){},_defConstructor:null,Constructor:function(){return this._Constructor;},_definition:null,addMember:function(U,V,W){var X=this._Constructor.prototype;gpf.ASSERT(U!=="constructor","No constructor can be added");gpf.ASSERT(undefined===X[U],"No member can be overridden");if(undefined===W){W=M;}else if("string"===typeof W){W=L.indexOf(W);if(-1===W){W=M;}}this._addMember(U,V,W);},_addMember:function(U,V,W){var X=this._Constructor.prototype;if(O===W){gpf.setReadOnlyProperty(X.constructor,U,V);}else{X[U]=V;}},_processMember:function(U,V){var W=this._definition[U],X=U==="constructor",Y,Z,ab;Y=typeof W;if(O===V){this._addMember(U,W,O);return;}if(X){Z=this._Base;}else{Z=this._Base.prototype[U];}ab=typeof Z;if("undefined"!==ab&&null!==Z&&Y!==ab){gpf.Error.ClassMemberOverloadWithTypeChange();}if("function"===Y&&"undefined"!==ab&&S(W)){W=T(Z,W);}if(X){this._defConstructor=W;}else{this._addMember(U,W,V);}},_processAttribute:function(U){var V,W=this._definition[U];U=U.substr(1,U.length-2);if(!this._attributes){this._attributes={};}V=this._attributes[U];if(undefined===V){V=[];}this._attributes[U]=V.concat(W);},_processDefWithVisibility:function(U){var V=this._definition,W,X;X=L[U];W=V[X];this._definition=W;try{for(X in W){if(W.hasOwnProperty(X)){if("["===X.charAt(0)&&"]"===X.charAt(X.length-1)){this._processAttribute(X);}else if("public"===X||"private"===X||"protected"===X||"static"===X){gpf.Error.ClassInvalidVisibility();}else{this._processMember(X,U);}}}if("wscript"===gpf.host()&&W.constructor!==Object){this._processMember("constructor",U);}}catch(e){throw e;}finally{this._definition=V;}},_processDefinition:function(){var U=this._definition,V,W;for(V in U){if(U.hasOwnProperty(V)){if("["===V.charAt(0)&&"]"===V.charAt(V.length-1)){this._processAttribute(V);}else{W=L.indexOf(V);if(-1===W){if(V.charAt(0)==="_"){W=N;}else{W=M;}this._processMember(V,W);}else{this._processDefWithVisibility(W);}}}}if("wscript"===gpf.host()&&U.constructor!==Object){this._processMember("constructor",M);}},_processAttributes:function(){var U=this._attributes,V,W,X;if(U){delete this._attributes;V=this._Constructor;W=V.prototype;for(X in U){if(U.hasOwnProperty(X)){if(X in W||X==="Class"){gpf.attributes.add(V,X,U[X]);}else{console.error("gpf.define: Invalid attribute name '"+X+"'");}}}}},_build:function(){var U,V,W;U=gpf._func(K(this._name))(gpf);this._Constructor=U;U._gpf=this;P=false;V=new this._Base;P=true;U.prototype=V;V.constructor=U;W=gpf.classDef(this._Base);W.Subs().push(U);this._processDefinition();this._processAttributes();}});gpf.classDef=function(U){if(undefined===U._gpf){U._gpf=new gpf.ClassDefinition(U);}return U._gpf;};gpf._classInit=function(U,V){if(P){var W=gpf.classDef(U);if(W._defConstructor){W._defConstructor.apply(this,V);}else{W._Base.apply(this,V);}}};function I(){var U=arguments[0],V=_CONSTRUCTOR_=function(){U._classInit.apply(this,[V,arguments]);};return V;}function J(){var U=arguments[0],V=function _CONSTRUCTOR_(){U._classInit.apply(this,[V,arguments]);};return V;}function K(U){var V,W,X,Y;if(-1<U.indexOf(".")){V=I;}else{V=J;}W=V.toString().replace("_CONSTRUCTOR_",U);X=W.indexOf("{")+1;Y=W.lastIndexOf("}")-1;return W.substr(X,Y-X+1);}gpf.define=function(U,V,W){var X,Y,Z,ab,bb;if("string"===typeof V){V=gpf.context(V);}else if("object"===typeof V){W=V;V=undefined;}if(undefined===V){V=Object;}if(-1<U.indexOf(".")){Y=U.split(".");ab=Y.pop();Z=gpf.context(Y);}bb=new gpf.ClassDefinition(U,V,W||{});X=bb.Constructor();if(undefined!==Z){Z[ab]=X;}return X;};gpf._genDefHandler=function(U,V){U=U+".";return function(W,X,Y){var Z;if(undefined===Y&&"object"===typeof X){Y=X;X=U+V;}else if(undefined===X){X=U+V;}if(-1===W.indexOf(".")){W=U+W;}Z=gpf.define(W,X,Y);return Z;};};var V=0,W=gpf._genDefHandler("gpf.attributes","Attribute");gpf.attributes={};function U(X,Y){Y="$"+Y;gpf[Y]=function(){var Z=gpf._func("return function "+Y+"(args) {"+"this.constructor.apply(this, args);"+"};")();Z.prototype=X.prototype;return function(){return new Z(arguments);};}();}gpf._defAttr=function(X,Y,Z){var ab=X.charAt(0)==="$",bb,cb;if(ab){X=X.substr(1);bb=X+"Attribute";}else{bb=X;}cb=W(bb,Y,Z);if(ab){U(cb,X);}return cb;};gpf._defAttr("Attribute",{protected:{_member:"",_alterPrototype:function(X){gpf.interfaces.ignoreParameter(X);}},public:{member:function(){return this._member;}}});gpf._defAttr("$Alias",{private:{_name:""},protected:{_alterPrototype:function(X){U(X.constructor,this._name);}},public:{constructor:function(X){this._name=X;}}});gpf.define("gpf.attributes.Array",{private:{_array:[]},public:{constructor:function(){this._array=[];},has:function(X){gpf.ASSERT("function"===typeof X,"Expected a class parameter");gpf.ASSERT(X.prototype instanceof gpf.attributes.Attribute,"Expected an Attribute-like class parameter");var Y,Z=this._array,ab=Z.length,bb;for(Y=0;Y<ab;++Y){bb=Z[Y];if(bb instanceof X){return bb;}}return null;},filter:function(X){gpf.ASSERT("function"===typeof X,"Expected a class parameter");gpf.ASSERT(X.prototype instanceof gpf.attributes.Attribute,"Expected an Attribute-like class parameter");var Y,Z=this._array,ab=Z.length,bb,cb=new gpf.attributes.Array,db=cb._array;for(Y=0;Y<ab;++Y){bb=Z[Y];if(bb instanceof X){db.push(bb);}}return cb;},each:function(X,Y,Z){Y=gpf.Callback.resolveScope(Y);Z=gpf.Callback.buildParamArray(1,Z);var ab,bb=this._array,cb=bb.length,db;for(ab=0;ab<cb;++ab){db=gpf.Callback.doApply(X,Y,Z,bb[ab]);if(undefined!==db){return db;}}}}});gpf.define("gpf.attributes.Map",{private:{_members:{},_count:0,_copyTo:function(X,Y,Z){var ab=this._members,bb,cb,db,eb;if(this._count){for(bb in ab){if(ab.hasOwnProperty(bb)){cb=ab[bb]._array;for(db=0;db<cb.length;++db){eb=cb[db];if(!Y||Y(bb,eb,Z)){X.add(bb,eb);}}}}}},_filterCallback:function(X,Y,Z){gpf.interfaces.ignoreParameter(X);return Y instanceof Z;}},public:{constructor:function(X){this._members={};this._count=0;if(undefined!==X){this.fillFromObject(X);}},count:function(){return this._count;},add:function(X,Y){var Z=this._members[X];if(undefined===Z){Z=this._members[X]=new gpf.attributes.Array;}Z._array.push(Y);++this._count;},fillFromObject:function(X){return this.fillFromClassDef(gpf.classDef(X.constructor));},fillFromClassDef:function(X){var Y;while(X){Y=X.attributes();if(Y){Y._copyTo(this);}if(X.Base()!==Object){X=gpf.classDef(X.Base());}else{break;}}return this._count;},filter:function(X){gpf.ASSERT("function"===typeof X,"Expected a class parameter");gpf.ASSERT(X.prototype instanceof gpf.attributes.Attribute,"Expected an Attribute-like class parameter");var Y=new gpf.attributes.Map;this._copyTo(Y,this._filterCallback,X);return Y;},member:function(X){var Y=this._members[X];if(undefined===Y){if(0===V){V=new gpf.attributes.Array;}Y=V;}return Y;},members:function(){var X=this._members,Y=[],Z;for(Z in X){if(X.hasOwnProperty(Z)){Y.push(Z);}}return Y;},each:function(X,Y,Z){Y=gpf.Callback.resolveScope(Y);Z=gpf.Callback.buildParamArray(2,Z);var ab=this._members,bb,cb;for(bb in ab){if(ab.hasOwnProperty(bb)){cb=gpf.Callback.doApply(X,Y,Z,bb,ab[bb]);if(undefined!==cb){return cb;}}}},addTo:function(X){var Y=this._members,Z;for(Z in Y){if(Y.hasOwnProperty(Z)){gpf.attributes.add(X,Z,Y[Z]);}}}}});gpf.attributes.add=function(X,Y,Z){var ab,bb,cb,db;ab=gpf.classDef(X).attributes();bb=Z.length;for(cb=0;cb<bb;++cb){db=Z[cb];db._member=Y;ab.add(Y,db);db._alterPrototype(X.prototype);}};gpf.define("gpf.Error",{public:{code:0,name:"Error",message:""}});var X={"NotImplemented":"Not implemented","Abstract":"Abstract","AssertionFailed":"Assertion failed: {message}","ClassMemberOverloadWithTypeChange":"You can't overload a member to change its type","ClassInvalidVisibility":"Invalid visibility keyword","InterfaceExpected":"Expected interface not implemented: {name}","EnumerableInvalidMember":"$Enumerable can be associated to arrays only","PatternUnexpected":"Invalid syntax (unexpected)","PatternEmpty":"Empty pattern","PatternInvalidSyntax":"Invalid syntax","PatternEmptyGroup":"Syntax error (empty group)","HtmlHandlerMultiplicityError":"Too many $HtmlHandler attributes for '{member}'","HtmlHandlerMissing":"No $HtmlHandler attributes","HtmlHandlerNoDefault":"No default $HtmlHandler attribute","EngineStackUnderflow":"Stack underflow","EngineTypeCheck":"Type check","EncodingNotSupported":"Encoding not supported","EncodingEOFWithUnprocessedBytes":"Unexpected end of stream: unprocessed bytes","XmlInvalidName":"Invalid XML name"},Y=function(bb,cb){return function(db){var eb=new gpf.Error,fb,gb;eb.code=bb;eb.name=cb;if(db){fb={};for(gb in db){if(db.hasOwnProperty(gb)){fb["{"+gb+"}"]=db[gb].toString();}}eb.message=gpf.replaceEx(X[cb],fb);}else{eb.message=X[cb];}throw eb;};},name,code=0;for(name in X){if(X.hasOwnProperty(name)){++code;gpf.Error["CODE_"+name.toUpperCase()]=code;gpf.Error[name]=Y(code,name);}}var bb=function(eb){return gpf._func("return this."+eb+";");},cb=function(eb){return gpf._func("var r = this."+eb+"; if (0 < arguments.length) { this."+eb+" = arguments[0]; } return r;");},db=gpf._defAttr("ClassAttribute");gpf._defAttr("$ClassProperty",db,{private:{_writeAllowed:false,_publicName:undefined,_visibility:undefined},protected:{_alterPrototype:function(eb){var fb=this._member,gb=this._publicName,hb=gpf.classDef(eb.constructor),ib;if(!gb){gb=fb.substr(1);}if(this._writeAllowed){ib=cb(fb);}else{ib=bb(fb);}hb.addMember(gb,ib,this._visibility);}},public:{constructor:function(eb,fb,gb){if(eb){this._writeAllowed=true;}if("string"===typeof fb){this._publicName=fb;}if("string"===typeof gb){this._visibility=gb;}}}});gpf._defAttr("$ClassEventHandler",db,{});gpf._defAttr("$ClassExtension",db,{private:{_ofClass:gpf.emptyFunction(),_publicName:""},public:{constructor:function(eb,fb){this._ofClass=eb;if("string"===typeof fb){this._publicName=fb;}}}});gpf.interfaces={isImplementedBy:function(gb,hb){var ib;for(ib in hb.prototype){if("constructor"===ib||"extend"===ib){continue;}if(typeof hb.prototype[ib]!==typeof gb[ib]){return false;}}return true;},query:function(gb,hb,ib){var jb=null;if(gpf.interfaces.isImplementedBy(gb,hb)){return gb;}else if(gpf.interfaces.isImplementedBy(gb,gpf.interfaces.IUnknown)){jb=gb.queryInterface(hb);}if(null===jb&&ib){gpf.Error.InterfaceExpected({name:gpf.classDef(hb).name()});}return jb;}};if(!gpf.interfaces.ignoreParameter){gpf.interfaces.ignoreParameter=function(){};}gpf._defIntrf=gpf._genDefHandler("gpf.interfaces","Interface");gpf._defIntrf("Interface");gpf._defIntrf("IEventTarget",{addEventListener:function(gb,hb,ib,jb){gpf.interfaces.ignoreParameter(gb);gpf.interfaces.ignoreParameter(hb);gpf.interfaces.ignoreParameter(ib);gpf.interfaces.ignoreParameter(jb);},removeEventListener:function(gb,hb,ib){gpf.interfaces.ignoreParameter(gb);gpf.interfaces.ignoreParameter(hb);gpf.interfaces.ignoreParameter(ib);}});gpf._defIntrf("IUnknown",{queryInterface:function(gb){gpf.interfaces.ignoreParameter(gb);return null;}});function eb(gb){var hb=new gpf.attributes.Map(this).member("Class").filter(gpf.attributes.InterfaceImplementAttribute),ib,jb;for(ib=0;ib<hb.length();++ib){jb=hb.get(ib);if(jb._interfaceDefinition===gb){if(jb._builder){return jb._builder(this);}break;}}return null;}function fb(gb){return function(){var hb=eb.apply(this,arguments);if(null===hb){hb=gb.apply(this,arguments);}return hb;};}gpf._defAttr("$InterfaceImplement",{private:{"[_interfaceDefinition]":[gpf.$ClassProperty(false,"which")],_interfaceDefinition:gpf.emptyFunction(),"[_builder]":[gpf.$ClassProperty(false,"how")],_builder:null},protected:{_alterPrototype:function(gb){var hb=this._interfaceDefinition.prototype,ib=gpf.classDef(this._interfaceDefinition),jb,kb;kb=new gpf.attributes.Map;kb.fillFromClassDef(ib);kb.addTo(gb.constructor);if(!this._builder){for(jb in hb){if(!(jb in gb)){gb[jb]=hb[jb];}}return;}if(undefined!==gb.queryInterface){if(eb!==gb.queryInterface){gb.queryInterface=fb(gb.queryInterface);}}else{gb.queryInterface=eb;gpf.attributes.add(gb.constructor,"Class",[gpf.$InterfaceImplement(gpf.interfaces.IUnknown)]);}}},public:{constructor:function(gb,hb){this._interfaceDefinition=gb;if(hb){this._builder=hb;}}}});var ib=gpf.interfaces,jb=gpf.attributes;gpf._defIntrf("IEnumerable",{reset:function(){},moveNext:function(){return false;},current:function(){return null;}});function gb(kb){var lb=-1;return{reset:function(){lb=-1;},moveNext:function(){++lb;return lb<kb.length;},current:function(){return kb[lb];}};}function hb(kb){var lb=new jb.Map(kb).filter(jb.EnumerableAttribute),mb=lb.members();gpf.ASSERT(mb.length===1,"Only one member can be defined as enumerable");return gb(kb[mb[0]]);}gpf._defAttr("$Enumerable",jb.ClassAttribute,{_alterPrototype:function(kb){if(!(kb[this._member]instanceof Array)){gpf.Error.EnumerableInvalidMember();}jb.add(kb.constructor,"Class",[new jb.InterfaceImplementAttribute(ib.IEnumerable,hb)]);}});var kb=gpf.interfaces,lb=gpf.attributes,mb;mb=gpf._defIntrf("IReadOnlyArray",{length:function(){return 0;},get:function(nb){kb.ignoreParameter(nb);return undefined;}});gpf._defIntrf("IArray",mb,{set:function(nb,ob){kb.ignoreParameter(nb);kb.ignoreParameter(ob);return undefined;}});gpf._defAttr("ClassArrayInterfaceAttribute",lb.ClassAttribute,{"[Class]":[gpf.$Alias("ClassIArray")],_writeAllowed:false,constructor:function(nb){if(nb){this._writeAllowed=true;}},_alterPrototype:function(nb){var ob;if(this._writeAllowed){ob=kb.IArray;}else{ob=kb.IReadOnlyArray;}lb.add(nb.constructor,"Class",[gpf.$InterfaceImplement(ob)]);nb.length=gpf._func("return this."+this._member+".length;");nb.get=gpf._func("return this."+this._member+"[arguments[0]];");if(this._writeAllowed){nb.set=gpf._func("var i=arguments[0],"+"v=this."+this._name+"[i];this."+this._member+"[i]=arguments[1];return v;");}}});lb.add(lb.Array,"_array",[gpf.$ClassIArray(false)]);gpf.arrayOrItem=function(nb,ob){if(undefined===ob){return Array.prototype.slice.call(nb,0);}else if(0===nb.length){return undefined;}else if(-1===ob){return nb[nb.length-1];}else if(ob<-1||ob>nb.length-1){return undefined;}else{return nb[ob];}};var nb=gpf.interfaces,ob=gpf.events.fire,pb=256,qb=0,rb=1,sb=2,tb=3;gpf._defIntrf("IReadableStream",{"[read]":[gpf.$ClassEventHandler()],read:function(ub,vb){gpf.interfaces.ignoreParameter(ub);gpf.interfaces.ignoreParameter(vb);},static:{EVENT_ERROR:"error",EVENT_DATA:"data",EVENT_END_OF_STREAM:"eos",EXCEPTION_READ_IN_PROGRESS:{message:"Read in progress"}}});gpf._defIntrf("IWritableStream",{"[write]":[gpf.$ClassEventHandler()],write:function(ub,vb){gpf.interfaces.ignoreParameter(ub);gpf.interfaces.ignoreParameter(vb);},static:{EVENT_ERROR:"error",EVENT_READY:"ready",EXCEPTION_WRITE_IN_PROGRESS:{message:"Read in progress"}}});gpf._defIntrf("IStream",{"[read]":[gpf.$ClassEventHandler()],read:function(ub,vb){gpf.interfaces.ignoreParameter(ub);gpf.interfaces.ignoreParameter(vb);},"[write]":[gpf.$ClassEventHandler()],write:function(ub,vb){gpf.interfaces.ignoreParameter(ub);gpf.interfaces.ignoreParameter(vb);}});gpf._defIntrf("ITextStream",nb.IStream,{});gpf.stream={};gpf.define("gpf.stream.BufferedOnRead",{"[Class]":[gpf.$InterfaceImplement(nb.IReadableStream)],protected:{_buffer:[],_bufferLength:0,_readSize:pb,_addToBuffer:function(ub){gpf.interfaces.ignoreParameter(ub);gpf.Error.Abstract();},_endOfInputStream:function(){},_readFromBuffer:function(ub){gpf.ASSERT(0!==this._buffer.length,"Buffer is not empty");if("string"===this._buffer[0]){return this._readFromStringBuffer(ub);}else{return this._readFromByteBuffer(ub);}},_readFromStringBuffer:function(ub){var vb=gpf.stringExtractFromStringArray(this._buffer,ub);this._bufferLength-=vb.length;return vb;},_readFromByteBuffer:function(ub){this._bufferLength-=ub;return this._buffer.splice(0,ub);}},public:{constructor:function(ub){this._iStream=nb.query(ub,nb.IReadableStream,true);this._buffer=[];},read:function(ub,vb){var wb=this._iState,xb=this._bufferLength;if(rb===wb){throw nb.IReadableStream.EXCEPTION_READ_IN_PROGRESS;}else if(ub<xb||xb&&tb===wb){if(0===ub||ub>xb){ub=xb;}ob.apply(this,[nb.IReadableStream.EVENT_DATA,{buffer:this._readFromBuffer(ub)},vb]);}else if(tb===wb){ob.apply(this,[nb.IReadableStream.EVENT_END_OF_STREAM,vb]);}else{if(qb===this._iState){this._cbRead=new gpf.Callback(this._onRead,this);}this._iState=rb;this._size=ub;this._eventsHandler=vb;this._iStream.read(this._readSize,this._cbRead);}}},private:{_iStream:null,_cbRead:null,_iState:qb,_size:0,_eventsHandler:null,_onRead:function(ub){var vb=ub.type();if(vb===nb.IReadableStream.EVENT_END_OF_STREAM){this._iState=tb;this._endOfInputStream();return this.read(this._size,this._eventsHandler);}else if(vb===nb.IReadableStream.EVENT_ERROR){ob.apply(this,[ub,this._eventsHandler]);}else{this._iState=sb;this._addToBuffer(ub.get("buffer"));if(0<this._bufferLength){return this.read(this._size,this._eventsHandler);}else{this._iStream.read(pb,this._cbRead);}}}}});gpf.define("gpf.stream.BitReader","gpf.stream.BufferedOnRead",{"[Class]":[gpf.$InterfaceImplement(nb.IReadableStream)],protected:{_addToBuffer:function(ub){this._buffer=this._buffer.concat(ub);this._bufferLength+=ub.length*8;},_readFromBuffer:function(ub){var vb=this._buffer,wb=[],xb=this._bit,yb,zb=0,Ab=0;yb=vb[0];while(0<ub){--ub;Ab<<=1;if(0!==(yb&xb)){Ab|=1;}--this._bufferLength;if(xb===1){vb.shift();yb=vb[0];xb=128;}else{xb>>=1;}if(zb===7){wb.push(Ab);Ab=0;zb=0;}else{++zb;}}if(zb!==0){wb.push(Ab);}this._bit=xb;return wb;}},private:{_bit:128}});var ub=gpf.define("AbstractStreamReader",{public:{constructor:function(xb,yb){this._scope=gpf.Callback.resolveScope(xb);this._eventsHandler=yb;},read:function(xb){xb.read(this._readSize,gpf.Callback.bind(this,"callback"));}},protected:{_readSize:0,_consolidateBuffer:function(){gpf.Error.Abstract();return[];},_addBuffer:function(xb){gpf.interfaces.ignoreParameter(xb);gpf.Error.Abstract();}},private:{_scope:null,_eventsHandler:null,callback:function(xb){var yb=xb.type(),zb=xb.scope();if(yb===nb.IReadableStream.EVENT_END_OF_STREAM){ob.apply(this._scope,[nb.IReadableStream.EVENT_DATA,{buffer:this._consolidateBuffer()},this._eventsHandler]);}else if(yb===nb.IReadableStream.EVENT_ERROR){ob.apply(this._scope,[xb,this._eventsHandler]);}else{this._addBuffer(xb.get("buffer"));this.read(zb);}}}}),vb=gpf.define("StreamReader",ub,{public:{constructor:function(xb,yb,zb){this._super(xb,yb);this._concatMethod=zb;}},protected:{_consolidateBuffer:function(){return this._concatMethod(this._buffer);},_addBuffer:function(xb){this._buffer=this._concatMethod(this._buffer,xb);}},private:{_buffer:undefined,_concatMethod:null}}),wb=gpf.define("B64StreamReader",ub,{public:{constructor:function(xb,yb){this._super(xb,yb);this._buffer=[];}},protected:{_readSize:6,_consolidateBuffer:function(){return this._buffer.join("");},_addBuffer:function(xb){this._buffer.push(gpf.bin.toBase64(xb[0]));}},private:{_buffer:[]}});gpf.stream.readAll=function(xb,yb,zb){xb=gpf.interfaces.query(xb,nb.IReadableStream,true);new vb(this,zb,yb).read(xb);};gpf.stream.readAllAsB64=function(xb,yb){xb=new gpf.stream.BitReader(xb);new wb(this,yb).read(xb);};var yb=gpf.interfaces,zb=gpf.events.fire,Ab={javascript:{"\\":"\\\\","\"":"\\\"","\n":"\\n","\r":"\\r","\t":"\\t"},xml:{"&":"&amp;","<":"&lt;",">":"&gt;"},html:{"&":"&amp;","<":"&lt;",">":"&gt;","\xE9":"&eacute;","\xE8":"&egrave;","\xEA":"&ecirc;","\xE1":"&aacute;","\xE0":"&agrave;"}},Bb=gpf.define("StringStream",{"[Class]":[gpf.$InterfaceImplement(gpf.interfaces.ITextStream)],public:{constructor:function(Cb){if(undefined!==Cb&&Cb.length){this._buffer=[Cb];}else{this._buffer=[];}},read:function(Cb,Db){var Eb;if(0===this._buffer.length){zb.apply(this,[yb.IReadableStream.EVENT_END_OF_STREAM,Db]);}else{Eb=gpf.stringExtractFromStringArray(this._buffer,Cb);zb.apply(this,[yb.IReadableStream.EVENT_DATA,{buffer:Eb},Db]);}},write:function(Cb,Db){gpf.ASSERT(Cb&&Cb.length,"Write must contain data");this._buffer.push(Cb);zb.apply(this,[yb.IReadableStream.EVENT_READY,Db]);},consolidateString:function(){return this._buffer.join("");}},private:{_buffer:[]}});gpf.extend(gpf,{"[capitalize]":[gpf.$ClassExtension(String)],"[replaceEx]":[gpf.$ClassExtension(String)],replaceEx:function(Cb,Db){var Eb=Cb,Fb;for(Fb in Db){if(Db.hasOwnProperty(Fb)){if(-1<Eb.indexOf(Fb)){Eb=Eb.split(Fb).join(Db[Fb]);}}}return Eb;},"[escapeFor]":[gpf.$ClassExtension(String)],escapeFor:function(Cb,Db){var Eb=Ab[Db];if(undefined!==Eb){Cb=gpf.replaceEx(Cb,Eb);if("javascript"===Db){Cb="\""+Cb+"\"";}}return Cb;},"[stringExtractFromStringArray]":[gpf.$ClassExtension(String,"fromStringArray")],stringExtractFromStringArray:function(Cb,Db){var Eb=Cb.length,Fb,Gb,Hb,Ib;if(!Db){Fb=Cb.splice(0,Eb).join("");}else{Gb=0;do{Hb=Cb[Gb];Ib=Hb.length;if(Ib<=Db){++Gb;Db-=Ib;}else{break;}}while(0<Db&&Gb<Eb);if(0===Db){Fb=Cb.splice(0,Gb).join("");}else if(Gb<Eb){Fb=[];if(0<Gb){Fb.push(Cb.splice(0,Gb-1).join(""));}Hb=Cb.shift();Fb.push(Hb.substr(0,Db));Cb.unshift(Hb.substr(Db));Fb=Fb.join("");}else{Fb=Cb.splice(0,Eb).join("");}}return Fb;},"[stringToStream]":[gpf.$ClassExtension(String,"toStream")],stringToStream:function(Cb){return new Bb(Cb);},"[stringFromStream]":[gpf.$ClassExtension(String,"fromStream")],stringFromStream:function(Cb,Db){if(Cb instanceof Bb){zb.apply(this,[yb.IReadableStream.EVENT_DATA,{buffer:Cb.consolidateString()},Db]);}else{gpf.stream.readAll(Cb,xb,Db);}}});function xb(Cb,Db){if(undefined===Cb){return[Db];}else if(undefined!==Db){Cb.push(Db);return Cb;}else{return Cb.join("");}}var Db=gpf.interfaces,Eb=gpf.events.fire,Fb=gpf.define("ArrayStream",{"[Class]":[gpf.$InterfaceImplement(gpf.interfaces.IStream)],public:{constructor:function(Gb){if(undefined!==Gb&&Gb.length){this._buffer=[].concat(Gb);}else{this._buffer=[];}},read:function(Gb,Hb){var Ib;if(0===this._buffer.length){Eb.apply(this,[Db.IReadableStream.EVENT_END_OF_STREAM,Hb]);}else if(undefined===Gb||Gb>this._buffer.length){Ib=this._buffer;this._buffer=[];Eb.apply(this,[Db.IReadableStream.EVENT_DATA,{buffer:Ib},Hb]);}else{Ib=this._buffer.splice(0,Gb);Eb.apply(this,[Db.IReadableStream.EVENT_DATA,{buffer:Ib},Hb]);}},write:function(Gb,Hb){gpf.ASSERT(Gb&&Gb.length,"Write must contain data");this._buffer=this._buffer.concat(Gb);Eb.apply(this,[Db.IWritableStream.EVENT_READY,Hb]);},consolidateArray:function(){return[].concat(this._buffer);}},private:{_buffer:[]}});gpf.extend(gpf,{"[arrayToStream]":[gpf.$ClassExtension(Array,"toStream")],arrayToStream:function(Gb){return new Fb(Gb);},"[arrayFromStream]":[gpf.$ClassExtension(Array,"fromStream")],arrayFromStream:function(Gb,Hb){if(Gb instanceof Fb){Eb.apply(this,[Db.IReadableStream.EVENT_DATA,{buffer:Gb.consolidateArray()},Hb]);return;}else{gpf.stream.readAll(Gb,Cb,Hb);}}});function Cb(Gb,Hb){if(undefined===Gb){return Hb;}else if(undefined!==Hb){Gb=Gb.concat(Hb);return Gb;}else{return Gb;}}var Gb=function(Hb){if(10>Hb){return"0"+Hb;}else{return Hb;}};;gpf.extend(gpf,{"[dateToComparableFormat]":[gpf.$ClassExtension(Date,"toComparableFormat")],dateToComparableFormat:function(Hb,Ib){if(undefined===Ib){Ib=true;}var Jb=[Hb.getFullYear(),"-",Gb(Hb.getMonth()+1),"-",Gb(Hb.getDate())];if(Ib){Jb.push(" ",Gb(Hb.getHours()),":",Gb(Hb.getMinutes()),":",Gb(Hb.getSeconds()));}return Jb.join("");},"[dateFromComparableFormat]":[gpf.$ClassExtension(String)],dateFromComparableFormat:function(Hb){var Ib=new Date;Ib.setFullYear(parseInt(Hb.substr(0,4),10),parseInt(Hb.substr(5,2),10)-1,parseInt(Hb.substr(8,2),10));if(10<Hb.length){Ib.setHours(parseInt(Hb.substr(11,2),10),parseInt(Hb.substr(14,2),10),parseInt(Hb.substr(17,2),10),0);}else{Ib.setHours(0,0,0,0);}return Ib;}});var Hb=gpf.events.fire,Ib=function(Kb){var Lb;if(this._list.length){Lb=this._list.shift();this._pos=0;Hb.apply(this,[gpf.Promise.THEN,Kb,Lb]);}},Jb=function(Kb){var Lb,Mb;while(this._list.length){Lb=this._list.shift();if(undefined===Mb){Mb=Hb.apply(this,[gpf.Promise.FAIL,Kb,Lb]);}else{Hb.apply(this,[Mb,Lb]);}if(Mb._propagationStopped){break;}}};gpf.define("gpf.Promise",{private:{_list:[],_pos:0},public:{constructor:function(){this._list=[];},then:function(Kb){this._list.splice(this._pos,0,Kb);++this._pos;return this;},resolve:function(Kb){gpf.defer(Ib,0,this,[Kb]);},reject:function(Kb){gpf.defer(Jb,0,this,[Kb]);}},static:{THEN:"then",REJECT:"reject"}});var Kb=gpf.interfaces,Lb=gpf.events.fire,Mb={},Nb=function(Sb){return function(){this._calls.push(new Qb(true,Sb,arguments,0));this._start();return this;};},Ob=function(Sb,Tb){return function(){this._calls.push(new Qb(false,Sb,arguments,Tb));this._start();return this;};},Pb=function(Sb){var Tb={public:{},static:{interface:Sb}},Ub=Tb.public,Vb=new gpf.attributes.Map,Wb=Sb.prototype,Xb,Yb;Vb.fillFromClassDef(gpf.classDef(Sb));for(Xb in Wb){if(Wb.hasOwnProperty(Xb)){Yb=Wb[Xb];if("constructor"===Xb){continue;}gpf.ASSERT("function"===typeof Yb,"Only methods");if(Vb.member(Xb).has(gpf.attributes.ClassEventHandlerAttribute)){Ub[Xb]=Ob(Xb,Yb.length);}else{Ub[Xb]=Nb(Xb);}}}return Tb;},Qb=gpf.define("MethodCall",{private:{_synchronous:true,_name:"",_args:[],_length:0},public:{constructor:function(Sb,Tb,Ub,Vb){this._synchronous=Sb;this._name=Tb;this._args=Ub;this._length=Vb;},apply:function(Sb,Tb){var Ub=this._args,Vb=Sb[this._name],Wb,Xb,Yb;if(this._synchronous){Vb.apply(Sb,Ub);Tb.call();}else{Xb=this._length;Wb=new Array(Xb);Wb[--Xb]=Tb;if(Xb>Ub.length){Xb=Ub.length;}for(Yb=0;Yb<Xb;++Yb){Wb[Yb]=Ub[Yb];}Vb.apply(Sb,Wb);}}}}),Rb=gpf.define("WrapInterface",{private:{_iHandler:null,_calls:[],_callback:null,_catch:null,_finally:null,_finalEventType:"done",_asyncResult:function(Sb){var Tb=this._iHandler,Ub;if(Sb&&Sb.type()==="error"){if(this._catch){Lb.apply(Tb,[Sb,this._catch]);}return;}Ub=this._calls;if(Ub.length){Ub.shift().apply(Tb,this._callback);}else if(this._finally){Lb.apply(Tb,[this._finalEventType,this._finally]);}},_needStart:true,_start:function(){if(this._needStart){this._needStart=false;gpf.defer(this._asyncResult,0,this);}}},public:{constructor:function(Sb){this._iHandler=Kb.query(Sb,this.constructor.interface);this._calls=[];this._callback=new gpf.Callback(this._asyncResult,this);},$catch:function(Sb){this._catch=Sb;this._start();return this;},$finally:function(Sb,Tb){this._finally=Sb;if(Tb){this._finalEventType=Tb;}this._start();return this;}}});Kb.wrap=function(Sb){var Tb=gpf.classDef(Sb),Ub=Mb[Tb.uid()],Vb;if(undefined===Ub){if(Sb===Kb.Interface){Ub=Rb;}else{Vb=Kb.wrap(Tb.Base());Ub=gpf.define("Wrap"+Tb.nameOnly(),Vb,Pb(Sb));}Mb[Tb.uid()]=Ub;}return Ub;};gpf.define("gpf.Parser",{public:{constructor:function(){this.reset();},reset:function(Sb){this._pos=0;this._line=0;this._column=0;this._setParserState(Sb);},currentPos:function(){return{pos:this._pos,line:this._line,column:this._column};},parse:function(){var Sb=arguments.length,Tb,Ub;for(Tb=0;Tb<Sb;++Tb){Ub=arguments[Tb];if(null===Ub){this._finalizeParserState();}else{gpf.ASSERT("string"===typeof Ub,"string expected");this._parse(Ub);}}},setOutputHandler:function(Sb){gpf.ASSERT(Sb instanceof Array||Sb.apply,"Invalid output handler");this._outputHandler=Sb;}},protected:{_initialParserState:null,_ignoreCarriageReturn:false,_ignoreLineFeed:false,_finalizeParserState:function(){this._pState(0);},_setParserState:function(Sb){if(!Sb){Sb=this._initialParserState;}if(Sb!==this._pState){this._pState=Sb;}},_output:function(Sb){var Tb=this._outputHandler;if(Tb instanceof Array){Tb.push(Sb);}else if(null!==Tb){Tb.apply(this,[Sb]);}}},private:{_pos:0,_line:0,_column:0,_pState:null,_outputHandler:null,_parse:function(Sb){var Tb,Ub,Vb,Wb,Xb=false;Tb=Sb.length;for(Ub=0;Ub<Tb;++Ub){Vb=Sb.charAt(Ub);if("\r"===Vb&&this._ignoreCarriageReturn){Vb=0;}if("\n"===Vb&&this._ignoreLineFeed){Xb=true;Vb=0;}if(Vb){Wb=this._pState.apply(this,[Vb]);if(undefined!==Wb){this._setParserState(Wb);}}++this._pos;if("\n"===Vb||Xb){++this._line;this._column=0;}else{++this._column;}}}},static:{FINALIZE:null}});gpf.define("gpf.ParserStream",gpf.stream.BufferedOnRead,{public:{constructor:function(Sb,Tb){this._super(Tb);this._parser=Sb;this._parser.setOutputHandler(new gpf.Callback(this._output,this));}},protected:{_addToBuffer:function(Sb){this._parser.parse(Sb);},_endOfInputStream:function(){this._parser.parse(gpf.Parser.FINALIZE);},_readFromBuffer:gpf.stream.BufferedOnRead.prototype._readFromStringBuffer},private:{_output:function(Sb){this._buffer.push(Sb);this._bufferLength+=Sb.length;}}});var Sb=gpf.bin.test,Tb=gpf.bin.clear,Ub=gpf._defIntrf("ITokenizer",{write:function(bc){gpf.interfaces.ignoreParameter(bc);return-1;}}),Vb=gpf.define("PatternItem",{private:{"[_min]":[gpf.$ClassProperty(true)],_min:1,"[_max]":[gpf.$ClassProperty(true)],_max:1},public:{parse:function(bc){gpf.interfaces.ignoreParameter(bc);gpf.Error.Abstract();return Vb.PARSE_IGNORED;},finalize:function(){},reset:function(bc){gpf.interfaces.ignoreParameter(bc);},write:function(bc,cc){gpf.interfaces.ignoreParameter(bc);gpf.interfaces.ignoreParameter(cc);gpf.Error.Abstract();return-1;}},static:{PARSE_IGNORED:0,PARSE_PROCESSED:1,PARSE_END_OF_PATTERN:2,PARSE_PROCESSED_EOP:3,CHARS_QUANTIFICATION:"?*+",WRITE_NO_MATCH:-1,WRITE_NEED_DATA:0,WRITE_MATCH:1,WRITE_PATTERN_END:2,WRITE_FINAL_MATCH:3}}),Wb=gpf.define("PatternChar",Vb,{private:{_match:""},public:{parse:function(bc){this._match=bc;return Vb.PARSE_PROCESSED_EOP;},write:function(bc,cc){gpf.interfaces.ignoreParameter(bc);if(cc===this._match){return Vb.WRITE_FINAL_MATCH;}return Vb.WRITE_NO_MATCH;}}}),Xb=gpf.define("PatternRange",Vb,{private:{_inc:"",_exc:"",_inRange:false,_parse:function(bc,cc){var dc,ec;if("^"===bc){this._exc=[];}else if("]"===bc){if(this._inRange){gpf.Error.PatternInvalidSyntax();}return true;}else if("-"===bc){if(this._inRange||0===cc.length){gpf.Error.PatternInvalidSyntax();}this._inRange=true;}else{if(this._inRange){dc=cc[cc.length-1].charCodeAt(0);ec=bc.charCodeAt(0);while(--ec>dc){cc.push(String.fromCharCode(ec));}cc.push(bc);delete this._inRange;}else{cc.push(bc);}}return false;}},public:{parse:function(bc){var cc;if(this.hasOwnProperty("_exc")){if("^"===bc){gpf.Error.PatternInvalidSyntax();}cc=this._exc;}else{cc=this._inc;}if("["===bc){if(this.hasOwnProperty("_inc")){gpf.Error.PatternInvalidSyntax();}this._inc=[];}else if(this._parse(bc,cc)){return Vb.PARSE_PROCESSED_EOP;}return Vb.PARSE_PROCESSED;},finalize:function(){this._inc=this._inc.join("");if(this.hasOwnProperty("_exc")){this._exc=this._exc.join("");}},write:function(bc,cc){gpf.interfaces.ignoreParameter(bc);var dc;if(this._inc.length){dc=-1<this._inc.indexOf(cc);}else{dc=true;}if(dc&&this._exc.length){dc=-1===this._exc.indexOf(cc);}if(dc){return Vb.WRITE_FINAL_MATCH;}else{return Vb.WRITE_NO_MATCH;}}}}),Yb=gpf.define("PatternGroup",Vb,{private:{_items:[],_choice:false,_optionals:[],_parsedParenthesis:false,_parsedItem:null,_getItems:function(bc){if(this._choice){if(undefined===bc){bc=this._items.length-1;}return this._items[bc];}return this._items;},_lastItem:function(){var bc=this._getItems();return bc[bc.length-1];},_push:function(bc){this._getItems().push(bc);this._parsedItem=bc;return bc;},_parseItem:function(bc){var cc=this._parsedItem,dc;if(cc){dc=cc.parse(bc);if(Sb(dc,Vb.PARSE_END_OF_PATTERN)){cc.finalize();this._parsedItem=null;dc=Tb(dc,Vb.PARSE_END_OF_PATTERN);}}else{dc=0;}return dc;},_parseQuantity:function(bc){var cc=this._lastItem();if("*"===bc){cc._min=0;cc._max=0;}else if("+"===bc){cc._max=0;}else if("?"===bc){cc._min=0;}return Vb.PARSE_PROCESSED;},_getOptional:function(bc){var cc;cc=bc.length;while(cc--){if(0!==bc[cc].min()){++cc;break;}}return cc;},_reset:function(bc,cc){cc.count=0;cc.sub={};bc.reset(cc.sub);},_getItem:function(bc,cc){var dc=this._getItems(bc.choice);if(cc<dc.length){return dc[cc];}return null;},_writeNoMatch:function(bc,cc,dc){if(cc.count<bc.min()||cc.length>cc.matchingLength+1){return Vb.WRITE_NO_MATCH;}bc=this._getItem(cc,cc.index+1);if(null===bc){return Vb.WRITE_NO_MATCH;}++cc.index;this._reset(bc,cc);return this.write(cc,dc);},_writeMatch:function(bc,cc){var dc=this._getItem(cc,cc.index+1),ec;if(this._choice&&-1<cc.choice){ec=this._optionals[cc.choice];}else{ec=this._optionals[0];}++cc.count;if(0===bc.max()){this._reset(bc,cc);if(null!==dc&&ec>cc.index){return Vb.WRITE_NEED_DATA;}else{return Vb.WRITE_MATCH;}}else if(cc.count===bc.max()){if(null===dc){return Vb.WRITE_FINAL_MATCH;}++cc.index;this._reset(dc,cc);if(ec<=cc.index){return Vb.WRITE_MATCH;}}return Vb.WRITE_NEED_DATA;}},public:{constructor:function(){this._items=[];},parse:function(bc){var cc=this._parseItem(bc);if(0!==cc){return cc;}if(-1<Vb.CHARS_QUANTIFICATION.indexOf(bc)){return this._parseQuantity(bc);}if("|"===bc){if(!this._choice){this._items=[this._items];this._choice=true;}this._items.push([]);return Vb.PARSE_PROCESSED;}else if("["===bc){this._push(new Xb);}else if("("===bc){if(this._parsedParenthesis){this._push(new Yb);}else{this._parsedParenthesis=true;return Vb.PARSE_PROCESSED;}}else if(")"===bc){return Vb.PARSE_PROCESSED_EOP;}else{this._push(new Wb);}return this._parseItem(bc);},finalize:function(){var bc,cc,dc;dc=this._optionals=[];if(this._choice){bc=this._items.length;for(cc=0;cc<bc;++cc){dc.push(this._getOptional(this._items[cc]));}}else{dc.push(this._getOptional(this._items));}},reset:function(bc){var cc;bc.index=0;if(this._choice){bc.choice=-1;}cc=this._getItems(0)[0];this._reset(cc,bc);},write:function(bc,cc){var dc,ec,fc,gc;if(this._choice&&-1===bc.choice){dc=this._items.length;for(ec=0;ec<dc;++ec){fc=this._items[ec][0];this._reset(fc,bc);gc=fc.write(bc.sub,cc);if(Vb.WRITE_NO_MATCH!==gc){bc.choice=ec;return this._writeMatch(fc,bc);}}if(ec===dc){return Vb.WRITE_NO_MATCH;}}fc=this._getItem(bc,bc.index);gc=fc.write(bc.sub,cc);if(Vb.WRITE_NEED_DATA===gc){return gc;}else if(Vb.WRITE_NO_MATCH===gc){return this._writeNoMatch(fc,bc,cc);}else{return this._writeMatch(fc,bc);}}}}),Zb=gpf.define("PatternParser",gpf.Parser,{private:{"[_patternItem]":[gpf.$ClassProperty()],_patternItem:null},protected:{_initialParserState:function(bc){this._patternItem.parse(bc);},_finalizeParserState:function(){var bc=this._patternItem;bc.parse(")");bc.finalize();}},public:{constructor:function(){this._super.apply(this,arguments);this._patternItem=new Yb;this._patternItem.parse("(");}}}),ac=gpf.define("PatternTokenizer",{"[Class]":[gpf.$InterfaceImplement(Ub)],private:{_patternItem:null,_stopMatching:false,_lastResult:0,_totalLength:0,_state:{}},public:{constructor:function(bc){this._patternItem=bc;this._state={};this._patternItem.reset(this._state);},write:function(bc){var cc;if(this._stopMatching){return this._lastResult;}++this._totalLength;cc=this._patternItem.write(this._state,bc);if(0<cc){this._lastResult=this._totalLength;this._stopMatching=Sb(cc,Vb.WRITE_PATTERN_END);}else if(Vb.WRITE_NO_MATCH===cc){this._stopMatching=true;if(0===this._lastResult){this._lastResult=-1;}}return this._lastResult;}}});gpf.define("gpf.Pattern",{private:{_patternItem:null},public:{constructor:function(bc){var cc=new Zb;cc.parse(bc,null);this._patternItem=cc.patternItem();},allocate:function(){return new ac(this._patternItem);}}});var bc="error",cc="unknown",dc="keyword",ec="identifier",fc="string",gc="number",hc="symbol",ic="comment",jc="space",kc=99,lc=0,mc=gpf._alpha+gpf._ALPHA+"_$",nc=2,oc=3,pc=4,qc=5,rc=6,sc=7,tc=8,uc=9,vc="(){}[]<>|&?,.;:!=+-*/%^~",wc=10,xc=11,yc=" \t\r\n",zc=12,Ac=0,Bc=0,Cc=1,Dc=2,Ec=3,Fc=4,Gc=["Parsing aborted","Unknown token","Unterminated string","Unterminated comment","Invalid or unsupported string escape"],Hc=function(){return{pos:0,line:0,column:0,state:lc,chars:[],nextPos:0,nextLine:0,nextColumn:0,eventsHandler:null,that:null};},Ic=("break,case,catch,continue,debugger,default,delete,do,"+"else,finally,for,function,if,in,instanceof,new,return,switch,"+"this,throw,try,typeof,var,void,while,with").split(","),Jc=function(){var Uc={};Uc[lc]=cc;Uc[wc]=hc;Uc[tc]=ic;Uc[uc]=ic;Uc[oc]=fc;Uc[qc]=fc;Uc[xc]=gc;Uc[zc]=jc;return Uc;}(),Kc=function(Uc,Vc){var Wc,Xc,Yc,Zc={token:"",pos:Uc.pos,line:Uc.line,column:Uc.column,code:0,message:""};if(undefined!==Vc){Xc=bc;Uc.state=kc;Zc.code=Vc;Zc.message=Gc[Vc-Ac];}else{Wc=Uc.chars.join("");if(nc===Uc.state){if(undefined!==gpf.test(Ic,Wc)){Xc=dc;}else{Xc=ec;}}else{Xc=Jc[Uc.state];}Zc.token=Wc;}Yc=gpf.events.fire.apply(Uc.that,[Xc,Zc,Uc.eventsHandler]);if(Yc.defaultPrevented()){Kc(Uc,Bc);}else if(undefined!==Vc){throw 0;}Uc.state=lc;Uc.chars=[];Uc.pos=Uc.nextPos;Uc.line=Uc.nextLine;Uc.column=Uc.nextColumn;},Lc=[0,function(Uc,Vc,Wc){gpf.interfaces.ignoreParameter(Vc);if(-1<"(){}[].,;:?".indexOf(Uc)){return false;}if(-1<"!^~*/%".indexOf(Uc)){return"="===Wc;}return"="===Wc||Uc===Wc;},function(Uc,Vc,Wc){if(-1<"+-|&".indexOf(Uc)){return false;}if("<"===Uc){return"<"===Vc[1]&&"="===Wc;}if(-1<"=!".indexOf(Uc)){return"="===Wc;}if(">"===Uc){return"="!==Vc[1]&&("="===Wc||">"===Wc);}return false;},function(Uc,Vc,Wc){return">"===Uc&&"="!==Vc[2]&&"="===Wc;},function(){return false;}],Mc=function(Uc,Vc){var Wc=Uc[0];return Lc[Uc.length](Wc,Uc,Vc);},Nc=function(){var Uc={};Uc[nc]=function(Vc,Wc){if(-1===mc.indexOf(Wc)&&("0">Wc||Wc>"9")){Kc(Vc);}else{Vc.chars.push(Wc);}};Uc[xc]=function(Vc,Wc){if("0">Wc||Wc>"9"){Kc(Vc);}else{Vc.chars.push(Wc);}};Uc[oc]=Uc[qc]=function(Vc,Wc){Vc.chars.push(Wc);if("\\"===Wc){++Vc.state;}else if("\n"===Wc){Kc(Vc,Dc);}else if(oc===Vc.state&&"\""===Wc){Kc(Vc);return true;}else if(qc===Vc.state&&"'"===Wc){Kc(Vc);return true;}return false;};Uc[pc]=Uc[rc]=function(Vc,Wc){if("\\"===Wc||"r"===Wc||"n"===Wc||"t"===Wc||"\""===Wc||"'"===Wc){--Vc.state;Vc.chars.push(Wc);}else{Kc(Vc,Fc);}};Uc[sc]=function(Vc,Wc){if("/"===Wc){Vc.state=tc;Vc.chars.push(Wc);}else if("*"===Wc){Vc.state=uc;Vc.chars.push(Wc);}else{Vc.state=wc;if(Mc(Vc.chars,Wc)){Vc.chars.push(Wc);}else{Kc(Vc);}}};Uc[tc]=function(Vc,Wc){if("\n"===Wc){Kc(Vc);}else{Vc.chars.push(Wc);}};Uc[uc]=function(Vc,Wc){Vc.chars.push(Wc);if("/"===Wc&&Vc.chars[Vc.chars.length-2]==="*"){Kc(Vc);return true;}return false;};Uc[zc]=function(Vc,Wc){if(-1<yc.indexOf(Wc)){Vc.chars.push(Wc);}else{Kc(Vc);}};Uc[wc]=function(Vc,Wc){if(-1<vc.indexOf(Wc)){if(Mc(Vc.chars,Wc)){Vc.chars.push(Wc);}else{Kc(Vc);}}else{Kc(Vc);}};return Uc;}(),Oc=function(Uc,Vc){Uc.chars=[Vc];if(-1<mc.indexOf(Vc)){Uc.state=nc;}else if("0"<=Vc&&Vc<="9"){Uc.state=xc;}else if("\""===Vc){Uc.state=oc;}else if("'"===Vc){Uc.state=qc;}else if("/"===Vc){Uc.state=sc;}else if(-1<vc.indexOf(Vc)){Uc.state=wc;}else if(-1<yc.indexOf(Vc)){Uc.state=zc;}else{Kc(Uc,Cc);}},Pc=function(Uc,Vc){var Wc=Nc[Uc.state];if(undefined!==Wc){if(Wc(Uc,Vc)){return;}}if(lc===Uc.state){Oc(Uc,Vc);}},Qc=function(Uc,Vc){++Uc.nextPos;if("\n"===Vc){++Uc.nextLine;Uc.nextColumn=0;}else{++Uc.nextColumn;}},Rc=function(Uc,Vc){Pc(Uc,Vc);Qc(Uc,Vc);},Sc=function(){var Uc={};Uc[nc]=1;Uc[xc]=1;Uc[tc]=1;Uc[wc]=1;Uc[sc]=2;Uc[uc]=3;Uc[oc]=4;Uc[qc]=4;Uc[pc]=4;Uc[rc]=4;return Uc;}(),Tc=function(Uc){var Vc=Sc[Uc.state];if(1===Vc){Kc(Uc);}else if(2===Vc){Uc.state=wc;Kc(Uc);}else if(3===Vc){Kc(Uc,Ec);}else if(4===Vc){Kc(Uc,Dc);}gpf.ASSERT(lc===Uc.state||kc===Uc.state||zc===Uc.state,"Unexpected non-final state");};gpf.js={};gpf.extend(gpf.js,{keywords:function(){return Ic;},"[tokenize]":[gpf.$ClassEventHandler()],tokenize:function(Uc,Vc){var Wc,Xc,Yc=Hc();Yc.eventsHandler=Vc;Yc.that=this;try{for(Wc=0,Xc=Uc.length;Wc<Xc;++Wc){Rc(Yc,Uc.charAt(Wc));}Tc(Yc);}catch(e){if("number"!==typeof e){throw e;}}},tokenizeEx:function(Uc,Vc,Wc){var Xc,Yc;if(undefined===Wc){Wc=Hc();}Wc.eventsHandler=Vc;Wc.that=this;try{if(null===Uc){Tc(Wc);Wc=null;}else{for(Xc=0,Yc=Uc.length;Xc<Yc;++Xc){Rc(Wc,Uc.charAt(Xc));}}}catch(e){if("number"!==typeof e){throw e;}}return Wc;}});(function(){"use strict";var Uc=function(Zc){var ad=[],bd=Zc.length,cd,dd;for(cd=0;cd<bd;++cd){dd=Zc.charCodeAt(cd);if(dd<128){ad.push(dd);}else if(dd>127&&dd<2048){ad.push(dd>>6|192);ad.push(dd&63|128);}else{ad.push(dd>>12|224);ad.push(dd>>6&63|128);ad.push(dd&63|128);}}return ad;},Vc=function(Zc,ad){var bd=[],cd=Zc.length,dd=0,ed,fd,gd;while(dd<cd){ed=Zc[dd];if(ed<128){bd.push(String.fromCharCode(ed));}else if(ed>191&&ed<224){if(dd+1===cd){break;}fd=Zc[++dd];bd.push(String.fromCharCode((ed&31)<<6|fd&63));}else{if(dd+2>=cd){break;}fd=Zc[++dd];gd=Zc[++dd];bd.push(String.fromCharCode((ed&15)<<12|(fd&63)<<6|gd&63));}++dd;}while(dd<cd){ad.push(Zc[dd++]);}return bd.join("");},Wc={"utf-8":[Uc,Vc]},Xc=gpf.define("EncoderStream",gpf.stream.BufferedOnRead,{public:{constructor:function(Zc,ad){this._super(ad);this._encoder=Zc;}},protected:{_addToBuffer:function(Zc){this._buffer=this._buffer.concat(this._encoder(Zc));this._bufferLength=this._buffer.length;},_readFromBuffer:gpf.stream.BufferedOnRead.prototype._readFromByteBuffer},private:{_encoder:null}}),Yc=gpf.define("DecoderStream",gpf.stream.BufferedOnRead,{public:{constructor:function(Zc,ad){this._super(ad);this._decoder=Zc;}},protected:{_addToBuffer:function(Zc){var ad;if(this._unprocessed.length){Zc=this._unprocessed.concat(Zc);}this._unprocessed=[];ad=this._decoder(Zc,this._unprocessed);this._buffer.push(ad);this._bufferLength+=ad.length;},_endOfInputStream:function(){if(this._unprocessed.length){gpf.Error.EncodingEOFWithUnprocessedBytes();}},_readFromBuffer:gpf.stream.BufferedOnRead.prototype._readFromStringBuffer},private:{_decoder:null,_unprocessed:[]}});gpf.encoding={UTF_8:"utf-8",createEncoder:function(Zc,ad){var bd=Wc[ad];if(undefined===bd){gpf.Error.EncodingNotSupported();}return new Xc(bd[0],Zc);},createDecoder:function(Zc,ad){var bd=Wc[ad];if(undefined===bd){gpf.Error.EncodingNotSupported();}return new Yc(bd[1],Zc);}};}());gpf.html={};var Zc=gpf.interfaces,ad=gpf.events.fire;gpf.define("gpf.html.MarkdownParser","gpf.Parser",{public:{constructor:function(){this._super.apply(this,arguments);this._openedTags=[];}},protected:{_ignoreCarriageReturn:true,_initialParserState:function(bd){var cd,dd=0<this._openedTags.length;if("#"===bd){this._hLevel=1;cd=this._parseTitle;}else if("*"===bd||"0"<=bd&&"9">=bd){if(bd!=="*"){this._numericList=1;}else{this._numericList=0;}cd=this._parseList;dd=false;}else if(" "!==bd&&"\t"!==bd&&"\n"!==bd){if(dd){this._output(" ");dd=false;}else{this._openTag("p");}cd=this._parseContent(bd);if(!cd){cd=this._parseContent;}}if(dd){this._closeTags();}return cd;},_finalizeParserState:function(){this._closeTags();}},private:{_openedTags:[],_closeTags:function(){var bd;while(this._openedTags.length){bd=this._openedTags.pop();this._output("</"+bd+">");if("p"===bd){break;}}},_openList:function(bd){var cd,dd=this._openedTags.length;while(dd){cd=this._openedTags.pop();--dd;this._output("</"+cd+">");if("li"===cd){break;}}if(dd){cd=this._openedTags[dd-1];if(cd!==bd){this._openedTags.pop();this._output("</"+cd+">");}else{return;}}this._openTag(bd);},_toggleTag:function(bd){var cd=this._openedTags.length;if(cd&&this._openedTags[cd-1]===bd){this._openedTags.pop();this._output("</"+bd+">");}else{this._openTag(bd);}},_openTag:function(bd){this._output("<"+bd+">");this._openedTags.push(bd);},_hLevel:1,_parseTitle:function(bd){if("#"===bd){++this._hLevel;}else{this._openTag("h"+this._hLevel);return this._parseText;}},_numericList:false,_parseList:function(bd){var cd=0<this._openedTags.length,dd;if(" "===bd){if(this._numericList){dd="ol";}else{dd="ul";}this._openList(dd);this._openTag("li");}else if(this._numericList&&("0"<=bd&&"9">=bd||"."===bd)){return;}else if("*"===bd){if(cd){this._output(" ");}this._openTag("strong");}return this._parseContent;},_handleEntities:function(bd){if("<"===bd){this._output("&lt;");}else if(">"===bd){this._output("&gt;");}else if("&"===bd){this._output("&amp;");}else{return false;}return true;},_escapeChar:"",_escapeCount:0,_parseEscape:function(bd){var cd=this._escapeChar,dd;if(bd===cd){dd=++this._escapeCount;if("-"===cd&&3===dd){this._output("&mdash;");return this._parseContent;}}else{dd=this._escapeCount+1;while(--dd){this._output(cd);}this._setParserState(this._parseContent);return this._parseContent(bd);}},_parseContent:function(bd){if(this._handleEntities(bd)){return;}if("*"===bd){return this._parseItalic;}else if("`"===bd){this._toggleTag("code");return;}else if("["===bd){this._linkState=0;this._linkText=[];this._linkUrl=[];return this._parseLink;}else if("-"===bd){this._escapeCount=1;this._escapeChar="-";return this._parseEscape;}else if("\n"===bd){return null;}else{this._output(bd);}},_parseItalic:function(bd){if("*"===bd){this._toggleTag("strong");}else{this._toggleTag("em");this._output(bd);}return this._parseContent;},_parseText:function(bd){if(this._handleEntities(bd)){return;}if("\n"===bd){this._closeTags();return null;}else{this._output(bd);}},_linkText:[],_linkUrl:[],_linkState:0,_parseLink:function(bd){var cd=this._linkState;if("]"===bd&&0===cd){++this._linkState;}else if("("===bd&&1===cd){++this._linkState;}else if(")"===bd&&2===cd){this._output("<a href=\"");this._output(this._linkUrl.join(""));this._output("\">");this._output(this._linkText.join(""));this._output("</a>");return this._parseContent;}else if(0===cd){this._linkText.push(bd);}else if(2===cd){this._linkUrl.push(bd);}}}});gpf.define("gpf.html.File",{"[Class]":[gpf.$InterfaceImplement(gpf.interfaces.ITextStream)],public:{constructor:function(bd){this._file=bd;},name:function(){return this._file.name;},size:function(){return this._file.size;},read:function(bd,cd){var dd=this,ed=this._reader,fd=this._file.size-this._pos,gd;if(0===fd){ad.apply(this,[Zc.IReadableStream.EVENT_END_OF_STREAM,cd]);return;}this._eventsHandler=cd;if(null===ed){ed=this._reader=new FileReader;ed.onloadend=function(hd){dd._onLoadEnd(hd);};}if(0===bd||bd>fd){bd=fd;}gd=this._file.slice(this._pos,bd);this._pos+=bd;ed.readAsArrayBuffer(gd);}},private:{_file:null,_reader:null,_pos:0,_eventsHandler:null,_onLoadEnd:function(bd){var cd=bd.target,dd,ed,fd,gd;gpf.ASSERT(cd===this._reader,"Unexpected change of reader");if(cd.error){ad.apply(this,[Zc.IReadableStream.ERROR,{error:{name:cd.error.name,message:cd.error.message}},this._eventsHandler]);}else if(cd.readyState===FileReader.DONE){dd=new Int8Array(cd.result);ed=dd.length;fd=[];for(gd=0;gd<ed;++gd){fd.push(dd[gd]);}ad.apply(this,[Zc.IReadableStream.EVENT_DATA,{buffer:fd},this._eventsHandler]);}}}});var bd=gpf._defAttr("HtmlAttribute",{}),cd=gpf._defAttr("$HtmlHandler",bd,{private:{_selector:"",_globalSelector:false},protected:{_select:function(ed){var fd=this._selector;if(fd){if(this._globalSelector){return document.querySelector(fd);}else{return ed.querySelector(fd);}}return undefined;}},public:{constructor:function(ed,fd){if(ed){this._selector=ed;}if(undefined!==fd){this._globalSelector=fd===true;}}}}),dd=gpf._defAttr("$HtmlEvent",cd,{private:{_event:""},public:{constructor:function(ed,fd,gd){cd.apply(this,[fd,gd]);this._event=ed;}}});function Uc(ed,fd){var gd;if(1!==fd.length()){gpf.Error.HtmlHandlerMultiplicityError({member:ed});}gd=fd.get(0);if(!(gd instanceof dd)){return gd;}return null;}function Vc(ed,fd){var gd=Uc(ed,fd);if(gd&&!gd._selector){return gd;}}gpf.html.handle=function(ed,fd){var gd=new gpf.attributes.Map(ed).filter(bd),hd=gd.filter(cd),id,jd;if(0===hd.count()){gpf.Error.HtmlHandlerMissing();}id=hd.each(Vc);if(undefined===id){gpf.Error.HtmlHandlerNoDefault();}id=id.member();if(undefined===fd){fd=ed[id];gpf.ASSERT(fd,"Handle not previously set");}else{if("string"===typeof fd){fd=document.querySelector(fd);}gpf.ASSERT(fd,"Selector does not resolve to DOM");if(!fd){return;}ed[id]=fd;}hd.each(Wc,ed,[fd]);jd=gd.filter(dd);if(0<jd.count()){jd.each(Xc,ed,[fd]);}return fd;};function Wc(ed,fd,gd){var hd=Uc(ed,fd);if(!hd||!hd._selector){return;}gd=hd._select(gd);if(!gd){return;}this[ed]=gd;}function Xc(ed,fd,gd){fd.each(Yc,this,[ed,gd]);}function Yc(ed,fd,gd){var hd=ed._event,id=fd+":$HtmlEvent("+hd+","+ed._selector+")";gd=ed._select(gd);if(!gd){return;}if(!this[id]){gd.addEventListener(hd,gpf.Callback.bind(this,fd));this[id]=true;}}gpf.extend(gpf.html,{hasClass:function(ed,fd){var gd,hd,id;if("string"===typeof fd){fd=[fd];}gpf.ASSERT(fd instanceof Array,"Expected array");gd=ed.className.split(" ");hd=fd.length;for(id=0;id<hd;++id){if(undefined!==gpf.test(gd,fd[id])){return true;}}return false;},addClass:function(ed,fd){var gd,hd,id,jd;if("string"===typeof fd){fd=[fd];}gpf.ASSERT(fd instanceof Array,"Expected array");gd=ed.className.split(" ");hd=gd.length;id=fd.length;for(jd=0;jd<id;++jd){gpf.set(gd,fd[jd]);}if(hd!==gd.length){ed.className=gd.join(" ");}return ed;},removeClass:function(ed,fd){var gd,hd,id,jd;if("string"===typeof fd){fd=[fd];}gpf.ASSERT(fd instanceof Array,"Expected array");gd=ed.className.split(" ");hd=gd.length;id=fd.length;for(jd=0;jd<id;++jd){gpf.clear(gd,fd[jd]);}if(hd!==gd.length){ed.className=gd.join(" ");}return ed;}});var ed=gpf.interfaces,fd=gpf.attributes,gd=gpf.events.fire;;gpf.xml={};gpf._defIntrf("IXmlSerializable",{"[toXml]":[gpf.$ClassEventHandler()],toXml:function(hd,id){ed.ignoreParameter(hd);ed.ignoreParameter(id);}});gpf._defIntrf("IXmlContentHandler",{"[characters]":[gpf.$ClassEventHandler()],characters:function(hd,id){ed.ignoreParameter(hd);ed.ignoreParameter(id);},"[endDocument]":[gpf.$ClassEventHandler()],endDocument:function(hd){ed.ignoreParameter(hd);},"[endElement]":[gpf.$ClassEventHandler()],endElement:function(hd){ed.ignoreParameter(hd);},endPrefixMapping:function(hd){ed.ignoreParameter(hd);},"[ignorableWhitespace]":[gpf.$ClassEventHandler()],ignorableWhitespace:function(hd,id){ed.ignoreParameter(hd);ed.ignoreParameter(id);},"[processingInstruction]":[gpf.$ClassEventHandler()],processingInstruction:function(hd,id,jd){ed.ignoreParameter(hd);ed.ignoreParameter(id);ed.ignoreParameter(jd);},setDocumentLocator:function(hd){ed.ignoreParameter(hd);},skippedEntity:function(hd){ed.ignoreParameter(hd);},"[startDocument]":[gpf.$ClassEventHandler()],startDocument:function(hd){ed.ignoreParameter(hd);},"[startElement]":[gpf.$ClassEventHandler()],startElement:function(hd,id,jd,kd,ld){ed.ignoreParameter(hd);ed.ignoreParameter(id);ed.ignoreParameter(jd);ed.ignoreParameter(kd);ed.ignoreParameter(ld);},startPrefixMapping:function(hd,id){ed.ignoreParameter(hd);ed.ignoreParameter(id);}});var hd=gpf._defAttr("XmlAttribute",{protected:{_alterPrototype:function(vd){if(undefined===vd.toXml){fd.add(vd.constructor,"Class",[gpf.$InterfaceImplement(ed.IXmlSerializable)]);vd.toXml=sd;fd.add(vd.constructor,"Class",[gpf.$InterfaceImplement(ed.IXmlContentHandler,ud)]);}}}}),id=gpf._defAttr("$XmlIgnore",hd,{}),jd=gpf._defAttr("$XmlAttribute",hd,{private:{"[_name]":[gpf.$ClassProperty()],_name:""},public:{constructor:function(vd){gpf.ASSERT(gpf.xml.isValidName(vd),"Valid XML attribute name");this._name=vd;}}}),kd=gpf._defAttr("XmlRawElementAttribute",hd,{private:{"[_name]":[gpf.$ClassProperty()],_name:""},public:{constructor:function(vd){gpf.ASSERT(gpf.xml.isValidName(vd),"Valid XML element name");this._name=vd;}}}),ld=gpf._defAttr("$XmlElement",kd,{private:{"[_objClass]":[gpf.$ClassProperty()],_objClass:null},public:{constructor:function(vd,wd){this._super(vd);if(wd){this._objClass=wd;}}}}),md=gpf._defAttr("$XmlList",kd,{}),nd=function(vd,wd){var xd,yd,zd=null,Ad=null,Bd;for(xd=0;xd<vd.length();++xd){yd=vd.get(xd);if(!(yd instanceof ld)){continue;}Bd=yd.objClass();if(Bd){if(wd instanceof Bd){if(!Ad||Bd.prototype instanceof Ad.objClass()){Ad=yd;}}}else if(!zd){zd=yd;}}if(null!==Ad){return Ad;}else{return zd;}},od=function(vd,wd,xd,yd){var zd;if(wd instanceof Array||yd.has(md)||"object"===xd||yd.has(ld)){return"";}zd=yd.has(jd);if(zd&&zd.name()){vd=zd.name();}else{if("_"===vd.charAt(0)){vd=vd.substr(1);}}return vd;},pd=function(vd,wd,xd,yd){var zd,Ad,Bd,Cd,Dd,Ed,Fd,Gd;zd=vd[wd];if(zd instanceof Date){zd=gpf.dateToComparableFormat(zd,true);}Ad=yd.member(wd);if("_"===wd.charAt(0)){wd=wd.substr(1);}Bd=Ad.has(md);if(zd instanceof Array||Bd){if(Bd&&Bd.name()){Cd=true;xd.startElement("",Bd.name());}Ad=Ad.filter(ld);for(Dd=0;Dd<zd.length;++Dd){Ed=zd[Dd];Fd=nd(Ad,Ed);if(Fd&&Fd.name()){Gd=Fd.name();}else{Gd="item";}rd(Ed,xd,Gd);}if(Cd){xd.endElement();}return;}Bd=Ad.has(ld);if(Bd&&Bd.name()){Gd=Bd.name();}rd(zd,xd,Gd);},qd=function(vd,wd,xd,yd){var zd,Ad,Bd,Cd,Dd,Ed=0,Fd=0,Gd;for(Ad in vd.constructor.prototype){Bd=vd[Ad];if(Bd instanceof Date){Bd=gpf.dateToComparableFormat(Bd,true);}Cd=typeof Bd;if("function"===Cd){continue;}zd=yd.member(Ad);if(zd.has(id)){continue;}Dd=od(Ad,Bd,Cd,zd);if(Dd){if(0===Fd){Fd={};}Fd[Dd]=Bd.toString();}else{if(0===Ed){Ed=[];}Ed.push(Ad);}}wd.startElement("",xd,xd,Fd);if(Ed){for(Gd=0;Gd<Ed.length;++Gd){pd(vd,Ed[Gd],wd,yd);}}},rd=function(vd,wd,xd){var yd=new fd.Map(vd).filter(hd),zd;if(!xd){zd=yd.member("Class").has(ld);if(zd){xd=zd.name();}else{xd=gpf.classDef(vd.constructor).name();if(!xd){xd="object";}}}if("object"!==typeof vd){wd.startElement("",xd);wd.characters(gpf.value(vd,""));}else{qd(vd,wd,xd,yd);}wd.endElement();},sd=function(vd,wd){var xd=gpf.interfaces.wrap(ed.IXmlContentHandler),yd=new xd(vd);yd.$catch(wd).$finally(wd,"ready");rd(this,yd);},td=gpf.define("FromXmlContentHandler",{"[Class]":[gpf.$InterfaceImplement(ed.IXmlContentHandler)],_target:null,_firstElement:true,_forward:[],constructor:function(vd){this._target=vd;this._firstElement=true;this._forward=[];},_fillFromAttributes:function(vd){var wd=new fd.Map(this._target),xd=this._target.constructor.prototype,yd,zd,Ad;for(yd in xd){if("function"===typeof xd[yd]){continue;}zd=wd.member(yd).filter(jd);if(0<zd.length()){gpf.ASSERT(zd.length()===1,"Expected one attribute only");Ad=zd.get(0).name();}else{if(yd.charAt(0)==="_"){Ad=yd.substr(1);}else{continue;}}if(Ad in vd){this._target[yd]=gpf.value(vd[Ad],xd[yd]);}}},_fillFromElement:function(vd,wd,xd,yd){var zd=new fd.Map(this._target).filter(kd),Ad=this._forward[0],Bd,Cd,Dd,Ed,Fd,Gd;gpf.interfaces.ignoreParameter(vd);gpf.interfaces.ignoreParameter(xd);gpf.interfaces.ignoreParameter(yd);if(undefined===Ad){Bd=zd.members();}else{gpf.ASSERT(Ad.type!==0,"No content handler here");Bd=[Ad.member];}for(Cd=0;Cd<Bd.length;++Cd){Dd=Bd[Cd];Ed=zd.member(Dd);for(Fd=0;Fd<Ed.length();++Fd){Gd=Ed.get(Fd);if(Gd.name()===wd){if(this._fillFromRawElement(Dd,Gd)){return;}}}}},_fillFromRawElement:function(vd,wd){var xd,yd;if(wd instanceof ld){if(wd.objClass()){xd=new(wd.objClass());this._target[vd]=xd;yd=ed.query(xd,ed.IXmlContentHandler);}if(yd){yd={type:0,iXCH:yd};}else{yd={type:1,member:vd,buffer:[]};}}else if(wd instanceof md){this._target[vd]=[];yd={type:2,member:vd};}if(yd){yd.depth=1;this._forward.unshift(yd);return true;}else{return false;}},characters:function(vd,wd){var xd=this._forward[0];if(undefined!==xd){if(0===xd.type){xd.iXCH.characters.apply(xd.iXCH,arguments);}else if(1===xd.type){xd.buffer.push(vd);}}gd.apply(this,["ready",wd]);},endDocument:function(vd){gd.apply(this,["ready",vd]);},endElement:function(vd){var wd=this._forward[0],xd,yd;if(undefined!==wd){if(0===wd.type){wd.iXCH.endElement.apply(wd.iXCH,arguments);}else if(1===wd.type){xd=this._target[wd.member];yd=wd.buffer.join("");if(xd instanceof Array){xd.push(yd);}else{this._target[wd.member]=gpf.value(yd,xd);}}if(0===--wd.depth){this._forward.shift();}}gd.apply(this,["ready",vd]);},endPrefixMapping:function(vd){ed.ignoreParameter(vd);},ignorableWhitespace:function(vd,wd){ed.ignoreParameter(vd);gd.apply(this,["ready",wd]);},processingInstruction:function(vd,wd,xd){ed.ignoreParameter(vd);ed.ignoreParameter(wd);gd.apply(this,["ready",xd]);},setDocumentLocator:function(vd){ed.ignoreParameter(vd);},skippedEntity:function(vd){ed.ignoreParameter(vd);},startDocument:function(vd){gd.apply(this,["ready",vd]);},startElement:function(vd,wd,xd,yd,zd){var Ad=this._forward[0];gpf.interfaces.ignoreParameter(vd);gpf.interfaces.ignoreParameter(wd);gpf.interfaces.ignoreParameter(xd);if(undefined!==Ad){if(0===Ad.type){++Ad.depth;Ad.iXCH.startElement.apply(Ad.iXCH,arguments);}else{this._fillFromElement.apply(this,arguments);}}else if(this._firstElement){this._firstElement=false;this._fillFromAttributes(yd);}else{this._fillFromElement.apply(this,arguments);}gd.apply(this,["ready",zd]);},startPrefixMapping:function(vd,wd){ed.ignoreParameter(vd);ed.ignoreParameter(wd);}}),ud=function(vd){return new td(vd);};gpf.define("gpf.xml.Writer",{"[Class]":[gpf.$InterfaceImplement(ed.IXmlContentHandler)],private:{_stream:null,_branch:[],_pendingPrefixMappings:[],_buffer:[],_eventsHandler:null,_closeLeafForContent:function(){var vd;if(this._branch.length){vd=this._branch[this._branch.length-1];if(!vd.hasContent){this._buffer.push(">");vd.hasContent=true;}}},_flush:function(vd){this._eventsHandler=vd;this._flushed();},_flushed:function(vd){var wd;if(vd&&vd.type()===ed.IWritableStream.EVENT_ERROR){gd.apply(this,[vd,this._eventsHandler]);}else if(0===this._buffer.length){wd=this._eventsHandler;this._eventsHandler=null;gd.apply(this,[ed.IWritableStream.EVENT_READY,wd]);}else{this._stream.write(this._buffer.shift(),gpf.Callback.bind(this,"_flushed"));}}},public:{constructor:function(vd){this._stream=ed.query(vd,ed.IWritableStream,true);this._branch=[];this._pendingPrefixMappings=[];this._buffer=[];},characters:function(vd,wd){gpf.ASSERT(null===this._eventsHandler,"Write in progress");this._closeLeafForContent();this._buffer.push(vd);this._flush(wd);},endDocument:function(vd){gpf.ASSERT(null===this._eventsHandler,"Write in progress");this._flush(vd);},endElement:function(vd){gpf.ASSERT(null===this._eventsHandler,"Write in progress");var wd=this._branch.pop();if(wd.hasContent){this._buffer.push("</",wd.qName,">");}else{this._buffer.push("/>");}this._flush(vd);},endPrefixMapping:function(vd){gpf.interfaces.ignoreParameter(vd);},ignorableWhitespace:function(vd,wd){gpf.ASSERT(null===this._eventsHandler,"Write in progress");this._closeLeafForContent();this._buffer.push(vd);this._flush(wd);},processingInstruction:function(vd,wd,xd){gpf.ASSERT(null===this._eventsHandler,"Write in progress");this._buffer.push("<?",vd," ",gpf.escapeFor(wd,"xml"),"?>");this._flush(xd);},setDocumentLocator:function(vd){gpf.interfaces.ignoreParameter(vd);},skippedEntity:function(vd){gpf.interfaces.ignoreParameter(vd);},startDocument:function(vd){gpf.ASSERT(null===this._eventsHandler,"Write in progress");this._flush(vd);},startElement:function(vd,wd,xd,yd,zd){gpf.ASSERT(null===this._eventsHandler,"Write in progress");var Ad,Bd,Cd,Dd;if(undefined===xd&&!vd){xd=wd;}this._closeLeafForContent();var Ed={hasContent:false,qName:xd};this._branch.push(Ed);this._buffer.push("<",xd);if(yd){for(Ad in yd){if(yd.hasOwnProperty(Ad)){this._buffer.push(" ",Ad,"=\"");Bd=gpf.escapeFor(yd[Ad].toString(),"xml");if(-1<Bd.indexOf("\"")){Bd=gpf.replaceEx(Bd,{"\"":"&quot;"});}this._buffer.push(Bd,"\"");}}}Cd=this._pendingPrefixMappings.length;if(Cd){for(Dd=0;Dd<Cd;++Dd){this._buffer.push(" ",this._pendingPrefixMappings[Dd]);}this._pendingPrefixMappings=[];}this._flush(zd);},startPrefixMapping:function(vd,wd){this._pendingPrefixMappings.push(["xmlns:",vd,":\"",gpf.escapeFor(wd,"xml"),"\""].join(""));}}});gpf.xml.convert=function(vd,wd,xd){var yd;if("string"===typeof vd){gpf.Error.NotImplemented();}else if("object"===typeof vd){yd=ed.query(vd,ed.IXmlSerializable);if(null===yd){yd=new gpf.xml.ConstNode(vd);}yd.toXml(wd,xd);}};var vd=gpf._alpha+gpf._ALPHA+"_",wd=vd+"012345789.-";gpf.extend(gpf.xml,{isValidName:function(xd){var yd;if(0===xd.length||-1===vd.indexOf(xd.charAt(0))){return false;}for(yd=1;yd<xd.length;++yd){if(-1===wd.indexOf(xd.charAt(yd))){return false;}}return true;},toValidName:function(xd){var yd;if(gpf.xml.isValidName(xd)){return xd;}yd="_"+xd;if(!gpf.xml.isValidName(yd)){gpf.Error.XmlInvalidName();}return yd;}});var yd=gpf.interfaces;gpf.extend(gpf.xml,{NODE_INVALID:0,NODE_ELEMENT:1,NODE_ATTRIBUTE:2,NODE_TEXT:3,NODE_ENTITY_REFERENCE:5,NODE_PROCESSING_INSTRUCTION:7,NODE_COMMENT:8,NODE_DOCUMENT:9});gpf._defIntrf("IXmlConstNode",{attributes:function(zd){gpf.interfaces.ignoreParameter(zd);return"";},children:function(zd){if(undefined===zd){return[];}else{return undefined;}},localName:function(){return"";},namespaceURI:function(){return"";},nextSibling:function(){return null;},nodeName:function(){return"";},nodeType:function(){return 0;},nodeValue:function(){return null;},ownerDocument:function(){return null;},parentNode:function(){return null;},prefix:function(){return"";},previousSibling:function(){return null;},textContent:function(){return"";}});gpf.define("gpf.xml.ConstNode",{"[Class]":[gpf.$InterfaceImplement(yd.IXmlConstNode),gpf.$InterfaceImplement(yd.IXmlSerializable)],_obj:null,_name:"",_parentNode:null,_attributes:{},_elements:{},_children:[],constructor:function(zd,Ad){this._obj=zd;this._attributes=null;this._elements=null;this._children=null;if(undefined===Ad){this._name="root";}else{this._name=Ad;}},_members:function(){var zd,Ad,Bd;this._attributes={};this._elements={};if("object"===typeof this._obj&&!(this._obj instanceof Array)){for(zd in this._obj){if(this._obj.hasOwnProperty(zd)){Ad=this._obj[zd];if(null===Ad){continue;}Bd=gpf.xml.toValidName(zd);if("object"===typeof Ad){this._elements[zd]=Bd;}else{this._attributes[zd]=Bd;}}}}},attributes:function(zd){var Ad,Bd,Cd;if(null===this._attributes){this._members();}if(undefined===zd){Ad={};for(Bd in this._attributes){if(this._attributes.hasOwnProperty(Bd)){Cd=this._attributes[Bd];Ad[Cd]=this._obj[Bd];}}return Ad;}for(Bd in this._attributes){if(this._attributes.hasOwnProperty(Bd)){if(zd===this._attributes[Bd]){return this._obj[Bd];}}}return undefined;},children:function(zd){var Ad,Bd,Cd,Dd;if(null===this._children){if(null===this._elements){this._members();}this._children=[];if(this._obj instanceof Array){for(Ad=0;Ad<this._obj.length;++Ad){Bd=new gpf.xml.ConstNode(this._obj[Ad],"item");Bd._parentNode=this;this._children.push(Bd);}}else{for(Cd in this._elements){if(this._elements.hasOwnProperty(Cd)){Dd=this._elements[Cd];Bd=new gpf.xml.ConstNode(this._obj[Cd],Dd);Bd._parentNode=this;this._children.push(Bd);}}}}return gpf.arrayOrItem(this._children,zd);},localName:function(){return this._name;},namespaceURI:function(){return"";},nextSibling:function(){var zd;if(null!==this._parentNode){zd=gpf.test(this._parentNode._children,this);if(undefined!==zd&&zd<this._parentNode._children.length-1){return this._parentNode._children[zd+1];}}return null;},nodeName:function(){return this._name;},nodeType:function(){return gpf.xml.NODE_ELEMENT;},nodeValue:function(){return this._obj;},ownerDocument:function(){return null;},parentNode:function(){return this._parentNode;},prefix:function(){return"";},previousSibling:function(){var zd;if(null!==this._parentNode){zd=gpf.test(this._parentNode._children,this);if(0<zd){return this._parentNode._children[zd-1];}}return null;},textContent:function(){if("object"!==typeof this._obj){return gpf.value(this._obj,"");}else{return"";}},toXml:function(zd,Ad){gpf.xml.nodeToXml(this,zd,Ad);}});function xd(zd,Ad){var Bd=zd.localName(),Cd=zd.attributes(),Dd=zd.children(),Ed=zd.textContent(),Fd;Ad.startElement("",Bd,Bd,Cd);if(Ed){Ad.characters(Ed);}else{for(Fd=0;Fd<Dd.length;++Fd){xd(Dd[Fd],Ad);}}Ad.endElement();}gpf.xml.nodeToXml=function(zd,Ad,Bd){var Cd=gpf.interfaces.wrap(yd.IXmlContentHandler),Dd=new Cd(Ad);Dd.$catch(Bd).$finally(Bd,"ready");xd(zd,Dd);};function zd(Fd,Gd,Hd,Id){var Jd,Kd;for(Jd=0;Jd<Fd.length;++Jd){Kd=Fd[Jd];Gd(Kd,Hd,Id);}}function Ad(Fd,Gd,Hd){var Id=Fd.children(),Jd,Kd,Ld;for(Kd=0;Kd<Id.length;++Kd){Ld=true;Jd=Id[Kd];if(Gd.name&&Jd.localName()!==Gd.name){Ld=false;}else if(Gd.text&&Jd.textContent()!==Gd.text){Ld=false;}if(Ld){Hd.push(Jd);}if(undefined!==Gd.relative&&!Gd.relative){Ad(Jd,Gd,Hd);}}}function Bd(Fd,Gd,Hd){var Id,Jd,Kd;if(Gd.name){Kd=Fd.attributes(Gd.name);if(undefined!==Kd&&(!Gd.text||Kd===Gd.text)){Hd.push(Fd);}}else{Id=Fd.attributes();for(Jd in Id){if(Id.hasOwnProperty(Jd)){Kd=Id[Jd];if(!Gd.text||Kd===Gd.text){Hd.push(Fd);break;}}}}}function Cd(Fd,Gd,Hd){if(gpf.xml.NODE_ELEMENT===Gd.type){zd(Fd,Ad,Gd,Hd);}else if(gpf.xml.NODE_ATTRIBUTE===Gd.type){zd(Fd,Bd,Gd,Hd);}}function Dd(Fd,Gd,Hd){var Id,Jd,Kd,Ld,Md;if(Gd.and){Jd=Gd.and;Kd=0;}else if(Gd.or){Jd=Gd.or;Kd=1;}for(Ld=0;Ld<Jd.length;++Ld){Md=Jd[Ld];if(Md.and||Md.or){Id=[];Dd(Fd,Md,Id);}else{Id=Ed(Fd,Md);}if(0===Kd&&Id.length===0){return;}if(1===Kd&&Id.length!==0){Hd.push(Fd);return;}}if(0===Kd){Hd.push(Fd);}}function Ed(Fd,Gd){var Hd,Id=[Fd];while(Gd){Hd=[];Cd(Id,Gd,Hd);if(0===Hd.length){return[];}Id=Hd;if(Gd.filter){Hd=[];zd(Id,Dd,Gd.filter,Hd);if(0===Hd.length){return[];}Id=Hd;}Gd=Gd.then;}return Hd;}gpf.define("gpf.xml.XPath",{_xpath:null,constructor:function(Fd){this._reset();if("string"===typeof Fd){this._xpath=this._compile(Fd);}else{this._xpath=Fd;}},_reset:function(){},_compile:function(Fd){gpf.interfaces.ignoreParameter(Fd);this._xpath=null;},selectNodes:function(Fd){return Ed(Fd,this._xpath);}});}));