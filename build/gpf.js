(function(e,w){"function"===typeof define&&define.amd?define(["exports"],w):"undefined"!==typeof exports?w(exports):"undefined"!==typeof module&&module.exports?w(module.exports):w(e.gpf={})})(this,function(e){function w(a){var b=(new e.attributes.Map(this)).member("Class").filter(e.attributes.InterfaceImplementAttribute),c,d,f;for(c=0;c<b.getItemsCount();++c)if(d=b.getItem(c),f=d._builder,d._interfaceDefinition===a&&f)return"function"===typeof f?f(this):this[f]();return null}function ra(a){return function(){var b=
w.apply(this,arguments);null===b&&(b=a.apply(this,arguments));return b}}function sa(a){var b=-1;return{reset:function(){b=-1},moveNext:function(c){var d;++b;d=b<a.length;!d&&c&&F.apply(this,[Y,{},c]);return d},current:function(){return 0>b||b>=a.length?void 0:a[b]}}}function ta(a){var b=(new k.Map(a)).filter(k.EnumerableAttribute).members();return sa(a[b[0]])}var s,G=!1,t,A,x=function(a){return null===a||"object"!==typeof a?t:a},p=!1,l=!1,H,P,B=function(){};"undefined"!==typeof WScript?(s="wscript",
G=!0,t=function(){return this}.apply(null,[]),A=function(a){WScript.Quit(a)},t.console={log:function(a){WScript.Echo("    "+a)},info:function(a){WScript.Echo("[?] "+a)},warn:function(a){WScript.Echo("/!\\ "+a)},error:function(a){WScript.Echo("(X) "+a)}}):"undefined"!==typeof phantom&&phantom.version?(s="phantomjs",G="\\"===require("fs").separator,t=window,l=p=!0,A=phantom.exit):"undefined"!==typeof module&&module.exports?(s="nodejs",G="\\"===require("path").sep,t=global,p=!0,A=process.exit):("undefined"!==
typeof window?(s="browser",t=window,l=!0):(s="unknown",t=this),A=B);p&&(e.node={});e.web={};l&&(H=document,P=H.getElementsByTagName("head")[0]||H.documentElement);e.version=function(){return"0.1"};e.host=function(){return s};e.context=function(a,b){var c,d,f;if(void 0===a)return t;"string"===typeof a&&(a=a.split("."));c=a.length;d=0;"gpf"===a[0]?(f=e,++d):f=t;for(;f&&d<c;++d){var h=a[d],g=f[h];void 0===g&&!0===b&&(g=f[h]={});f=g}return f};e.loaded=function(a){a&&a();return!0};e.ASSERT=function(){};
var I=Array.prototype.slice;void 0===Array.prototype.every&&(Array.prototype.every=function(a,b){var c=this.length,d;for(d=0;d<c;++d)if(!a.apply(b,[this[d],d,this]))return!1;return!0});void 0===Array.prototype.forEach&&(Array.prototype.forEach=function(a,b){var c=this.length,d;for(d=0;d<c;++d)a.apply(b,[this[d],d,this])});void 0===Array.prototype.indexOf&&(Array.prototype.indexOf=function(a,b){var c,d=this.length;for(c=void 0!==b?b:0;c<d;){if(this[c]===a)return c;++c}return-1});void 0===Array.prototype.map&&
(Array.prototype.map=function(a,b){var c=this.length,d=Array(c),f;for(f=0;f<c;++f)d[f]=a.apply(b,[this[f],f,this]);return d});void 0===Function.prototype.bind&&(Function.prototype.bind=function(a){var b=this,c=I.apply(arguments,[1]);return function(){var d=I.apply(arguments,[0]);b.apply(a,c.concat(d))}});(function(){return"functionName"!==function(){}.name?!0:!1})()?function(){var a=RegExp("//.*$|/\\*.*\\*/","g");Function.prototype.compatibleName=function(){var b=""+this,c=b.indexOf("function"),d=
b.indexOf("(",c);return b.substr(c+9,d-c-9).replace(a,"").trim()}}():Function.prototype.compatibleName=function(){return this.name};e.setReadOnlyProperty=void 0===Object.defineProperty?function(a,b,c){a[b]=c;return a}:function(a,b,c){Object.defineProperty(a,b,{enumerable:!0,configurable:!1,writable:!1,value:c});return a};void 0===String.prototype.trim&&function(){var a=RegExp("^[\\s\ufeff\u00a0]+|[\\s\ufeff\u00a0]+$","g");String.prototype.trim=function(){return this.replace(a,"")}}();var Y="endOfData",
ua=e.setReadOnlyProperty,Z=Function,$=function(){return!1},v=function(a,b){var c;void 0===b&&(b=a,a=[]);e.ASSERT("string"===typeof b&&b.length,"Source expected (or use _gpfEmptyFunc)");if(0===a.length)return Z(b);c=[].concat(a);c.push(b);return Z.apply(null,c)},va="break case catch continue debugger default delete do else finally for function if in instanceof new return switch this throw try typeof var void while with".split(" ");e.events={};(function(){var a=e.events,b={EVENT_ERROR:"error",EVENT_READY:"ready",
EVENT_DATA:"data",EVENT_END_OF_DATA:Y,EVENT_CONTINUE:"continue",EVENT_STOP:"stop",EVENT_STOPPED:"stopped"},c;for(c in b)b.hasOwnProperty(c)&&ua(a,c,b[c])})();var Q=e.events.Event=function(a,b,c){e.setReadOnlyProperty(this,"type",a);e.setReadOnlyProperty(this,"scope",x(c));void 0!==b&&(this._params=b)},aa=0,ba=function(a,b){var c=a.scope;e.ASSERT(b,"Expected eventsHandler");"function"===typeof b._dispatchEvent?b._dispatchEvent(a):"function"===typeof b.apply?b.apply(c,[a]):(c=b[a.type],void 0===c&&
(c=b["*"]),void 0!==c&&c.apply(b.scope||b,[a]))},F=function(a,b,c){var d=x(this);a instanceof Q||(a=new e.events.Event(a,b,d));10<++aa?e.defer(ba,0,null,[a,c]):ba(a,c);--aa;return a},wa=function(a,b,c){var d=b.length,f=a.length-1;if(f!==d)for(a=I.apply(a,[0]),a[d]=a[f],--f,--d;d>f;)a[d]=b[d],--d;return c.apply(this,a)};Q.prototype={constructor:Q,type:"",scope:null,_params:{},get:function(a){return this._params[a]},fire:function(a){return e.events.fire(this,a)}};e.events.fire=function(){var a=this;
a===e.events&&(a=void 0);return wa.apply(a,[arguments,[0,{}],F])};var r=function(a,b){this.id=++r.id;this.src=a;this.eventsHandler=b;r.map[this.id]=this},xa=function(a){P.insertBefore(a,P.firstChild)},ca=function(a){F.apply(t,a)},q=function(a,b){var c=new r(a,b),d=H.createElement("script");d.language="javascript";d.src=a;d.id=c.id;d.onload=d.onreadystatechange=r.onLoad;d.onerror=r.onError;void 0!==d.async&&(d.async=!0);setTimeout(xa,0,d)};r.prototype={id:0,src:"",eventsHandler:null,clean:function(a){var b=
a.parentNode;a.onerror=a.onload=a.onreadystatechange=null;b&&b.removeChild(a);delete r.map[this.id]},check:function(a){var b=a.readyState;if(!b||-1<["loaded","complete"].indexOf(b))this.clean(a),setTimeout(ca,0,["ready",{url:this.src},this.eventsHandler])},failed:function(a){this.clean(a);setTimeout(ca,0,["error",{url:this.src},this.eventsHandler])}};r.id=0;r.map={};r.onLoad=function(){var a=r.map[this.id];a&&a.check(this)};r.onError=function(){var a=r.map[this.id];a&&a.failed(this)};l&&(e.web.include=
q);var da=function(a,b,c){var d,f=a.length,e;for(e=0;e<f;++e)if(d=b.apply(this,[e,a[e],f]),void 0!==d)return d;return c},ya=function(a,b){var c=a.length,d;for(d=0;d<c;++d)b.apply(this,[d,a[d],c])},ea=function(a,b){return void 0===b?Array.prototype.slice.call(a,0):0===a.length?void 0:-1===b?a[a.length-1]:-1>b||b>a.length-1?void 0:a[b]},fa=function(a,b,c){var d,f;for(f in a)if(a.hasOwnProperty(f)&&(d=b.apply(this,[f,a[f]]),void 0!==d))return d;return c},ga=function(a,b){for(var c in a)a.hasOwnProperty(c)&&
b.apply(this,[c,a[c]])},za=function(a,b){this[0][a]=b},Aa=function(a,b){var c=this[0],d=this[2];void 0!==c[a]?d(c,a,b):c[a]=b},Ba={"boolean":function(a,b,c){return"string"===b?"yes"===a||"true"===a?!0:0!==parseInt(a,10):"number"===b?0!==a:c},number:function(a,b,c){return"string"===b?parseFloat(a):c},string:function(a,b,c){e.interfaces.ignoreParameter(b);e.interfaces.ignoreParameter(c);return a instanceof Date?e.dateToComparableFormat(a):a.toString()},object:function(a,b,c){return c instanceof Date&&
"string"===b?e.dateFromComparableFormat(a):c}},ha=function(a,b){var c=a,d;for(d in b)b.hasOwnProperty(d)&&-1<c.indexOf(d)&&(c=c.split(d).join(b[d]));return c},Ca={javascript:{"\\":"\\\\",'"':'\\"',"\n":"\\n","\r":"\\r","\t":"\\t"},xml:{"&":"&amp;","<":"&lt;",">":"&gt;"},html:{"&":"&amp;","<":"&lt;",">":"&gt;","\u00e9":"&eacute;","\u00e8":"&egrave;","\u00ea":"&ecirc;","\u00e1":"&aacute;","\u00e0":"&agrave;"}},ia=function(a,b){var c=Ca[b];void 0!==c&&(a=ha(a,c),"javascript"===b&&(a='"'+a+'"'));return a},
J;J="browser"===s&&(window.HTMLCollection||window.NodeList)?function(a){return a instanceof Array||a instanceof window.HTMLCollection||a instanceof window.NodeList}:function(a){return a instanceof Array};e.isArrayLike=J;e.each=function(a,b,c){if(3>arguments.length)e.isArrayLike(a)?ya.apply(this,arguments):ga.apply(this,arguments);else return e.isArrayLike(a)?da.apply(this,arguments):fa.apply(this,arguments)};e.extend=function(a,b,c){var d;void 0===c?d=za:(e.ASSERT("function"===typeof c,"Expected function"),
d=Aa);ga.apply(arguments,[b,d]);return a};e.extend(e,{value:function(a,b,c){var d=typeof a;c||(c=typeof b);return c===d?a:"undefined"!==d&&a?Ba[c](a,d,b):b},clone:function(a){return e.json.parse(e.json.stringify(a))},test:function(a,b){var c;if(a instanceof Array)for(c=a.length;0<c;){if(a[--c]===b)return c}else for(c in a)if(a.hasOwnProperty(c)&&a[c]===b)return c},set:function(a,b){e.ASSERT(a instanceof Array,"gpf.set must be used with an Array");for(var c=a.length;0<c;)if(a[--c]===b)return a;a.push(b);
return a},clear:function(a,b){var c;if(a instanceof Array)for(c=a.length;0<c;){if(a[--c]===b){a.splice(c,1);break}}else for(c in a)if(a.hasOwnProperty(c)&&a[c]===b)break;return a},xor:function(a,b){return a&&!b||!a&&b},exit:function(a){void 0===a&&(a=0);A(a)}});p&&(e.node.buffer2JsArray=function(a){var b=[],c=a.length,d;for(d=0;d<c;++d)b.push(a.readUInt8(d));return b});var ja=function(a){this._pending=[];this._done=[];!0!==a?this._alike=$:this._haveDifferentPrototypes=$};ja.prototype={_pending:[],
_done:[],_stack:function(a,b){var c=this._done,d,f;for(d=c.indexOf(a);-1<d;){f=d%2?c[d-1]:c[d+1];if(f===b)return;d=c.indexOf(a,d+1)}c=this._pending;c.push(a);c.push(b)},_haveDifferentPrototypes:function(a,b){return a.prototype!==b.prototype},explore:function(){for(var a=this._pending,b,c,d=this._done,f,e;0!==a.length;){c=a.pop();b=a.pop();if(this._haveDifferentPrototypes(b,c))return!1;d.push(b,c);f=0;for(e in b)if(b.hasOwnProperty(e)&&(++f,!this.like(b,c)))return!1;for(e in c)c.hasOwnProperty(e)&&
--f;if(0!==f)return!1}return!0},_downcast:function(a){if("object"===typeof a){if(a instanceof String)return a.toString();if(a instanceof Number)return a.valueOf();if(a instanceof Boolean)return!!a}return a},_alike:function(a,b){return this._downcast(a)===this._downcast(b)},like:function(a,b){if(a===b)return!0;if(typeof a!==typeof b)return this._alike(a,b);if(null===a||null===b||"object"!==typeof a)return!1;this._stack(a,b);return!0}};e.like=function(a,b,c){c=new ja(c);return c.like(a,b)&&c.explore()};
e.Callback=function(a,b){e.ASSERT(a,"Handler expected");this._handler=a;b&&(this._scope=x(b))};e.extend(e.Callback.prototype,{_handler:B,_scope:null,handler:function(){return this._handler},scope:function(){return this._scope},call:function(){return this.apply(arguments[0],I.apply(arguments,[1]))},apply:function(a,b){var c=x(a||this._scope);return this._handler.apply(c,b||[])}});e.extend(e.Callback,{resolveScope:x,buildParamArray:function(a,b){var c,d,f;if(b)for(c=b.length,d=Array(a+c),f=0;f<c;++f)d[a]=
b[f],++a;else d=Array(a);return d},doApply:function(a,b,c){for(var d=arguments.length,f=3,e=0;f<d;)c[e]=arguments[f],++f,++e;return a.apply(b,c)},bind:function(a,b,c){e.ASSERT("string"===typeof b,"Expected method name");e.ASSERT("function"===typeof a[b],"Only methods can be bound");var d=b+":boundToThis",f;f=a[d];void 0===f&&(f=!0===c?function(){return a[b].apply(a,arguments)}:a[b].bind(a),a[d]=f);return f}});e.events.EventDispatcherImpl={_eventDispatcherListeners:null,addEventListener:function(a,
b,c){var d=this._eventDispatcherListeners;d||(d=this._eventDispatcherListeners={});c||(c=!1);void 0===d[a]&&(d[a]=[]);c?d[a].unshift(b):d[a].push(b);return this},removeEventListener:function(a,b){var c=this._eventDispatcherListeners,d;c&&(c=c[a],void 0!==c&&(d=c.indexOf(b),-1!==d&&c.splice(d,1)));return this},_dispatchEvent:function(a,b){var c,d,f,h;if(!this._eventDispatcherListeners)return this;a instanceof e.events.Event?(c=a,d=a.type):d=a;f=this._eventDispatcherListeners[d];if(void 0===f)return this;
c||(c=new e.events.Event(d,b,this));d=f.length;for(h=0;h<d;++h)e.events.fire.apply(this,[c,f[h]]);return this}};var Da={application:{javascript:"js"},image:{gif:0,jpeg:"jpg,jpeg",png:0},text:{css:0,html:"htm,html",plain:"txt,text,log"}},y=null,C=null,ka=function(a,b){var c,d,f,e,g,n;for(c in b)if(b.hasOwnProperty(c))if(d=a?a+"/"+c:c,e=b[c],0===e)f="."+c,C[f]=d,void 0===y[d]&&(y[d]=f);else if("string"===typeof e)for(e=e.split(","),g=e.length,n=0;n<g;++n)f="."+e[n],C[f]=d,void 0===y[d]&&(y[d]=f);else ka(d,
e)},la=function(){null===C&&(C={},y={},ka("",Da))};e.web.getMimeType=function(a){la();a=C[a.toLowerCase()];void 0===a&&(a="application/octet-stream");return a};e.web.getFileExtension=function(a){la();a=y[a.toLowerCase()];void 0===a&&(a=".bin");return a};"use strict";var D=function(a,b,c){"string"===typeof a&&(a=v(a));J(c)||(c=[]);return function(){a.apply(x(b),c)}},K=[],Ea=function(a,b){return a._dt-b._dt};e.runAsyncQueue=B;"browser"===s?(D=function(a){a[0].apply(x(a[1]),a[2])},p=function(a,b,c,d){"string"===
typeof a&&(a=v(a));b||(b=0);setTimeout(D,b,[a,c,d])}):"undefined"!==typeof setTimeout?p=function(a,b,c,d){b||(b=0);setTimeout(D(a,c,d),b)}:"wscript"===s?(p=function(a,b,c,d){a=D(a,c,d);b||(b=0);a._dt=new Date(new Date- -b);K.push(a);K.sort(Ea)},e.runAsyncQueue=function(){for(var a;K.length;)a=K.shift(),a._dt>new Date&&WScript.Sleep(a._dt-new Date),a()}):(console.warn("No implementation for gpf.defer"),p=function(a,b,c,d){D(a,c,d)()});e.defer=p;var R=function(a,b,c,d){var f=a.length,h=e.bin.isPow2(f),
g,n=[],k;if(-1<h&&(void 0===c||32>=c*h))for(g=(1<<(void 0===c?32:c*h)-h)-1,f=(1<<h)-1;0!==b;)k=b&f,n.unshift(a.charAt(k)),b=b>>h&g;else for(;0!==b;)k=b%f,n.unshift(a.charAt(k)),b=(b-k)/f;if(void 0!==c)for(void 0===d&&(d=a.charAt(0));n.length<c;)n.unshift(d.charAt(n.length%d.length));else 0===n.length&&(n=[a.charAt(0)]);return n.join("")},S=function(a,b,c){var d=a.length,f=0,e=0;for(void 0===c&&(c=a.charAt(0));e<b.length&&-1!==c.indexOf(b.charAt(e));)++e;for(;e<b.length;)f=d*f+a.indexOf(b.charAt(e++));
return f};e.bin={pow2:function(a){return 1<<a},isPow2:function(a){if(0<a&&0===(a&a-1)){for(var b=0;1<a;)++b,a>>=1;return b}return-1},toBaseANY:R,fromBaseANY:S,toHexa:function(a,b,c){return R("0123456789ABCDEF",a,b,c)},fromHexa:function(a,b){return S("0123456789ABCDEF",a,b)},toBase64:function(a,b,c){return R("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",a,b,c)},fromBase64:function(a,b){return S("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",a,b)},test:function(a,
b){return(a&b)===b},clear:function(a,b){return a&~b}};var L;"undefined"===typeof JSON?(L=function(a){var b=typeof a;if("undefined"!==b&&"function"!==b){if("number"===b||"boolean"===b)return a.toString();if("string"===b)return ia(a,"javascript");if(null===a)return"null";var c,d,f,b=a instanceof Array;c=[];for(d in a)"function"!==typeof a[d]&&(f=L(a[d]),b?c.push(f):c.push(ia(d,"javascript")+":"+f));a=b?"["+c.join(",")+"]":"{"+c.join(",")+"}";return a}},p=function(a){return v("return "+a)()}):(L=JSON.stringify,
p=JSON.parse);e.json={stringify:L,parse:p,load:function(a,b){var c=a.constructor.prototype,d=new k.Map(a),f,e;for(f in c)"function"===typeof c[f]||d.member(f).has(T)||(e=0===f.indexOf("_")?f.substr(1):f,a[f]=e in b?b[e]:c[f]);return a},save:function(a){var b={},c=a.constructor.prototype,d=new k.Map(a),f,e,g;for(f in c)"function"===typeof c[f]||d.member(f).has(T)||(e=0===f.indexOf("_")?f.substr(1):f,g=a[f],g!==c[f]&&(b[e]=g));return b}};var U=function(a){return a.split("*")},M=function(a){"!"===a.charAt(0)&&
(this.negative=!0,a=a.substr(1));var b=a.indexOf("**");-1===b?this.start=a.split("/").map(U):(0<b&&(e.ASSERT("/"===a.charAt(b-1),"** must be preceded by /"),this.start=a.substr(0,b-1).split("/").map(U)),b<a.length-2&&(e.ASSERT("/"===a.charAt(b+2),"** must be followed by /"),this.end=a.substr(b+3).split("/").map(U).reverse()))},ma=function(a){return a instanceof M?a:new M(a)},na=function(a){return a instanceof Array?a.map(ma):[ma(a)]},Fa=function(a){var b=a.negative;return a.match(this.parts)?(this.result=
!b,!1):b?(this.result=!0,!1):!0};M.prototype={constructor:M,negative:!1,start:null,end:null,_matchName:function(a,b){var c=a.length,d,f,e=0;for(d=0;d<c;++d)if(f=a[d])if(e=b.indexOf(f,e),-1===e||0===d&&0<e)return!1;return!f||e+f.length===b.length},match:function(a){var b=a.length,c=0,d=b-1,f,e,g;if(this.start)for(f=this.start,e=f.length,g=0;g<e;++g)if(this._matchName(f[g],a[c])){if(++c>=b)return g===e-1&&!this.end}else return!1;if(this.end)for(f=this.end,e=f.length,g=0;g<e;++g)if(-1<d&&this._matchName(f[g],
a[d])){if(d--<c)return!1}else return!1;return!0}};e.path={match:function(a,b){var c=b;G&&(c=c.toLowerCase().split("\\").join("/"));var d=c.split("/"),c=na(a),d={parts:d};c.every(Fa,d);return d.result||!1},compileMatchPattern:function(a){return na(a)}};var l=e.Error=function(){},Ga=function(a,b,c){var d=function(d){var h=new e.Error,g,n;e.setReadOnlyProperty(h,"code",a);e.setReadOnlyProperty(h,"name",b);if(d){g={};for(n in d)d.hasOwnProperty(n)&&(g["{"+n+"}"]=d[n].toString());d=ha(c,g)}else d=c;e.setReadOnlyProperty(h,
"message",d);return h};e.setReadOnlyProperty(d,"CODE",a);e.setReadOnlyProperty(d,"NAME",b);e.setReadOnlyProperty(d,"MESSAGE",c);return d},Ha=0,p=function(a,b){var c,d;for(c in b)b.hasOwnProperty(c)&&(d=++Ha,e.Error["CODE_"+c.toUpperCase()]=d,e.Error[c]=Ga(d,c,b[c]))};l.prototype={constructor:l,code:0,name:"Error",message:""};p("boot",{NotImplemented:"Not implemented",Abstract:"Abstract",AssertionFailed:"Assertion failed: {message}"});e.js={keywords:function(){return[].concat(va)}};p("csv",{CsvInvalid:"Invalid CSV syntax (bad quote sequence or missing end of file)"});
var oa=function(a,b){for(var c=a.indexOf(b),d=!0;-1<c;){if(c===a.length-1){a=a.substr(0,c);d=!1;break}else if(a.charAt(c+1)===b)a=a.substr(0,c)+a.substr(c+1);else throw e.Error.CsvInvalid();c=a.indexOf(b,c+1)}return[a,d]},Ia=function(a){var b=a.length-1;return"\r"===a.charAt(b)?a.substr(0,b):a};e.csv={parse:function(a,b){b=b||{};var c=a.split("\n").map(Ia),d=b.header||c.shift(),f;if(!(f=b.separator))a:{f=d;var h,g;for(h=0;4>h;++h)if(g=";,\t ".charAt(h),-1!==f.indexOf(g)){f=g;break a}f=";"}h=f;var n,
k,l;g=[];d=d.split(h);for(f=d.length;c.length;){a:{n=c;k=h;l=b.quote||'"';for(var p=[],m=void 0,r=!1,t=void 0,q=void 0,u=void 0,s=void 0,u=void 0;n.length;){m=n.shift();m=m.split(k);r?(t=!0,m.unshift(p.pop()),q=1):(q=0,t=!1);for(;q<m.length;)u=m[q],r?(s=[m[q-1]],t?s.push("\r\n"):s.push(k),u=oa(u,l),s.push(u[0]),r=u[1],m[q-1]=s.join(""),t=!1,m.splice(q,1)):(0===u.indexOf(l)&&(u=oa(u.substr(1),l),m[q]=u[0],r=u[1]),++q);p=p.concat(m);if(r){if(0===n.length)throw e.Error.CsvInvalid();}else{n=p;break a}}n=
void 0}k={};for(l=0;l<f;++l)k[d[l]]=n[l];g.push(k)}return g}};var V=["public","protected","private","static"],W=!0,Ja=0,Ka=function(){var a=arguments,b=function(){a[0].apply(this,[b,arguments])};return b},La=function(a,b){return function(){var c=this._super,d;this._super=a;try{d=b.apply(this,arguments)}finally{void 0===c?delete this._super:this._super=c}return d}},q=function(a,b){a+=".";return function(c,d,f){void 0===f&&"object"===typeof d?(f=d,d=a+b):void 0===d&&(d=a+b);-1===c.indexOf(".")&&(c=
a+c);return e.define(c,d,f)}},pa={},N=function(a,b,c){this._uid=++Ja;pa[this._uid]=this;this._Subs=[];"function"===typeof a?(this._name="anonymous",this._Constructor=a):(this._name=a,this._Super=b,this._definition=c,this._build())},m=function(a){var b;b=a._gpf;void 0===b?(b=new N(a),e.setReadOnlyProperty(a,"_gpf",b.uid())):b=pa[b];return b},Ma=function(a,b){if(W){var c=m(a);c._defConstructor?c._defConstructor.apply(this,b):c._Super.apply(this,b)}};N.prototype={constructor:N,_uid:0,uid:function(){return this._uid},
_name:"",name:function(){return this._name},nameOnly:function(){var a=this._name,b=a.lastIndexOf(".");return-1===b?a:a.substr(b+1)},_Super:Object,Super:function(){return this._Super},_Subs:[],Subs:function(){return this._Subs},_attributes:null,attributes:function(){this._attributes||(this._attributes=new e.attributes.Map);return this._attributes},_Constructor:function(){},_defConstructor:null,Constructor:function(){return this._Constructor},_definition:null,addMember:function(a,b,c){var d=this._Constructor.prototype;
e.ASSERT("constructor"!==a,"No constructor can be added");e.ASSERT(void 0===d[a],"No member can be overridden");void 0===c?c=0:"string"===typeof c&&(c=V.indexOf(c),-1===c&&(c=0));this._addMember(a,b,c)},_addMember:function(a,b,c){var d=this._Constructor.prototype;3===c?e.setReadOnlyProperty(d.constructor,a,b):d[a]=b},_processMember:function(a,b){var c=this._definition[a],d="constructor"===a,f,h,g;f=typeof c;if(3===b)this._addMember(a,c,3);else{h=d?this._Super:this._Super.prototype[a];g=typeof h;if("undefined"!==
g&&null!==h&&f!==g)throw e.Error.ClassMemberOverloadWithTypeChange();if(f="function"===f){if(g="undefined"!==g)a:{var k;g=c.toString().split("._super");f=g.length;for(k=1;k<f;++k)if(-1==="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789_$".indexOf(g[k].charAt(0))){g=!0;break a}g=!1}f=g}f&&(c=La(h,c));d?this._defConstructor=c:this._addMember(a,c,b)}},_processAttribute:function(a){var b,c=this._definition[a];a=a.substr(1,a.length-2);this._attributes||(this._attributes={});b=this._attributes[a];
void 0===b&&(b=[]);this._attributes[a]=b.concat(c)},_processDefWithVisibility:function(a){var b=this._definition,c,d;d=V[a];this._definition=c=b[d];try{for(d in c)if(c.hasOwnProperty(d))if("["===d.charAt(0)&&"]"===d.charAt(d.length-1))this._processAttribute(d);else{if("public"===d||"private"===d||"protected"===d||"static"===d)throw e.Error.ClassInvalidVisibility();this._processMember(d,a)}"wscript"===e.host()&&c.constructor!==Object&&this._processMember("constructor",a)}finally{this._definition=b}},
_processDefinition:function(){var a=this._definition,b,c;for(b in a)a.hasOwnProperty(b)&&("["===b.charAt(0)&&"]"===b.charAt(b.length-1)?this._processAttribute(b):(c=V.indexOf(b),-1===c?(c="_"===b.charAt(0)?1:0,this._processMember(b,c)):this._processDefWithVisibility(c)));"wscript"===e.host()&&a.constructor!==Object&&this._processMember("constructor",0)},_processAttributes:function(){var a=this._attributes,b,c,d;if(a)for(d in delete this._attributes,b=this._Constructor,c=b.prototype,a)a.hasOwnProperty(d)&&
(d in c||"Class"===d?e.attributes.add(b,d,a[d]):console.error("gpf.define: Invalid attribute name '"+d+"'"))},_build:function(){var a,b;a=this._name;a=a.substr(a.lastIndexOf(".")+1);b=Ka.toString();var c,d;c=b.indexOf("{")+1;d=b.lastIndexOf("}")-1;b=b.substr(c,d-c+1);a=b.replace("function","function "+a);this._Constructor=a=v(a)(Ma);e.setReadOnlyProperty(a,"_gpf",this._uid);W=!1;b=new this._Super;W=!0;a.prototype=b;b.constructor=a;m(this._Super).Subs().push(a);this._processDefinition();this._processAttributes()}};
e.define=function(a,b,c){var d,f;"string"===typeof b?b=e.context(b):"object"===typeof b&&(c=b,b=void 0);void 0===b&&(b=Object);-1<a.indexOf(".")&&(d=a.split("."),f=d.pop(),d=e.context(d,!0));a=(new N(a,b,c||{})).Constructor();void 0!==d&&(d[f]=a);return a};var k=e.attributes={},X=0,qa=function(a,b){b="$"+b;e[b]=function(){var c=v("return function "+b+"(args) {this.constructor.apply(this, args);};")();c.prototype=a.prototype;return function(){return new c(arguments)}}()},Na=q("gpf.attributes","Attribute"),
l=function(a,b,c){var d="$"===a.charAt(0),e;d?(a=a.substr(1),e=a+"Attribute"):e=a;b=Na(e,b,c);d&&qa(b,a);return b};l("Attribute",{"protected":{_member:"",_alterPrototype:function(a){}},"public":{member:function(){return this._member}}});l("$Alias",{"private":{_name:""},"protected":{_alterPrototype:function(a){qa(a.constructor,this._name)}},"public":{constructor:function(a){this._name=a}}});e.define("gpf.attributes.Array",{"private":{_array:[]},"public":{constructor:function(){this._array=[]},getItemsCount:function(){return this._array.length},
getItem:function(a){return ea(this._array,a)},has:function(a){e.ASSERT("function"===typeof a,"Expected a class parameter");e.ASSERT(a.prototype instanceof k.Attribute,"Expected an Attribute-like class parameter");var b,c=this._array,d=c.length,f;for(b=0;b<d;++b)if(f=c[b],f instanceof a)return f;return null},filter:function(a){e.ASSERT("function"===typeof a,"Expected a class parameter");e.ASSERT(a.prototype instanceof k.Attribute,"Expected an Attribute-like class parameter");var b,c=this._array,d=
c.length,f,h=new k.Array,g=h._array;for(b=0;b<d;++b)f=c[b],f instanceof a&&g.push(f);return h},each:function(a){return da(this._array,a,void 0)}}});e.define("gpf.attributes.Map",{"private":{_members:{},_count:0,_copyTo:function(a,b,c){var d=this._members,e,h,g,k;if(this._count)for(e in d)if(d.hasOwnProperty(e))for(h=d[e]._array,g=0;g<h.length;++g)k=h[g],b&&!b(e,k,c)||a.add(e,k)},_filterCallback:function(a,b,c){return b instanceof c}},"public":{constructor:function(a){this._members={};this._count=
0;a instanceof Function?(a=m(a),this.fillFromClassDef(a)):void 0!==a&&this.fillFromObject(a)},count:function(){return this._count},add:function(a,b){var c=this._members[a];void 0===c&&(c=this._members[a]=new k.Array);c._array.push(b);++this._count},fillFromObject:function(a){a=m(a.constructor);return this.fillFromClassDef(a)},fillFromClassDef:function(a){for(var b;a;)if((b=a.attributes())&&b._copyTo(this),a=a.Super(),a!==Object)a=m(a);else break;return this._count},filter:function(a){e.ASSERT("function"===
typeof a,"Expected a class parameter");e.ASSERT(a.prototype instanceof k.Attribute,"Expected an Attribute-like class parameter");var b=new k.Map;this._copyTo(b,this._filterCallback,a);return b},member:function(a){a=this._members[a];void 0!==a&&a instanceof k.Array||(0===X&&(X=new k.Array),a=X);return a},members:function(){var a=this._members,b=[],c;for(c in a)a.hasOwnProperty(c)&&b.push(c);return b},each:function(a){return fa(this._members,a,void 0)},addTo:function(a){var b=this._members,c;for(c in b)b.hasOwnProperty(c)&&
k.add(a,c,b[c])}}});k.add=function(a,b,c){c instanceof k.Array?c=c._array:c instanceof Array||(c=[c]);var d,f,h,g;d=m(a).attributes();f=c.length;for(h=0;h<f;++h)g=c[h],e.ASSERT(g instanceof k.Attribute,"Expected attribute"),g._member=b,d.add(b,g),g._alterPrototype(a.prototype)};p("a_attributes",{OnlyForAttributeClass:"The attribute {attributeName} can be used only on an Attribute class",OnlyOnClassForAttributeClass:"The attribute {attributeName} must be used on Class",ClassOnlyAttribute:"The attribute {attributeName} can be used only for Class",
MemberOnlyAttribute:"The attribute {attributeName} can be used only for members",UniqueAttributeConstraint:"Attribute {attributeName} already defined on {className}",UniqueMemberAttributeConstraint:"Attribute {attributeName} already defined on {className}::{memberName}"});var z=l("AttrClassOnlyAttribute",{"protected":{_alterPrototype:function(a){if(!(a instanceof k.Attribute))throw e.Error.OnlyForAttributeClass({attributeName:m(this.constructor).name()});if("Class"!==this._member)throw e.Error.OnlyOnClassForAttributeClass({attributeName:m(this.constructor).name()});
}}}),O=l("AttrConstraintAttribute",z,{"static":{originalAlterPrototype:"_alterPrototype:checked"},"private":{_checkAndAlterPrototype:function(a){var b=k.AttrConstraintAttribute.originalAlterPrototype,c=this;(new k.Map(this)).filter(O).each(function(b,e){var h=e.getItemsCount(),g;for(g=0;g<h;++g)e.getItem(g)._check(c,a)});c[b].apply(c,[a])}},"protected":{_check:function(a,b){throw e.Error.Abstract();},_alterPrototype:function(a){var b=k.AttrConstraintAttribute.originalAlterPrototype;this._super(a);
void 0===a[b]&&(a[b]=a._alterPrototype,a._alterPrototype=this._checkAndAlterPrototype)}}});l("$ClassAttribute",O,{"protected":{_check:function(a){if("Class"!==a.member())throw a=m(a.constructor),e.Error.ClassOnlyAttribute({attributeName:a.name()});}}});l("$MemberAttribute",O,{"protected":{_check:function(a){if("Class"===a.member())throw a=m(a.constructor),e.Error.MemberOnlyAttribute({attributeName:a.name()});}}});l("$UniqueAttribute",O,{"private":{_classScope:!0},"protected":{_check:function(a,b){var c,
d,f,h,g=a.member();c=b.constructor;d=m(c);f=new k.Map(c);h=a.constructor;c=m(h);f=f.filter(h);if(this._classScope){if(1<f.count())throw e.Error.UniqueAttributeConstraint({attributeName:c.name(),className:d.name()});}else if(1<f.member(g).getItemsCount())throw e.Error.UniqueMemberAttributeConstraint({attributeName:c.name(),className:d.name(),memberName:g});}},"public":{constructor:function(a){void 0!==a&&(this._classScope=!0===a)}}});var Oa=function(){return this._MEMBER_},Pa=function(){var a=this._MEMBER_;
0<arguments.length&&(this._MEMBER_=arguments[0]);return a},z=l("ClassAttribute"),T;l("$ClassProperty",z,{"[Class]":[e.$MemberAttribute(),e.$UniqueAttribute(!1)],"private":{_writeAllowed:!1,_publicName:void 0,_visibility:void 0},"protected":{_alterPrototype:function(a){var b=this._member,c=this._publicName;a=m(a.constructor);var d,e,h;c||(c=b.substr(1));this._writeAllowed?(d=["value"],e=Pa.toString()):(d=[],e=Oa.toString());e=e.split("_MEMBER_").join(b);b=e.indexOf("{")+1;h=e.lastIndexOf("}")-1;e=
e.substr(b,h-b+1);a.addMember(c,v(d,e),this._visibility)}},"public":{constructor:function(a,b,c){a&&(this._writeAllowed=!0);"string"===typeof b&&(this._publicName=b);"string"===typeof c&&(this._visibility=c)}}});l("$ClassEventHandler",z,{"[Class]":[e.$MemberAttribute(),e.$UniqueAttribute(!1)]});T=l("$ClassNonSerialized",z,{"[Class]":[e.$MemberAttribute(),e.$UniqueAttribute(!1)]});l("$ClassExtension",z,{"private":{_ofClass:B,_publicName:""},"public":{constructor:function(a,b){this._ofClass=a;"string"===
typeof b&&(this._publicName=b)}}});p("interfaces",{InterfaceExpected:"Expected interface not implemented: {name}"});var E=e.interfaces={isImplementedBy:function(a,b){var c,d,e,h;a instanceof Function&&(a=a.prototype);for(c in b.prototype)if("constructor"!==c&&"extend"!==c&&(d=b.prototype[c],e=a[c],h=typeof e,typeof d!==h||"function"===h&&d.length!==e.length))return!1;return!0},query:function(a,b,c){var d=null;if(e.interfaces.isImplementedBy(a,b))return a;e.interfaces.isImplementedBy(a,e.interfaces.IUnknown)&&
(d=a.queryInterface(b));void 0===c&&(c=!0);if(null===d&&c)throw e.Error.InterfaceExpected({name:m(b).name()});return d}},q=q("gpf.interfaces","Interface");q("Interface");q("IEventDispatcher",{addEventListener:function(a,b,c){return this},removeEventListener:function(a,b){return this}});q("IUnknown",{queryInterface:function(a){return null}});l("$InterfaceImplement",{"private":{"[_interfaceDefinition]":[e.$ClassProperty(!1,"which")],_interfaceDefinition:B,"[_builder]":[e.$ClassProperty(!1,"how")],_builder:null},
"protected":{_alterPrototype:function(a){var b=this._interfaceDefinition.prototype,c=m(this._interfaceDefinition),d,f;f=new e.attributes.Map;f.fillFromClassDef(c);f.addTo(a.constructor);if(this._builder)void 0!==a.queryInterface?w!==a.queryInterface&&(a.queryInterface=ra(a.queryInterface)):(a.queryInterface=w,e.attributes.add(a.constructor,"Class",[e.$InterfaceImplement(e.interfaces.IUnknown)]));else for(d in b)d in a||(a[d]=b[d])}},"public":{constructor:function(a,b){this._interfaceDefinition=a;
b&&(this._builder=b)}}});p("i_enumerator",{EnumerableInvalidMember:"$Enumerator can be associated to arrays only"});q("IEnumerator",{reset:function(){},"[moveNext]":[e.$ClassEventHandler()],moveNext:function(a){return!1},current:function(){return null},"static":{each:function(a,b,c){var d=E.query(a,E.IEnumerator),f=function(b){F.apply(a,[b,{},c])},h;if(1<b.length)h=function(a){if(e.events.EVENT_CONTINUE===a.type){if(!d.moveNext(h))return}else{if(e.events.EVENT_STOP===a.type)return f(e.events.EVENT_STOPPED);
if(e.events.EVENT_DATA!==a.type)return f(a.type)}b(d.current(),h)},d.moveNext(h)&&b(d.current(),h);else for(h=function(a){if(e.events.EVENT_DATA!==a.type)return f(a.type);do b(d.current());while(d.moveNext(h))};d.moveNext(h);)b(d.current())}}});l("$Enumerable",k.ClassAttribute,{Class:[e.$UniqueAttribute(),e.$MemberAttribute()],_alterPrototype:function(a){if(!J(a[this._member]))throw e.Error.EnumerableInvalidMember();k.add(a.constructor,"Class",[new k.InterfaceImplementAttribute(E.IEnumerator,ta)])}});
q("IReadOnlyArray",{getItemsCount:function(){return 0},getItem:function(a){}});l("$ClassIArray",k.ClassAttribute,{Class:[e.$UniqueAttribute(),e.$MemberAttribute()],"private":{_writeAllowed:!1},"protected":{_alterPrototype:function(a){k.add(a.constructor,"Class",[e.$InterfaceImplement(this._writeAllowed?E.IArray:E.IReadOnlyArray)]);a.getItemsCount=v("return this."+this._member+".length;");a.getItem=v(["_gpfArrayOrItem"],"return function (idx) { return _gpfArrayOrItem(this. "+this._member+", idx); }")(ea);
this._writeAllowed&&(a.setItem=v("var i=arguments[0],v=this."+this._name+"[i];this."+this._member+"[i]=arguments[1];return v;"))}},"public":{constructor:function(a){if(a)throw e.Error.NotImplemented();}}});k.add(k.Array,"_array",[e.$ClassIArray(!1)])});
